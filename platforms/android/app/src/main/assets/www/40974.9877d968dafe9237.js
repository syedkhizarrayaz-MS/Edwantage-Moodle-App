"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[40974],{2401:(e,t,r)=>{r.d(t,{R:()=>CoreListItemsManager});var i=r(10467),n=r(21182),a=r(15324),s=r(93417),o=r(81690),c=r(95990),l=r(82907),_=r(24742),p=r(55554);class CoreListItemsManager extends c.u{constructor(e,t){super(e);const r=o.j.debounce((()=>this.scrollToCurrentElement()),300);this.pageRouteLocator=t,this.addListener({onSelectedItemUpdated:r}),this.finishSuccessfulFetch=_.j.once((()=>p.g.ignoreErrors(this.logActivity())))}get items(){return this.getSource().getItems()||[]}get loaded(){return null!==this.itemsMap}get completed(){return this.getSource().isCompleted()}get empty(){const e=this.getSource().getItems();return null===e||0===e.length}start(e){var t=this;return(0,i.A)((function*(){e&&t.watchSplitViewOutlet(e),t.updateSelectedItem()}))()}destroy(){var e;super.destroy(),null===(e=this.splitViewOutletSubscription)||void 0===e||e.unsubscribe()}watchSplitViewOutlet(e){var t;this.splitView=e,this.splitViewOutletSubscription=e.outletRouteObservable.subscribe((e=>this.updateSelectedItem(this.getPageRouteFromSplitViewOutlet(e)))),this.updateSelectedItem(null!==(t=this.getPageRouteFromSplitViewOutlet(e.outletRoute))&&void 0!==t?t:null)}isSelected(e){return this.selectedItem===e}getItemAriaCurrent(e){return this.isSelected(e)?"page":"false"}select(e){var t=this;return(0,i.A)((function*(){if(!e)return yield t.navigateToIndex({reset:t.resetNavigation()}),void 0;yield t.navigateToItem(e,{reset:t.resetNavigation()})}))()}reset(){this.getSource().reset()}reload(){var e=this;return(0,i.A)((function*(){yield e.getSource().reload(),e.finishSuccessfulFetch()}))()}load(){var e=this;return(0,i.A)((function*(){yield e.getSource().load(),e.finishSuccessfulFetch()}))()}logActivity(){return(0,i.A)((function*(){}))()}resetNavigation(){var e;return!!s.CoreScreen.isTablet&&!(!this.splitView||null!==(e=this.splitView)&&void 0!==e&&e.isNested)}updateSelectedItem(e=null){super.updateSelectedItem(e);this.select(s.CoreScreen.isTablet&&null===this.selectedItem&&this.splitView&&!this.splitView.isNested?this.getDefaultItem():this.selectedItem)}scrollToCurrentElement(){var e=this;return(0,i.A)((function*(){var t,r,i;if(s.CoreScreen.isMobile)return;const n=(null!==(t=null===(r=e.splitView)||void 0===r?void 0:r.nativeElement)&&void 0!==t?t:document).querySelector('[aria-current="page"]');if(!n)return;l.y.isElementInViewport(n,1,null===(i=e.splitView)||void 0===i?void 0:i.nativeElement)||n.scrollIntoView({behavior:"smooth"})}))()}getDefaultItem(){return this.items[0]||null}getCurrentPageRoute(){return this.pageRouteLocator instanceof n.nX?a.CoreNavigator.isRouteActive(this.pageRouteLocator)?this.pageRouteLocator:null:a.CoreNavigator.getCurrentRoute({pageComponent:this.pageRouteLocator})}getSelectedItemPathFromRoute(e){const t=[];for(;e.firstChild;)t.push(...a.CoreNavigator.getRouteUrl(e=e.firstChild));return t.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}getPageRouteFromSplitViewOutlet(e){const t=this.buildRouteMatcher();for(;e&&!t(e);)e=e.parent;return e}buildRouteMatcher(){if(this.pageRouteLocator instanceof n.nX){const e=a.CoreNavigator.getRouteFullPath(this.pageRouteLocator);return t=>a.CoreNavigator.getRouteFullPath(t)===e}return e=>e.component===this.pageRouteLocator}}},40974:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var i=r(10467),n=r(15324),a=r(2401),s=r(29492),o=r(98870),c=r(55554),l=r(32379),_=r(83696),p=r(22693),u=r(79555),g=r(44426),h=r(25572),m=r(86654),d=r(75357),f=r(54438),P=r(60177),C=r(2910),I=r(16986),b=r(66198),v=r(64422),R=r(16658),y=r(58197),T=r(88246),S=r(73955),U=r(93453);function CoreUserParticipantsPage_core_empty_box_7_Template(e,t){1&e&&(f.nrm(0,"core-empty-box",8),f.nI1(1,"translate")),2&e&&f.Y8G("message",f.bMT(1,1,"core.user.noparticipants"))}function CoreUserParticipantsPage_core_empty_box_8_Template(e,t){if(1&e&&(f.nrm(0,"core-empty-box",9),f.nI1(1,"translate")),2&e){const e=f.XpG();f.Y8G("message",f.bMT(1,2,"core.noresults")),f.BMQ("role",e.searchQuery?"alert":null)}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_ng_container_4_Template(e,t){if(1&e&&(f.qex(0),f.EFF(1),f.nI1(2,"coreTimeAgo"),f.bVm()),2&e){const e=f.XpG(3).$implicit;f.R7$(),f.SpI("",f.bMT(2,1,e.lastcourseaccess)," ")}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_ng_container_5_Template(e,t){1&e&&(f.qex(0),f.EFF(1),f.nI1(2,"translate"),f.bVm()),2&e&&(f.R7$(),f.JRh(f.bMT(2,1,"core.never")))}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_Template(e,t){if(1&e&&(f.j41(0,"p")(1,"strong"),f.EFF(2),f.nI1(3,"translate"),f.k0s(),f.DNE(4,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_ng_container_4_Template,3,3,"ng-container",6)(5,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_ng_container_5_Template,3,3,"ng-container",6),f.k0s()),2&e){const e=f.XpG(2).$implicit;f.R7$(2),f.SpI("",f.bMT(3,3,"core.user.lastcourseaccess"),": "),f.R7$(2),f.Y8G("ngIf",e.lastcourseaccess),f.R7$(),f.Y8G("ngIf",!e.lastcourseaccess)}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_ng_container_4_Template(e,t){if(1&e&&(f.qex(0),f.EFF(1),f.nI1(2,"coreTimeAgo"),f.bVm()),2&e){const e=f.XpG(3).$implicit;f.R7$(),f.JRh(f.bMT(2,1,e.lastaccess))}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_ng_container_5_Template(e,t){1&e&&(f.qex(0),f.EFF(1),f.nI1(2,"translate"),f.bVm()),2&e&&(f.R7$(),f.JRh(f.bMT(2,1,"core.never")))}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_Template(e,t){if(1&e&&(f.j41(0,"p")(1,"strong"),f.EFF(2),f.nI1(3,"translate"),f.k0s(),f.DNE(4,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_ng_container_4_Template,3,3,"ng-container",6)(5,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_ng_container_5_Template,3,3,"ng-container",6),f.k0s()),2&e){const e=f.XpG(2).$implicit;f.R7$(2),f.SpI("",f.bMT(3,3,"core.lastaccess"),": "),f.R7$(2),f.Y8G("ngIf",e.lastaccess),f.R7$(),f.Y8G("ngIf",!e.lastaccess)}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_Template(e,t){if(1&e&&(f.qex(0),f.j41(1,"p",13),f.EFF(2),f.k0s(),f.DNE(3,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_Template,6,5,"p",6)(4,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_Template,6,5,"p",6),f.bVm()),2&e){const e=f.XpG().$implicit;f.R7$(2),f.JRh(e.fullname),f.R7$(),f.Y8G("ngIf",void 0!==e.lastcourseaccess),f.R7$(),f.Y8G("ngIf",void 0===e.lastcourseaccess&&void 0!==e.lastaccess)}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_4_Template(e,t){if(1&e&&(f.qex(0),f.j41(1,"p",13),f.nrm(2,"core-format-text",14),f.k0s(),f.bVm()),2&e){const e=f.XpG().$implicit,t=f.XpG(2);f.R7$(2),f.Y8G("text",e.fullname)("highlight",t.searchQuery)("filter",!1)}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_Template(e,t){if(1&e){const e=f.RV6();f.j41(0,"ion-item",11),f.bIt("click",(function CoreUserParticipantsPage_ion_list_9_ion_item_1_Template_ion_item_click_0_listener(){const t=f.eBV(e).$implicit,r=f.XpG(2);return f.Njj(r.participants.select(t))})),f.nrm(1,"core-user-avatar",12),f.j41(2,"ion-label"),f.DNE(3,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_Template,5,3,"ng-container",6)(4,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_4_Template,3,3,"ng-container",6),f.k0s()()}if(2&e){const e=t.$implicit,r=f.XpG(2);f.Y8G("detail",!0),f.BMQ("aria-current",r.participants.getItemAriaCurrent(e))("aria-label",e.fullname),f.R7$(),f.Y8G("user",e)("linkProfile",!1)("checkOnline",!0),f.R7$(2),f.Y8G("ngIf",!r.searchQuery),f.R7$(),f.Y8G("ngIf",r.searchQuery)}}function CoreUserParticipantsPage_ion_list_9_Template(e,t){if(1&e&&(f.j41(0,"ion-list"),f.DNE(1,CoreUserParticipantsPage_ion_list_9_ion_item_1_Template,5,8,"ion-item",10),f.k0s()),2&e){const e=f.XpG();f.R7$(),f.Y8G("ngForOf",e.participants.items)}}let w=(()=>{var e;class CoreUserParticipantsPage{constructor(){this.searchQuery=null,this.searchInProgress=!1,this.searchEnabled=!1,this.fetchMoreParticipantsFailed=!1;try{this.courseId=n.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.participants=new CoreUserParticipantsManager(_.u.getOrCreateSource(l.u,[this.courseId]),CoreUserParticipantsPage)}catch(e){return h.CoreAlerts.showError(e),n.CoreNavigator.back(),void 0}}ngOnInit(){var e=this;return(0,i.A)((function*(){e.searchEnabled=yield o.CoreUser.canSearchParticipantsInSite()}))()}ngAfterViewInit(){var e=this;return(0,i.A)((function*(){yield e.fetchInitialParticipants(),yield e.participants.start(e.splitView)}))()}ionViewDidEnter(){var e=this;return(0,i.A)((function*(){yield e.participants.start()}))()}ngOnDestroy(){this.participants.destroy()}clearSearch(){var e=this;return(0,i.A)((function*(){if(null===e.searchQuery)return;const t=_.u.getOrCreateSource(l.u,[e.courseId]);e.searchQuery=null,e.searchInProgress=!1,e.participants.setSource(t),yield e.fetchInitialParticipants()}))()}search(e){var t=this;return(0,i.A)((function*(){g.p.close();const r=_.u.getOrCreateSource(l.u,[t.courseId,e]);t.searchInProgress=!0,t.searchQuery=e,t.participants.setSource(r),yield t.fetchInitialParticipants(),t.searchInProgress=!1}))()}refreshParticipants(e){var t=this;return(0,i.A)((function*(){yield c.g.ignoreErrors(o.CoreUser.invalidateParticipantsList(t.courseId)),yield c.g.ignoreErrors(t.fetchParticipants(!0)),null==e||e.complete()}))()}fetchMoreParticipants(e){var t=this;return(0,i.A)((function*(){try{yield t.fetchParticipants(!1)}catch(e){h.CoreAlerts.showError(e,{default:"Error loading more participants"}),t.fetchMoreParticipantsFailed=!0}e()}))()}fetchInitialParticipants(){var e=this;return(0,i.A)((function*(){try{yield e.fetchParticipants(!0)}catch(t){h.CoreAlerts.showError(t,{default:"Error loading participants"}),e.participants.reset()}}))()}fetchParticipants(e){var t=this;return(0,i.A)((function*(){e?yield t.participants.reload():yield t.participants.load(),t.fetchMoreParticipantsFailed=!1}))()}}return(e=CoreUserParticipantsPage).ɵfac=function CoreUserParticipantsPage_Factory(t){return new(t||e)},e.ɵcmp=f.VBU({type:e,selectors:[["page-core-user-participants"]],viewQuery:function CoreUserParticipantsPage_Query(e,t){if(1&e&&f.GBs(s.M,5),2&e){let e;f.mGM(e=f.lsd())&&(t.splitView=e.first)}},standalone:!0,features:[f.aNF],decls:11,vars:13,consts:[["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["autocorrect","off","searchArea","CoreUserParticipants",3,"onSubmit","onClear","disabled","spellcheck","lengthCheck"],["placeholderType","listwithavatar","placeholderHeight","44px","placeholderWidth","44px",3,"hideUntil"],["icon","far-user",3,"message",4,"ngIf"],["icon","fas-magnifying-glass",3,"message",4,"ngIf"],[4,"ngIf"],[3,"action","enabled","error"],["icon","far-user",3,"message"],["icon","fas-magnifying-glass",3,"message"],["class","ion-text-wrap","button","",3,"detail","click",4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap",3,"click","detail"],["slot","start",3,"user","linkProfile","checkOnline"],[1,"item-heading"],[3,"text","highlight","filter"]],template:function CoreUserParticipantsPage_Template(e,t){1&e&&(f.j41(0,"ion-content")(1,"core-split-view")(2,"ion-refresher",0),f.bIt("ionRefresh",(function CoreUserParticipantsPage_Template_ion_refresher_ionRefresh_2_listener(e){return t.refreshParticipants(e.target)})),f.nrm(3,"ion-refresher-content",1),f.nI1(4,"translate"),f.k0s(),f.j41(5,"core-search-box",2),f.bIt("onSubmit",(function CoreUserParticipantsPage_Template_core_search_box_onSubmit_5_listener(e){return t.search(e)}))("onClear",(function CoreUserParticipantsPage_Template_core_search_box_onClear_5_listener(){return t.clearSearch()})),f.k0s(),f.j41(6,"core-loading",3),f.DNE(7,CoreUserParticipantsPage_core_empty_box_7_Template,2,3,"core-empty-box",4)(8,CoreUserParticipantsPage_core_empty_box_8_Template,2,4,"core-empty-box",5)(9,CoreUserParticipantsPage_ion_list_9_Template,2,1,"ion-list",6),f.j41(10,"core-infinite-loading",7),f.bIt("action",(function CoreUserParticipantsPage_Template_core_infinite_loading_action_10_listener(e){return t.fetchMoreParticipants(e)})),f.k0s()()()()),2&e&&(f.R7$(2),f.Y8G("disabled",!t.participants.loaded||t.searchInProgress),f.R7$(),f.FS9("pullingText",f.bMT(4,11,"core.pulltorefresh")),f.R7$(2),f.Y8G("disabled",t.searchInProgress)("spellcheck",!1)("lengthCheck",1),f.R7$(),f.Y8G("hideUntil",t.participants.loaded),f.R7$(),f.Y8G("ngIf",t.participants.empty&&!t.searchInProgress&&!t.searchQuery),f.R7$(),f.Y8G("ngIf",t.participants.empty&&!t.searchInProgress&&t.searchQuery),f.R7$(),f.Y8G("ngIf",!t.participants.empty),f.R7$(),f.Y8G("enabled",t.participants.loaded&&!t.participants.completed)("error",t.fetchMoreParticipantsFailed))},dependencies:[m.n,P.Sq,P.bT,C.W9,C.uz,C.he,C.nf,C.To,C.Ki,I.h,b.b,v.R,s.M,R.T,y.B,T.i,S.D9,U.A,d.CoreSearchBoxComponent],encapsulation:2}),CoreUserParticipantsPage})();class CoreUserParticipantsManager extends a.R{logActivity(){var e=this;return(0,i.A)((function*(){yield c.g.ignoreErrors(o.CoreUser.logParticipantsView(e.getSource().COURSE_ID)),p.OF.logEvent({type:p.qr.VIEW_ITEM_LIST,ws:"core_user_view_user_list",name:u.HT.instant("core.user.participants"),data:{courseid:e.getSource().COURSE_ID,category:"user"},url:`/user/index.php?id=${e.getSource().COURSE_ID}`})}))()}}}}]);