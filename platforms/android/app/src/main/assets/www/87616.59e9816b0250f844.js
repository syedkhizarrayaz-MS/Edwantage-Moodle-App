"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[87616],{87616:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var o=n(10467),s=n(74431),r=n(90378),i=n(8044),a=n(43496),d=n(89818),c=n(98870),l=n(2910),_=n(22693),u=n(15324),f=n(52749),p=n(75383),g=n(8014),I=n(55554),h=n(79555),m=n(49882),N=n(24742),b=n(47551),y=n(93589),A=n(22542),T=n(25572),L=n(86654),C=n(54438),R=n(60177),P=n(69502),G=n(17388),k=n(16986),w=n(64422),v=n(13988),$=n(16658),D=n(7570),O=n(19858),E=n(86198),j=n(58197),F=n(88246),x=n(43570),Y=n(73955),M=n(2423);const _c0=e=>({$a:e});function AddonNotesListPage_ion_item_24_Template(e,t){if(1&e&&(C.j41(0,"ion-item",19),C.nrm(1,"core-user-avatar",20),C.j41(2,"ion-label")(3,"p",21),C.EFF(4),C.k0s()()()),2&e){const e=C.XpG();C.R7$(),C.Y8G("user",e.user)("courseId",e.courseId)("linkProfile",!1),C.R7$(3),C.JRh(e.user.fullname)}}function AddonNotesListPage_ion_card_35_Template(e,t){1&e&&(C.j41(0,"ion-card",22)(1,"ion-item"),C.nrm(2,"ion-icon",23),C.j41(3,"ion-label"),C.EFF(4),C.nI1(5,"translate"),C.nI1(6,"lowercase"),C.nI1(7,"translate"),C.k0s()()()),2&e&&(C.R7$(4),C.SpI(" ",C.i5U(7,5,"core.thereisdatatosync",C.eq3(8,_c0,C.bMT(6,3,C.bMT(5,1,"addon.notes.notes"))))," "))}function AddonNotesListPage_core_empty_box_36_Template(e,t){1&e&&(C.nrm(0,"core-empty-box",24),C.nI1(1,"translate")),2&e&&C.Y8G("message",C.bMT(1,1,"addon.notes.nonotes"))}function AddonNotesListPage_ng_container_37_ion_card_1_core_user_avatar_2_Template(e,t){if(1&e&&C.nrm(0,"core-user-avatar",31),2&e){const e=C.XpG().$implicit,t=C.XpG(2);C.Y8G("user",e)("courseId",t.courseId)}}function AddonNotesListPage_ng_container_37_ion_card_1_p_4_Template(e,t){if(1&e&&(C.j41(0,"p",21),C.EFF(1),C.k0s()),2&e){const e=C.XpG().$implicit;C.R7$(),C.JRh(e.userfullname)}}function AddonNotesListPage_ng_container_37_ion_card_1_p_5_Template(e,t){if(1&e&&(C.j41(0,"p",2)(1,"span",19),C.EFF(2),C.nI1(3,"coreDateDayOrTime"),C.k0s()()),2&e){const e=C.XpG().$implicit;C.R7$(2),C.JRh(C.bMT(3,1,e.lastmodified))}}function AddonNotesListPage_ng_container_37_ion_card_1_p_6_Template(e,t){1&e&&(C.j41(0,"p",2),C.nrm(1,"ion-icon",32),C.j41(2,"span",19),C.EFF(3),C.nI1(4,"translate"),C.k0s()()),2&e&&(C.R7$(3),C.SpI(" ",C.bMT(4,1,"core.notsent")," "))}function AddonNotesListPage_ng_container_37_ion_card_1_p_7_Template(e,t){1&e&&(C.j41(0,"p",2),C.nrm(1,"ion-icon",33),C.j41(2,"span",19),C.EFF(3),C.nI1(4,"translate"),C.k0s()()),2&e&&(C.R7$(3),C.SpI(" ",C.bMT(4,1,"core.deletedoffline")," "))}function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template(e,t){if(1&e){const e=C.RV6();C.j41(0,"ion-button",34),C.nI1(1,"translate"),C.bIt("click",(function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template_ion_button_click_0_listener(t){C.eBV(e);const n=C.XpG().$implicit,o=C.XpG(2);return C.Njj(o.undoDeleteNote(t,n))})),C.nrm(2,"ion-icon",35),C.k0s()}2&e&&C.Y8G("ariaLabel",C.bMT(1,1,"core.restore"))}function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template(e,t){if(1&e){const e=C.RV6();C.j41(0,"ion-button",34),C.nI1(1,"translate"),C.bIt("click",(function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template_ion_button_click_0_listener(t){C.eBV(e);const n=C.XpG().$implicit,o=C.XpG(2);return C.Njj(o.deleteNote(t,n))})),C.nrm(2,"ion-icon",36),C.k0s()}2&e&&C.Y8G("@coreSlideInOut","fromRight")("ariaLabel",C.bMT(1,2,"core.delete"))}function AddonNotesListPage_ng_container_37_ion_card_1_Template(e,t){if(1&e&&(C.j41(0,"ion-card")(1,"ion-item",19),C.DNE(2,AddonNotesListPage_ng_container_37_ion_card_1_core_user_avatar_2_Template,1,2,"core-user-avatar",26),C.j41(3,"ion-label"),C.DNE(4,AddonNotesListPage_ng_container_37_ion_card_1_p_4_Template,2,1,"p",27)(5,AddonNotesListPage_ng_container_37_ion_card_1_p_5_Template,4,3,"p",28),C.k0s(),C.DNE(6,AddonNotesListPage_ng_container_37_ion_card_1_p_6_Template,5,3,"p",28)(7,AddonNotesListPage_ng_container_37_ion_card_1_p_7_Template,5,3,"p",28)(8,AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template,3,3,"ion-button",29)(9,AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template,3,4,"ion-button",29),C.k0s(),C.j41(10,"ion-item",19)(11,"ion-label"),C.nrm(12,"core-format-text",30),C.k0s()()()),2&e){const e=t.$implicit,n=C.XpG(2);C.R7$(2),C.Y8G("ngIf",!n.userId),C.R7$(2),C.Y8G("ngIf",!n.userId),C.R7$(),C.Y8G("ngIf",!e.deleted&&!e.offline),C.R7$(),C.Y8G("ngIf",e.offline),C.R7$(),C.Y8G("ngIf",e.deleted),C.R7$(),C.Y8G("ngIf",e.deleted),C.R7$(),C.Y8G("ngIf",n.showDelete&&!e.deleted&&("personal"!==n.type||e.usermodified===n.currentUserId)),C.R7$(3),C.Y8G("text",e.content)("filter",!1)("sanitize",e.offline)}}function AddonNotesListPage_ng_container_37_Template(e,t){if(1&e&&(C.qex(0),C.DNE(1,AddonNotesListPage_ng_container_37_ion_card_1_Template,13,10,"ion-card",25),C.bVm()),2&e){const e=C.XpG();C.R7$(),C.Y8G("ngForOf",e.notes)}}function AddonNotesListPage_ion_fab_38_Template(e,t){if(1&e){const e=C.RV6();C.j41(0,"ion-fab",37)(1,"ion-fab-button",38),C.nI1(2,"translate"),C.bIt("click",(function AddonNotesListPage_ion_fab_38_Template_ion_fab_button_click_1_listener(t){C.eBV(e);const n=C.XpG();return C.Njj(n.addNote(t))})),C.nrm(3,"ion-icon",39),C.j41(4,"span",40),C.EFF(5),C.nI1(6,"translate"),C.k0s()()()}2&e&&(C.R7$(),C.BMQ("aria-label",C.bMT(2,2,"addon.notes.addnewnote")),C.R7$(4),C.JRh(C.bMT(6,4,"addon.notes.addnewnote")))}let S=(()=>{var e;class AddonNotesListPage{constructor(){this.type="course",this.refreshIcon=s.CoreConstants.ICON_LOADING,this.syncIcon=s.CoreConstants.ICON_LOADING,this.notes=[],this.hasOffline=!1,this.notesLoaded=!1,this.showDelete=!1,this.canDeleteNotes=!1,this.logView=N.j.once((()=>this.performLogView()));try{this.courseId=u.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.userId=u.CoreNavigator.getRouteNumberParam("userId")}catch(e){return T.CoreAlerts.showError(e),u.CoreNavigator.back(),void 0}this.syncObserver=m.z.on(A.a,(e=>{var t;e.courseId==this.courseId&&(this.showSyncWarnings(e.warnings),this.notesLoaded=!1,this.refreshIcon=s.CoreConstants.ICON_LOADING,this.syncIcon=s.CoreConstants.ICON_LOADING,null===(t=this.content)||void 0===t||t.scrollToTop(),this.fetchNotes(!1))}),f.CoreSites.getCurrentSiteId()),this.currentUserId=f.CoreSites.getCurrentSiteUserId()}ngOnInit(){var e=this;return(0,o.A)((function*(){yield e.fetchNotes(!0)}))()}fetchNotes(e=!1,t=!1){var n=this;return(0,o.A)((function*(){e&&(yield n.syncNotes(t));try{const e=(yield r.AddonNotes.getNotes(n.courseId,n.userId))[`${n.type}notes`]||[];e.forEach((e=>{e.content=p.Ni.decodeHTML(e.content)})),yield r.AddonNotes.setOfflineDeletedNotes(e,n.courseId),n.hasOffline=e.some((e=>e.offline||e.deleted)),n.userId?(n.notes=e,n.user=yield c.CoreUser.getProfile(n.userId,n.courseId,!0)):n.notes=yield r.AddonNotes.getNotesUserData(e),n.logView()}catch(e){T.CoreAlerts.showError(e)}finally{let e=n.notes&&n.notes.length>0;e&&"personal"==n.type&&(e=!!n.notes.find((e=>e.usermodified==n.currentUserId))),n.canDeleteNotes=e,n.notesLoaded=!0,n.refreshIcon=s.CoreConstants.ICON_REFRESH,n.syncIcon=s.CoreConstants.ICON_SYNC}}))()}refreshNotes(e,t){this.refreshIcon=s.CoreConstants.ICON_LOADING,this.syncIcon=s.CoreConstants.ICON_LOADING,r.AddonNotes.invalidateNotes(this.courseId,this.userId).finally((()=>{this.fetchNotes(!0,e).finally((()=>{t&&(null==t||t.complete())}))}))}typeChanged(e){var t=this;return(0,o.A)((function*(){t.type=e,t.notesLoaded=!1,t.refreshIcon=s.CoreConstants.ICON_LOADING,t.syncIcon=s.CoreConstants.ICON_LOADING,yield t.fetchNotes(!0)}))()}addNote(e){var t=this;return(0,o.A)((function*(){e.preventDefault(),e.stopPropagation(),t.logViewAdd();const{AddonNotesAddComponent:o}=yield n.e(94956).then(n.bind(n,94956)),s=yield y.I.openModal({component:o,componentProps:{userId:t.userId,courseId:t.courseId,type:t.type}});void 0!==s&&(s.sent&&s.type?(s.type!=t.type&&(t.type=s.type,t.notesLoaded=!1),t.refreshNotes(!1)):s.type&&s.type!=t.type&&t.typeChanged(s.type))}))()}deleteNote(e,t){var n=this;return(0,o.A)((function*(){e.preventDefault(),e.stopPropagation();try{n.logViewDelete(t),yield T.CoreAlerts.confirmDelete(h.HT.instant("addon.notes.deleteconfirm"));try{yield r.AddonNotes.deleteNote(t,n.courseId),n.showDelete=!1,n.refreshNotes(!1),b.CoreToasts.show({message:"addon.notes.eventnotedeleted",translateMessage:!0,duration:b.ToastDuration.LONG})}catch(e){T.CoreAlerts.showError(e,{default:"Delete note failed."})}}catch{}}))()}undoDeleteNote(e,t){var n=this;return(0,o.A)((function*(){e.preventDefault(),e.stopPropagation(),yield i.AddonNotesOffline.undoDeleteNote(t.id),n.refreshNotes(!1)}))()}toggleDelete(){this.showDelete=!this.showDelete}syncNotes(e){var t=this;return(0,o.A)((function*(){try{const e=yield a.AddonNotesSync.syncNotes(t.courseId);t.showSyncWarnings(e.warnings)}catch(t){e&&T.CoreAlerts.showError(t,{default:h.HT.instant("core.errorsync")})}}))()}showSyncWarnings(e){const t=p.Ni.buildMessage(e);t&&T.CoreAlerts.show({message:t})}performLogView(){var e=this;return(0,o.A)((function*(){yield I.g.ignoreErrors(r.AddonNotes.logView(e.courseId,e.userId)),_.OF.logEvent({type:_.qr.VIEW_ITEM_LIST,ws:"core_notes_view_notes",name:h.HT.instant("addon.notes.notes"),data:{courseid:e.courseId,userid:e.userId||0,category:"notes"},url:g.F.addParamsToUrl("/notes/index.php",{user:e.userId,course:e.courseId!==f.CoreSites.getCurrentSiteHomeId()?e.courseId:void 0})})}))()}logViewAdd(){var e=this;return(0,o.A)((function*(){_.OF.logEvent({type:_.qr.VIEW_ITEM,ws:"core_notes_create_notes",name:h.HT.instant("addon.notes.notes"),data:{courseid:e.courseId,userid:e.userId||0,category:"notes"},url:g.F.addParamsToUrl("/notes/edit.php",{courseid:e.courseId,userid:e.userId,publishstate:"personal"===e.type?"draft":"course"===e.type?"public":"site"})})}))()}logViewDelete(e){return(0,o.A)((function*(){e.id&&_.OF.logEvent({type:_.qr.VIEW_ITEM,ws:"core_notes_delete_notes",name:h.HT.instant("addon.notes.notes"),data:{id:e.id,category:"notes"},url:`/notes/delete.php?id=${e.id}`})}))()}ngOnDestroy(){this.syncObserver&&this.syncObserver.off()}}return(e=AddonNotesListPage).ɵfac=function AddonNotesListPage_Factory(t){return new(t||e)},e.ɵcmp=C.VBU({type:e,selectors:[["page-addon-notes-list-page"]],viewQuery:function AddonNotesListPage_Query(e,t){if(1&e&&C.GBs(l.W9,5),2&e){let e;C.mGM(e=C.lsd())&&(t.content=e.first)}},standalone:!0,features:[C.aNF],decls:39,vars:45,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","end","fill","clear",3,"click","ariaLabel"],["name","fas-pen","slot","icon-only","aria-hidden","true"],[3,"action","hidden","priority","content","iconAction","closeOnClick"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[3,"onChange","selection"],["value","site",1,"ion-text-wrap"],["value","course",1,"ion-text-wrap"],["value","personal",1,"ion-text-wrap"],["class","core-warning-card",4,"ngIf"],["icon","fas-receipt",3,"message",4,"ngIf"],[4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId","linkProfile"],[1,"item-heading"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["icon","fas-receipt",3,"message"],[4,"ngFor","ngForOf"],["slot","start",3,"user","courseId",4,"ngIf"],["class","item-heading",4,"ngIf"],["slot","end",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"ariaLabel","click",4,"ngIf"],[3,"text","filter","sanitize"],["slot","start",3,"user","courseId"],["name","fas-clock","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],["slot","end","fill","clear","color","danger",3,"click","ariaLabel"],["name","fas-rotate-left","slot","icon-only","aria-hidden","true"],["name","fas-trash","slot","icon-only","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonNotesListPage_Template(e,t){1&e&&(C.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),C.nrm(3,"ion-back-button",1),C.nI1(4,"translate"),C.k0s(),C.j41(5,"ion-title")(6,"h1"),C.EFF(7),C.nI1(8,"translate"),C.k0s()(),C.nrm(9,"ion-buttons",2),C.k0s()(),C.j41(10,"core-navbar-buttons",2)(11,"ion-button",3),C.nI1(12,"translate"),C.bIt("click",(function AddonNotesListPage_Template_ion_button_click_11_listener(){return t.toggleDelete()})),C.nrm(13,"ion-icon",4),C.k0s(),C.j41(14,"core-context-menu")(15,"core-context-menu-item",5),C.nI1(16,"translate"),C.bIt("action",(function AddonNotesListPage_Template_core_context_menu_item_action_15_listener(){return t.refreshNotes(!1)})),C.k0s(),C.j41(17,"core-context-menu-item",5),C.nI1(18,"translate"),C.bIt("action",(function AddonNotesListPage_Template_core_context_menu_item_action_17_listener(){return t.refreshNotes(!0)})),C.k0s()()(),C.j41(19,"ion-content",6)(20,"ion-refresher",7),C.bIt("ionRefresh",(function AddonNotesListPage_Template_ion_refresher_ionRefresh_20_listener(e){return t.refreshNotes(!1,e.target)})),C.nrm(21,"ion-refresher-content",8),C.nI1(22,"translate"),C.k0s(),C.j41(23,"core-loading",9),C.DNE(24,AddonNotesListPage_ion_item_24_Template,5,4,"ion-item",10),C.j41(25,"core-combobox",11),C.bIt("onChange",(function AddonNotesListPage_Template_core_combobox_onChange_25_listener(e){return t.typeChanged(e)})),C.j41(26,"ion-select-option",12),C.EFF(27),C.nI1(28,"translate"),C.k0s(),C.j41(29,"ion-select-option",13),C.EFF(30),C.nI1(31,"translate"),C.k0s(),C.j41(32,"ion-select-option",14),C.EFF(33),C.nI1(34,"translate"),C.k0s()(),C.DNE(35,AddonNotesListPage_ion_card_35_Template,8,10,"ion-card",15)(36,AddonNotesListPage_core_empty_box_36_Template,2,3,"core-empty-box",16)(37,AddonNotesListPage_ng_container_37_Template,2,1,"ng-container",17),C.k0s(),C.DNE(38,AddonNotesListPage_ion_fab_38_Template,7,6,"ion-fab",18),C.k0s()),2&e&&(C.R7$(3),C.Y8G("text",C.bMT(4,27,"core.back")),C.R7$(4),C.JRh(C.bMT(8,29,"addon.notes.notes")),C.R7$(4),C.AVh("hidden",!t.canDeleteNotes),C.Y8G("ariaLabel",C.bMT(12,31,"core.toggledelete")),C.R7$(4),C.Y8G("hidden",!(t.notesLoaded&&!t.hasOffline))("priority",100)("content",C.bMT(16,33,"core.refresh"))("iconAction",t.refreshIcon)("closeOnClick",!0),C.R7$(2),C.Y8G("hidden",!(t.notesLoaded&&t.hasOffline))("priority",100)("content",C.bMT(18,35,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),C.R7$(3),C.Y8G("disabled",!t.notesLoaded),C.R7$(),C.FS9("pullingText",C.bMT(22,37,"core.pulltorefresh")),C.R7$(2),C.Y8G("hideUntil",t.notesLoaded),C.R7$(),C.Y8G("ngIf",t.user),C.R7$(),C.Y8G("selection",t.type),C.R7$(2),C.SpI(" ",C.bMT(28,39,"addon.notes.sitenotes")," "),C.R7$(3),C.SpI(" ",C.bMT(31,41,"addon.notes.coursenotes")," "),C.R7$(3),C.SpI(" ",C.bMT(34,43,"addon.notes.personalnotes")," "),C.R7$(2),C.Y8G("ngIf",t.hasOffline),C.R7$(),C.Y8G("ngIf",t.notes&&0===t.notes.length),C.R7$(),C.Y8G("ngIf",t.notes&&t.notes.length>0),C.R7$(),C.Y8G("ngIf",t.userId&&t.notesLoaded))},dependencies:[L.n,R.Sq,R.bT,l.Jm,l.QW,l.b_,l.W9,l.Q8,l.YW,l.eU,l.iq,l.uz,l.he,l.To,l.Ki,l.Ip,l.BC,l.ai,l.el,P.B,G.Q,k.h,w.R,v.c,$.T,D._,O.A,E.t,j.B,F.i,x.T,R.GH,Y.D9,M.Y],encapsulation:2,data:{animation:[d.d.SLIDE_IN_OUT]}}),AddonNotesListPage})()}}]);