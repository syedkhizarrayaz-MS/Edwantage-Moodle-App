"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[76220],{76220:(e,n,t)=>{t.r(n),t.d(n,{default:()=>y});var s=t(10467),o=t(52749),a=t(20728),i=t(49882),c=t(79555),r=t(93417),g=t(15324),d=t(29492),l=t(44426),_=t(40152),m=t(25572),h=t(86654),C=t(75357),M=t(54438),f=t(21182),u=t(60177),P=t(2910),p=t(69502),O=t(16986),b=t(64422),T=t(16658),v=t(88246),x=t(73955);function AddonMessagesContacts35Page_core_empty_box_19_Template(e,n){1&e&&(M.nrm(0,"core-empty-box",9),M.nI1(1,"translate")),2&e&&M.Y8G("message",M.bMT(1,1,"addon.messages.contactlistempty"))}function AddonMessagesContacts35Page_core_empty_box_20_Template(e,n){1&e&&(M.nrm(0,"core-empty-box",9),M.nI1(1,"translate")),2&e&&M.Y8G("message",M.bMT(1,1,"addon.messages.nousersfound"))}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template(e,n){if(1&e){const e=M.RV6();M.j41(0,"ion-item",16),M.bIt("click",(function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template_ion_item_click_0_listener(){M.eBV(e);const n=M.XpG().$implicit,t=M.XpG(3);return M.Njj(t.gotoDiscussion(n.id))})),M.nrm(1,"core-user-avatar",17),M.j41(2,"ion-label")(3,"p",12),M.EFF(4),M.k0s()()()}if(2&e){const e=M.XpG().$implicit,n=M.XpG(3);M.Y8G("detail",!0),M.BMQ("aria-label",e.fullname)("aria-current",e.id===n.discussionUserId?"page":"false"),M.R7$(),M.Y8G("user",e)("checkOnline",e.showonlinestatus),M.R7$(3),M.JRh(e.fullname)}}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_Template(e,n){if(1&e&&(M.qex(0),M.DNE(1,AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template,5,6,"ion-item",15),M.bVm()),2&e){const e=n.$implicit;M.R7$(),M.Y8G("ngIf",e.profileimageurl||e.profileimageurlsmall)}}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_Template(e,n){if(1&e&&(M.qex(0),M.j41(1,"ion-item-divider")(2,"ion-label")(3,"p",12),M.EFF(4),M.nI1(5,"translate"),M.k0s()(),M.j41(6,"ion-note",13)(7,"ion-badge"),M.EFF(8),M.k0s()()(),M.DNE(9,AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_Template,2,1,"ng-container",14),M.bVm()),2&e){const e=M.XpG().$implicit,n=M.XpG();M.R7$(4),M.JRh(M.bMT(5,3,"addon.messages.type_"+e)),M.R7$(4),M.JRh(n.contacts[e].length),M.R7$(),M.Y8G("ngForOf",n.contacts[e])}}function AddonMessagesContacts35Page_ion_list_21_Template(e,n){if(1&e&&(M.j41(0,"ion-list",10),M.DNE(1,AddonMessagesContacts35Page_ion_list_21_ng_container_1_Template,10,5,"ng-container",11),M.k0s()),2&e){const e=n.$implicit,t=M.XpG();M.R7$(),M.Y8G("ngIf",t.contacts[e]&&(t.contacts[e].length>0||e===t.searchType))}}let y=(()=>{var e;class AddonMessagesContacts35Page{constructor(e){this.route=e,this.noSearchTypes=["online","offline","blocked","strangers"],this.loaded=!1,this.contactTypes=["online","offline","blocked","strangers"],this.searchType="search",this.loadingMessage="",this.hasContacts=!1,this.contacts={online:[],offline:[],strangers:[],search:[]},this.searchString="",this.siteId=o.CoreSites.getCurrentSiteId(),this.searchingMessages=c.HT.instant("core.searching"),this.loadingMessages=c.HT.instant("core.loading"),this.loadingMessage=this.loadingMessages,this.memberInfoObserver=i.z.on(_.Ie,(e=>{e.contactRequestConfirmed&&this.refreshData()}),o.CoreSites.getCurrentSiteId())}ngOnInit(){var e=this;return(0,s.A)((function*(){const n=g.CoreNavigator.getRouteNumberParam("discussionUserId")||g.CoreNavigator.getRouteNumberParam("userId")||void 0;if(!e.loaded||e.discussionUserId!=n){e.discussionUserId=n,e.discussionUserId&&e.gotoDiscussion(e.discussionUserId);try{if(yield e.fetchData(),!e.discussionUserId&&e.hasContacts&&r.CoreScreen.isTablet){let n;for(const t in e.contacts)if(e.contacts[t].length>0){n=e.contacts[t][0];break}n&&e.gotoDiscussion(n.id)}}finally{e.loaded=!0}}}))()}refreshData(e){var n=this;return(0,s.A)((function*(){try{n.searchString?yield n.performSearch(n.searchString):(yield a.AddonMessages.invalidateAllContactsCache(),yield n.fetchData())}finally{null==e||e.complete()}}))()}fetchData(){var e=this;return(0,s.A)((function*(){e.loadingMessage=e.loadingMessages;try{const n=yield a.AddonMessages.getAllContacts();for(const t in n)e.contacts[t]=n[t].length>0?e.sortUsers(n[t]):[];e.clearSearch()}catch(e){m.CoreAlerts.showError(e,{default:c.HT.instant("addon.messages.errorwhileretrievingcontacts")})}}))()}sortUsers(e){return e.sort(((e,n)=>{const t=e.fullname.toLowerCase(),s=n.fullname.toLowerCase();return t.localeCompare(s)}))}clearSearch(){this.searchString="",this.contactTypes=this.noSearchTypes,this.hasContacts=!1;for(const e in this.contacts)if(this.contacts[e].length>0)return this.hasContacts=!0,void 0}search(e){var n=this;return(0,s.A)((function*(){l.p.close(),n.loaded=!1,n.loadingMessage=n.searchingMessages;try{yield n.performSearch(e)}finally{n.loaded=!0}}))()}performSearch(e){var n=this;return(0,s.A)((function*(){try{const t=yield a.AddonMessages.searchContacts(e);n.hasContacts=t.length>0,n.searchString=e,n.contactTypes=["search"],n.contacts.search=n.sortUsers(t)}catch(e){m.CoreAlerts.showError(e,{default:c.HT.instant("addon.messages.errorwhileretrievingcontacts")})}}))()}gotoDiscussion(e){this.discussionUserId=e;const n=g.CoreNavigator.getRelativePathToParent("/messages/contacts-35")+`discussion/user/${e}`;g.CoreNavigator.navigate(n,{reset:r.CoreScreen.isTablet&&!!this.splitView&&!this.splitView.isNested})}ngOnDestroy(){var e;null===(e=this.memberInfoObserver)||void 0===e||e.off()}}return(e=AddonMessagesContacts35Page).ɵfac=function AddonMessagesContacts35Page_Factory(n){return new(n||e)(M.rXU(f.nX))},e.ɵcmp=M.VBU({type:e,selectors:[["addon-messages-contacts"]],viewQuery:function AddonMessagesContacts35Page_Query(e,n){if(1&e&&M.GBs(d.M,5),2&e){let e;M.mGM(e=M.lsd())&&(n.splitView=e.first)}},standalone:!0,features:[M.aNF],decls:22,vars:19,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["autocorrect","off","spellcheck","false","lengthCheck","2","searchArea","AddonMessagesContacts",3,"onSubmit","onClear","placeholder","disabled"],[3,"hideUntil","message"],["icon","fas-address-book",3,"message",4,"ngIf"],["class","ion-no-margin",4,"ngFor","ngForOf"],["icon","fas-address-book",3,"message"],[1,"ion-no-margin"],[4,"ngIf"],[1,"item-heading"],["slot","end",1,"ion-padding-end"],[4,"ngFor","ngForOf"],["class","ion-text-wrap addon-messages-conversation-item","button","",3,"detail","click",4,"ngIf"],["button","",1,"ion-text-wrap","addon-messages-conversation-item",3,"click","detail"],["slot","start",3,"user","checkOnline"]],template:function AddonMessagesContacts35Page_Template(e,n){1&e&&(M.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),M.nrm(3,"ion-back-button",1),M.nI1(4,"translate"),M.k0s(),M.j41(5,"ion-title")(6,"h1"),M.EFF(7),M.nI1(8,"translate"),M.k0s()(),M.j41(9,"ion-buttons",2),M.nrm(10,"core-context-menu"),M.k0s()()(),M.j41(11,"ion-content")(12,"core-split-view")(13,"ion-refresher",3),M.bIt("ionRefresh",(function AddonMessagesContacts35Page_Template_ion_refresher_ionRefresh_13_listener(e){return n.refreshData(e.target)})),M.nrm(14,"ion-refresher-content",4),M.nI1(15,"translate"),M.k0s(),M.j41(16,"core-search-box",5),M.nI1(17,"translate"),M.bIt("onSubmit",(function AddonMessagesContacts35Page_Template_core_search_box_onSubmit_16_listener(e){return n.search(e)}))("onClear",(function AddonMessagesContacts35Page_Template_core_search_box_onClear_16_listener(){return n.clearSearch()})),M.k0s(),M.j41(18,"core-loading",6),M.DNE(19,AddonMessagesContacts35Page_core_empty_box_19_Template,2,3,"core-empty-box",7)(20,AddonMessagesContacts35Page_core_empty_box_20_Template,2,3,"core-empty-box",7)(21,AddonMessagesContacts35Page_ion_list_21_Template,2,1,"ion-list",8),M.k0s()()()),2&e&&(M.R7$(3),M.Y8G("text",M.bMT(4,11,"core.back")),M.R7$(4),M.JRh(M.bMT(8,13,"addon.messages.contacts")),M.R7$(6),M.Y8G("disabled",!n.loaded),M.R7$(),M.FS9("pullingText",M.bMT(15,15,"core.pulltorefresh")),M.R7$(2),M.Y8G("placeholder",M.bMT(17,17,"addon.messages.contactname"))("disabled",!n.loaded),M.R7$(2),M.Y8G("hideUntil",n.loaded)("message",n.loadingMessage),M.R7$(),M.Y8G("ngIf",!n.hasContacts&&""===n.searchString),M.R7$(),M.Y8G("ngIf",!n.hasContacts&&""!==n.searchString),M.R7$(),M.Y8G("ngForOf",n.contactTypes))},dependencies:[h.n,u.Sq,u.bT,P.In,P.QW,P.W9,P.eU,P.uz,P.Dg,P.he,P.nf,P.JI,P.To,P.Ki,P.BC,P.ai,P.el,p.B,O.h,b.R,d.M,T.T,v.i,x.D9,C.CoreSearchBoxComponent],styles:["[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:.6875rem}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-inline-end:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesContacts35Page})()}}]);