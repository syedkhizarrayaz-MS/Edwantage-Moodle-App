"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[56054],{2401:(e,t,r)=>{r.d(t,{R:()=>CoreListItemsManager});var o=r(10467),i=r(21182),n=r(15324),s=r(93417),l=r(81690),a=r(95990),u=r(82907),c=r(24742),p=r(55554);class CoreListItemsManager extends a.u{constructor(e,t){super(e);const r=l.j.debounce((()=>this.scrollToCurrentElement()),300);this.pageRouteLocator=t,this.addListener({onSelectedItemUpdated:r}),this.finishSuccessfulFetch=c.j.once((()=>p.g.ignoreErrors(this.logActivity())))}get items(){return this.getSource().getItems()||[]}get loaded(){return null!==this.itemsMap}get completed(){return this.getSource().isCompleted()}get empty(){const e=this.getSource().getItems();return null===e||0===e.length}start(e){var t=this;return(0,o.A)((function*(){e&&t.watchSplitViewOutlet(e),t.updateSelectedItem()}))()}destroy(){var e;super.destroy(),null===(e=this.splitViewOutletSubscription)||void 0===e||e.unsubscribe()}watchSplitViewOutlet(e){var t;this.splitView=e,this.splitViewOutletSubscription=e.outletRouteObservable.subscribe((e=>this.updateSelectedItem(this.getPageRouteFromSplitViewOutlet(e)))),this.updateSelectedItem(null!==(t=this.getPageRouteFromSplitViewOutlet(e.outletRoute))&&void 0!==t?t:null)}isSelected(e){return this.selectedItem===e}getItemAriaCurrent(e){return this.isSelected(e)?"page":"false"}select(e){var t=this;return(0,o.A)((function*(){if(!e)return yield t.navigateToIndex({reset:t.resetNavigation()}),void 0;yield t.navigateToItem(e,{reset:t.resetNavigation()})}))()}reset(){this.getSource().reset()}reload(){var e=this;return(0,o.A)((function*(){yield e.getSource().reload(),e.finishSuccessfulFetch()}))()}load(){var e=this;return(0,o.A)((function*(){yield e.getSource().load(),e.finishSuccessfulFetch()}))()}logActivity(){return(0,o.A)((function*(){}))()}resetNavigation(){var e;return!!s.CoreScreen.isTablet&&!(!this.splitView||null!==(e=this.splitView)&&void 0!==e&&e.isNested)}updateSelectedItem(e=null){super.updateSelectedItem(e);this.select(s.CoreScreen.isTablet&&null===this.selectedItem&&this.splitView&&!this.splitView.isNested?this.getDefaultItem():this.selectedItem)}scrollToCurrentElement(){var e=this;return(0,o.A)((function*(){var t,r,o;if(s.CoreScreen.isMobile)return;const i=(null!==(t=null===(r=e.splitView)||void 0===r?void 0:r.nativeElement)&&void 0!==t?t:document).querySelector('[aria-current="page"]');if(!i)return;u.y.isElementInViewport(i,1,null===(o=e.splitView)||void 0===o?void 0:o.nativeElement)||i.scrollIntoView({behavior:"smooth"})}))()}getDefaultItem(){return this.items[0]||null}getCurrentPageRoute(){return this.pageRouteLocator instanceof i.nX?n.CoreNavigator.isRouteActive(this.pageRouteLocator)?this.pageRouteLocator:null:n.CoreNavigator.getCurrentRoute({pageComponent:this.pageRouteLocator})}getSelectedItemPathFromRoute(e){const t=[];for(;e.firstChild;)t.push(...n.CoreNavigator.getRouteUrl(e=e.firstChild));return t.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}getPageRouteFromSplitViewOutlet(e){const t=this.buildRouteMatcher();for(;e&&!t(e);)e=e.parent;return e}buildRouteMatcher(){if(this.pageRouteLocator instanceof i.nX){const e=n.CoreNavigator.getRouteFullPath(this.pageRouteLocator);return t=>n.CoreNavigator.getRouteFullPath(t)===e}return e=>e.component===this.pageRouteLocator}}},56054:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var o=r(10467),i=r(2401),n=r(83696),s=r(99522),l=r(42176);class CoreReportBuilderReportsSource extends s.F{getItemPath(e){return e.id.toString()}loadPageItems(e){var t=this;return(0,o.A)((function*(){const r=yield l.Zn.getReports(e,t.getPageLength());return{items:r,hasMoreItems:r.length>0}}))()}setItems(e,t){const r=e.slice(0);r.sort(((e,t)=>e.timemodified<t.timemodified?1:-1)),super.setItems(r,t)}getPageLength(){return l.Pd}}var a=r(22693),u=r(15324),c=r(55554),p=r(79555),d=r(24742),g=r(84412),_=r(25572),h=r(86654),m=r(54438),f=r(60177),R=r(2910),b=r(16986),C=r(66198),I=r(64422),v=r(58197),S=r(88246),L=r(73955);function CoreReportBuilderListPage_ion_content_9_ion_list_5_ion_item_1_Template(e,t){if(1&e){const e=m.RV6();m.j41(0,"ion-item",10),m.bIt("click",(function CoreReportBuilderListPage_ion_content_9_ion_list_5_ion_item_1_Template_ion_item_click_0_listener(){const t=m.eBV(e).$implicit,r=m.XpG(3);return m.Njj(r.reports.select(t))})),m.j41(1,"ion-label")(2,"p",11),m.nrm(3,"core-format-text",12),m.k0s(),m.j41(4,"p"),m.EFF(5),m.k0s()()()}if(2&e){const e=t.$implicit,r=m.XpG(3);m.Y8G("detail",!0)("button",!0),m.BMQ("aria-current",r.reports.getItemAriaCurrent(e)),m.R7$(3),m.Y8G("clean",!0)("text",e.name)("filter",!1),m.R7$(2),m.JRh(e.sourcename)}}function CoreReportBuilderListPage_ion_content_9_ion_list_5_Template(e,t){if(1&e&&(m.j41(0,"ion-list"),m.DNE(1,CoreReportBuilderListPage_ion_content_9_ion_list_5_ion_item_1_Template,6,7,"ion-item",9),m.k0s()),2&e){const e=m.XpG(2);m.R7$(),m.Y8G("ngForOf",e.reports.items)}}function CoreReportBuilderListPage_ion_content_9_ng_template_6_core_empty_box_0_Template(e,t){1&e&&(m.nrm(0,"core-empty-box",14),m.nI1(1,"translate")),2&e&&m.Y8G("message",m.bMT(1,1,"core.course.nocontentavailable"))}function CoreReportBuilderListPage_ion_content_9_ng_template_6_Template(e,t){if(1&e&&m.DNE(0,CoreReportBuilderListPage_ion_content_9_ng_template_6_core_empty_box_0_Template,2,3,"core-empty-box",13),2&e){const e=m.XpG(2);m.Y8G("ngIf",!(null!=e.reports.items&&e.reports.items.length))}}function CoreReportBuilderListPage_ion_content_9_core_infinite_loading_8_Template(e,t){if(1&e){const e=m.RV6();m.j41(0,"core-infinite-loading",15),m.bIt("action",(function CoreReportBuilderListPage_ion_content_9_core_infinite_loading_8_Template_core_infinite_loading_action_0_listener(t){m.eBV(e);const r=m.XpG(2);return m.Njj(r.fetchMoreReports(t))})),m.k0s()}if(2&e){const e=m.XpG().ngIf,t=m.XpG();m.Y8G("enabled",t.reports.loaded&&!t.reports.completed)("error",e.loadMoreError)}}function CoreReportBuilderListPage_ion_content_9_Template(e,t){if(1&e){const e=m.RV6();m.j41(0,"ion-content")(1,"ion-refresher",4),m.bIt("ionRefresh",(function CoreReportBuilderListPage_ion_content_9_Template_ion_refresher_ionRefresh_1_listener(t){m.eBV(e);const r=m.XpG();return m.Njj(r.refreshReports(t.target))})),m.nrm(2,"ion-refresher-content",5),m.nI1(3,"translate"),m.k0s(),m.j41(4,"core-loading",6),m.DNE(5,CoreReportBuilderListPage_ion_content_9_ion_list_5_Template,2,1,"ion-list",7)(6,CoreReportBuilderListPage_ion_content_9_ng_template_6_Template,1,1,"ng-template",null,0,m.C5r)(8,CoreReportBuilderListPage_ion_content_9_core_infinite_loading_8_Template,1,2,"core-infinite-loading",8),m.k0s()()}if(2&e){const e=t.ngIf,r=m.sdS(7),o=m.XpG();m.R7$(),m.Y8G("disabled",!e.loaded),m.R7$(),m.FS9("pullingText",m.bMT(3,6,"core.pulltorefresh")),m.R7$(2),m.Y8G("hideUntil",e.loaded),m.R7$(),m.Y8G("ngIf",null==o.reports.items?null:o.reports.items.length)("ngIfElse",r),m.R7$(3),m.Y8G("ngIf",null==o.reports.items?null:o.reports.items.length)}}let w=(()=>{var e;class CoreReportBuilderListPage{constructor(){this.state$=new g.t({page:1,perpage:l.Pd,loaded:!1,loadMoreError:!1}),this.logView=d.j.once((()=>this.performLogView()));try{const e=n.u.getOrCreateSource(CoreReportBuilderReportsSource,[]);this.reports=new i.R(e,CoreReportBuilderListPage)}catch(e){_.CoreAlerts.showError(e),u.CoreNavigator.back()}}ngAfterViewInit(){var e=this;return(0,o.A)((function*(){try{yield e.fetchReports(!0),e.updateState({loaded:!0})}catch(t){_.CoreAlerts.showError(t,{default:"Error loading reports"}),e.reports.reset()}}))()}fetchReports(e){var t=this;return(0,o.A)((function*(){e?yield t.reports.reload():yield t.reports.load(),t.updateState({loadMoreError:!1}),t.logView()}))()}updateState(e){const t=this.state$.getValue();this.state$.next({...t,...e})}fetchMoreReports(e){var t=this;return(0,o.A)((function*(){try{yield t.fetchReports(!1)}catch(e){_.CoreAlerts.showError(e,{default:"Error loading more reports"}),t.updateState({loadMoreError:!0})}e()}))()}refreshReports(e){var t=this;return(0,o.A)((function*(){yield c.g.ignoreErrors(l.Zn.invalidateReportsList()),yield c.g.ignoreErrors(t.fetchReports(!0)),yield null==e?void 0:e.complete()}))()}performLogView(){a.OF.logEvent({type:a.qr.VIEW_ITEM_LIST,ws:"core_reportbuilder_list_reports",name:p.HT.instant("core.reportbuilder.reports"),data:{category:"reportbuilder"},url:"/reportbuilder/index.php"})}ngOnDestroy(){this.reports.destroy()}}return(e=CoreReportBuilderListPage).ɵfac=function CoreReportBuilderListPage_Factory(t){return new(t||e)},e.ɵcmp=m.VBU({type:e,selectors:[["core-report-builder-list"]],standalone:!0,features:[m.aNF],decls:11,vars:9,consts:[["empty",""],["slot","start"],[3,"text"],[4,"ngIf"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf","ngIfElse"],[3,"enabled","error","action",4,"ngIf"],["class","ion-text-wrap",3,"detail","button","click",4,"ngFor","ngForOf"],[1,"ion-text-wrap",3,"click","detail","button"],[1,"item-heading"],[3,"clean","text","filter"],["icon","fas-rectangle-list",3,"message",4,"ngIf"],["icon","fas-rectangle-list",3,"message"],[3,"action","enabled","error"]],template:function CoreReportBuilderListPage_Template(e,t){1&e&&(m.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),m.nrm(3,"ion-back-button",2),m.nI1(4,"translate"),m.k0s(),m.j41(5,"ion-title")(6,"h1"),m.EFF(7),m.nI1(8,"translate"),m.k0s()()()(),m.DNE(9,CoreReportBuilderListPage_ion_content_9_Template,9,8,"ion-content",3),m.nI1(10,"async")),2&e&&(m.R7$(3),m.Y8G("text",m.bMT(4,3,"core.back")),m.R7$(4),m.JRh(m.bMT(8,5,"core.reportbuilder.reports")),m.R7$(2),m.Y8G("ngIf",m.bMT(10,7,t.state$)))},dependencies:[h.n,f.Sq,f.bT,R.QW,R.W9,R.eU,R.uz,R.he,R.nf,R.To,R.Ki,R.BC,R.ai,R.el,b.h,C.b,I.R,v.B,S.i,f.Jj,L.D9],encapsulation:2,changeDetection:0}),CoreReportBuilderListPage})()}}]);