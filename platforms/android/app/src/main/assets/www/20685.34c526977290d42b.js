"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[20685],{20685:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var s=n(10467),o=n(49882),a=n(52749),i=n(20728),r=n(15324),c=n(93417),d=n(29492),l=n(40152),g=n(25572),_=n(79555),m=n(86654),f=n(54438),u=n(60177),C=n(2910),M=n(69502),h=n(16986),p=n(66198),P=n(64422),b=n(72597),O=n(73564),I=n(16658),T=n(86198),q=n(58197),A=n(88246),R=n(43570),x=n(73955);function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_ion_icon_5_Template(e,t){1&e&&(f.nrm(0,"ion-icon",20),f.nI1(1,"translate")),2&e&&f.BMQ("aria-label",f.bMT(1,1,"addon.messages.contactblocked"))}function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template(e,t){if(1&e){const e=f.RV6();f.j41(0,"ion-item",15),f.bIt("click",(function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template_ion_item_click_0_listener(){const t=f.eBV(e).$implicit,n=f.XpG(3);return f.Njj(n.selectUser(t.id))})),f.nrm(1,"core-user-avatar",16),f.j41(2,"ion-label")(3,"p",17),f.nrm(4,"core-format-text",18),f.DNE(5,AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_ion_icon_5_Template,2,3,"ion-icon",19),f.k0s()()()}if(2&e){const e=t.$implicit,n=f.XpG(3);f.Y8G("detail",!0),f.BMQ("aria-label",e.fullname)("aria-current",e.id===n.selectedUserId?"page":"false"),f.R7$(),f.Y8G("user",e)("checkOnline",e.showonlinestatus)("linkProfile",!1),f.R7$(3),f.Y8G("text",e.fullname)("contextInstanceId",0),f.R7$(),f.Y8G("ngIf",e.isblocked)}}function AddonMessagesContactsPage_ng_template_19_ion_list_4_Template(e,t){if(1&e&&(f.j41(0,"ion-list",13),f.DNE(1,AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template,6,9,"ion-item",14),f.k0s()),2&e){const e=f.XpG(2);f.R7$(),f.Y8G("ngForOf",e.confirmedContacts)}}function AddonMessagesContactsPage_ng_template_19_core_empty_box_5_Template(e,t){1&e&&(f.nrm(0,"core-empty-box",21),f.nI1(1,"translate")),2&e&&f.Y8G("message",f.bMT(1,1,"addon.messages.nocontactsgetstarted"))}function AddonMessagesContactsPage_ng_template_19_Template(e,t){if(1&e){const e=f.RV6();f.j41(0,"ion-refresher",8),f.bIt("ionRefresh",(function AddonMessagesContactsPage_ng_template_19_Template_ion_refresher_ionRefresh_0_listener(t){f.eBV(e);const n=f.XpG();return f.Njj(n.refreshData(t.target))})),f.nrm(1,"ion-refresher-content",9),f.nI1(2,"translate"),f.k0s(),f.j41(3,"core-loading",5),f.DNE(4,AddonMessagesContactsPage_ng_template_19_ion_list_4_Template,2,1,"ion-list",10)(5,AddonMessagesContactsPage_ng_template_19_core_empty_box_5_Template,2,3,"core-empty-box",11),f.j41(6,"core-infinite-loading",12),f.bIt("action",(function AddonMessagesContactsPage_ng_template_19_Template_core_infinite_loading_action_6_listener(t){f.eBV(e);const n=f.XpG();return f.Njj(n.loadMore(t))})),f.k0s()()}if(2&e){const e=f.XpG();f.Y8G("disabled",!e.confirmedLoaded),f.R7$(),f.FS9("pullingText",f.bMT(2,7,"core.pulltorefresh")),f.R7$(2),f.Y8G("hideUntil",e.confirmedLoaded),f.R7$(),f.Y8G("ngIf",e.confirmedContacts.length),f.R7$(),f.Y8G("ngIf",!e.confirmedContacts.length),f.R7$(),f.Y8G("enabled",e.confirmedCanLoadMore)("error",e.confirmedLoadMoreError)}}function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_p_4_Template(e,t){1&e&&(f.j41(0,"p"),f.EFF(1),f.nI1(2,"translate"),f.k0s()),2&e&&(f.R7$(),f.SpI(" ",f.bMT(2,1,"addon.messages.wouldliketocontactyou")," "))}function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template(e,t){if(1&e){const e=f.RV6();f.j41(0,"ion-item",15),f.bIt("click",(function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template_ion_item_click_0_listener(){const t=f.eBV(e).$implicit,n=f.XpG(3);return f.Njj(n.selectUser(t.id))})),f.nrm(1,"core-user-avatar",22),f.j41(2,"ion-label"),f.nrm(3,"core-format-text",18),f.DNE(4,AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_p_4_Template,3,3,"p",23),f.k0s()()}if(2&e){const e=t.$implicit,n=f.XpG(3);f.Y8G("detail",!0),f.BMQ("aria-label",e.fullname)("aria-current",e.id===n.selectedUserId?"page":"false"),f.R7$(),f.Y8G("user",e)("linkProfile",!1),f.R7$(2),f.Y8G("text",e.fullname)("contextInstanceId",0),f.R7$(),f.Y8G("ngIf",!e.iscontact)}}function AddonMessagesContactsPage_ng_template_22_ion_list_4_Template(e,t){if(1&e&&(f.j41(0,"ion-list",13),f.DNE(1,AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template,5,8,"ion-item",14),f.k0s()),2&e){const e=f.XpG(2);f.R7$(),f.Y8G("ngForOf",e.requests)}}function AddonMessagesContactsPage_ng_template_22_core_empty_box_5_Template(e,t){1&e&&(f.nrm(0,"core-empty-box",21),f.nI1(1,"translate")),2&e&&f.Y8G("message",f.bMT(1,1,"addon.messages.nocontactrequests"))}function AddonMessagesContactsPage_ng_template_22_Template(e,t){if(1&e){const e=f.RV6();f.j41(0,"ion-refresher",8),f.bIt("ionRefresh",(function AddonMessagesContactsPage_ng_template_22_Template_ion_refresher_ionRefresh_0_listener(t){f.eBV(e);const n=f.XpG();return f.Njj(n.refreshData(t.target))})),f.nrm(1,"ion-refresher-content",9),f.nI1(2,"translate"),f.k0s(),f.j41(3,"core-loading",5),f.DNE(4,AddonMessagesContactsPage_ng_template_22_ion_list_4_Template,2,1,"ion-list",10)(5,AddonMessagesContactsPage_ng_template_22_core_empty_box_5_Template,2,3,"core-empty-box",11),f.j41(6,"core-infinite-loading",12),f.bIt("action",(function AddonMessagesContactsPage_ng_template_22_Template_core_infinite_loading_action_6_listener(t){f.eBV(e);const n=f.XpG();return f.Njj(n.loadMore(t))})),f.k0s()()}if(2&e){const e=f.XpG();f.Y8G("disabled",!e.requestsLoaded),f.R7$(),f.FS9("pullingText",f.bMT(2,7,"core.pulltorefresh")),f.R7$(2),f.Y8G("hideUntil",e.requestsLoaded),f.R7$(),f.Y8G("ngIf",e.requests.length),f.R7$(),f.Y8G("ngIf",!e.requests.length),f.R7$(),f.Y8G("enabled",e.requestsCanLoadMore)("error",e.requestsLoadMoreError)}}let v=(()=>{var e;class AddonMessagesContactsPage{constructor(){this.selected="confirmed",this.requestsBadge="",this.confirmedLoaded=!1,this.confirmedInitialising=!1,this.confirmedCanLoadMore=!1,this.confirmedLoadMoreError=!1,this.confirmedContacts=[],this.requestsLoaded=!1,this.requestsInitialising=!1,this.requestsCanLoadMore=!1,this.requestsLoadMoreError=!1,this.requests=[],this.siteId=a.CoreSites.getCurrentSiteId(),this.contactRequestsCountObserver=o.z.on(l.l3,(e=>{this.requestsBadge=e.count>0?String(e.count):""}),this.siteId),this.memberInfoObserver=o.z.on(l.Ie,(e=>{if(e.userBlocked||e.userUnblocked){const t=this.confirmedContacts.find((t=>t.id==e.userId));t&&(t.isblocked=!!e.userBlocked)}else if(e.contactRemoved){const t=this.confirmedContacts.findIndex((t=>t.id==e.userId));t>=0&&this.confirmedContacts.splice(t,1)}else e.contactRequestConfirmed&&this.confirmedFetchData(!0);if(e.contactRequestConfirmed||e.contactRequestDeclined){const t=this.requests.findIndex((t=>t.id==e.userId));t>=0&&this.requests.splice(t,1)}}),a.CoreSites.getCurrentSiteId())}ngOnInit(){var e=this;return(0,s.A)((function*(){i.AddonMessages.getContactRequestsCount(e.siteId),"confirmed"===e.selected?yield e.initConfirmed():yield e.initRequests()}))()}initConfirmed(){var e=this;return(0,s.A)((function*(){if(!e.confirmedInitialising)try{e.confirmedInitialising=!0,yield e.confirmedFetchData(),e.confirmedContacts.length&&c.CoreScreen.isTablet&&e.selectUser(e.confirmedContacts[0].id,!0)}finally{e.confirmedInitialising=!1,e.confirmedLoaded=!0}}))()}initRequests(){var e=this;return(0,s.A)((function*(){if(!e.requestsInitialising)try{e.requestsInitialising=!0,yield e.requestsFetchData(),e.requests.length&&c.CoreScreen.isTablet&&e.selectUser(e.requests[0].id,!0)}finally{e.requestsInitialising=!1,e.requestsLoaded=!0}}))()}confirmedFetchData(e=!1){var t=this;return(0,s.A)((function*(){t.confirmedLoadMoreError=!1;const n=e?0:t.confirmedContacts.length;0===n&&(yield i.AddonMessages.invalidateUserContacts());try{const s=yield i.AddonMessages.getUserContacts(n);t.confirmedContacts=e?s.contacts:t.confirmedContacts.concat(s.contacts),t.confirmedCanLoadMore=s.canLoadMore}catch(e){t.confirmedLoadMoreError=!0,g.CoreAlerts.showError(e,{default:_.HT.instant("addon.messages.errorwhileretrievingcontacts")})}}))()}requestsFetchData(e=!1){var t=this;return(0,s.A)((function*(){t.requestsLoadMoreError=!1;const n=e?0:t.requests.length;0===n&&(yield i.AddonMessages.invalidateContactRequestsCache());try{const s=yield i.AddonMessages.getContactRequests(n);t.requests=e?s.requests:t.requests.concat(s.requests),t.requestsCanLoadMore=s.canLoadMore}catch(e){t.requestsLoadMoreError=!0,g.CoreAlerts.showError(e,{default:_.HT.instant("addon.messages.errorwhileretrievingcontacts")})}}))()}refreshData(e){var t=this;return(0,s.A)((function*(){try{"confirmed"==t.selected?yield t.confirmedFetchData(!0):(i.AddonMessages.refreshContactRequestsCount(),yield t.requestsFetchData(!0))}finally{null==e||e.complete()}}))()}loadMore(e){var t=this;return(0,s.A)((function*(){try{"confirmed"==t.selected?yield t.confirmedFetchData():yield t.requestsFetchData()}finally{e&&e()}}))()}gotoSearch(){r.CoreNavigator.navigateToSitePath("search")}selectTab(e){"confirmed"!==e&&"requests"!==e||(this.selected=e,"confirmed"!=this.selected||this.confirmedLoaded||this.initConfirmed(),"requests"!=this.selected||this.requestsLoaded||this.initRequests())}selectUser(e,t=!1){if(e==this.selectedUserId&&c.CoreScreen.isTablet)return;if(t&&c.CoreScreen.isMobile)return;this.selectedUserId=e;const n=r.CoreNavigator.getRelativePathToParent("/messages/contacts")+`discussion/user/${e}`;r.CoreNavigator.navigate(n,{reset:c.CoreScreen.isTablet&&!!this.splitView&&!this.splitView.isNested})}ngOnDestroy(){var e;null===(e=this.contactRequestsCountObserver)||void 0===e||e.off()}}return(e=AddonMessagesContactsPage).ɵfac=function AddonMessagesContactsPage_Factory(t){return new(t||e)},e.ɵcmp=f.VBU({type:e,selectors:[["page-addon-messages-contacts"]],viewQuery:function AddonMessagesContactsPage_Query(e,t){if(1&e&&f.GBs(d.M,5),2&e){let e;f.mGM(e=f.lsd())&&(t.splitView=e.first)}},standalone:!0,features:[f.aNF],decls:23,vars:17,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["name","fas-magnifying-glass","slot","icon-only","aria-hidden","true"],[3,"hideUntil"],[3,"ionSelect","title"],["badgeA11yText","addon.messages.pendingcontactrequests",3,"ionSelect","title","badge"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["class","ion-no-margin",4,"ngIf"],["icon","far-address-book",3,"message",4,"ngIf"],["position","bottom",3,"action","enabled","error"],[1,"ion-no-margin"],["class","ion-text-wrap addon-messages-conversation-item","button","",3,"detail","click",4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap","addon-messages-conversation-item",3,"click","detail"],["slot","start",3,"user","checkOnline","linkProfile"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-user-slash","slot","end",4,"ngIf"],["name","fas-user-slash","slot","end"],["icon","far-address-book",3,"message"],["slot","start",3,"user","linkProfile"],[4,"ngIf"]],template:function AddonMessagesContactsPage_Template(e,t){1&e&&(f.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),f.nrm(3,"ion-back-button",1),f.nI1(4,"translate"),f.k0s(),f.j41(5,"ion-title")(6,"h1"),f.EFF(7),f.nI1(8,"translate"),f.k0s()(),f.j41(9,"ion-buttons",2)(10,"ion-button",3),f.nI1(11,"translate"),f.bIt("click",(function AddonMessagesContactsPage_Template_ion_button_click_10_listener(){return t.gotoSearch()})),f.nrm(12,"ion-icon",4),f.k0s(),f.nrm(13,"core-context-menu"),f.k0s()()(),f.j41(14,"ion-content")(15,"core-split-view")(16,"core-tabs",5)(17,"core-tab",6),f.nI1(18,"translate"),f.bIt("ionSelect",(function AddonMessagesContactsPage_Template_core_tab_ionSelect_17_listener(){return t.selectTab("confirmed")})),f.DNE(19,AddonMessagesContactsPage_ng_template_19_Template,7,9,"ng-template"),f.k0s(),f.j41(20,"core-tab",7),f.nI1(21,"translate"),f.bIt("ionSelect",(function AddonMessagesContactsPage_Template_core_tab_ionSelect_20_listener(){return t.selectTab("requests")})),f.DNE(22,AddonMessagesContactsPage_ng_template_22_Template,7,9,"ng-template"),f.k0s()()()()),2&e&&(f.R7$(3),f.Y8G("text",f.bMT(4,7,"core.back")),f.R7$(4),f.JRh(f.bMT(8,9,"addon.messages.contacts")),f.R7$(3),f.Y8G("ariaLabel",f.bMT(11,11,"addon.messages.searchcombined")),f.R7$(6),f.Y8G("hideUntil",!0),f.R7$(),f.Y8G("title",f.bMT(18,13,"addon.messages.contacts")),f.R7$(3),f.Y8G("title",f.bMT(21,15,"addon.messages.requests"))("badge",t.requestsBadge))},dependencies:[m.n,u.Sq,u.bT,C.Jm,C.QW,C.W9,C.eU,C.iq,C.uz,C.he,C.nf,C.To,C.Ki,C.BC,C.ai,C.el,M.B,h.h,p.b,P.R,d.M,b.K,O.h,I.T,T.t,q.B,A.i,R.T,x.D9],styles:["[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:.6875rem}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-inline-end:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesContactsPage})()}}]);