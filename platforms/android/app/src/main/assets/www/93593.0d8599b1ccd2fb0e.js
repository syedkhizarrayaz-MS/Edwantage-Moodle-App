"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[93593,69006],{6369:(n,o,e)=>{e.d(o,{a:()=>_});var t=e(10467),i=e(99522),s=e(98870),r=e(15221),d=e(43411),a=e(16179),u=e(11945),c=e(2216),l=e(52749),m=e(55554);let _=(()=>{class AddonModForumDiscussionsSource extends i.F{constructor(n,o,e){super(),this.trackPosts=!1,this.usesGroups=!1,this.supportsChangeGroup=!1,this.selectedSortOrder=null,this.groupId=0,this.canAddDiscussionToGroup=!0,this.errorLoadingDiscussions=!1,this.DISCUSSIONS_PATH_PREFIX=e,this.COURSE_ID=n,this.CM_ID=o}isNewDiscussionForm(n){return"newDiscussion"in n}isOfflineDiscussion(n){return!this.isNewDiscussionForm(n)&&!this.isOnlineDiscussion(n)}isOnlineDiscussion(n){return"id"in n}getItemPath(n){return this.isOnlineDiscussion(n)?this.DISCUSSIONS_PATH_PREFIX+n.discussion:this.isOfflineDiscussion(n)?`${this.DISCUSSIONS_PATH_PREFIX}new/${n.timecreated}`:`${this.DISCUSSIONS_PATH_PREFIX}new/0`}getItemQueryParams(n){var o;const e={courseId:this.COURSE_ID,cmId:this.CM_ID,forumId:null===(o=this.forum)||void 0===o?void 0:o.id};return this.isOnlineDiscussion(n)?(e.discussion=n,e.trackPosts=this.trackPosts):this.isNewDiscussionForm(n)&&(e.groupId=this.usesGroups?this.groupId:void 0),e}getPagesLoaded(){if(null===this.items)return 0;const n=this.items.filter((n=>this.isOnlineDiscussion(n)));return Math.ceil(n.length/this.getPageLength())}getPageLength(){return c.eG}loadForum(){var n=this;return(0,t.A)((function*(){n.forum=yield a.AddonModForum.getForum(n.COURSE_ID,n.CM_ID),void 0!==n.forum.istracked&&(n.trackPosts=n.forum.istracked)}))()}loadGroupInfo(n){var o=this;return(0,t.A)((function*(){[o.groupInfo,o.allPartsPermissions]=yield Promise.all([r.CoreGroups.getActivityGroupInfo(o.CM_ID,!1),m.g.ignoreErrors(a.AddonModForum.canAddDiscussionToAll(n,{cmId:o.CM_ID}))]),o.supportsChangeGroup=a.AddonModForum.isGetDiscussionPostsAvailable(),o.usesGroups=!(!o.groupInfo.separateGroups&&!o.groupInfo.visibleGroups),o.groupId=r.CoreGroups.validateGroupId(o.groupId,o.groupInfo),yield o.loadSelectedGroupData()}))()}loadSelectedGroupData(){var n=this;return(0,t.A)((function*(){if(n.usesGroups)if(0===n.groupId)n.canAddDiscussionToGroup=!n.allPartsPermissions||n.allPartsPermissions.status;else if(n.forum){const o=yield a.AddonModForum.canAddDiscussion(n.forum.id,n.groupId,{cmId:n.CM_ID});n.canAddDiscussionToGroup=o.status}else n.canAddDiscussionToGroup=!0;else n.canAddDiscussionToGroup=!0}))()}loadPageItems(n){var o=this;return(0,t.A)((function*(){var e;const t=[];if(0===n){const n=yield o.loadOfflineDiscussions();t.push(AddonModForumDiscussionsSource.NEW_DISCUSSION),t.push(...n)}const{discussions:i,canLoadMore:s}=yield o.loadOnlineDiscussions(n);if(t.push(...i),o.canAddDiscussionToGroup&&"eachuser"===(null===(e=o.forum)||void 0===e?void 0:e.type)){const n=l.CoreSites.getCurrentSiteUserId();o.canAddDiscussionToGroup=!t.some((e=>o.isOfflineDiscussion(e)||!o.isNewDiscussionForm(e)&&e.userid===n))}return{items:t,hasMoreItems:s}}))()}loadOnlineDiscussions(n){var o=this;return(0,t.A)((function*(){if(!o.forum||!o.selectedSortOrder)throw new Error("Can't load discussions without a forum or selected sort order");let e=[],t=!1;try{const i=yield a.AddonModForum.getDiscussions(o.forum.id,{cmId:o.forum.cmid,sortOrder:o.selectedSortOrder.value,page:n,groupId:o.groupId});e=i.discussions,t=i.canLoadMore,o.errorLoadingDiscussions=!1}catch(e){if(n>0||d.CoreWSError.isWebServiceError(e))throw e;o.errorLoadingDiscussions=!0}if(o.usesGroups&&(e=yield a.AddonModForum.formatDiscussionsGroups(o.forum.cmid,e)),"single"===o.forum.type)for(const n of e)if(n.userfullname&&0===n.parent){n.userfullname=!1;break}if(void 0===o.forum.istracked&&!o.trackPosts)for(const n of e)if(n.numunread>0){o.trackPosts=!0;break}return{discussions:e,canLoadMore:t}}))()}loadOfflineDiscussions(){var n=this;return(0,t.A)((function*(){if(!n.forum)throw new Error("Can't load discussions without a forum");const o=n.forum;let e=yield u.p.getNewDiscussions(o.id);if(0===e.length)return[];n.usesGroups&&(e=yield a.AddonModForum.formatDiscussionsGroups(o.cmid,e));const i=e.map(function(){var e=(0,t.A)((function*(e){const t=e;if(0!==t.parent&&"single"!==o.type)try{const o=yield s.CoreUser.getProfile(t.userid,n.COURSE_ID,!0);t.userfullname=o.fullname,t.userpictureurl=o.profileimageurl}catch{}}));return function(n){return e.apply(this,arguments)}}());return yield Promise.all(i),e.sort(((n,o)=>o.timecreated-n.timecreated)),e}))()}invalidateCache(){var n=this;return(0,t.A)((function*(){const o=[];o.push(a.AddonModForum.invalidateForumData(n.COURSE_ID)),n.forum&&(o.push(a.AddonModForum.invalidateDiscussionsList(n.forum.id)),o.push(a.AddonModForum.invalidateCanAddDiscussion(n.forum.id)),o.push(r.CoreGroups.invalidateActivityGroupInfo(n.forum.cmid))),yield Promise.all(o)}))()}invalidateList(){var n=this;return(0,t.A)((function*(){n.forum&&(yield a.AddonModForum.invalidateDiscussionsList(n.forum.id))}))()}}return AddonModForumDiscussionsSource.NEW_DISCUSSION={newDiscussion:!0},AddonModForumDiscussionsSource})()},93593:(n,o,e)=>{e.r(o),e.d(o,{AddonModForumIndexComponent:()=>en});var t=e(10467),i=e(69006),s=e(16179),r=e(11945),d=e(79555),a=e(51024),u=e(93956),c=e(49882),l=e(52749),m=e(98870),_=e(44682),p=e(29492),f=e(93417),g=e(57095),h=e(87326),I=e(82308),v=e(32440),C=e(6369),M=e(2401),A=e(83696),b=e(25124),F=e(15324),O=e(2216),S=e(89014),y=e(47551),x=e(24813),D=e(33014),T=e(25572),R=e(86654),P=e(30864),w=e(6736),G=e(54438),k=e(21182),E=e(2910),$=e(60177),N=e(69502),j=e(17388),L=e(16986),V=e(97818),Y=e(66198),X=e(64422),U=e(13988),B=e(16658),z=e(7570),H=e(19858),q=e(86198),Q=e(58197),J=e(8199),W=e(66731),K=e(43570),Z=e(73955),nn=e(59528),on=e(93453);const _c0=(n,o)=>({blockafter:n,blockperiod:o}),_c1=n=>({$a:n}),_c2=n=>({numreplies:n}),_c3=n=>({$a:n});function AddonModForumIndexComponent_ion_button_1_Template(n,o){if(1&n){const n=G.RV6();G.j41(0,"ion-button",14),G.nI1(1,"translate"),G.bIt("click",(function AddonModForumIndexComponent_ion_button_1_Template_ion_button_click_0_listener(){G.eBV(n);const o=G.XpG();return G.Njj(o.openSearch())})),G.nrm(2,"ion-icon",15),G.k0s()}2&n&&G.Y8G("ariaLabel",G.bMT(1,1,"core.search"))}function AddonModForumIndexComponent_Conditional_2_Template(n,o){if(1&n){const n=G.RV6();G.j41(0,"ion-button",16),G.nI1(1,"translate"),G.bIt("click",(function AddonModForumIndexComponent_Conditional_2_Template_ion_button_click_0_listener(){G.eBV(n);const o=G.XpG();return G.Njj(o.openModuleSummary())})),G.nrm(2,"ion-icon",17),G.k0s(),G.nrm(3,"core-context-menu")}2&n&&G.Y8G("ariaLabel",G.bMT(1,1,"core.info"))}function AddonModForumIndexComponent_Conditional_3_Template(n,o){if(1&n){const n=G.RV6();G.j41(0,"core-context-menu")(1,"core-context-menu-item",18),G.nI1(2,"translate"),G.bIt("action",(function AddonModForumIndexComponent_Conditional_3_Template_core_context_menu_item_action_1_listener(){G.eBV(n);const o=G.XpG();return G.Njj(o.openModuleSummary())})),G.k0s()()}2&n&&(G.R7$(),G.Y8G("priority",5e3)("content",G.bMT(2,2,"core.info")))}function AddonModForumIndexComponent_core_group_selector_13_Template(n,o){if(1&n){const n=G.RV6();G.j41(0,"core-group-selector",19),G.mxI("selectedChange",(function AddonModForumIndexComponent_core_group_selector_13_Template_core_group_selector_selectedChange_0_listener(o){G.eBV(n);const e=G.XpG();return G.DH7(e.groupId,o)||(e.groupId=o),G.Njj(o)})),G.bIt("selectedChange",(function AddonModForumIndexComponent_core_group_selector_13_Template_core_group_selector_selectedChange_0_listener(){G.eBV(n);const o=G.XpG();return G.Njj(o.groupChanged())})),G.k0s()}if(2&n){const n=G.XpG();G.Y8G("groupInfo",n.groupInfo),G.R50("selected",n.groupId),G.Y8G("courseId",n.courseId)}}function AddonModForumIndexComponent_ion_card_14_Template(n,o){if(1&n&&(G.j41(0,"ion-card",10)(1,"ion-item"),G.nrm(2,"ion-icon",20),G.j41(3,"ion-label"),G.EFF(4),G.k0s()()()),2&n){const n=G.XpG();G.R7$(4),G.JRh(n.availabilityMessage)}}function AddonModForumIndexComponent_ion_card_15_Template(n,o){1&n&&(G.j41(0,"ion-card",10)(1,"ion-item"),G.nrm(2,"ion-icon",20),G.j41(3,"ion-label"),G.EFF(4),G.nI1(5,"translate"),G.k0s()()()),2&n&&(G.R7$(4),G.JRh(G.bMT(5,1,"addon.mod_forum.qandanotify")))}function AddonModForumIndexComponent_ion_card_16_span_4_Template(n,o){1&n&&(G.j41(0,"span"),G.EFF(1),G.nI1(2,"translate"),G.k0s()),2&n&&(G.R7$(),G.JRh(G.bMT(2,1,"addon.mod_forum.cannotadddiscussionall")))}function AddonModForumIndexComponent_ion_card_16_span_5_Template(n,o){1&n&&(G.j41(0,"span"),G.EFF(1),G.nI1(2,"translate"),G.k0s()),2&n&&(G.R7$(),G.JRh(G.bMT(2,1,"addon.mod_forum.cannotadddiscussion")))}function AddonModForumIndexComponent_ion_card_16_Template(n,o){if(1&n&&(G.j41(0,"ion-card",21)(1,"ion-item"),G.nrm(2,"ion-icon",22),G.j41(3,"ion-label"),G.DNE(4,AddonModForumIndexComponent_ion_card_16_span_4_Template,3,3,"span",11)(5,AddonModForumIndexComponent_ion_card_16_span_5_Template,3,3,"span",11),G.k0s()()()),2&n){const n=G.XpG();G.R7$(4),G.Y8G("ngIf",n.groupId<=0),G.R7$(),G.Y8G("ngIf",n.groupId>0)}}function AddonModForumIndexComponent_Conditional_17_Template(n,o){1&n&&(G.j41(0,"ion-card",10)(1,"ion-item"),G.nrm(2,"ion-icon",20),G.j41(3,"ion-label")(4,"span"),G.EFF(5),G.nI1(6,"translate"),G.k0s()()()()),2&n&&(G.R7$(5),G.JRh(G.bMT(6,1,"addon.mod_forum.allowsdiscussions")))}function AddonModForumIndexComponent_Conditional_18_Template(n,o){if(1&n&&(G.j41(0,"ion-card",10)(1,"ion-item"),G.nrm(2,"ion-icon",20),G.j41(3,"ion-label")(4,"span"),G.EFF(5),G.nI1(6,"translate"),G.nI1(7,"translate"),G.k0s()()()()),2&n){const n=G.XpG();G.R7$(5),G.JRh(G.i5U(7,3,"addon.mod_forum.thisforumisthrottled",G.eq3(9,_c1,G.l_i(6,_c0,n.forum.blockafter,G.bMT(6,1,"core.secondstotime"+n.forum.blockperiod)))))}}function AddonModForumIndexComponent_ng_container_19_div_1_ion_select_option_3_Template(n,o){if(1&n&&(G.j41(0,"ion-select-option",30),G.EFF(1),G.nI1(2,"translate"),G.k0s()),2&n){const n=o.$implicit;G.Y8G("value",n.value),G.R7$(),G.SpI(" ",G.bMT(2,2,n.label)," ")}}function AddonModForumIndexComponent_ng_container_19_div_1_Template(n,o){if(1&n){const n=G.RV6();G.j41(0,"div",6)(1,"core-combobox",28),G.nI1(2,"translate"),G.bIt("onChange",(function AddonModForumIndexComponent_ng_container_19_div_1_Template_core_combobox_onChange_1_listener(o){G.eBV(n);const e=G.XpG(2);return G.Njj(e.setSortOrder(o))})),G.DNE(3,AddonModForumIndexComponent_ng_container_19_div_1_ion_select_option_3_Template,3,4,"ion-select-option",29),G.k0s()()}if(2&n){const n=G.XpG(2);G.R7$(),G.Y8G("label",G.bMT(2,3,"core.sort"))("selection",n.selectedSortOrder.value),G.R7$(2),G.Y8G("ngForOf",n.sortOrders)}}function AddonModForumIndexComponent_ng_container_19_core_empty_box_2_Template(n,o){1&n&&(G.nrm(0,"core-empty-box",31),G.nI1(1,"translate")),2&n&&G.Y8G("message",G.bMT(1,1,"addon.mod_forum.forumnodiscussionsyet"))}function AddonModForumIndexComponent_ng_container_19_core_empty_box_3_Template(n,o){1&n&&(G.j41(0,"core-empty-box",32),G.nI1(1,"translate"),G.j41(2,"p"),G.EFF(3),G.nI1(4,"translate"),G.k0s()()),2&n&&(G.Y8G("message",G.bMT(1,2,"addon.mod_forum.errorloadingsortingorder")),G.R7$(3),G.JRh(G.bMT(4,4,"addon.mod_forum.errorloadingsortingorderdetails")))}function AddonModForumIndexComponent_ng_container_19_div_4_ion_icon_4_Template(n,o){1&n&&(G.nrm(0,"ion-icon",48),G.nI1(1,"translate")),2&n&&G.BMQ("aria-label",G.bMT(1,1,"addon.mod_forum.discussionpinned"))}function AddonModForumIndexComponent_ng_container_19_div_4_ion_icon_5_Template(n,o){1&n&&(G.nrm(0,"ion-icon",49),G.nI1(1,"translate")),2&n&&G.BMQ("aria-label",G.bMT(1,1,"addon.mod_forum.favourites"))}function AddonModForumIndexComponent_ng_container_19_div_4_ion_icon_8_Template(n,o){1&n&&(G.nrm(0,"ion-icon",50),G.nI1(1,"translate")),2&n&&G.BMQ("aria-label",G.bMT(1,1,"addon.mod_forum.discussionlocked"))}function AddonModForumIndexComponent_ng_container_19_div_4_core_user_avatar_10_Template(n,o){if(1&n&&G.nrm(0,"core-user-avatar",51),2&n){const n=G.XpG().$implicit,o=G.XpG(2);G.Y8G("user",n)("courseId",o.courseId)("linkProfile",!1)}}function AddonModForumIndexComponent_ng_container_19_div_4_span_12_Template(n,o){if(1&n&&(G.j41(0,"span",52),G.EFF(1),G.k0s()),2&n){const n=G.XpG().$implicit;G.R7$(),G.JRh(n.userfullname)}}function AddonModForumIndexComponent_ng_container_19_div_4_p_13_Template(n,o){if(1&n&&(G.j41(0,"p",53),G.nrm(1,"ion-icon",54),G.nI1(2,"translate"),G.nrm(3,"core-format-text",55),G.k0s()),2&n){const n=G.XpG().$implicit,o=G.XpG(2);G.R7$(),G.BMQ("aria-label",G.bMT(2,4,"addon.mod_forum.group")),G.R7$(2),G.Y8G("text",n.groupname)("contextInstanceId",o.courseId)("wsNotFiltered",!0)}}function AddonModForumIndexComponent_ng_container_19_div_4_p_14_Template(n,o){if(1&n&&(G.j41(0,"p"),G.EFF(1),G.nI1(2,"coreFormatDate"),G.k0s()),2&n){const n=G.XpG().$implicit;G.R7$(),G.SpI(" ",G.i5U(2,1,1e3*n.created,"strftimerecentfull")," ")}}function AddonModForumIndexComponent_ng_container_19_div_4_p_15_Template(n,o){1&n&&(G.j41(0,"p"),G.nrm(1,"ion-icon",56),G.EFF(2),G.nI1(3,"translate"),G.k0s()),2&n&&(G.R7$(2),G.SpI(" ",G.bMT(3,1,"core.notsent")," "))}function AddonModForumIndexComponent_ng_container_19_div_4_ion_row_16_ng_container_6_Template(n,o){if(1&n&&(G.qex(0),G.EFF(1),G.nI1(2,"coreTimeAgo"),G.bVm()),2&n){const n=G.XpG(2).$implicit;G.R7$(),G.SpI(" ",G.bMT(2,1,n.timemodified)," ")}}function AddonModForumIndexComponent_ng_container_19_div_4_ion_row_16_ng_container_7_Template(n,o){if(1&n&&(G.qex(0),G.EFF(1),G.nI1(2,"coreTimeAgo"),G.bVm()),2&n){const n=G.XpG(2).$implicit;G.R7$(),G.SpI(" ",G.bMT(2,1,n.created)," ")}}function AddonModForumIndexComponent_ng_container_19_div_4_ion_row_16_ion_badge_13_Template(n,o){if(1&n&&(G.j41(0,"ion-badge",62)(1,"span",63),G.EFF(2),G.k0s(),G.j41(3,"span",64),G.EFF(4),G.nI1(5,"translate"),G.k0s()()),2&n){const n=G.XpG(2).$implicit;G.R7$(2),G.JRh(n.numunread),G.R7$(2),G.SpI(" ",G.i5U(5,2,"addon.mod_forum.unreadpostsnumber",G.eq3(5,_c3,n.numunread))," ")}}function AddonModForumIndexComponent_ng_container_19_div_4_ion_row_16_Template(n,o){if(1&n&&(G.j41(0,"ion-row",57)(1,"ion-col",58)(2,"ion-note"),G.nrm(3,"ion-icon",56),G.EFF(4),G.nI1(5,"translate"),G.DNE(6,AddonModForumIndexComponent_ng_container_19_div_4_ion_row_16_ng_container_6_Template,3,3,"ng-container",11)(7,AddonModForumIndexComponent_ng_container_19_div_4_ion_row_16_ng_container_7_Template,3,3,"ng-container",11),G.k0s()(),G.j41(8,"ion-col",59)(9,"ion-note"),G.nrm(10,"ion-icon",60),G.EFF(11),G.nI1(12,"translate"),G.DNE(13,AddonModForumIndexComponent_ng_container_19_div_4_ion_row_16_ion_badge_13_Template,6,7,"ion-badge",61),G.k0s()()()),2&n){const n=G.XpG().$implicit;G.R7$(4),G.SpI(" ",G.bMT(5,5,"addon.mod_forum.lastpost")," "),G.R7$(2),G.Y8G("ngIf",n.timemodified>n.created),G.R7$(),G.Y8G("ngIf",n.timemodified<=n.created),G.R7$(4),G.SpI(" ",G.i5U(12,7,"addon.mod_forum.numreplies",G.eq3(10,_c2,n.numreplies))," "),G.R7$(2),G.Y8G("ngIf",n.numunread)}}function AddonModForumIndexComponent_ng_container_19_div_4_ion_button_17_Template(n,o){if(1&n){const n=G.RV6();G.j41(0,"ion-button",65),G.nI1(1,"translate"),G.bIt("click",(function AddonModForumIndexComponent_ng_container_19_div_4_ion_button_17_Template_ion_button_click_0_listener(o){G.eBV(n);const e=G.XpG().$implicit,t=G.XpG(2);return G.Njj(t.showOptionsMenu(o,e))})),G.nrm(2,"ion-icon",66),G.k0s()}2&n&&G.Y8G("ariaLabel",G.bMT(1,1,"core.displayoptions"))}function AddonModForumIndexComponent_ng_container_19_div_4_Template(n,o){if(1&n){const n=G.RV6();G.j41(0,"div",33)(1,"ion-item",34),G.bIt("click",(function AddonModForumIndexComponent_ng_container_19_div_4_Template_ion_item_click_1_listener(){const o=G.eBV(n).$implicit,e=G.XpG(2);return G.Njj(null==e.discussions?null:e.discussions.select(o))})),G.j41(2,"ion-label")(3,"p",35),G.DNE(4,AddonModForumIndexComponent_ng_container_19_div_4_ion_icon_4_Template,2,3,"ion-icon",36)(5,AddonModForumIndexComponent_ng_container_19_div_4_ion_icon_5_Template,2,3,"ion-icon",37),G.j41(6,"span",38),G.bIt("ariaButtonClick",(function AddonModForumIndexComponent_ng_container_19_div_4_Template_span_ariaButtonClick_6_listener(){const o=G.eBV(n).$implicit,e=G.XpG(2);return G.Njj(null==e.discussions?null:e.discussions.select(o))})),G.nrm(7,"core-format-text",39),G.k0s(),G.DNE(8,AddonModForumIndexComponent_ng_container_19_div_4_ion_icon_8_Template,2,3,"ion-icon",40),G.k0s(),G.j41(9,"div",41),G.DNE(10,AddonModForumIndexComponent_ng_container_19_div_4_core_user_avatar_10_Template,1,3,"core-user-avatar",42),G.j41(11,"div",43),G.DNE(12,AddonModForumIndexComponent_ng_container_19_div_4_span_12_Template,2,1,"span",44)(13,AddonModForumIndexComponent_ng_container_19_div_4_p_13_Template,4,6,"p",45)(14,AddonModForumIndexComponent_ng_container_19_div_4_p_14_Template,3,4,"p",11)(15,AddonModForumIndexComponent_ng_container_19_div_4_p_15_Template,4,3,"p",11),G.k0s()(),G.DNE(16,AddonModForumIndexComponent_ng_container_19_div_4_ion_row_16_Template,14,12,"ion-row",46),G.k0s(),G.DNE(17,AddonModForumIndexComponent_ng_container_19_div_4_ion_button_17_Template,3,3,"ion-button",47),G.k0s(),G.nrm(18,"ion-ripple-effect"),G.k0s()}if(2&n){const n=o.$implicit,e=G.XpG(2);G.R7$(),G.Y8G("detail",!0)("lines",n.groupname&&"none"),G.BMQ("aria-current",null==e.discussions?null:e.discussions.getItemAriaCurrent(n)),G.R7$(3),G.Y8G("ngIf",n.pinned),G.R7$(),G.Y8G("ngIf",n.starred),G.R7$(2),G.Y8G("text",n.subject)("courseId",e.courseId)("contextInstanceId",e.module&&e.module.id)("sanitize",e.isOfflineDiscussion(n)),G.R7$(),G.Y8G("ngIf",n.locked),G.R7$(2),G.Y8G("ngIf",n.userfullname),G.R7$(2),G.Y8G("ngIf",n.userfullname),G.R7$(),G.Y8G("ngIf",n.groupname),G.R7$(),G.Y8G("ngIf",e.isOnlineDiscussion(n)),G.R7$(),G.Y8G("ngIf",e.isOfflineDiscussion(n)),G.R7$(),G.Y8G("ngIf",e.isOnlineDiscussion(n)),G.R7$(),G.Y8G("ngIf",e.canPin||n.canlock||n.canfavourite)}}function AddonModForumIndexComponent_ng_container_19_Template(n,o){if(1&n){const n=G.RV6();G.qex(0),G.DNE(1,AddonModForumIndexComponent_ng_container_19_div_1_Template,4,5,"div",23)(2,AddonModForumIndexComponent_ng_container_19_core_empty_box_2_Template,2,3,"core-empty-box",24)(3,AddonModForumIndexComponent_ng_container_19_core_empty_box_3_Template,5,6,"core-empty-box",25)(4,AddonModForumIndexComponent_ng_container_19_div_4_Template,19,17,"div",26),G.j41(5,"core-infinite-loading",27),G.bIt("action",(function AddonModForumIndexComponent_ng_container_19_Template_core_infinite_loading_action_5_listener(o){G.eBV(n);const e=G.XpG();return G.Njj(e.fetchMoreDiscussions(o))})),G.k0s(),G.bVm()}if(2&n){const n=G.XpG();G.R7$(),G.Y8G("ngIf",n.discussions&&n.sortingAvailable&&n.selectedSortOrder),G.R7$(),G.Y8G("ngIf",!n.discussions||!n.discussions.hasDiscussions&&!n.errorLoadingDiscussions),G.R7$(),G.Y8G("ngIf",n.errorLoadingDiscussions),G.R7$(),G.Y8G("ngForOf",n.discussionsItems),G.R7$(),G.Y8G("enabled",n.discussions&&n.discussions.loaded&&!n.discussions.completed)("error",n.fetchFailed)}}function AddonModForumIndexComponent_ion_fab_21_Template(n,o){if(1&n){const n=G.RV6();G.j41(0,"ion-fab",67)(1,"ion-fab-button",68),G.bIt("click",(function AddonModForumIndexComponent_ion_fab_21_Template_ion_fab_button_click_1_listener(){G.eBV(n);const o=G.XpG();return G.Njj(o.openNewDiscussion())})),G.nrm(2,"ion-icon",69),G.j41(3,"span",64),G.EFF(4),G.k0s()()()}if(2&n){const n=G.XpG();G.R7$(),G.BMQ("aria-label",n.addDiscussionText),G.R7$(3),G.JRh(n.addDiscussionText)}}let en=(()=>{var n;class AddonModForumIndexComponent extends i.y{constructor(n,o,e){super("AddonModForumIndexComponent",o,e),this.route=n,this.content=o,this.component=O.CT,this.pluginName="forum",this.discussionsItems=[],this.fetchFailed=!1,this.canAddDiscussion=!1,this.availabilityMessage=null,this.sortOrders=[],this.hasOfflineRatings=!1,this.showQAMessage=!1,this.isSetPinAvailable=!1,this.showSearch=!1,this.fetchContentDefaultError="addon.mod_forum.errorgetforum",this.syncEventName=O.D7,this.checkCompletionAfterLog=!1,this.promisedDiscussions=new b._}get discussions(){return this.promisedDiscussions.value}get forum(){var n;return null===(n=this.discussions)||void 0===n?void 0:n.getSource().forum}get selectedSortOrder(){var n,o;return null!==(n=null===(o=this.discussions)||void 0===o?void 0:o.getSource().selectedSortOrder)&&void 0!==n?n:void 0}get supportsChangeGroup(){var n,o;return null!==(n=null===(o=this.discussions)||void 0===o?void 0:o.getSource().supportsChangeGroup)&&void 0!==n&&n}get groupId(){var n,o;return null!==(n=null===(o=this.discussions)||void 0===o?void 0:o.getSource().groupId)&&void 0!==n?n:0}set groupId(n){this.discussions&&(this.discussions.getSource().groupId=n)}get groupInfo(){var n;return null===(n=this.discussions)||void 0===n?void 0:n.getSource().groupInfo}get usesGroups(){var n;return!(null===(n=this.discussions)||void 0===n||!n.getSource().usesGroups)}get canPin(){var n;return!(!this.isSetPinAvailable||null===(n=this.discussions)||void 0===n||null===(n=n.getSource().allPartsPermissions)||void 0===n||!n.canpindiscussions)}get canAddDiscussionToGroup(){var n;return!!(this.forum&&this.canAddDiscussion&&null!==(n=this.discussions)&&void 0!==n&&n.getSource().canAddDiscussionToGroup)}get errorLoadingDiscussions(){var n;return!(null===(n=this.discussions)||void 0===n||!n.getSource().errorLoadingDiscussions)}get hasBlockingEnabled(){var n;return!(null===(n=this.forum)||void 0===n||!n.blockafter||!this.forum.blockperiod)}isOnlineDiscussion(n){var o;return!(null===(o=this.discussions)||void 0===o||!o.getSource().isOnlineDiscussion(n))}isOfflineDiscussion(n){var o;return!(null===(o=this.discussions)||void 0===o||!o.getSource().isOfflineDiscussion(n))}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,n=this;return(0,t.A)((function*(){n.addDiscussionText=d.HT.instant("addon.mod_forum.addanewdiscussion"),n.sortingAvailable=s.AddonModForum.isDiscussionListSortingAvailable(),n.sortOrders=s.AddonModForum.getAvailableSortOrders(),n.isSetPinAvailable=s.AddonModForum.isSetPinStateAvailableForSite(),yield _superprop_getNgOnInit().call(n);const o=A.u.getOrCreateSource(C.a,[n.courseId,n.module.id,n.courseContentsPage?`${O.Yj}/`:""]);var e;n.sourceUnsubscribe=o.addListener({onItemsUpdated:(e=(0,t.A)((function*(e){if(n.discussionsItems=e.filter((n=>!o.isNewDiscussionForm(n))),n.hasOffline=e.some((n=>o.isOfflineDiscussion(n))),!n.forum)return;const i=yield r.p.hasForumReplies(n.forum.id);if(n.hasOffline=n.hasOffline||i||n.hasOfflineRatings,i){const o=e.map(function(){var o=(0,t.A)((function*(o){var e;if(null===(e=n.discussions)||void 0===e||!e.getSource().isOnlineDiscussion(o))return;const t=yield r.p.getDiscussionReplies(o.discussion);o.numreplies=Number(o.numreplies)+t.length}));return function(n){return o.apply(this,arguments)}}());yield Promise.all(o)}})),function onItemsUpdated(n){return e.apply(this,arguments)}),onReset:()=>{n.discussionsItems=[]}}),n.promisedDiscussions.resolve(new AddonModForumDiscussionsManager(o,n)),n.syncManualObserver=c.z.on(O.uP,(o=>{n.autoSyncEventReceived(o)}),n.siteId),n.newDiscObserver=c.z.on(O.p8,(o=>n.eventReceived(!0,o))),n.replyObserver=c.z.on(O.L4,(o=>n.eventReceived(!1,o))),n.changeDiscObserver=c.z.on(O.rh,(o=>{n.forum&&(n.forum.id!==o.forumId&&o.cmId!==n.module.id||s.AddonModForum.invalidateDiscussionsList(n.forum.id).finally((()=>{if(o.discussionId){var e;const t=null===(e=n.discussions)||void 0===e?void 0:e.items.find((e=>{var t;return(null===(t=n.discussions)||void 0===t?void 0:t.getSource().isOnlineDiscussion(e))&&o.discussionId==e.discussion}));t&&(void 0!==o.locked&&(t.locked=o.locked),void 0!==o.pinned&&(t.pinned=o.pinned),void 0!==o.starred&&(t.starred=o.starred),n.showLoadingAndRefresh(!1))}var t;void 0!==o.deleted&&o.deleted&&(0==(null===(t=o.post)||void 0===t?void 0:t.parentid)&&f.CoreScreen.isTablet&&n.discussions&&!n.discussions.empty&&n.discussions.select(n.discussions[0]),n.showLoadingAndRefresh(!1))})))})),n.ratingOfflineObserver=c.z.on(h.CoreRatingProvider.RATING_SAVED_EVENT,(o=>{n.forum&&"mod_forum"==o.component&&"post"==o.ratingArea&&"module"==o.contextLevel&&o.instanceId==n.forum.cmid&&(n.hasOfflineRatings=!0,n.hasOffline=!0)})),n.ratingSyncObserver=c.z.on(I.CoreRatingSyncProvider.SYNCED_EVENT,function(){var o=(0,t.A)((function*(o){n.forum&&"mod_forum"==o.component&&"post"==o.ratingArea&&"module"==o.contextLevel&&o.instanceId==n.forum.cmid&&(n.hasOfflineRatings=yield v.CoreRatingOffline.hasRatings("mod_forum","post","module",n.forum.cmid),n.hasOffline=n.hasOffline||n.hasOfflineRatings)}));return function(n){return o.apply(this,arguments)}}()),n.showSearch=yield n.isSearchEnabled()}))()}ngAfterViewInit(){var n=this;return(0,t.A)((function*(){yield n.loadContent(!1,!0);(yield n.promisedDiscussions).start(n.splitView)}))()}ngOnDestroy(){var n;super.ngOnDestroy(),this.syncManualObserver&&this.syncManualObserver.off(),this.newDiscObserver&&this.newDiscObserver.off(),this.replyObserver&&this.replyObserver.off(),this.viewDiscObserver&&this.viewDiscObserver.off(),this.changeDiscObserver&&this.changeDiscObserver.off(),this.ratingOfflineObserver&&this.ratingOfflineObserver.off(),this.ratingSyncObserver&&this.ratingSyncObserver.off(),this.sourceUnsubscribe&&this.sourceUnsubscribe(),null===(n=this.discussions)||void 0===n||n.destroy()}openSearch(){var n=this;return(0,t.A)((function*(){n.forum&&(yield F.CoreNavigator.navigateToSitePath(O.t4,{params:{courseId:n.courseId,forumId:n.forum.id}}))}))()}fetchContent(n=!1,o=!1,e=!1){var i=this;return(0,t.A)((function*(){i.fetchFailed=!1;try{if(yield Promise.all([i.fetchForum(o,e),i.fetchSortOrderPreference()]),!i.forum)return;const t=yield i.promisedDiscussions;yield Promise.all([n?t.reload():t.load(),v.CoreRatingOffline.hasRatings("mod_forum","post","module",i.forum.cmid).then((n=>{i.hasOfflineRatings=n}))])}catch(n){throw i.fetchFailed=!0,n}}))()}fetchForum(n=!1,o=!1){var e=this;return(0,t.A)((function*(){var i;if(!e.courseId||!e.module)return;const r=yield e.promisedDiscussions;if(yield r.getSource().loadForum(),!e.forum)return;const a=e.forum,m=!(null!==(i=l.CoreSites.getCurrentSite())&&void 0!==i&&i.isVersionGreaterEqualThan("3.11"));switch(e.description=a.intro||e.description,e.availabilityMessage=u.i.getAvailabilityMessage(a,m),e.descriptionNote=d.HT.instant("addon.mod_forum.numdiscussions",{numdiscussions:a.numdiscussions}),e.dataRetrieved.emit(a),a.type){case"news":case"blog":e.addDiscussionText=d.HT.instant("addon.mod_forum.addanewtopic");break;case"qanda":e.addDiscussionText=d.HT.instant("addon.mod_forum.addanewquestion");break;default:e.addDiscussionText=d.HT.instant("addon.mod_forum.addanewdiscussion")}if(n){(yield e.syncActivity(o))&&c.z.trigger(O.uP,{forumId:a.id,userId:l.CoreSites.getCurrentSiteUserId(),source:"index"},l.CoreSites.getCurrentSiteId())}const _=[];_.push(r.getSource().loadGroupInfo(a.id)),_.push(s.AddonModForum.getAccessInformation(a.id,{cmId:e.module.id}).then(function(){var n=(0,t.A)((function*(n){const o=u.i.isCutoffDateReached(a)&&!n.cancanoverridecutoff;e.canAddDiscussion=!!a.cancreatediscussions&&!o,e.showQAMessage="qanda"===a.type&&!n.canviewqandawithoutposting}));return function(o){return n.apply(this,arguments)}}())),yield Promise.all(_)}))()}fetchMoreDiscussions(n){var o=this;return(0,t.A)((function*(){const e=yield o.promisedDiscussions;try{o.fetchFailed=!1,yield e.load()}catch(n){T.CoreAlerts.showError(n,{default:d.HT.instant("addon.mod_forum.errorgetforum")}),o.fetchFailed=!0}finally{n()}}))()}fetchSortOrderPreference(){var n=this;return(0,t.A)((function*(){const o=yield n.promisedDiscussions,e=yield s.AddonModForum.getSelectedSortOrder();o.getSource().selectedSortOrder=e}))()}invalidateContent(){var n=this;return(0,t.A)((function*(){const o=[];n.discussions&&o.push(n.discussions.getSource().invalidateCache()),n.forum&&o.push(s.AddonModForum.invalidateAccessInformation(n.forum.id)),n.sortingAvailable&&o.push(m.CoreUser.invalidateUserPreference(O.BR)),yield Promise.all(o)}))()}sync(){return g.V.sync(this.module,this.courseId)}isRefreshSyncNeeded(n){return!(!this.forum||"source"in n&&"index"==n.source||n.forumId!=this.forum.id||n.userId!=l.CoreSites.getCurrentSiteUserId())}eventReceived(n,o){var e=this;return(0,t.A)((function*(){if(e.forum&&e.forum.id===o.forumId||o.cmId===e.module.id){e.checkCompletion();try{if(n){y.CoreToasts.show({message:"addon.mod_forum.postaddedsuccess",translateMessage:!0});const n=o.groupId;var t;if(!n||n<0||!e.groupId||n===e.groupId)yield e.showLoadingAndRefresh(!1);else yield null===(t=e.discussions)||void 0===t?void 0:t.getSource().invalidateList()}else yield e.showLoadingAndRefresh(!1)}finally{if(n&&f.CoreScreen.isTablet&&e.discussions){const n=o,t=e.discussions.items.find((o=>{var t,i,s;return null!==(t=e.discussions)&&void 0!==t&&t.getSource().isOfflineDiscussion(o)?o.timecreated===n.discTimecreated:!(null===(i=e.discussions)||void 0===i||!i.getSource().isOnlineDiscussion(o))&&(null!==(s=n.discussionIds)&&void 0!==s?s:[]).includes(o.discussion)}));e.discussions.select(null!=t?t:null)}}}}))()}openNewDiscussion(){var n;null===(n=this.discussions)||void 0===n||n.select(C.a.NEW_DISCUSSION)}setSortOrder(n){var o=this;return(0,t.A)((function*(){var e;const t=o.sortOrders.find((o=>o.value===n));if(o.discussions&&t&&t.value!=(null===(e=o.discussions.getSource().selectedSortOrder)||void 0===e?void 0:e.value)){o.discussions.getSource().selectedSortOrder=t,o.discussions.getSource().setDirty(!0);try{yield m.CoreUser.setUserPreference(O.BR,t.value.toFixed(0)),yield o.showLoadingAndFetch()}catch(n){T.CoreAlerts.showError(n,{default:"Error updating preference."})}}}))()}showOptionsMenu(n,o){var i=this;return(0,t.A)((function*(){if(!i.forum)return;n.preventDefault(),n.stopPropagation();const{AddonModForumDiscussionOptionsMenuComponent:t}=yield e.e(4237).then(e.bind(e,4237)),s=yield x.CorePopovers.open({component:t,componentProps:{discussion:o,forumId:i.forum.id,cmId:i.module.id},event:n});if(s&&s.action)switch(s.action){case"lock":o.locked=s.value;break;case"pin":o.pinned=s.value;break;case"star":o.starred=s.value}}))()}groupChanged(){var n=this;return(0,t.A)((function*(){const o=yield D.CoreLoadings.show();try{var e,t;yield Promise.all([null===(e=n.discussions)||void 0===e?void 0:e.getSource().loadSelectedGroupData(),null===(t=n.discussions)||void 0===t?void 0:t.reload()])}catch(n){T.CoreAlerts.showError(n,{default:d.HT.instant("core.errorloadingcontent")})}finally{o.dismiss()}}))()}isSearchEnabled(){return(0,t.A)((function*(){if(!S.CoreSearchGlobalSearch.isEnabled())return!1;return!!(yield S.CoreSearchGlobalSearch.getSearchAreas()).find((({id:n})=>"mod_forum-post"===n))}))()}}return(n=AddonModForumIndexComponent).ɵfac=function AddonModForumIndexComponent_Factory(o){return new(o||n)(G.rXU(k.nX),G.rXU(E.W9,8),G.rXU(a.A,8))},n.ɵcmp=G.VBU({type:n,selectors:[["addon-mod-forum-index"]],viewQuery:function AddonModForumIndexComponent_Query(n,o){if(1&n&&G.GBs(p.M,5),2&n){let n;G.mGM(n=G.lsd())&&(o.splitView=n.first)}},standalone:!0,features:[G.Vt3,G.aNF],decls:22,vars:25,consts:[["slot","end"],["fill","clear",3,"ariaLabel","click",4,"ngIf"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[3,"completionChanged","module","description","component","componentId","courseId","hasDataToSync"],[1,"ion-text-wrap"],[3,"groupInfo","selected","courseId","selectedChange",4,"ngIf"],["class","core-info-card",4,"ngIf"],["class","core-warning-card",4,"ngIf"],[1,"core-info-card"],[4,"ngIf"],["collapsible-footer","",3,"hidden","courseId","currentModuleId"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["fill","clear",3,"click","ariaLabel"],["name","fas-magnifying-glass","slot","icon-only","aria-hidden","true"],["fill","clear","aria-haspopup","true",3,"click","ariaLabel"],["name","fas-circle-info","slot","icon-only","aria-hidden","true"],["iconAction","fas-circle-info",3,"action","priority","content"],[3,"selectedChange","groupInfo","selected","courseId"],["name","fas-circle-info","slot","start","aria-hidden","true"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["class","ion-text-wrap",4,"ngIf"],["icon","far-comments",3,"message",4,"ngIf"],["icon","fas-triangle-exclamation",3,"message",4,"ngIf"],["class","ion-activatable ripple-parent",4,"ngFor","ngForOf"],[3,"action","enabled","error"],[3,"onChange","label","selection"],["class","ion-text-wrap",3,"value",4,"ngFor","ngForOf"],[1,"ion-text-wrap",3,"value"],["icon","far-comments",3,"message"],["icon","fas-triangle-exclamation",3,"message"],[1,"ion-activatable","ripple-parent"],["tappable","",1,"addon-mod-forum-discussion",3,"click","detail","lines"],[1,"addon-mod-forum-discussion-title","ion-text-wrap","item-heading"],["name","fas-map-pin",4,"ngIf"],["name","fas-star","class","addon-forum-star",4,"ngIf"],[3,"ariaButtonClick"],["contextLevel","module",3,"text","courseId","contextInstanceId","sanitize"],["name","fas-lock","class","addon-mod-forum-locked-icon",4,"ngIf"],[1,"addon-mod-forum-discussion-info"],["slot","start",3,"user","courseId","linkProfile",4,"ngIf"],[1,"addon-mod-forum-discussion-author"],["class","core-discussionusername",4,"ngIf"],["class","core-groupname",4,"ngIf"],["class","ion-text-center addon-mod-forum-discussion-more-info",4,"ngIf"],["fill","clear","slot","end",3,"ariaLabel","click",4,"ngIf"],["name","fas-map-pin"],["name","fas-star",1,"addon-forum-star"],["name","fas-lock",1,"addon-mod-forum-locked-icon"],["slot","start",3,"user","courseId","linkProfile"],[1,"core-discussionusername"],[1,"core-groupname"],["name","fas-users"],["contextLevel","course",3,"text","contextInstanceId","wsNotFiltered"],["name","fas-clock","aria-hidden","true"],[1,"ion-text-center","addon-mod-forum-discussion-more-info"],[1,"ion-text-start"],[1,"ion-text-end"],["name","fas-comments","aria-hidden","true"],["class","ion-text-center",4,"ngIf"],[1,"ion-text-center"],["aria-hidden","true"],[1,"sr-only"],["fill","clear","slot","end",3,"click","ariaLabel"],["name","ellipsis-vertical","slot","icon-only","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"]],template:function AddonModForumIndexComponent_Template(n,o){1&n&&(G.j41(0,"core-navbar-buttons",0),G.DNE(1,AddonModForumIndexComponent_ion_button_1_Template,3,3,"ion-button",1)(2,AddonModForumIndexComponent_Conditional_2_Template,4,3)(3,AddonModForumIndexComponent_Conditional_3_Template,3,4),G.k0s(),G.j41(4,"core-split-view")(5,"ion-refresher",2),G.bIt("ionRefresh",(function AddonModForumIndexComponent_Template_ion_refresher_ionRefresh_5_listener(n){return o.doRefresh(n.target)})),G.nrm(6,"ion-refresher-content",3),G.nI1(7,"translate"),G.k0s(),G.j41(8,"core-loading",4)(9,"core-course-module-info",5),G.bIt("completionChanged",(function AddonModForumIndexComponent_Template_core_course_module_info_completionChanged_9_listener(){return o.onCompletionChange()})),G.j41(10,"ion-item",6)(11,"ion-label"),G.EFF(12),G.k0s()()(),G.DNE(13,AddonModForumIndexComponent_core_group_selector_13_Template,1,3,"core-group-selector",7)(14,AddonModForumIndexComponent_ion_card_14_Template,5,1,"ion-card",8)(15,AddonModForumIndexComponent_ion_card_15_Template,6,3,"ion-card",8)(16,AddonModForumIndexComponent_ion_card_16_Template,6,2,"ion-card",9)(17,AddonModForumIndexComponent_Conditional_17_Template,7,3,"ion-card",10)(18,AddonModForumIndexComponent_Conditional_18_Template,8,11,"ion-card",10)(19,AddonModForumIndexComponent_ng_container_19_Template,6,6,"ng-container",11),G.k0s(),G.nrm(20,"core-course-module-navigation",12),G.DNE(21,AddonModForumIndexComponent_ion_fab_21_Template,5,2,"ion-fab",13),G.k0s()),2&n&&(G.R7$(),G.Y8G("ngIf",o.showSearch),G.R7$(),G.vxM(2,o.courseContentsPage?3:2),G.R7$(3),G.Y8G("disabled",o.showLoading||o.discussions&&!o.discussions.loaded),G.R7$(),G.FS9("pullingText",G.bMT(7,23,"core.pulltorefresh")),G.R7$(2),G.Y8G("hideUntil",!o.showLoading&&o.discussions&&o.discussions.loaded),G.R7$(),G.Y8G("module",o.module)("description",o.forum&&"single"!==o.forum.type&&o.description)("component",o.component)("componentId",o.componentId)("courseId",o.courseId)("hasDataToSync",o.hasOffline||o.hasOfflineRatings),G.R7$(3),G.SpI(" ",o.descriptionNote," "),G.R7$(),G.Y8G("ngIf",o.supportsChangeGroup),G.R7$(),G.Y8G("ngIf",o.availabilityMessage),G.R7$(),G.Y8G("ngIf",o.showQAMessage),G.R7$(),G.Y8G("ngIf",o.usesGroups&&o.canAddDiscussion&&!o.canAddDiscussionToGroup),G.R7$(),G.vxM(17,"eachuser"===(null==o.forum?null:o.forum.type)?17:-1),G.R7$(),G.vxM(18,o.hasBlockingEnabled&&o.forum?18:-1),G.R7$(),G.Y8G("ngIf",o.forum),G.R7$(),G.Y8G("hidden",o.showLoading)("courseId",o.courseId)("currentModuleId",o.module.id),G.R7$(),G.Y8G("ngIf",o.canAddDiscussionToGroup))},dependencies:[R.n,$.Sq,$.bT,E.In,E.Jm,E.b_,E.hU,E.Q8,E.YW,E.iq,E.uz,E.he,E.JI,E.To,E.Ki,E.S7,E.ln,E.Ip,N.B,j.Q,L.h,V.F,Y.b,X.R,U.c,p.M,B.T,z._,H.A,q.t,Q.B,J.a,W.i,K.T,Z.D9,nn.f,on.A,w.CoreCourseModuleInfoComponent,P.CoreCourseModuleNavigationComponent],styles:["[_nghost-%COMP%]   .addon-forum-star[_ngcontent-%COMP%]{color:var(--core-star-color)}[_nghost-%COMP%]   .core-groupname[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:4px}[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px;font-weight:700}[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:0;margin-inline-end:6px;margin-top:0;margin-bottom:0}[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon.addon-mod-forum-locked-icon[_ngcontent-%COMP%]{margin-inline-start:4px;margin-inline-end:0px;color:var(--gray-500)}[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   core-user-avatar[_ngcontent-%COMP%]{--core-avatar-size: var(--addon-forum-avatar-size);margin-inline-start:0;margin-inline-end:8px;margin-top:0;margin-bottom:0}[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   .addon-mod-forum-discussion-info[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   .addon-mod-forum-discussion-info[_ngcontent-%COMP%]   .addon-mod-forum-discussion-author[_ngcontent-%COMP%]{flex-grow:1}[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   .addon-mod-forum-discussion-title[_ngcontent-%COMP%]{margin-inline-end:8px;line-height:18px}[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   .addon-mod-forum-discussion-more-info.ios[_ngcontent-%COMP%]{font-size:.9rem}[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{position:absolute;top:4px}@supports (inset-inline-start: 0){[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{inset-inline-end:8px}}@supports not (inset-inline-start: 0){[_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{right:8px}[dir=rtl][_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{left:unset;right:unset;left:8px}@supports selector(:dir(rtl)){[_nghost-%COMP%]:dir(rtl)   .addon-mod-forum-discussion.item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{left:unset;right:unset;left:8px}}}[_nghost-%COMP%]   .core-group-selector[_ngcontent-%COMP%]{border-top:1px solid var(--spacer-color)}[_nghost-%COMP%]   .ripple-parent[_ngcontent-%COMP%]{position:relative}[_nghost-%COMP%]   .ripple-parent[_ngcontent-%COMP%]   ion-ripple-effect[_ngcontent-%COMP%]{z-index:1}"]}),AddonModForumIndexComponent})();class AddonModForumDiscussionsManager extends M.R{constructor(n,o){super(n,o.route.component),this.page=o}getDefaultItem(){const n=this.getSource();return this.items.find((o=>!n.isNewDiscussionForm(o)))||null}logActivity(){var n=this;return(0,t.A)((function*(){const o=n.getSource().forum;if(o){try{yield s.AddonModForum.logView(o.id),_.CoreCourse.checkModuleCompletion(n.page.courseId,n.page.module.completiondata)}catch{}n.page.analyticsLogEvent("mod_forum_view_forum")}}))()}get hasDiscussions(){const n=this.getSource(),o=n.getItems();return null!==o&&o.some((o=>!n.isNewDiscussionForm(o)))}}},2401:(n,o,e)=>{e.d(o,{R:()=>CoreListItemsManager});var t=e(10467),i=e(21182),s=e(15324),r=e(93417),d=e(81690),a=e(95990),u=e(82907),c=e(24742),l=e(55554);class CoreListItemsManager extends a.u{constructor(n,o){super(n);const e=d.j.debounce((()=>this.scrollToCurrentElement()),300);this.pageRouteLocator=o,this.addListener({onSelectedItemUpdated:e}),this.finishSuccessfulFetch=c.j.once((()=>l.g.ignoreErrors(this.logActivity())))}get items(){return this.getSource().getItems()||[]}get loaded(){return null!==this.itemsMap}get completed(){return this.getSource().isCompleted()}get empty(){const n=this.getSource().getItems();return null===n||0===n.length}start(n){var o=this;return(0,t.A)((function*(){n&&o.watchSplitViewOutlet(n),o.updateSelectedItem()}))()}destroy(){var n;super.destroy(),null===(n=this.splitViewOutletSubscription)||void 0===n||n.unsubscribe()}watchSplitViewOutlet(n){var o;this.splitView=n,this.splitViewOutletSubscription=n.outletRouteObservable.subscribe((n=>this.updateSelectedItem(this.getPageRouteFromSplitViewOutlet(n)))),this.updateSelectedItem(null!==(o=this.getPageRouteFromSplitViewOutlet(n.outletRoute))&&void 0!==o?o:null)}isSelected(n){return this.selectedItem===n}getItemAriaCurrent(n){return this.isSelected(n)?"page":"false"}select(n){var o=this;return(0,t.A)((function*(){if(!n)return yield o.navigateToIndex({reset:o.resetNavigation()}),void 0;yield o.navigateToItem(n,{reset:o.resetNavigation()})}))()}reset(){this.getSource().reset()}reload(){var n=this;return(0,t.A)((function*(){yield n.getSource().reload(),n.finishSuccessfulFetch()}))()}load(){var n=this;return(0,t.A)((function*(){yield n.getSource().load(),n.finishSuccessfulFetch()}))()}logActivity(){return(0,t.A)((function*(){}))()}resetNavigation(){var n;return!!r.CoreScreen.isTablet&&!(!this.splitView||null!==(n=this.splitView)&&void 0!==n&&n.isNested)}updateSelectedItem(n=null){super.updateSelectedItem(n);this.select(r.CoreScreen.isTablet&&null===this.selectedItem&&this.splitView&&!this.splitView.isNested?this.getDefaultItem():this.selectedItem)}scrollToCurrentElement(){var n=this;return(0,t.A)((function*(){var o,e,t;if(r.CoreScreen.isMobile)return;const i=(null!==(o=null===(e=n.splitView)||void 0===e?void 0:e.nativeElement)&&void 0!==o?o:document).querySelector('[aria-current="page"]');if(!i)return;u.y.isElementInViewport(i,1,null===(t=n.splitView)||void 0===t?void 0:t.nativeElement)||i.scrollIntoView({behavior:"smooth"})}))()}getDefaultItem(){return this.items[0]||null}getCurrentPageRoute(){return this.pageRouteLocator instanceof i.nX?s.CoreNavigator.isRouteActive(this.pageRouteLocator)?this.pageRouteLocator:null:s.CoreNavigator.getCurrentRoute({pageComponent:this.pageRouteLocator})}getSelectedItemPathFromRoute(n){const o=[];for(;n.firstChild;)o.push(...s.CoreNavigator.getRouteUrl(n=n.firstChild));return o.map((n=>n.path)).join("/").replace(/\/+/,"/").trim()||null}getPageRouteFromSplitViewOutlet(n){const o=this.buildRouteMatcher();for(;n&&!o(n);)n=n.parent;return n}buildRouteMatcher(){if(this.pageRouteLocator instanceof i.nX){const n=s.CoreNavigator.getRouteFullPath(this.pageRouteLocator);return o=>s.CoreNavigator.getRouteFullPath(o)===n}return n=>n.component===this.pageRouteLocator}}},69006:(n,o,e)=>{e.d(o,{y:()=>f});var t=e(10467),i=e(23063),s=e(49882),r=e(44682),d=e(55554),a=e(51024),u=e(52749),c=e(25572),l=e(79555),m=e(95384),_=e(54438),p=e(2910);let f=(()=>{var n;class CoreCourseModuleMainActivityComponent extends i.x{constructor(n="CoreCourseModuleMainResourceComponent",o,e){super(n,e),this.content=o,this.moduleName=""}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,n=this;return(0,t.A)((function*(){yield _superprop_getNgOnInit().call(n),n.hasOffline=!1,n.moduleName=m.CoreCourseModuleHelper.translateModuleName(n.pluginName||n.moduleName||""),n.syncEventName&&(n.syncObserver=s.z.on(n.syncEventName,(o=>{n.autoSyncEventReceived(o)}),n.siteId))}))()}isRefreshSyncNeeded(n){return!1}autoSyncEventReceived(n){this.isRefreshSyncNeeded(n)&&this.showLoadingAndRefresh(!1)}refreshContent(n=!1,o=!1){var e=this;return(0,t.A)((function*(){e.module&&(yield d.g.ignoreErrors(Promise.all([e.invalidateContent(),e.showCompletion?r.CoreCourse.invalidateModule(e.module.id):void 0])),yield e.loadContent(!0,n,o))}))()}showLoadingAndFetch(n=!1,o=!1){var e=this;return(0,t.A)((function*(){var t;e.showLoading=!0,null===(t=e.content)||void 0===t||t.scrollToTop(),yield e.loadContent(!1,n,o)}))()}showLoadingAndRefresh(n=!1,o=!1){var e;return this.showLoading=!0,null===(e=this.content)||void 0===e||e.scrollToTop(),this.refreshContent(n,o)}fetchContent(n=!1,o=!1,e=!1){return(0,t.A)((function*(){}))()}loadContent(n,o=!1,e=!1){var i=this;return(0,t.A)((function*(){if(i.module)try{n&&i.showCompletion&&(yield d.g.ignoreErrors(i.fetchModule())),yield i.fetchContent(n,o,e),i.finishSuccessfulFetch()}catch(e){var t;if(!n&&(null===(t=u.CoreSites.getCurrentSite())||void 0===t||!t.isOfflineDisabled())&&m.CoreCourseModuleHelper.isNotFoundError(e))return yield i.refreshContent(o);c.CoreAlerts.showError(e,{default:l.HT.instant(i.fetchContentDefaultError)})}finally{i.showLoading=!1}}))()}sync(){return(0,t.A)((function*(){return{updated:!1,warnings:[]}}))()}hasSyncSucceed(n){return n.updated}syncActivity(n=!1){var o=this;return(0,t.A)((function*(){try{const n=yield o.sync();return n.warnings.length&&c.CoreAlerts.show({message:n.warnings[0]}),o.hasSyncSucceed(n)}catch(o){return n&&c.CoreAlerts.showError(o,{default:l.HT.instant("core.errorsync")}),!1}}))()}ngOnDestroy(){var n;super.ngOnDestroy(),null===(n=this.syncObserver)||void 0===n||n.off()}}return(n=CoreCourseModuleMainActivityComponent).ɵfac=function CoreCourseModuleMainActivityComponent_Factory(o){return new(o||n)(_.rXU("",8),_.rXU(p.W9),_.rXU(a.A))},n.ɵcmp=_.VBU({type:n,selectors:[["ng-component"]],inputs:{group:"group"},features:[_.Vt3],decls:0,vars:0,template:function CoreCourseModuleMainActivityComponent_Template(n,o){},encapsulation:2}),CoreCourseModuleMainActivityComponent})()}}]);