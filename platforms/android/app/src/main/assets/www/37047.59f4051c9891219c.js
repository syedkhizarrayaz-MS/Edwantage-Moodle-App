"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[37047],{37047:(e,n,s)=>{s.r(n),s.d(n,{default:()=>x});var t=s(10467),a=s(49882),o=s(52749),i=s(20728),r=s(15324),c=s(93417),l=s(29492),g=s(44426),_=s(40152),d=s(25572),m=s(79555),h=s(75357),u=s(86654),p=s(54438),f=s(60177),M=s(2910),b=s(69502),S=s(16986),T=s(66198),P=s(64422),k=s(16658),A=s(86198),C=s(58197),I=s(88246),R=s(43570),v=s(73955),y=s(2423);const _c0=e=>({item:e});function AddonMessagesSearchPage_ion_list_16_ng_container_1_Template(e,n){1&e&&p.eu8(0)}function AddonMessagesSearchPage_ion_list_16_ng_container_2_Template(e,n){1&e&&p.eu8(0)}function AddonMessagesSearchPage_ion_list_16_ng_container_3_Template(e,n){1&e&&p.eu8(0)}function AddonMessagesSearchPage_ion_list_16_Template(e,n){if(1&e){const e=p.RV6();p.j41(0,"ion-list"),p.DNE(1,AddonMessagesSearchPage_ion_list_16_ng_container_1_Template,1,0,"ng-container",8)(2,AddonMessagesSearchPage_ion_list_16_ng_container_2_Template,1,0,"ng-container",8)(3,AddonMessagesSearchPage_ion_list_16_ng_container_3_Template,1,0,"ng-container",8),p.j41(4,"core-infinite-loading",9),p.bIt("action",(function AddonMessagesSearchPage_ion_list_16_Template_core_infinite_loading_action_4_listener(n){p.eBV(e);const s=p.XpG();return p.Njj(s.search(s.query,"messages",n))})),p.k0s()()}if(2&e){const e=p.XpG(),n=p.sdS(19);p.R7$(),p.Y8G("ngTemplateOutlet",n)("ngTemplateOutletContext",p.eq3(8,_c0,e.contacts)),p.R7$(),p.Y8G("ngTemplateOutlet",n)("ngTemplateOutletContext",p.eq3(10,_c0,e.nonContacts)),p.R7$(),p.Y8G("ngTemplateOutlet",n)("ngTemplateOutletContext",p.eq3(12,_c0,e.messages)),p.R7$(),p.Y8G("enabled",e.messages.canLoadMore)("error",e.messages.loadMoreError)}}function AddonMessagesSearchPage_core_empty_box_17_Template(e,n){1&e&&(p.nrm(0,"core-empty-box",10),p.nI1(1,"translate")),2&e&&p.Y8G("message",p.bMT(1,1,"core.noresults"))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_icon_5_Template(e,n){1&e&&(p.nrm(0,"ion-icon",21),p.nI1(1,"translate")),2&e&&p.BMQ("aria-label",p.bMT(1,1,"addon.messages.contactblocked"))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_note_6_Template(e,n){if(1&e&&(p.j41(0,"ion-note"),p.EFF(1),p.nI1(2,"coreDateDayOrTime"),p.k0s()),2&e){const e=p.XpG().$implicit;p.R7$(),p.SpI(" ",p.bMT(2,1,e.lastmessagedate)," ")}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_span_8_Template(e,n){1&e&&(p.j41(0,"span",22),p.EFF(1),p.nI1(2,"translate"),p.k0s()),2&e&&(p.R7$(),p.SpI(" ",p.bMT(2,1,"addon.messages.you")," "))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template(e,n){if(1&e){const e=p.RV6();p.j41(0,"ion-item",13),p.bIt("click",(function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template_ion_item_click_0_listener(){const n=p.eBV(e).$implicit,s=p.XpG(3);return p.Njj(s.openConversation(n))})),p.nrm(1,"core-user-avatar",14),p.j41(2,"ion-label")(3,"p",15),p.nrm(4,"core-format-text",16),p.DNE(5,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_icon_5_Template,2,3,"ion-icon",17),p.k0s(),p.DNE(6,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_note_6_Template,3,3,"ion-note",6),p.j41(7,"p",18),p.DNE(8,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_span_8_Template,3,3,"span",19),p.nrm(9,"core-format-text",20),p.k0s()()()}if(2&e){const e=n.$implicit,s=p.XpG(3);p.Y8G("detail",!0),p.BMQ("aria-label",e.fullname)("aria-current",e===s.selectedResult?"page":"false"),p.R7$(),p.Y8G("user",e)("checkOnline",!0)("linkProfile",!1),p.R7$(3),p.Y8G("text",e.fullname)("highlight",e.highlightName)("filter",!1),p.R7$(),p.Y8G("ngIf",e.isblocked),p.R7$(),p.Y8G("ngIf",e.lastmessagedate>0),p.R7$(2),p.Y8G("ngIf",e.sentfromcurrentuser),p.R7$(),p.Y8G("text",e.lastmessage)("highlight",e.highlightMessage)("contextInstanceId",0)}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template(e,n){if(1&e){const e=p.RV6();p.j41(0,"div",25)(1,"ion-button",26),p.bIt("click",(function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template_ion_button_click_1_listener(){p.eBV(e);const n=p.XpG(3).item,s=p.XpG();return p.Njj(s.search(s.query,n.type))})),p.EFF(2),p.nI1(3,"translate"),p.k0s()()}2&e&&(p.R7$(2),p.SpI(" ",p.bMT(3,1,"core.loadmore")," "))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_2_Template(e,n){1&e&&(p.j41(0,"div",27),p.nrm(1,"ion-spinner"),p.nI1(2,"translate"),p.k0s()),2&e&&(p.R7$(),p.BMQ("aria-label",p.bMT(2,1,"core.loading")))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_Template(e,n){if(1&e&&(p.qex(0),p.DNE(1,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template,4,3,"div",23)(2,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_2_Template,3,3,"div",24),p.bVm()),2&e){const e=p.XpG(2).item;p.R7$(),p.Y8G("ngIf",e.canLoadMore&&!e.loadingMore),p.R7$(),p.Y8G("ngIf",e.loadingMore)}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_Template(e,n){if(1&e&&(p.qex(0),p.j41(1,"ion-item-divider",11)(2,"ion-label")(3,"h2"),p.EFF(4),p.nI1(5,"translate"),p.k0s()()(),p.DNE(6,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template,10,15,"ion-item",12)(7,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_Template,3,2,"ng-container",6),p.bVm()),2&e){const e=p.XpG().item;p.R7$(4),p.JRh(p.bMT(5,3,e.titleString)),p.R7$(2),p.Y8G("ngForOf",e.results),p.R7$(),p.Y8G("ngIf","messages"!==e.type)}}function AddonMessagesSearchPage_ng_template_18_Template(e,n){if(1&e&&p.DNE(0,AddonMessagesSearchPage_ng_template_18_ng_container_0_Template,8,5,"ng-container",6),2&e){p.Y8G("ngIf",n.item.results.length>0)}}let x=(()=>{var e;class AddonMessagesSearchPage{constructor(){this.disableSearch=!1,this.displaySearching=!1,this.displayResults=!1,this.query="",this.contacts={type:"contacts",titleString:"addon.messages.contacts",results:[],canLoadMore:!1,loadingMore:!1},this.nonContacts={type:"noncontacts",titleString:"addon.messages.noncontacts",results:[],canLoadMore:!1,loadingMore:!1},this.messages={type:"messages",titleString:"addon.messages.messages",results:[],canLoadMore:!1,loadingMore:!1,loadMoreError:!1},this.memberInfoObserver=a.z.on(_.Ie,(e=>{if(!e.userBlocked&&!e.userUnblocked)return;const n=this.contacts.results.find((n=>n.id==e.userId));if(n)n.isblocked=!!e.userBlocked;else{const n=this.nonContacts.results.find((n=>n.id==e.userId));n&&(n.isblocked=!!e.userBlocked)}this.messages.results.forEach((n=>{n.userid==e.userId&&(n.isblocked=!!e.userBlocked)}))}),o.CoreSites.getCurrentSiteId())}clearSearch(){this.query="",this.displayResults=!1;const e=r.CoreNavigator.getRelativePathToParent("/messages/search");e&&r.CoreNavigator.navigate(e)}search(e,n,s){var a=this;return(0,t.A)((function*(){g.p.close(),a.query=e,a.disableSearch=!0,a.displaySearching=!n;const t=[];let o=[],r=[],c=[],l=!1,h=!1,u=!1;if(!n||"contacts"==n||"noncontacts"==n){const s=n?_.xT:_._R;let c=0;"contacts"==n?(c=a.contacts.results.length,a.contacts.loadingMore=!0):"noncontacts"==n&&(c=a.nonContacts.results.length,a.nonContacts.loadingMore=!0),t.push(i.AddonMessages.searchUsers(e,c,s).then((e=>{n&&"contacts"!=n||(o=e.contacts,l=e.canLoadMoreContacts),n&&"noncontacts"!=n||(r=e.nonContacts,h=e.canLoadMoreNonContacts)})))}if(!n||"messages"==n){let s=0;"messages"==n&&(s=a.messages.results.length,a.messages.loadingMore=!0),t.push(i.AddonMessages.searchMessages(e,void 0,s).then((e=>{c=e.messages,u=e.canLoadMore})))}try{yield Promise.all(t),n||(a.contacts.results=[],a.nonContacts.results=[],a.messages.results=[]),a.displayResults=!0,n&&"contacts"!=n||(a.contacts.results.push(...o),a.contacts.canLoadMore=l,a.setHighlight(o,!0)),n&&"noncontacts"!=n||(a.nonContacts.results.push(...r),a.nonContacts.canLoadMore=h,a.setHighlight(r,!0)),n&&"messages"!=n||(a.messages.results.push(...c),a.messages.canLoadMore=u,a.messages.loadMoreError=!1,a.setHighlight(c,!1)),n||(a.contacts.results.length>0?a.openConversation(a.contacts.results[0],!0):a.nonContacts.results.length>0?a.openConversation(a.nonContacts.results[0],!0):a.messages.results.length>0&&a.openConversation(a.messages.results[0],!0))}catch(e){d.CoreAlerts.showError(e,{default:m.HT.instant("addon.messages.errorwhileretrievingusers")}),"messages"==n&&(a.messages.loadMoreError=!0)}finally{a.disableSearch=!1,a.displaySearching=!1,"contacts"==n?a.contacts.loadingMore=!1:"noncontacts"==n?a.nonContacts.loadingMore=!1:"messages"==n&&(a.messages.loadingMore=!1),s&&s()}}))()}openConversation(e,n=!1){if(!n||c.CoreScreen.isTablet){let n,s;this.selectedResult=e,"conversationid"in e?n=e.conversationid:s=e.id;const t=r.CoreNavigator.getRelativePathToParent("/messages/search")+"discussion/"+(n||`user/${s}`);r.CoreNavigator.navigate(t,{reset:c.CoreScreen.isTablet&&!!this.splitView&&!this.splitView.isNested})}}setHighlight(e,n=!1){e.forEach((e=>{e.highlightName=n?this.query:void 0,e.highlightMessage=n?void 0:this.query}))}ngOnDestroy(){var e;null===(e=this.memberInfoObserver)||void 0===e||e.off()}}return(e=AddonMessagesSearchPage).ɵfac=function AddonMessagesSearchPage_Factory(n){return new(n||e)},e.ɵcmp=p.VBU({type:e,selectors:[["page-addon-messages-search"]],viewQuery:function AddonMessagesSearchPage_Query(e,n){if(1&e&&p.GBs(l.M,5),2&e){let e;p.mGM(e=p.lsd())&&(n.splitView=e.first)}},standalone:!0,features:[p.aNF],decls:20,vars:16,consts:[["resultsTemplate",""],["slot","start"],[3,"text"],["slot","end"],["autocorrect","off","searchArea","AddonMessagesSearch",3,"onSubmit","onClear","disabled","spellcheck","autoFocus","lengthCheck"],[3,"hideUntil","message"],[4,"ngIf"],["icon","fas-magnifying-glass","role","alert",3,"message",4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"action","enabled","error"],["icon","fas-magnifying-glass","role","alert",3,"message"],[1,"ion-text-wrap"],["class","addon-message-discussion ion-text-wrap","button","",3,"detail","click",4,"ngFor","ngForOf"],["button","",1,"addon-message-discussion","ion-text-wrap",3,"click","detail"],["slot","start",3,"user","checkOnline","linkProfile"],[1,"item-heading"],[3,"text","highlight","filter"],["name","fas-ban",4,"ngIf"],[1,"addon-message-last-message"],["class","addon-message-last-message-user",4,"ngIf"],["clean","true","singleLine","true","contextLevel","system",1,"addon-message-last-message-text",3,"text","highlight","contextInstanceId"],["name","fas-ban"],[1,"addon-message-last-message-user"],["class","ion-padding-horizontal",4,"ngIf"],["class","ion-padding ion-text-center",4,"ngIf"],[1,"ion-padding-horizontal"],["expand","block","fill","outline",3,"click"],[1,"ion-padding","ion-text-center"]],template:function AddonMessagesSearchPage_Template(e,n){if(1&e){const e=p.RV6();p.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),p.nrm(3,"ion-back-button",2),p.nI1(4,"translate"),p.k0s(),p.j41(5,"ion-title")(6,"h1"),p.EFF(7),p.nI1(8,"translate"),p.k0s()(),p.j41(9,"ion-buttons",3),p.nrm(10,"core-context-menu"),p.k0s()()(),p.j41(11,"ion-content")(12,"core-split-view")(13,"core-search-box",4),p.bIt("onSubmit",(function AddonMessagesSearchPage_Template_core_search_box_onSubmit_13_listener(s){return p.eBV(e),p.Njj(n.search(s))}))("onClear",(function AddonMessagesSearchPage_Template_core_search_box_onClear_13_listener(){return p.eBV(e),p.Njj(n.clearSearch())})),p.k0s(),p.j41(14,"core-loading",5),p.nI1(15,"translate"),p.DNE(16,AddonMessagesSearchPage_ion_list_16_Template,5,14,"ion-list",6)(17,AddonMessagesSearchPage_core_empty_box_17_Template,2,3,"core-empty-box",7),p.k0s()()(),p.DNE(18,AddonMessagesSearchPage_ng_template_18_Template,1,1,"ng-template",null,0,p.C5r)}2&e&&(p.R7$(3),p.Y8G("text",p.bMT(4,10,"core.back")),p.R7$(4),p.JRh(p.bMT(8,12,"addon.messages.searchcombined")),p.R7$(6),p.Y8G("disabled",n.disableSearch)("spellcheck",!1)("autoFocus",!0)("lengthCheck",1),p.R7$(),p.Y8G("hideUntil",!n.displaySearching)("message",p.bMT(15,14,"core.searching")),p.R7$(2),p.Y8G("ngIf",n.displayResults),p.R7$(),p.Y8G("ngIf",n.displayResults&&!n.contacts.results.length&&!n.nonContacts.results.length&&!n.messages.results.length))},dependencies:[u.n,f.Sq,f.bT,f.T3,M.Jm,M.QW,M.W9,M.eU,M.iq,M.uz,M.Dg,M.he,M.nf,M.JI,M.w2,M.BC,M.ai,M.el,b.B,S.h,T.b,P.R,l.M,k.T,A.t,C.B,I.i,R.T,v.D9,y.Y,h.CoreSearchBoxComponent],encapsulation:2}),AddonMessagesSearchPage})()}}]);