"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[30046],{30046:(e,s,n)=>{n.r(s),n.d(s,{default:()=>G});var t=n(10467),o=n(49882),i=n(52749),a=n(20728),r=n(81690),c=n(71758),d=n(79555),g=n(15324),l=n(93417),_=n(18022),u=n(29492),m=n(44426),h=n(40152),M=n(55554),f=n(25572),p=n(86654),P=n(75357),C=n(20871),O=n(54438),b=n(21182),v=n(60177),I=n(2910),D=n(69502),x=n(16986),T=n(64422),R=n(16658),A=n(86198),k=n(58197),y=n(88246),w=n(73955),$=n(2423);function AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template(e,s){if(1&e){const e=O.RV6();O.j41(0,"ion-item",16),O.bIt("click",(function AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template_ion_item_click_0_listener(){const s=O.eBV(e).$implicit,n=O.XpG(2);return O.Njj(n.gotoDiscussion(s.userid,s.messageid))})),O.nrm(1,"core-user-avatar",17),O.j41(2,"ion-label")(3,"p",10),O.EFF(4),O.k0s(),O.j41(5,"p"),O.nrm(6,"core-format-text",18),O.k0s()()()}if(2&e){const e=s.$implicit,n=O.XpG(2);O.Y8G("detail",!1),O.BMQ("aria-label",e.fullname)("aria-current",e.userid===n.discussionUserId?"page":"false"),O.R7$(),O.Y8G("user",e)("checkOnline",e.showonlinestatus),O.R7$(3),O.JRh(e.fullname),O.R7$(2),O.Y8G("text",e.lastmessage)("contextInstanceId",0)}}function AddonMessagesDiscussions35Page_ng_container_28_Template(e,s){if(1&e&&(O.qex(0),O.j41(1,"ion-item-divider")(2,"ion-label")(3,"h2"),O.EFF(4),O.nI1(5,"translate"),O.k0s()(),O.j41(6,"ion-note",14)(7,"ion-badge"),O.EFF(8),O.k0s()()(),O.DNE(9,AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template,7,8,"ion-item",15),O.bVm()),2&e){const e=O.XpG();O.R7$(4),O.JRh(O.bMT(5,3,"core.searchresults")),O.R7$(4),O.JRh(e.search.results.length),O.R7$(),O.Y8G("ngForOf",e.search.results)}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_1_Template(e,s){if(1&e&&(O.j41(0,"span",24),O.EFF(1),O.nI1(2,"coreDateDayOrTime"),O.k0s()),2&e){const e=O.XpG(2).$implicit;O.R7$(),O.SpI(" ",O.bMT(2,1,e.message.timecreated/1e3)," ")}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_ion_icon_2_Template(e,s){1&e&&O.nrm(0,"ion-icon",25)}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_3_Template(e,s){1&e&&(O.j41(0,"span",26),O.EFF(1),O.nI1(2,"translate"),O.k0s()),2&e&&(O.R7$(),O.SpI(" ",O.bMT(2,1,"addon.messages.unreadmessages")," "))}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_Template(e,s){if(1&e&&(O.j41(0,"ion-note"),O.DNE(1,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_1_Template,3,3,"span",21)(2,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_ion_icon_2_Template,1,0,"ion-icon",22)(3,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_3_Template,3,3,"span",23),O.k0s()),2&e){const e=O.XpG().$implicit;O.R7$(),O.Y8G("ngIf",e.message.timecreated>0),O.R7$(),O.Y8G("ngIf",e.unread),O.R7$(),O.Y8G("ngIf",e.unread)}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template(e,s){if(1&e){const e=O.RV6();O.j41(0,"ion-item",16),O.bIt("click",(function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template_ion_item_click_0_listener(){const s=O.eBV(e).$implicit,n=O.XpG(2);return O.Njj(n.gotoDiscussion(s.message.user))})),O.nrm(1,"core-user-avatar",19),O.j41(2,"ion-label")(3,"div",20)(4,"p",10),O.EFF(5),O.k0s(),O.DNE(6,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_Template,4,3,"ion-note",11),O.k0s(),O.j41(7,"p"),O.nrm(8,"core-format-text",18),O.k0s()()()}if(2&e){const e=s.$implicit,n=O.XpG(2);O.Y8G("detail",!1),O.BMQ("aria-label",e.fullname)("aria-current",e.message.user===n.discussionUserId?"page":"false"),O.R7$(),O.Y8G("user",e),O.R7$(4),O.JRh(e.fullname),O.R7$(),O.Y8G("ngIf",e.message.timecreated>0||e.unread),O.R7$(2),O.Y8G("text",e.message.message)("contextInstanceId",0)}}function AddonMessagesDiscussions35Page_ng_container_29_Template(e,s){if(1&e&&(O.qex(0),O.DNE(1,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template,9,8,"ion-item",15),O.bVm()),2&e){const e=O.XpG();O.R7$(),O.Y8G("ngForOf",e.discussions)}}function AddonMessagesDiscussions35Page_core_empty_box_30_Template(e,s){1&e&&(O.nrm(0,"core-empty-box",27),O.nI1(1,"translate")),2&e&&O.Y8G("message",O.bMT(1,1,"addon.messages.nomessagesfound"))}function AddonMessagesDiscussions35Page_core_empty_box_31_Template(e,s){1&e&&(O.nrm(0,"core-empty-box",28),O.nI1(1,"translate")),2&e&&O.Y8G("message",O.bMT(1,1,"core.noresults"))}let G=(()=>{var e;class AddonMessagesDiscussions35Page{constructor(e){this.route=e,this.loaded=!1,this.loadingMessage="",this.discussions=[],this.search={showResults:!1,results:[],loading:"",text:""},this.search.loading=d.HT.instant("core.searching"),this.loadingMessages=d.HT.instant("core.loading"),this.siteId=i.CoreSites.getCurrentSiteId(),this.newMessagesObserver=o.z.on(h.cj,(e=>{if(e.userId&&this.discussions){const n=this.discussions.find((s=>{var n;return(null===(n=s.message)||void 0===n?void 0:n.user)===e.userId}));if(void 0===n)this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0}));else if(n.message){var s;n.message.message=null!==(s=e.message)&&void 0!==s?s:"",n.message.timecreated=e.timecreated}}}),this.siteId),this.readChangedObserver=o.z.on(h.j_,(e=>{if(e.userId&&this.discussions){const s=this.discussions.find((s=>{var n;return(null===(n=s.message)||void 0===n?void 0:n.user)===e.userId}));void 0!==s&&(s.unread=!1,a.AddonMessages.invalidateConversations(this.siteId),a.AddonMessages.refreshUnreadConversationCounts(this.siteId))}}),this.siteId),this.appResumeSubscription=_.CorePlatform.resume.subscribe((()=>{this.loaded&&(this.loaded=!1,this.refreshData())})),this.pushObserver=c.CorePushNotificationsDelegate.on("receive").subscribe((e=>{r.j.isFalseOrZero(e.notif)&&e.site==this.siteId&&this.refreshData(void 0,!1)}))}ngOnInit(){var e=this;return(0,t.A)((function*(){e.route.queryParams.subscribe(function(){var s=(0,t.A)((function*(s){var n;e.discussionUserId=null!==(n=g.CoreNavigator.getRouteNumberParam("userId",{params:s}))&&void 0!==n?n:e.discussionUserId}));return function(e){return s.apply(this,arguments)}}()),yield e.fetchData(),!e.discussionUserId&&e.discussions.length>0&&l.CoreScreen.isTablet&&e.discussions[0].message&&(yield e.gotoDiscussion(e.discussions[0].message.user)),i.CoreSites.loginNavigationFinished()}))()}refreshData(e,s=!0){var n=this;return(0,t.A)((function*(){const t=[];t.push(a.AddonMessages.invalidateDiscussionsCache(n.siteId)),s&&t.push(a.AddonMessages.invalidateUnreadConversationCounts(n.siteId)),yield M.g.allPromises(t).finally((()=>n.fetchData().finally((()=>{e&&(null==e||e.complete())}))))}))()}fetchData(){var e=this;return(0,t.A)((function*(){e.loadingMessage=e.loadingMessages;const s=[];s.push(a.AddonMessages.getDiscussions(e.siteId).then((s=>{const n=[];for(const e in s)s[e].unread=!!s[e].unread,n.push(s[e]);e.discussions=n.sort(((e,s)=>{var n,t;return((null===(n=s.message)||void 0===n?void 0:n.timecreated)||0)-((null===(t=e.message)||void 0===t?void 0:t.timecreated)||0)}))}))),s.push(a.AddonMessages.getUnreadConversationCounts(e.siteId));try{yield Promise.all(s)}catch(e){f.CoreAlerts.showError(e,{default:d.HT.instant("addon.messages.errorwhileretrievingdiscussions")})}e.loaded=!0}))()}clearSearch(){this.loaded=!1,this.search.showResults=!1,this.search.text="",this.fetchData().finally((()=>{this.loaded=!0}))}searchMessage(e){var s=this;return(0,t.A)((function*(){m.p.close(),s.loaded=!1,s.loadingMessage=s.search.loading;try{const n=yield a.AddonMessages.searchMessages(e,void 0,void 0,void 0,s.siteId);s.search.showResults=!0,s.search.results=n.messages}catch(e){f.CoreAlerts.showError(e,{default:d.HT.instant("addon.messages.errorwhileretrievingmessages")})}s.loaded=!0}))()}gotoDiscussion(e,s){var n=this;return(0,t.A)((function*(){n.discussionUserId=e;const t={};s&&(t.message=s);const o=g.CoreNavigator.getRelativePathToParent("/messages/index")+`discussion/user/${e}`;yield g.CoreNavigator.navigate(o,{params:t,reset:l.CoreScreen.isTablet&&!!n.splitView&&!n.splitView.isNested})}))()}gotoContacts(){const e={};l.CoreScreen.isTablet&&this.discussionUserId&&(e.discussionUserId=this.discussionUserId),g.CoreNavigator.navigateToSitePath("contacts-35",{params:e})}ngOnDestroy(){var e,s,n,t;null===(e=this.newMessagesObserver)||void 0===e||e.off(),null===(s=this.readChangedObserver)||void 0===s||s.off(),null===(n=this.appResumeSubscription)||void 0===n||n.unsubscribe(),null===(t=this.pushObserver)||void 0===t||t.unsubscribe()}}return(e=AddonMessagesDiscussions35Page).ɵfac=function AddonMessagesDiscussions35Page_Factory(s){return new(s||e)(O.rXU(b.nX))},e.ɵcmp=O.VBU({type:e,selectors:[["addon-messages-discussions"]],viewQuery:function AddonMessagesDiscussions35Page_Query(e,s){if(1&e&&O.GBs(u.M,5),2&e){let e;O.mGM(e=O.lsd())&&(s.splitView=e.first)}},standalone:!0,features:[O.aNF],decls:32,vars:28,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["autocorrect","off","spellcheck","false","lengthCheck","2","searchArea","AddonMessagesDiscussions",3,"onSubmit","onClear","placeholder","disabled","autoFocus"],[3,"hideUntil","message"],[1,"ion-no-margin"],["button","",1,"ion-text-wrap",3,"click","detail"],["name","fas-address-book","slot","start","aria-hidden","true"],[1,"item-heading"],[4,"ngIf"],["icon","far-comments",3,"message",4,"ngIf"],["icon","fas-magnifying-glass",3,"message",4,"ngIf"],["slot","end",1,"ion-padding-end"],["class","ion-text-wrap addon-message-discussion","button","",3,"detail","click",4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap","addon-message-discussion",3,"click","detail"],["slot","start",3,"user","checkOnline"],["clean","true","singleLine","true","contextLevel","system",3,"text","contextInstanceId"],["slot","start","checkOnline","false",3,"user"],[1,"flex-row","ion-justify-content-between"],["class","addon-message-last-message-date",4,"ngIf"],["name","fas-circle","color","primary","aria-hidden","true",4,"ngIf"],["class","sr-only",4,"ngIf"],[1,"addon-message-last-message-date"],["name","fas-circle","color","primary","aria-hidden","true"],[1,"sr-only"],["icon","far-comments",3,"message"],["icon","fas-magnifying-glass",3,"message"]],template:function AddonMessagesDiscussions35Page_Template(e,s){1&e&&(O.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),O.nrm(3,"ion-back-button",1),O.nI1(4,"translate"),O.k0s(),O.j41(5,"ion-title")(6,"h1"),O.EFF(7),O.nI1(8,"translate"),O.k0s()(),O.j41(9,"ion-buttons",2),O.nrm(10,"core-context-menu")(11,"core-user-menu-button"),O.k0s()()(),O.j41(12,"ion-content")(13,"core-split-view")(14,"ion-refresher",3),O.bIt("ionRefresh",(function AddonMessagesDiscussions35Page_Template_ion_refresher_ionRefresh_14_listener(e){return s.refreshData(e.target)})),O.nrm(15,"ion-refresher-content",4),O.nI1(16,"translate"),O.k0s(),O.j41(17,"core-search-box",5),O.nI1(18,"translate"),O.bIt("onSubmit",(function AddonMessagesDiscussions35Page_Template_core_search_box_onSubmit_17_listener(e){return s.searchMessage(e)}))("onClear",(function AddonMessagesDiscussions35Page_Template_core_search_box_onClear_17_listener(){return s.clearSearch()})),O.k0s(),O.j41(19,"core-loading",6)(20,"ion-list",7)(21,"ion-item",8),O.nI1(22,"translate"),O.bIt("click",(function AddonMessagesDiscussions35Page_Template_ion_item_click_21_listener(){return s.gotoContacts()})),O.nrm(23,"ion-icon",9),O.j41(24,"ion-label")(25,"p",10),O.EFF(26),O.nI1(27,"translate"),O.k0s()()(),O.DNE(28,AddonMessagesDiscussions35Page_ng_container_28_Template,10,5,"ng-container",11)(29,AddonMessagesDiscussions35Page_ng_container_29_Template,2,1,"ng-container",11),O.k0s(),O.DNE(30,AddonMessagesDiscussions35Page_core_empty_box_30_Template,2,3,"core-empty-box",12)(31,AddonMessagesDiscussions35Page_core_empty_box_31_Template,2,3,"core-empty-box",13),O.k0s()()()),2&e&&(O.R7$(3),O.Y8G("text",O.bMT(4,16,"core.back")),O.R7$(4),O.JRh(O.bMT(8,18,"addon.messages.messages")),O.R7$(7),O.Y8G("disabled",!s.loaded),O.R7$(),O.FS9("pullingText",O.bMT(16,20,"core.pulltorefresh")),O.R7$(2),O.Y8G("placeholder",O.bMT(18,22,"addon.messages.message"))("disabled",!s.loaded)("autoFocus",!1),O.R7$(2),O.Y8G("hideUntil",s.loaded)("message",s.loadingMessage),O.R7$(2),O.Y8G("detail",!0),O.BMQ("aria-label",O.bMT(22,24,"addon.messages.contacts")),O.R7$(5),O.JRh(O.bMT(27,26,"addon.messages.contacts")),O.R7$(2),O.Y8G("ngIf",s.search.showResults),O.R7$(),O.Y8G("ngIf",!s.search.showResults),O.R7$(),O.Y8G("ngIf",(!s.discussions||s.discussions.length<=0)&&!s.search.showResults),O.R7$(),O.Y8G("ngIf",(!s.search.results||s.search.results.length<=0)&&s.search.showResults))},dependencies:[p.n,v.Sq,v.bT,I.In,I.QW,I.W9,I.eU,I.iq,I.uz,I.Dg,I.he,I.nf,I.JI,I.To,I.Ki,I.BC,I.ai,I.el,D.B,x.h,T.R,u.M,R.T,A.t,k.B,y.i,w.D9,$.Y,P.CoreSearchBoxComponent,C.U],styles:["[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:.6875rem}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-inline-end:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesDiscussions35Page})()}}]);