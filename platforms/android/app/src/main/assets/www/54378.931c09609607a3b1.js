"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[54378],{54378:(e,r,t)=>{t.r(r),t.d(r,{CoreSearchGlobalSearchFiltersComponent:()=>F});var o=t(10467),n=t(66110),a=t(89014),i=t(49882),s=t(79555),l=t(55554),c=t(86654),h=t(91416),C=t(54438),_=t(60177),d=t(89417),u=t(2910),g=t(4060),p=t(86198),m=t(58197),S=t(88246),f=t(43570),b=t(73955);function CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_11_Template(e,r){if(1&e){const e=C.RV6();C.j41(0,"ion-item",9)(1,"ion-checkbox",12),C.mxI("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_11_Template_ion_checkbox_ngModelChange_1_listener(r){const t=C.eBV(e).$implicit;return C.DH7(t.checked,r)||(t.checked=r),C.Njj(r)})),C.bIt("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_11_Template_ion_checkbox_ionChange_1_listener(){const r=C.eBV(e).$implicit,t=C.XpG(2);return C.Njj(t.onSearchAreaCategoryInputChanged(r))})),C.nrm(2,"core-format-text",13),C.k0s()()}if(2&e){const e=r.$implicit;C.R7$(),C.R50("ngModel",e.checked),C.R7$(),C.Y8G("text",e.name)}}function CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template(e,r){if(1&e){const e=C.RV6();C.qex(0),C.nrm(1,"core-spacer"),C.j41(2,"ion-item",7)(3,"ion-label")(4,"p",8),C.EFF(5),C.nI1(6,"translate"),C.k0s()()(),C.j41(7,"ion-item",9)(8,"ion-checkbox",10),C.mxI("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template_ion_checkbox_ngModelChange_8_listener(r){C.eBV(e);const t=C.XpG();return C.DH7(t.allSearchAreaCategories,r)||(t.allSearchAreaCategories=r),C.Njj(r)})),C.bIt("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template_ion_checkbox_ionChange_8_listener(){C.eBV(e);const r=C.XpG();return C.Njj(r.allSearchAreaCategoriesUpdated())})),C.EFF(9),C.nI1(10,"translate"),C.k0s()(),C.DNE(11,CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_11_Template,3,2,"ion-item",11),C.bVm()}if(2&e){const e=C.XpG();C.R7$(5),C.JRh(C.bMT(6,5,"core.search.filtercategories")),C.R7$(3),C.R50("ngModel",e.allSearchAreaCategories),C.Y8G("indeterminate",null===e.allSearchAreaCategories),C.R7$(),C.JRh(C.bMT(10,7,"core.search.allcategories")),C.R7$(2),C.Y8G("ngForOf",e.searchAreaCategories)}}function CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_11_Template(e,r){if(1&e){const e=C.RV6();C.j41(0,"ion-item",9)(1,"ion-checkbox",12),C.mxI("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_11_Template_ion_checkbox_ngModelChange_1_listener(r){const t=C.eBV(e).$implicit;return C.DH7(t.checked,r)||(t.checked=r),C.Njj(r)})),C.bIt("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_11_Template_ion_checkbox_ionChange_1_listener(){const r=C.eBV(e).$implicit,t=C.XpG(2);return C.Njj(t.onCourseInputChanged(r))})),C.nrm(2,"core-format-text",13),C.k0s()()}if(2&e){const e=r.$implicit;C.R7$(),C.R50("ngModel",e.checked),C.R7$(),C.Y8G("text",e.shortname)}}function CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template(e,r){if(1&e){const e=C.RV6();C.qex(0),C.nrm(1,"core-spacer"),C.j41(2,"ion-item",7)(3,"ion-label")(4,"p",8),C.EFF(5),C.nI1(6,"translate"),C.k0s()()(),C.j41(7,"ion-item",9)(8,"ion-checkbox",10),C.mxI("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template_ion_checkbox_ngModelChange_8_listener(r){C.eBV(e);const t=C.XpG();return C.DH7(t.allCourses,r)||(t.allCourses=r),C.Njj(r)})),C.bIt("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template_ion_checkbox_ionChange_8_listener(){C.eBV(e);const r=C.XpG();return C.Njj(r.allCoursesUpdated())})),C.EFF(9),C.nI1(10,"translate"),C.k0s()(),C.DNE(11,CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_11_Template,3,2,"ion-item",11),C.bVm()}if(2&e){const e=C.XpG();C.R7$(5),C.JRh(C.bMT(6,5,"core.search.filtercourses")),C.R7$(3),C.R50("ngModel",e.allCourses),C.Y8G("indeterminate",null===e.allCourses),C.R7$(),C.SpI(" ",C.bMT(10,7,"core.search.allcourses"),""),C.R7$(2),C.Y8G("ngForOf",e.courses)}}let F=(()=>{var e;class CoreSearchGlobalSearchFiltersComponent{constructor(){this.allSearchAreaCategories=!0,this.searchAreaCategories=[],this.allCourses=!0,this.courses=[],this.hideCourses=!1,this.newFilters={}}ngOnInit(){var e=this;return(0,o.A)((function*(){var r;e.newFilters=null!==(r=e.filters)&&void 0!==r?r:{},yield e.updateSearchAreaCategories(),yield e.updateCourses()}))()}close(){s.W3.dismiss()}allSearchAreaCategoriesUpdated(){if(null===this.allSearchAreaCategories)return;const e=this.allSearchAreaCategories;this.searchAreaCategories.forEach((r=>{r.checked!==e&&(r.checked=e)}))}onSearchAreaCategoryInputChanged(e){(e.checked||!this.newFilters.searchAreaCategoryIds||this.newFilters.searchAreaCategoryIds.includes(e.id))&&(!e.checked||this.newFilters.searchAreaCategoryIds&&!this.newFilters.searchAreaCategoryIds.includes(e.id))&&this.searchAreaCategoryUpdated()}allCoursesUpdated(){if(null===this.allCourses)return;const e=this.allCourses;this.courses.forEach((r=>{r.checked!==e&&(r.checked=e)}))}onCourseInputChanged(e){(e.checked||!this.newFilters.courseIds||this.newFilters.courseIds.includes(e.id))&&(!e.checked||this.newFilters.courseIds&&!this.newFilters.courseIds.includes(e.id))&&this.courseUpdated()}refreshFilters(e){var r=this;return(0,o.A)((function*(){yield l.g.ignoreErrors(Promise.all([a.CoreSearchGlobalSearch.invalidateSearchAreas(),n.CoreCourses.invalidateUserCourses()])),yield r.updateSearchAreaCategories(),yield r.updateCourses(),null==e||e.complete()}))()}updateSearchAreaCategories(){var e=this;return(0,o.A)((function*(){const r=yield a.CoreSearchGlobalSearch.getSearchAreas(),t=new Set;e.searchAreaCategories=[];for(const a of r){var o,n;t.has(a.category.id)||(t.add(a.category.id),e.searchAreaCategories.push({...a.category,checked:null===(o=null===(n=e.filters)||void 0===n||null===(n=n.searchAreaCategoryIds)||void 0===n?void 0:n.includes(a.category.id))||void 0===o||o}))}e.allSearchAreaCategories=e.getGroupFilterStatus(e.searchAreaCategories)}))()}updateCourses(){var e=this;return(0,o.A)((function*(){const r=yield n.CoreCourses.getUserCourses();e.courses=r.sort(((e,r)=>{var t,o,n,a;return(null!==(t=null===(o=e.shortname)||void 0===o?void 0:o.toLowerCase())&&void 0!==t?t:"").localeCompare(null!==(n=null===(a=r.shortname)||void 0===a?void 0:a.toLowerCase())&&void 0!==n?n:"")})).map((r=>{var t,o;return{...r,checked:null===(t=null===(o=e.filters)||void 0===o||null===(o=o.courseIds)||void 0===o?void 0:o.includes(r.id))||void 0===t||t}})),e.allCourses=e.getGroupFilterStatus(e.courses)}))()}searchAreaCategoryUpdated(){const e=this.getGroupFilterStatus(this.searchAreaCategories);e!==this.allSearchAreaCategories&&(this.allSearchAreaCategories=e),this.emitFiltersUpdated()}courseUpdated(){const e=this.getGroupFilterStatus(this.courses);e!==this.allCourses&&(this.allCourses=e),this.emitFiltersUpdated()}getGroupFilterStatus(e){if(0===e.length)return null;const r=e[0].checked;for(const t of e)if(t.checked!==r)return null;return r}emitFiltersUpdated(){this.newFilters={},this.allSearchAreaCategories||(this.newFilters.searchAreaCategoryIds=this.searchAreaCategories.filter((({checked:e})=>e)).map((({id:e})=>e))),this.allCourses||(this.newFilters.courseIds=this.courses.filter((({checked:e})=>e)).map((({id:e})=>e))),i.z.trigger(a.CORE_SEARCH_GLOBAL_SEARCH_FILTERS_UPDATED,this.newFilters)}}return(e=CoreSearchGlobalSearchFiltersComponent).ɵfac=function CoreSearchGlobalSearchFiltersComponent_Factory(r){return new(r||e)},e.ɵcmp=C.VBU({type:e,selectors:[["core-search-global-search-filters"]],inputs:{hideCourses:[C.Mj6.HasDecoratorInputTransform,"hideCourses","hideCourses",h.G],filters:"filters"},standalone:!0,features:[C.GFd,C.aNF],decls:17,vars:12,consts:[["slot","end"],["fill","clear",3,"click","ariaLabel"],["name","fas-xmark","slot","icon-only","aria-hidden","true"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[3,"pullingText"],[4,"ngIf"],[1,"ion-text-wrap","heading"],[1,"item-heading"],[1,"ion-text-wrap"],["labelPlacement","start",3,"ngModelChange","ionChange","ngModel","indeterminate"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["labelPlacement","start",3,"ngModelChange","ionChange","ngModel"],[3,"text"]],template:function CoreSearchGlobalSearchFiltersComponent_Template(e,r){1&e&&(C.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title")(3,"h1"),C.EFF(4),C.nI1(5,"translate"),C.k0s()(),C.j41(6,"ion-buttons",0)(7,"ion-button",1),C.nI1(8,"translate"),C.bIt("click",(function CoreSearchGlobalSearchFiltersComponent_Template_ion_button_click_7_listener(){return r.close()})),C.nrm(9,"ion-icon",2),C.k0s()()()(),C.j41(10,"ion-content",3)(11,"ion-refresher",4),C.bIt("ionRefresh",(function CoreSearchGlobalSearchFiltersComponent_Template_ion_refresher_ionRefresh_11_listener(e){return r.refreshFilters(e.target)})),C.nrm(12,"ion-refresher-content",5),C.nI1(13,"translate"),C.k0s(),C.j41(14,"ion-list"),C.DNE(15,CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template,12,9,"ng-container",6)(16,CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template,12,9,"ng-container",6),C.k0s()()),2&e&&(C.R7$(4),C.JRh(C.bMT(5,6,"core.search.filterheader")),C.R7$(3),C.Y8G("ariaLabel",C.bMT(8,8,"core.close")),C.R7$(3),C.Y8G("fullscreen",!0),C.R7$(2),C.FS9("pullingText",C.bMT(13,10,"core.pulltorefresh")),C.R7$(3),C.Y8G("ngIf",r.searchAreaCategories.length>0),C.R7$(),C.Y8G("ngIf",!r.hideCourses&&r.courses.length>0))},dependencies:[c.n,_.Sq,_.bT,d.BC,d.vS,u.Jm,u.QW,u.eY,u.W9,u.eU,u.iq,u.uz,u.he,u.nf,u.To,u.Ki,u.BC,u.ai,u.hB,g.f,p.t,m.B,S.i,f.T,b.D9],styles:["[_nghost-%COMP%]{--heading-text-color: var(--gray-700)}[_nghost-%COMP%]   ion-item.heading[_ngcontent-%COMP%]{color:var(--heading-text-color)}[_nghost-%COMP%]   ion-item.heading[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:0}:root.dark[_nghost-%COMP%], :root.dark   [_nghost-%COMP%]{--heading-text-color: var(--gray-400)}"]}),CoreSearchGlobalSearchFiltersComponent})()}}]);