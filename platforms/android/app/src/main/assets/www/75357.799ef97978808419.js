"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[75357,64254],{75357:(e,t,r)=>{r.r(t),r.d(t,{CoreSearchBoxComponent:()=>f});var o=r(10467),a=r(54438),n=r(52749),i=r(64254),s=r(79555),c=r(63153),h=r(91416),l=r(86654),d=r(60177),u=r(89417),m=r(2910),g=r(69901),p=r(86198),b=r(43570),C=r(73955);const _=["searchForm"],_c1=e=>({format:e}),_c2=e=>({$a:e});function CoreSearchBoxComponent_ion_button_5_Template(e,t){if(1&e){const e=a.RV6();a.j41(0,"ion-button",9),a.nI1(1,"translate"),a.bIt("click",(function CoreSearchBoxComponent_ion_button_5_Template_ion_button_click_0_listener(){a.eBV(e);const t=a.XpG();return a.Njj(t.clearForm())})),a.nrm(2,"ion-icon",10),a.k0s()}if(2&e){const e=a.XpG();a.Y8G("ariaLabel",a.bMT(1,2,"core.clearsearch"))("disabled",""===e.searched||e.disabled)}}function CoreSearchBoxComponent_ion_item_6_Template(e,t){if(1&e&&(a.j41(0,"ion-item",11)(1,"ion-label"),a.EFF(2),a.nI1(3,"translate"),a.k0s()()),2&e){const e=a.XpG();a.R7$(2),a.SpI(" ",a.i5U(3,1,"core.search.err_minlength",a.eq3(6,_c2,a.eq3(4,_c1,e.lengthCheck)))," ")}}function CoreSearchBoxComponent_ion_item_8_Template(e,t){if(1&e){const e=a.RV6();a.j41(0,"ion-item",12),a.bIt("click",(function CoreSearchBoxComponent_ion_item_8_Template_ion_item_click_0_listener(t){const r=a.eBV(e).$implicit,o=a.XpG();return a.Njj(o.historyClicked(t,r.searchedtext))})),a.nrm(1,"ion-icon",13),a.j41(2,"ion-label"),a.EFF(3),a.k0s()()}if(2&e){const e=t.$implicit;a.Y8G("detail",!0),a.R7$(3),a.JRh(e.searchedtext)}}let f=(()=>{var e;class CoreSearchBoxComponent{constructor(){this.autocorrect="on",this.spellcheck=!0,this.autoFocus=!1,this.lengthCheck=3,this.showClear=!0,this.disabled=!1,this.initialSearch="",this.searchArea="",this.searched="",this.searchText="",this.history=[],this.historyShown=(0,a.vPA)(!1),this.showLengthAlert=(0,a.vPA)(!1),this.onSubmit=new a.bkB,this.onClear=new a.bkB}ngOnInit(){this.searchLabel=this.searchLabel||s.HT.instant("core.search"),this.placeholder=this.placeholder||s.HT.instant("core.search"),this.searchText=this.initialSearch,this.searchArea&&this.loadHistory()}submitForm(e){if(null==e||e.preventDefault(),null==e||e.stopPropagation(),this.searchText.length<this.lengthCheck)return this.showLengthAlert.set(!0),void 0;this.showLengthAlert.set(!1),this.searchArea&&this.saveSearchToHistory(this.searchText),c.R.triggerFormSubmittedEvent(this.formElement,!1,n.CoreSites.getCurrentSiteId()),this.historyShown.set(!1),this.searched=this.searchText,this.onSubmit.emit(this.searchText)}saveSearchToHistory(e){var t=this;return(0,o.A)((function*(){try{yield i.CoreSearchHistory.insertOrUpdateSearchText(t.searchArea,e.toLowerCase())}finally{t.loadHistory()}}))()}loadHistory(){var e=this;return(0,o.A)((function*(){e.history=yield i.CoreSearchHistory.getSearchHistory(e.searchArea)}))()}historyClicked(e,t){this.searched!=t&&(this.searchText=t,this.submitForm(e))}clearForm(){this.searched="",this.searchText="",this.showLengthAlert.set(!1),this.onClear.emit()}focus(){this.historyShown.set(!0)}checkFocus(){setTimeout((()=>{var e,t;(null===(e=document.activeElement)||void 0===e?void 0:e.closest("form"))!==(null===(t=this.formElement)||void 0===t?void 0:t.nativeElement)&&(this.historyShown.set(!1),this.showLengthAlert.set(!1))}))}}return(e=CoreSearchBoxComponent).ɵfac=function CoreSearchBoxComponent_Factory(t){return new(t||e)},e.ɵcmp=a.VBU({type:e,selectors:[["core-search-box"]],viewQuery:function CoreSearchBoxComponent_Query(e,t){if(1&e&&a.GBs(_,5),2&e){let e;a.mGM(e=a.lsd())&&(t.formElement=e.first)}},inputs:{searchLabel:"searchLabel",placeholder:"placeholder",autocorrect:"autocorrect",spellcheck:[a.Mj6.HasDecoratorInputTransform,"spellcheck","spellcheck",h.G],autoFocus:[a.Mj6.HasDecoratorInputTransform,"autoFocus","autoFocus",h.G],lengthCheck:"lengthCheck",showClear:[a.Mj6.HasDecoratorInputTransform,"showClear","showClear",h.G],disabled:[a.Mj6.HasDecoratorInputTransform,"disabled","disabled",h.G],initialSearch:"initialSearch",searchArea:"searchArea"},outputs:{onSubmit:"onSubmit",onClear:"onClear"},standalone:!0,features:[a.GFd,a.aNF],decls:9,vars:13,consts:[["searchForm",""],["role","search",3,"ngSubmit","focusout"],["type","search","name","search","role","searchbox",3,"ngModelChange","ionFocus","ariaLabel","ngModel","placeholder","autocorrect","spellcheck","core-auto-focus","disabled"],["slot","end","fill","clear","type","submit",3,"ariaLabel","disabled"],["name","fas-magnifying-glass","slot","icon-only","aria-hidden","true"],["slot","end","fill","clear",3,"ariaLabel","disabled","click",4,"ngIf"],["class","core-search-alert text-danger ion-text-wrap","role","alert",4,"ngIf"],[1,"core-search-history",3,"hidden"],["button","","class","ion-text-wrap",3,"detail","click",4,"ngFor","ngForOf"],["slot","end","fill","clear",3,"click","ariaLabel","disabled"],["name","fas-delete-left","slot","icon-only","aria-hidden","true","flip-rtl",""],["role","alert",1,"core-search-alert","text-danger","ion-text-wrap"],["button","",1,"ion-text-wrap",3,"click","detail"],["name","fas-clock-rotate-left","slot","start","aria-hidden","true"]],template:function CoreSearchBoxComponent_Template(e,t){if(1&e){const e=a.RV6();a.j41(0,"form",1,0),a.bIt("ngSubmit",(function CoreSearchBoxComponent_Template_form_ngSubmit_0_listener(r){return a.eBV(e),a.Njj(t.submitForm(r))}))("focusout",(function CoreSearchBoxComponent_Template_form_focusout_0_listener(){return a.eBV(e),a.Njj(t.checkFocus())})),a.j41(2,"ion-input",2),a.mxI("ngModelChange",(function CoreSearchBoxComponent_Template_ion_input_ngModelChange_2_listener(r){return a.eBV(e),a.DH7(t.searchText,r)||(t.searchText=r),a.Njj(r)})),a.bIt("ionFocus",(function CoreSearchBoxComponent_Template_ion_input_ionFocus_2_listener(){return a.eBV(e),a.Njj(t.focus())})),a.j41(3,"ion-button",3),a.nrm(4,"ion-icon",4),a.k0s(),a.DNE(5,CoreSearchBoxComponent_ion_button_5_Template,3,4,"ion-button",5),a.k0s(),a.DNE(6,CoreSearchBoxComponent_ion_item_6_Template,4,8,"ion-item",6),a.j41(7,"ion-list",7),a.DNE(8,CoreSearchBoxComponent_ion_item_8_Template,4,2,"ion-item",8),a.k0s()()}2&e&&(a.R7$(2),a.Y8G("ariaLabel",t.placeholder),a.R50("ngModel",t.searchText),a.Y8G("placeholder",t.placeholder)("autocorrect",t.autocorrect)("spellcheck",t.spellcheck)("core-auto-focus",t.autoFocus)("disabled",t.disabled),a.R7$(),a.Y8G("ariaLabel",t.searchLabel)("disabled",t.disabled||!t.searchText),a.R7$(2),a.Y8G("ngIf",t.showClear),a.R7$(),a.Y8G("ngIf",t.showLengthAlert()),a.R7$(),a.Y8G("hidden",!t.historyShown()),a.R7$(),a.Y8G("ngForOf",t.history))},dependencies:[l.n,d.Sq,d.bT,u.qT,u.BC,u.cb,u.vS,u.cV,m.Jm,m.iq,m.$w,m.uz,m.he,m.nf,m.Gw,g.i,p.t,b.T,C.D9],styles:["[_nghost-%COMP%]{--height: var(--a11y-sizing-minTargetSize);--search-height: calc(var(--height) - 2px);min-height:var(--height);display:block;position:relative;margin:8px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{position:absolute;left:0;right:0;z-index:4;margin:0;border:1px solid var(--core-search-box-border-color);border-radius:var(--core-search-box-border-radius);background:var(--core-search-box-background);color:var(--core-search-box-border-color);--min-height: var(--search-height)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--padding-start: 16px;--padding-end: 16px;--border-radius: var(--core-search-box-border-radius);min-height:var(--search-height)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-button.button[_ngcontent-%COMP%]{margin:0;--a11y-sizing-minTargetSize: var(--search-height);--padding-start: 0px;--padding-end: 0px;font-size:var(--mdl-typography-body-fontSize-sm)}[_nghost-%COMP%]   .core-search-history[_ngcontent-%COMP%]{max-height:calc(-120px + 80vh);overflow-y:auto;background:var(--core-search-box-background);border-radius:0 0 var(--core-search-box-border-radius) var(--core-search-box-border-radius);--ion-item-background: var(--core-search-box-background)}[_nghost-%COMP%]   .core-search-history[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:hover{--background: var(--light);cursor:pointer}[_nghost-%COMP%]   .core-search-history[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--min-height: var(--a11y-sizing-minTargetSize);--border-width: 0px;--background: var(--core-search-box-background)}[_nghost-%COMP%]   .core-search-history[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:0}"]}),CoreSearchBoxComponent})()},64254:(e,t,r)=>{r.r(t),r.d(t,{CoreSearchHistory:()=>u,CoreSearchHistoryProvider:()=>d});var o=r(10467),a=r(52749),n=r(37762),i=r(79555),s=r(49833),c=r(89312),h=r(71689),l=r(54438);let d=(()=>{var e;class CoreSearchHistoryProvider{constructor(){this.searchHistoryTables=(0,s.$)((e=>(0,c.A)((()=>a.CoreSites.getSiteTable(n.lG,{siteId:e,primaryKeyColumns:[...n.Ph],rowIdColumn:null,config:{cachingStrategy:h.T.None},onDestroy:()=>delete this.searchHistoryTables[e]})))))}getSearchHistory(e,t){var r=this;return(0,o.A)((function*(){null!=t?t:t=a.CoreSites.getCurrentSiteId();return(yield r.searchHistoryTables[t].getMany({searcharea:e})).sort(((e,t)=>(t.lastused||0)-(e.lastused||0)))}))()}controlSearchLimit(e,t){var r=this;return(0,o.A)((function*(){const o=yield r.getSearchHistory(e);if(o.length>CoreSearchHistoryProvider.HISTORY_LIMIT){const e=o.pop();if(!e)return;yield r.searchHistoryTables[t].delete({searcharea:e.searcharea,searchedtext:e.searchedtext})}}))()}updateExistingItem(e,t,r){var a=this;return(0,o.A)((function*(){const o={searcharea:e,searchedtext:t};try{const e=yield a.searchHistoryTables[r].getOne(o);return e.lastused=Date.now(),e.times++,yield a.searchHistoryTables[r].update(e,o),!0}catch{return!1}}))()}insertOrUpdateSearchText(e,t,r){var n=this;return(0,o.A)((function*(){null!=r?r:r=a.CoreSites.getCurrentSiteId();(yield n.updateExistingItem(e,t,r))||(yield n.searchHistoryTables[r].insert({searcharea:e,searchedtext:t,lastused:Date.now(),times:1}),yield n.controlSearchLimit(e,r))}))()}}return(e=CoreSearchHistoryProvider).HISTORY_LIMIT=10,e.ɵfac=function CoreSearchHistoryProvider_Factory(t){return new(t||e)},e.ɵprov=l.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),CoreSearchHistoryProvider})();const u=(0,i.Qd)(d)}}]);