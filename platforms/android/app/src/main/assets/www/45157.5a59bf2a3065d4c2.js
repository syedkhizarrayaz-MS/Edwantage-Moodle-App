"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[45157,80178],{45157:(e,s,o)=>{o.r(s),o.d(s,{AddonModWorkshopAssessmentStrategyComponent:()=>V});var t=o(10467),n=o(89417),r=o(75629),a=o(16082),d=o(45507),i=o(88436),l=o(24942),m=o(52749),c=o(48966),p=o(81690),h=o(79555),u=o(49882),f=o(63153),g=o(65964),k=o(67193),_=o(80178),A=o(26327),y=o(81552),b=o(91416),F=o(33014),S=o(55554),I=o(43411),w=o(58364),C=o(25572),v=o(41450),M=o(86654),W=o(54438),T=o(60177),x=o(2910),O=o(95638),R=o(68162),G=o(31498),E=o(25880),D=o(64422),$=o(17778),U=o(58197),j=o(73955);const H=["assessmentForm"],_c1=e=>({$a:e}),_c2=e=>({asid:e}),_c3=e=>({header:e});function AddonModWorkshopAssessmentStrategyComponent_ng_container_6_Template(e,s){if(1&e&&(W.qex(0),W.nrm(1,"core-dynamic-component",6),W.bVm()),2&e){const e=W.XpG();W.R7$(),W.Y8G("component",e.componentClass)("data",e.data)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_7_Template(e,s){if(1&e&&(W.j41(0,"ion-card",7)(1,"ion-item")(2,"ion-label")(3,"p"),W.EFF(4),W.nI1(5,"translate"),W.k0s()()()()),2&e){const e=W.XpG();W.R7$(4),W.JRh(W.i5U(5,1,"addon.mod_workshop.assessmentstrategynotsupported",W.eq3(4,_c1,e.strategy)))}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_core_input_errors_6_Template(e,s){if(1&e&&W.nrm(0,"core-input-errors",16),2&e){const e=W.XpG(3);W.Y8G("errorText",e.data.fieldErrors.feedbackauthor)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template(e,s){if(1&e){const e=W.RV6();W.j41(0,"ion-item")(1,"ion-label",12)(2,"span",13),W.EFF(3),W.nI1(4,"translate"),W.k0s()(),W.j41(5,"core-rich-text-editor",14),W.bIt("contentChanged",(function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template_core_rich_text_editor_contentChanged_5_listener(s){W.eBV(e);const o=W.XpG(2);return W.Njj(o.onFeedbackChange(s))})),W.k0s(),W.DNE(6,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_core_input_errors_6_Template,1,1,"core-input-errors",15),W.k0s()}if(2&e){const e=W.XpG(2);W.R7$(2),W.Y8G("core-mark-required",e.overallFeedkbackRequired),W.R7$(),W.SpI(" ",W.bMT(4,9,"addon.mod_workshop.feedbackauthor")," "),W.R7$(2),W.Y8G("control",e.feedbackControl)("component",e.component)("componentId",e.workshop.coursemodule)("autoSave",!0)("contextInstanceId",e.workshop.coursemodule)("draftExtraParams",W.eq3(11,_c2,e.assessmentId)),W.R7$(),W.Y8G("ngIf",e.overallFeedkbackRequired&&e.data.fieldErrors&&e.data.fieldErrors.feedbackauthor)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_core_attachments_7_Template(e,s){if(1&e&&W.nrm(0,"core-attachments",17),2&e){const e=W.XpG(2);W.Y8G("files",null==e.data.assessment?null:e.data.assessment.feedbackattachmentfiles)("maxSize",e.workshop.overallfeedbackmaxbytes)("maxSubmissions",e.workshop.overallfeedbackfiles)("component",e.component)("componentId",e.componentId)("allowOffline",!0)("courseId",e.workshop.course)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_ion_select_option_7_Template(e,s){if(1&e&&(W.j41(0,"ion-select-option",21),W.EFF(1),W.k0s()),2&e){const e=s.$implicit;W.Y8G("value",e),W.R7$(),W.JRh(e)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template(e,s){if(1&e){const e=W.RV6();W.j41(0,"ion-item")(1,"ion-select",18),W.nI1(2,"translate"),W.nI1(3,"translate"),W.mxI("ngModelChange",(function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template_ion_select_ngModelChange_1_listener(s){W.eBV(e);const o=W.XpG(2);return W.DH7(o.weight,s)||(o.weight=s),W.Njj(s)})),W.j41(4,"div",19),W.EFF(5),W.nI1(6,"translate"),W.k0s(),W.DNE(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_ion_select_option_7_Template,2,2,"ion-select-option",20),W.k0s()()}if(2&e){const e=W.XpG(2);W.R7$(),W.R50("ngModel",e.weight),W.Y8G("cancelText",W.bMT(2,6,"core.cancel"))("interfaceOptions",W.eq3(12,_c3,W.bMT(3,8,"addon.mod_workshop.assessmentweight"))),W.R7$(3),W.Y8G("core-mark-required",!0),W.R7$(),W.SpI(" ",W.bMT(6,10,"addon.mod_workshop.assessmentweight")," "),W.R7$(2),W.Y8G("ngForOf",e.weights)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_9_Template(e,s){if(1&e&&(W.j41(0,"ion-item",8)(1,"ion-label"),W.nrm(2,"core-format-text",22),W.k0s()()),2&e){const e=W.XpG(2);W.R7$(2),W.Y8G("component",e.component)("componentId",e.componentId)("text",null==e.data.assessment?null:e.data.assessment.feedbackauthor)("contextInstanceId",e.workshop.coursemodule)("courseId",e.workshop.course)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_10_Template(e,s){if(1&e&&(W.j41(0,"ion-item")(1,"ion-label"),W.nrm(2,"core-files",23),W.k0s()()),2&e){const e=W.XpG(2);W.R7$(2),W.Y8G("files",null==e.data.assessment?null:e.data.assessment.feedbackattachmentfiles)("component",e.component)("componentId",e.componentId)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_Template(e,s){if(1&e&&(W.j41(0,"ion-card")(1,"ion-item",8)(2,"ion-label")(3,"h3",9),W.EFF(4),W.nI1(5,"translate"),W.k0s()()(),W.DNE(6,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template,7,13,"ion-item",4)(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_core_attachments_7_Template,1,7,"core-attachments",10)(8,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template,8,14,"ion-item",4)(9,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_9_Template,3,5,"ion-item",11)(10,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_10_Template,3,3,"ion-item",4),W.k0s()),2&e){const e=W.XpG();W.R7$(4),W.JRh(W.bMT(5,6,"addon.mod_workshop.overallfeedback")),W.R7$(2),W.Y8G("ngIf",e.edit),W.R7$(),W.Y8G("ngIf",e.edit&&e.workshop.overallfeedbackfiles),W.R7$(),W.Y8G("ngIf",e.edit&&e.access&&e.access.canallocate),W.R7$(),W.Y8G("ngIf",!e.edit&&(null==e.data.assessment?null:e.data.assessment.feedbackauthor)),W.R7$(),W.Y8G("ngIf",!e.edit&&e.workshop.overallfeedbackfiles&&(null==e.data.assessment||null==e.data.assessment.feedbackattachmentfiles?null:e.data.assessment.feedbackattachmentfiles.length))}}let V=(()=>{var e;class AddonModWorkshopAssessmentStrategyComponent{constructor(){this.edit=!1,this.data={workshopId:0,assessment:void 0,edit:!1,selectedValues:[],fieldErrors:{},strategy:"",moduleId:0,courseId:void 0},this.assessmentStrategyLoaded=!1,this.notSupported=!1,this.feedbackText="",this.feedbackControl=new n.MJ(null),this.overallFeedkback=!1,this.overallFeedkbackRequired=!1,this.component=y.Ug,this.weights=[],this.hasOffline=!1,this.originalData={text:"",files:[],weight:1,selectedValues:[]}}ngOnInit(){var e=this;return(0,t.A)((function*(){if(!e.assessmentId||!e.strategy)return e.assessmentStrategyLoaded=!0,void 0;if(e.data.workshopId=e.workshop.id,e.data.edit=e.edit,e.data.strategy=e.strategy,e.data.moduleId=e.workshop.coursemodule,e.data.courseId=e.workshop.course,e.componentClass=yield g.AddonWorkshopAssessmentStrategyDelegate.getComponentForPlugin(e.strategy),e.componentClass){if(e.overallFeedkback=0!=e.workshop.overallfeedbackmode,e.overallFeedkbackRequired=2==e.workshop.overallfeedbackmode,e.componentId=e.workshop.coursemodule,e.edit&&e.access.canallocate){e.weights=[];for(let s=16;s>=0;s--)e.weights[s]=s}e.edit&&c.CoreSync.blockOperation(y.Ug,e.workshop.id);try{yield e.load(),e.obsInvalidated=u.z.on(y.Dl,(()=>e.load()),m.CoreSites.getCurrentSiteId())}catch(s){e.componentClass=void 0,C.CoreAlerts.showError(s,{default:"Error loading assessment."})}finally{e.assessmentStrategyLoaded=!0}}else e.notSupported=!g.AddonWorkshopAssessmentStrategyDelegate.isPluginSupported(e.strategy),e.assessmentStrategyLoaded=!0}))()}load(){var e=this;return(0,t.A)((function*(){if(e.data.assessment=yield _.AddonModWorkshopHelper.getReviewerAssessmentById(e.workshop.id,e.assessmentId,{userId:e.userId,cmId:e.workshop.coursemodule,filter:!e.edit&&void 0,readingStrategy:e.edit?3:void 0}),e.data.assessment.form){if(e.edit)try{const s=(yield A.AddonModWorkshopOffline.getAssessment(e.workshop.id,e.assessmentId)).inputdata;e.hasOffline=!0,e.data.assessment.feedbackauthor=s.feedbackauthor,e.access.canallocate&&(e.data.assessment.weight=s.weight),e.data.assessment.form.current=k.AddonModWorkshop.parseFields(w.T.toArrayOfObjects(s,"name","value")),s&&(e.data.assessment.feedbackattachmentfiles=yield _.AddonModWorkshopHelper.getAssessmentFilesFromOfflineFilesObject(s.feedbackauthorattachmentsid,e.workshop.id,e.assessmentId))}catch{e.hasOffline=!1}finally{e.feedbackText=e.data.assessment.feedbackauthor,e.feedbackControl.setValue(e.feedbackText),e.originalData.text=e.data.assessment.feedbackauthor,e.access.canallocate&&(e.originalData.weight=e.data.assessment.weight),e.originalData.files=[],e.data.assessment.feedbackattachmentfiles.forEach((s=>{let o=d.CoreFile.getFileName(s);o||(o=i.CoreFileHelper.getFilenameFromPath(s)||""),e.originalData.files.push({filename:o,fileurl:""})}))}try{e.data.selectedValues=yield g.AddonWorkshopAssessmentStrategyDelegate.getOriginalValues(e.strategy,e.data.assessment.form,e.workshop.id)}finally{e.originalData.selectedValues=p.j.clone(e.data.selectedValues),e.edit&&(l.CoreFileSession.setFiles(y.Ug,`${e.workshop.id}_${e.assessmentId}`,e.data.assessment.feedbackattachmentfiles),e.access.canallocate&&(e.weight=e.data.assessment.weight))}}}))()}hasDataChanged(){var e;if(!this.assessmentStrategyLoaded||!this.workshop.strategy||!this.edit)return!1;const s=i.CoreFileHelper.restorePluginfileUrls(this.feedbackText,(null===(e=this.data.assessment)||void 0===e?void 0:e.feedbackcontentfiles)||[]);if(this.originalData.text!=s)return!0;if(this.access.canallocate&&this.originalData.weight!=this.weight)return!0;const o=l.CoreFileSession.getFiles(y.Ug,`${this.workshop.id}_${this.assessmentId}`)||[];return!!a.CoreFileUploader.areFileListDifferent(o,this.originalData.files)||g.AddonWorkshopAssessmentStrategyDelegate.hasDataChanged(this.workshop.strategy,this.originalData.selectedValues,this.data.selectedValues)}saveAssessment(){var e=this;return(0,t.A)((function*(){var s;if(null===(s=e.data.assessment)||void 0===s||!s.form)return;const o=l.CoreFileSession.getFiles(y.Ug,`${e.workshop.id}_${e.assessmentId}`)||[];let t=!1,n=!o.length;const d=yield F.CoreLoadings.show("core.sending",!0);e.data.fieldErrors={};try{var c;let s;try{s=yield _.AddonModWorkshopHelper.uploadOrStoreAssessmentFiles(e.workshop.id,e.assessmentId,o,t)}catch(r){if(I.CoreWSError.isWebServiceError(r))throw r;t=!0,n=!0,s=yield _.AddonModWorkshopHelper.uploadOrStoreAssessmentFiles(e.workshop.id,e.assessmentId,o,t)}const d=i.CoreFileHelper.restorePluginfileUrls(e.feedbackText,(null===(c=e.data.assessment)||void 0===c?void 0:c.feedbackcontentfiles)||[]);let l;try{l=yield _.AddonModWorkshopHelper.prepareAssessmentData(e.workshop,e.data.selectedValues,d,e.data.assessment.form,s)}catch(s){throw e.data.fieldErrors=s,new r.CoreError(h.HT.instant("core.errorinvalidform"))}let p=!1;t?yield A.AddonModWorkshopOffline.saveAssessment(e.workshop.id,e.assessmentId,e.workshop.course,l):p=yield k.AddonModWorkshop.updateAssessment(e.workshop.id,e.assessmentId,e.workshop.course,l,void 0,n),f.R.triggerFormSubmittedEvent(e.formElement,!!p,m.CoreSites.getCurrentSiteId());const g=[];p&&(g.push(_.AddonModWorkshopHelper.deleteAssessmentStoredFiles(e.workshop.id,e.assessmentId)),g.push(k.AddonModWorkshop.invalidateAssessmentFormData(e.workshop.id,e.assessmentId)),g.push(k.AddonModWorkshop.invalidateAssessmentData(e.workshop.id,e.assessmentId))),yield S.g.ignoreErrors(Promise.all(g)),u.z.trigger(y.Px,{workshopId:e.workshop.id,assessmentId:e.assessmentId,userId:m.CoreSites.getCurrentSiteUserId()},m.CoreSites.getCurrentSiteId()),o&&a.CoreFileUploader.clearTmpFiles(o)}catch(e){C.CoreAlerts.showError(e,{default:"Error saving assessment."})}finally{d.dismiss()}}))()}onFeedbackChange(e){this.feedbackText=null!=e?e:""}ngOnDestroy(){var e,s;null===(e=this.obsInvalidated)||void 0===e||e.off(),null!==(s=this.data.assessment)&&void 0!==s&&s.feedbackattachmentfiles&&a.CoreFileUploader.clearTmpFiles(this.data.assessment.feedbackattachmentfiles)}}return(e=AddonModWorkshopAssessmentStrategyComponent).ɵfac=function AddonModWorkshopAssessmentStrategyComponent_Factory(s){return new(s||e)},e.ɵcmp=W.VBU({type:e,selectors:[["addon-mod-workshop-assessment-strategy"]],viewQuery:function AddonModWorkshopAssessmentStrategyComponent_Query(e,s){if(1&e&&W.GBs(H,5),2&e){let e;W.mGM(e=W.lsd())&&(s.formElement=e.first)}},inputs:{workshop:"workshop",access:"access",assessmentId:"assessmentId",userId:"userId",strategy:"strategy",edit:[W.Mj6.HasDecoratorInputTransform,"edit","edit",b.G]},standalone:!0,features:[W.GFd,W.aNF],decls:9,vars:7,consts:[["assessmentForm",""],[1,"ion-padding"],["name","mma-mod_workshop-assessment-form"],[3,"hideUntil"],[4,"ngIf"],["class","core-info-card",4,"ngIf"],[3,"component","data"],[1,"core-info-card"],[1,"ion-text-wrap"],[1,"item-heading"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["position","stacked"],[3,"core-mark-required"],["contextLevel","module","elementId","feedbackauthor_editor",3,"contentChanged","control","component","componentId","autoSave","contextInstanceId","draftExtraParams"],[3,"errorText",4,"ngIf"],[3,"errorText"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId"],["labelPlacement","stacked","interface","action-sheet","name","weight",3,"ngModelChange","ngModel","cancelText","interfaceOptions"],["slot","label",3,"core-mark-required"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[3,"files","component","componentId"]],template:function AddonModWorkshopAssessmentStrategyComponent_Template(e,s){1&e&&(W.j41(0,"h2",1),W.EFF(1),W.nI1(2,"translate"),W.k0s(),W.j41(3,"form",2,0)(5,"core-loading",3),W.DNE(6,AddonModWorkshopAssessmentStrategyComponent_ng_container_6_Template,2,2,"ng-container",4)(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_7_Template,6,6,"ion-card",5)(8,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_Template,11,8,"ion-card",4),W.k0s()()),2&e&&(W.R7$(),W.JRh(W.bMT(2,5,"addon.mod_workshop.assessmentform")),W.R7$(4),W.Y8G("hideUntil",s.assessmentStrategyLoaded),W.R7$(),W.Y8G("ngIf",s.componentClass&&s.assessmentStrategyLoaded),W.R7$(),W.Y8G("ngIf",s.notSupported),W.R7$(),W.Y8G("ngIf",s.assessmentStrategyLoaded&&s.overallFeedkback&&(s.edit||(null==s.data.assessment?null:s.data.assessment.feedbackauthor)||(null==s.data.assessment||null==s.data.assessment.feedbackattachmentfiles?null:s.data.assessment.feedbackattachmentfiles.length))))},dependencies:[M.n,T.Sq,T.bT,n.qT,n.BC,n.cb,n.vS,n.cV,x.b_,x.uz,x.he,x.Nm,x.Ip,x.Je,O.V,R.m,G.Y,E.q,D.R,$.j,U.B,j.D9,v.CoreEditorRichTextEditorComponent],encapsulation:2}),AddonModWorkshopAssessmentStrategyComponent})()},80178:(e,s,o)=>{o.r(s),o.d(s,{AddonModWorkshopHelper:()=>y,AddonModWorkshopHelperProvider:()=>A});var t=o(10467),n=o(75629),r=o(16082),a=o(45507),d=o(88436),i=o(52749),l=o(75383),m=o(81690),c=o(79555),p=o(65964),h=o(67193),u=o(26327),f=o(81552),g=o(55554),k=o(58364),_=o(54438);let A=(()=>{var e;class AddonModWorkshopHelperProvider{getTask(e,s){return e.find((e=>e.code==s))}isTaskDone(e,s){const o=this.getTask(e,s);return!o||!!o.completed}canSubmit(e,s,o){const t=e.useexamples&&1==e.examplesmode,n=s.canmanageexamples||0==e.examplesmode||this.isTaskDone(o,"examples");return e.phase>10&&s.cansubmit&&(!t||n)}canAssess(e,s){return!(e.useexamples&&2==e.examplesmode)||s.canmanageexamples}canAddFeedback(e,s){return 40===e.phase&&s.canoverridegrades}canEditAssessments(e,s){return 30===e.phase&&this.canAssess(e,s)&&s.assessingallowed&&s.canpeerassess}getUserSubmission(e,s={}){return(0,t.A)((function*(){const o=s.userId||i.CoreSites.getCurrentSiteUserId();return(yield h.AddonModWorkshop.getSubmissions(e,s)).find((e=>e.authorid==o))}))()}getSubmissionById(e,s,o={}){return(0,t.A)((function*(){try{return yield h.AddonModWorkshop.getSubmission(e,s,o)}catch{const t=(yield h.AddonModWorkshop.getSubmissions(e,o)).find((e=>e.id==s));if(!t)throw new n.CoreError("Submission not found");return t}}))()}getReviewerAssessmentById(e,s,o={}){return(0,t.A)((function*(){let t;try{t=yield h.AddonModWorkshop.getAssessment(e,s,o)}catch(n){if(t=(yield h.AddonModWorkshop.getReviewerAssessments(e,o)).find((e=>e.id===s)),!t)throw n}return t.form=yield h.AddonModWorkshop.getAssessmentForm(e,s,{cmId:o.cmId,siteId:o.siteId}),t}))()}getReviewerAssessments(e,s={}){var o=this;return(0,t.A)((function*(){s.siteId=s.siteId||i.CoreSites.getCurrentSiteId();const t=yield h.AddonModWorkshop.getReviewerAssessments(e,s),n=[];return t.forEach((t=>{const r=k.T.without(s,["canAssess","filter"]);n.push(o.getSubmissionById(e,t.submissionid,r).then((e=>{t.submission=e}))),n.push(h.AddonModWorkshop.getAssessmentForm(e,t.id,r).then((e=>{t.form=e})))})),yield Promise.all(n),t}))()}deleteSubmissionStoredFiles(e,s){return(0,t.A)((function*(){const o=yield u.AddonModWorkshopOffline.getSubmissionFolder(e,s);yield g.g.ignoreErrors(a.CoreFile.removeDir(o))}))()}storeSubmissionFiles(e,s,o){return(0,t.A)((function*(){const t=yield u.AddonModWorkshopOffline.getSubmissionFolder(e,o);return r.CoreFileUploader.storeFilesToUpload(t,s)}))()}uploadOrStoreSubmissionFiles(e,s,o,t){return o?this.storeSubmissionFiles(e,s,t):r.CoreFileUploader.uploadOrReuploadFiles(s,f.Ug,e,t)}getStoredSubmissionFiles(e,s){return(0,t.A)((function*(){const o=yield u.AddonModWorkshopOffline.getSubmissionFolder(e,s);return g.g.ignoreErrors(r.CoreFileUploader.getStoredFiles(o),[])}))()}getSubmissionFilesFromOfflineFilesObject(e,s,o){return(0,t.A)((function*(){const t=yield u.AddonModWorkshopOffline.getSubmissionFolder(s,o);return r.CoreFileUploader.getStoredFilesFromOfflineFilesObject(e,t)}))()}deleteAssessmentStoredFiles(e,s,o){return(0,t.A)((function*(){const t=yield u.AddonModWorkshopOffline.getAssessmentFolder(e,s,o);yield g.g.ignoreErrors(a.CoreFile.removeDir(t))}))()}storeAssessmentFiles(e,s,o,n){return(0,t.A)((function*(){const t=yield u.AddonModWorkshopOffline.getAssessmentFolder(e,s,n);return r.CoreFileUploader.storeFilesToUpload(t,o)}))()}uploadOrStoreAssessmentFiles(e,s,o,t,n){return t?this.storeAssessmentFiles(e,s,o,n):r.CoreFileUploader.uploadOrReuploadFiles(o,f.Ug,e,n)}getStoredAssessmentFiles(e,s,o){return(0,t.A)((function*(){const t=yield u.AddonModWorkshopOffline.getAssessmentFolder(e,s,o);return g.g.ignoreErrors(r.CoreFileUploader.getStoredFiles(t),[])}))()}getAssessmentFilesFromOfflineFilesObject(e,s,o,n){return(0,t.A)((function*(){const t=yield u.AddonModWorkshopOffline.getAssessmentFolder(s,o,n);return r.CoreFileUploader.getStoredFilesFromOfflineFilesObject(e,t)}))()}applyOfflineData(e,s=[]){var o=this;return(0,t.A)((function*(){if(0===s.length)return e;const t=null!=e?e:{id:0,workshopid:0,title:"",content:"",timemodified:0,example:!1,authorid:0,timecreated:0,contenttrust:0,attachment:0,published:!1,late:0};let n;const r=s[0].workshopid;return s.forEach((s=>{switch(s.action){case"add":case"update":t.title=s.title,t.content=d.CoreFileHelper.replacePluginfileUrls(s.content,(null==e?void 0:e.contentfiles)||[]),t.courseid=s.courseid,t.submissionmodified=s.timemodified/1e3,t.offline=!0,n=s.attachmentsid;break;case"delete":t.deleted=!0,t.submissionmodified=s.timemodified/1e3}})),t.attachmentfiles=n?yield o.getSubmissionFilesFromOfflineFilesObject(n,r):[],t}))()}prepareAssessmentData(e,s,o,n,r=0){return(0,t.A)((function*(){var t;if(2==e.overallfeedbackmode&&!o){throw{feedbackauthor:c.HT.instant("core.err_required")}}const a=(yield p.AddonWorkshopAssessmentStrategyDelegate.prepareAssessmentData(null!==(t=e.strategy)&&void 0!==t?t:"",s,n))||{};return a.feedbackauthor=o,a.feedbackauthorformat=l.C9,a.feedbackauthorattachmentsid=r,a.nodims=n.dimenssionscount,a}))()}realGradeValueHelper(e,s=0,o=0){return"string"==typeof e?e:null!=e?0===s?"0":(e=l.Ni.roundToDecimals(s*e/100,o),m.j.formatFloat(e)):void 0}realGradeValue(e,s){return s.grade=this.realGradeValueHelper(s.grade,e.grade,e.gradedecimals),s.gradinggrade=this.realGradeValueHelper(s.gradinggrade,e.gradinggrade,e.gradedecimals),s.gradinggradeover=this.realGradeValueHelper(s.gradinggradeover,e.gradinggrade,e.gradedecimals),s}showGrade(e){return null!=e}}return(e=AddonModWorkshopHelperProvider).ɵfac=function AddonModWorkshopHelperProvider_Factory(s){return new(s||e)},e.ɵprov=_.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModWorkshopHelperProvider})();const y=(0,c.Qd)(A)}}]);