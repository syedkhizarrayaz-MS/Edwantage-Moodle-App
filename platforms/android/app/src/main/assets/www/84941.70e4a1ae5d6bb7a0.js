"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[84941],{84941:(e,t,o)=>{o.r(t),o.d(t,{default:()=>M});var n=o(10467),i=o(83696),r=o(2401),a=o(25124),s=o(29492),l=o(15324),d=o(55554),c=o(4856),u=o(24742),m=o(22693),p=o(25572),g=o(79555),_=o(86654),h=o(54438),f=o(21182),b=o(60177),A=o(2910),v=o(97818),k=o(66198),F=o(64422),R=o(16658),I=o(88246),y=o(73955),T=o(59528);const _c0=e=>({$a:e});function AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_p_5_Template(e,t){if(1&e&&(h.j41(0,"p"),h.EFF(1),h.nI1(2,"coreFormatDate"),h.k0s()),2&e){const e=h.XpG().$implicit;h.R7$(),h.JRh(h.bMT(2,1,1e3*e.timemodified))}}function AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_Template(e,t){if(1&e){const e=h.RV6();h.j41(0,"ion-item",10),h.bIt("click",(function AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_Template_ion_item_click_0_listener(){const t=h.eBV(e).$implicit,o=h.XpG(2);return h.Njj(null==o.attempts?null:o.attempts.select(t))})),h.nrm(1,"core-user-avatar",11),h.j41(2,"ion-label")(3,"p",12),h.EFF(4),h.k0s(),h.DNE(5,AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_p_5_Template,3,3,"p",7),h.k0s()()}if(2&e){const e=t.$implicit,o=h.XpG(2);h.Y8G("detail",!0),h.BMQ("aria-current",null==o.attempts?null:o.attempts.getItemAriaCurrent(e)),h.R7$(),h.Y8G("user",e)("linkProfile",!1),h.R7$(3),h.JRh(e.fullname),h.R7$(),h.Y8G("ngIf",e.timemodified)}}function AddonModFeedbackAttemptsPage_ng_container_17_Template(e,t){if(1&e&&(h.qex(0),h.j41(1,"ion-item-divider")(2,"ion-label")(3,"h2"),h.EFF(4),h.nI1(5,"translate"),h.k0s()()(),h.DNE(6,AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_Template,6,6,"ion-item",9),h.bVm()),2&e){const e=h.XpG();h.R7$(4),h.JRh(h.i5U(5,2,"addon.mod_feedback.non_anonymous_entries",h.eq3(5,_c0,e.identifiableAttemptsTotal))),h.R7$(2),h.Y8G("ngForOf",e.identifiableAttempts)}}function AddonModFeedbackAttemptsPage_ng_container_18_ion_item_6_Template(e,t){if(1&e){const e=h.RV6();h.j41(0,"ion-item",10),h.bIt("click",(function AddonModFeedbackAttemptsPage_ng_container_18_ion_item_6_Template_ion_item_click_0_listener(){const t=h.eBV(e).$implicit,o=h.XpG(2);return h.Njj(null==o.attempts?null:o.attempts.select(t))})),h.nrm(1,"core-user-avatar",13),h.j41(2,"ion-label")(3,"p",12),h.EFF(4),h.nI1(5,"translate"),h.k0s(),h.j41(6,"p"),h.EFF(7),h.nI1(8,"translate"),h.k0s()()()}if(2&e){const e=t.$implicit,o=h.XpG(2);h.Y8G("detail",!0),h.BMQ("aria-current",null==o.attempts?null:o.attempts.getItemAriaCurrent(e)),h.R7$(),h.Y8G("linkProfile",!1),h.R7$(3),h.JRh(h.bMT(5,6,"addon.mod_feedback.anonymous_user")),h.R7$(3),h.Lme("",h.bMT(8,8,"addon.mod_feedback.response_nr"),": ",e.number,"")}}function AddonModFeedbackAttemptsPage_ng_container_18_Template(e,t){if(1&e&&(h.qex(0),h.j41(1,"ion-item-divider")(2,"ion-label")(3,"h2"),h.EFF(4),h.nI1(5,"translate"),h.k0s()()(),h.DNE(6,AddonModFeedbackAttemptsPage_ng_container_18_ion_item_6_Template,9,10,"ion-item",9),h.bVm()),2&e){const e=h.XpG();h.R7$(4),h.JRh(h.i5U(5,2,"addon.mod_feedback.anonymous_entries",h.eq3(5,_c0,e.anonymousAttemptsTotal))),h.R7$(2),h.Y8G("ngForOf",e.anonymousAttempts)}}let M=(()=>{var e;class AddonModFeedbackAttemptsPage{constructor(e){this.route=e,this.fetchFailed=!1,this.promisedAttempts=new a._,this.logView=u.j.once((()=>{var e;const t=null===(e=this.attempts)||void 0===e?void 0:e.getSource();t&&t.feedback&&m.OF.logEvent({type:m.qr.VIEW_ITEM_LIST,ws:"mod_feedback_get_responses_analysis",name:t.feedback.name,data:{feedbackid:t.feedback.id,category:"feedback"},url:`/mod/feedback/show_entries.php?id=${t.CM_ID}`})}))}get attempts(){return this.promisedAttempts.value}get groupInfo(){var e;return null===(e=this.attempts)||void 0===e?void 0:e.getSource().groupInfo}get selectedGroup(){var e;return null===(e=this.attempts)||void 0===e?void 0:e.getSource().selectedGroup}set selectedGroup(e){this.attempts&&(this.attempts.getSource().selectedGroup=e,this.attempts.getSource().setDirty(!0))}get identifiableAttempts(){var e,t;return null!==(e=null===(t=this.attempts)||void 0===t?void 0:t.getSource().identifiable)&&void 0!==e?e:[]}get identifiableAttemptsTotal(){var e,t;return null!==(e=null===(t=this.attempts)||void 0===t?void 0:t.getSource().identifiableTotal)&&void 0!==e?e:0}get anonymousAttempts(){var e,t;return null!==(e=null===(t=this.attempts)||void 0===t?void 0:t.getSource().anonymous)&&void 0!==e?e:[]}get anonymousAttemptsTotal(){var e,t;return null!==(e=null===(t=this.attempts)||void 0===t?void 0:t.getSource().anonymousTotal)&&void 0!==e?e:0}ngAfterViewInit(){var e=this;return(0,n.A)((function*(){try{e.courseId=l.CoreNavigator.getRequiredRouteNumberParam("courseId");const t=l.CoreNavigator.getRequiredRouteNumberParam("cmId"),o=i.u.getOrCreateSource(c.D,[e.courseId,t]);o.selectedGroup=l.CoreNavigator.getRouteNumberParam("group")||0,e.promisedAttempts.resolve(new AddonModFeedbackAttemptsManager(o,e.route.component))}catch(e){return p.CoreAlerts.showError(e),l.CoreNavigator.back(),void 0}const t=yield e.promisedAttempts;try{e.fetchFailed=!1,yield t.getSource().loadFeedback(),yield t.load(),e.logView()}catch(t){e.fetchFailed=!0,p.CoreAlerts.showError(t,{default:g.HT.instant("core.course.errorgetmodule")})}yield t.start(e.splitView)}))()}ngOnDestroy(){var e;null===(e=this.attempts)||void 0===e||e.destroy()}fetchMoreAttempts(e){var t=this;return(0,n.A)((function*(){const o=yield t.promisedAttempts;try{t.fetchFailed=!1,yield o.load()}catch(e){t.fetchFailed=!0,p.CoreAlerts.showError(e,{default:g.HT.instant("core.course.errorgetmodule")})}finally{e&&e()}}))()}refreshFeedback(e){var t=this;return(0,n.A)((function*(){const o=yield t.promisedAttempts;try{t.fetchFailed=!1,yield d.g.ignoreErrors(o.getSource().invalidateCache()),yield o.getSource().loadFeedback(),yield o.reload()}catch(e){t.fetchFailed=!0,p.CoreAlerts.showError(e,{default:g.HT.instant("core.course.errorgetmodule")})}finally{e.complete()}}))()}reloadAttempts(){var e=this;return(0,n.A)((function*(){const t=yield e.promisedAttempts;yield t.reload()}))()}}return(e=AddonModFeedbackAttemptsPage).ɵfac=function AddonModFeedbackAttemptsPage_Factory(t){return new(t||e)(h.rXU(f.nX))},e.ɵcmp=h.VBU({type:e,selectors:[["page-addon-mod-feedback-attempts"]],viewQuery:function AddonModFeedbackAttemptsPage_Query(e,t){if(1&e&&h.GBs(s.M,5),2&e){let e;h.mGM(e=h.lsd())&&(t.splitView=e.first)}},standalone:!0,features:[h.aNF],decls:20,vars:18,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[1,"ion-no-margin"],[3,"selectedChange","groupInfo","selected","courseId"],[4,"ngIf"],[3,"action","enabled","error"],["class","ion-text-wrap","button","",3,"detail","click",4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap",3,"click","detail"],["slot","start",3,"user","linkProfile"],[1,"item-heading"],["slot","start",3,"linkProfile"]],template:function AddonModFeedbackAttemptsPage_Template(e,t){1&e&&(h.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),h.nrm(3,"ion-back-button",1),h.nI1(4,"translate"),h.k0s(),h.j41(5,"ion-title")(6,"h1"),h.EFF(7),h.nI1(8,"translate"),h.k0s()()()(),h.j41(9,"ion-content")(10,"core-split-view")(11,"ion-refresher",2),h.bIt("ionRefresh",(function AddonModFeedbackAttemptsPage_Template_ion_refresher_ionRefresh_11_listener(e){return t.refreshFeedback(e.target)})),h.nrm(12,"ion-refresher-content",3),h.nI1(13,"translate"),h.k0s(),h.j41(14,"core-loading",4)(15,"ion-list",5)(16,"core-group-selector",6),h.mxI("selectedChange",(function AddonModFeedbackAttemptsPage_Template_core_group_selector_selectedChange_16_listener(e){return h.DH7(t.selectedGroup,e)||(t.selectedGroup=e),e})),h.bIt("selectedChange",(function AddonModFeedbackAttemptsPage_Template_core_group_selector_selectedChange_16_listener(){return t.reloadAttempts()})),h.k0s(),h.DNE(17,AddonModFeedbackAttemptsPage_ng_container_17_Template,7,7,"ng-container",7)(18,AddonModFeedbackAttemptsPage_ng_container_18_Template,7,7,"ng-container",7),h.j41(19,"core-infinite-loading",8),h.bIt("action",(function AddonModFeedbackAttemptsPage_Template_core_infinite_loading_action_19_listener(e){return t.fetchMoreAttempts(e)})),h.k0s()()()()()),2&e&&(h.R7$(3),h.Y8G("text",h.bMT(4,12,"core.back")),h.R7$(4),h.JRh(h.bMT(8,14,"addon.mod_feedback.responses")),h.R7$(4),h.Y8G("disabled",!t.attempts||!t.attempts.loaded),h.R7$(),h.FS9("pullingText",h.bMT(13,16,"core.pulltorefresh")),h.R7$(2),h.Y8G("hideUntil",t.attempts&&t.attempts.loaded),h.R7$(2),h.Y8G("groupInfo",t.groupInfo),h.R50("selected",t.selectedGroup),h.Y8G("courseId",t.courseId),h.R7$(),h.Y8G("ngIf",t.identifiableAttemptsTotal>0),h.R7$(),h.Y8G("ngIf",t.identifiableAttemptsTotal===t.identifiableAttempts.length&&t.anonymousAttemptsTotal>0),h.R7$(),h.Y8G("enabled",t.attempts&&t.attempts.loaded&&!t.attempts.completed)("error",t.fetchFailed))},dependencies:[_.n,b.Sq,b.bT,A.QW,A.W9,A.eU,A.uz,A.Dg,A.he,A.nf,A.To,A.Ki,A.BC,A.ai,A.el,v.F,k.b,F.R,s.M,R.T,I.i,y.D9,T.f],encapsulation:2}),AddonModFeedbackAttemptsPage})();class AddonModFeedbackAttemptsManager extends r.R{}},2401:(e,t,o)=>{o.d(t,{R:()=>CoreListItemsManager});var n=o(10467),i=o(21182),r=o(15324),a=o(93417),s=o(81690),l=o(95990),d=o(82907),c=o(24742),u=o(55554);class CoreListItemsManager extends l.u{constructor(e,t){super(e);const o=s.j.debounce((()=>this.scrollToCurrentElement()),300);this.pageRouteLocator=t,this.addListener({onSelectedItemUpdated:o}),this.finishSuccessfulFetch=c.j.once((()=>u.g.ignoreErrors(this.logActivity())))}get items(){return this.getSource().getItems()||[]}get loaded(){return null!==this.itemsMap}get completed(){return this.getSource().isCompleted()}get empty(){const e=this.getSource().getItems();return null===e||0===e.length}start(e){var t=this;return(0,n.A)((function*(){e&&t.watchSplitViewOutlet(e),t.updateSelectedItem()}))()}destroy(){var e;super.destroy(),null===(e=this.splitViewOutletSubscription)||void 0===e||e.unsubscribe()}watchSplitViewOutlet(e){var t;this.splitView=e,this.splitViewOutletSubscription=e.outletRouteObservable.subscribe((e=>this.updateSelectedItem(this.getPageRouteFromSplitViewOutlet(e)))),this.updateSelectedItem(null!==(t=this.getPageRouteFromSplitViewOutlet(e.outletRoute))&&void 0!==t?t:null)}isSelected(e){return this.selectedItem===e}getItemAriaCurrent(e){return this.isSelected(e)?"page":"false"}select(e){var t=this;return(0,n.A)((function*(){if(!e)return yield t.navigateToIndex({reset:t.resetNavigation()}),void 0;yield t.navigateToItem(e,{reset:t.resetNavigation()})}))()}reset(){this.getSource().reset()}reload(){var e=this;return(0,n.A)((function*(){yield e.getSource().reload(),e.finishSuccessfulFetch()}))()}load(){var e=this;return(0,n.A)((function*(){yield e.getSource().load(),e.finishSuccessfulFetch()}))()}logActivity(){return(0,n.A)((function*(){}))()}resetNavigation(){var e;return!!a.CoreScreen.isTablet&&!(!this.splitView||null!==(e=this.splitView)&&void 0!==e&&e.isNested)}updateSelectedItem(e=null){super.updateSelectedItem(e);this.select(a.CoreScreen.isTablet&&null===this.selectedItem&&this.splitView&&!this.splitView.isNested?this.getDefaultItem():this.selectedItem)}scrollToCurrentElement(){var e=this;return(0,n.A)((function*(){var t,o,n;if(a.CoreScreen.isMobile)return;const i=(null!==(t=null===(o=e.splitView)||void 0===o?void 0:o.nativeElement)&&void 0!==t?t:document).querySelector('[aria-current="page"]');if(!i)return;d.y.isElementInViewport(i,1,null===(n=e.splitView)||void 0===n?void 0:n.nativeElement)||i.scrollIntoView({behavior:"smooth"})}))()}getDefaultItem(){return this.items[0]||null}getCurrentPageRoute(){return this.pageRouteLocator instanceof i.nX?r.CoreNavigator.isRouteActive(this.pageRouteLocator)?this.pageRouteLocator:null:r.CoreNavigator.getCurrentRoute({pageComponent:this.pageRouteLocator})}getSelectedItemPathFromRoute(e){const t=[];for(;e.firstChild;)t.push(...r.CoreNavigator.getRouteUrl(e=e.firstChild));return t.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}getPageRouteFromSplitViewOutlet(e){const t=this.buildRouteMatcher();for(;e&&!t(e);)e=e.parent;return e}buildRouteMatcher(){if(this.pageRouteLocator instanceof i.nX){const e=r.CoreNavigator.getRouteFullPath(this.pageRouteLocator);return t=>r.CoreNavigator.getRouteFullPath(t)===e}return e=>e.component===this.pageRouteLocator}}}}]);