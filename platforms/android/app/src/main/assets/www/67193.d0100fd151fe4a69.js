"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[67193],{67193:(e,t,s)=>{s.r(t),s.d(t,{AddonModWorkshop:()=>v,AddonModWorkshopProvider:()=>f});var r=s(10467),i=s(75629),o=s(97254),n=s(94455),a=s(52749),d=s(75383),u=s(24502),c=s(99121),l=s(79555),h=s(26327),g=s(81552),y=s(74431),m=s(43411),p=s(58364),S=s(95384),C=s(54438);let f=(()=>{var e;class AddonModWorkshopProvider{getWorkshopDataCacheKey(e){return`${AddonModWorkshopProvider.ROOT_CACHE_KEY}workshop:${e}`}getWorkshopDataPrefixCacheKey(e){return AddonModWorkshopProvider.ROOT_CACHE_KEY+e}getWorkshopAccessInformationDataCacheKey(e){return`${this.getWorkshopDataPrefixCacheKey(e)}:access`}getUserPlanDataCacheKey(e){return`${this.getWorkshopDataPrefixCacheKey(e)}:userplan`}getSubmissionsDataCacheKey(e,t=0,s=0){return`${this.getWorkshopDataPrefixCacheKey(e)}:submissions:${t}:${s}`}getSubmissionDataCacheKey(e,t){return`${this.getWorkshopDataPrefixCacheKey(e)}:submission:${t}`}getGradesDataCacheKey(e){return`${this.getWorkshopDataPrefixCacheKey(e)}:grades`}getGradesReportDataCacheKey(e,t=0){return`${this.getWorkshopDataPrefixCacheKey(e)}:report:${t}`}getSubmissionAssessmentsDataCacheKey(e,t){return`${this.getWorkshopDataPrefixCacheKey(e)}:assessments:${t}`}getReviewerAssessmentsDataCacheKey(e,t=0){return`${this.getWorkshopDataPrefixCacheKey(e)}:reviewerassessments:${t}`}getAssessmentDataCacheKey(e,t){return`${this.getWorkshopDataPrefixCacheKey(e)}:assessment:${t}`}getAssessmentFormDataCacheKey(e,t,s="assessment"){return`${this.getWorkshopDataPrefixCacheKey(e)}:assessmentsform:${t}:${s}`}getWorkshopByKey(e,t,s,i={}){var o=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(i.siteId),n={courseids:[e]},d={cacheKey:o.getWorkshopDataCacheKey(e),updateFrequency:y.CoreCacheUpdateFrequency.RARELY,component:g.Ug,...a.CoreSites.getReadingStrategyPreSets(i.readingStrategy)},u=yield r.read("mod_workshop_get_workshops_by_courses",n,d),c=S.CoreCourseModuleHelper.getActivityByField(u.workshops,t,s);return void 0===c.submissiontypetext&&(void 0!==c.nattachments&&c.nattachments>0?(c.submissiontypetext=1,c.submissiontypefile=1):(c.submissiontypetext=2,c.submissiontypefile=0)),c}))()}getWorkshop(e,t,s={}){return this.getWorkshopByKey(e,"coursemodule",t,s)}getWorkshopById(e,t,s={}){return this.getWorkshopByKey(e,"id",t,s)}invalidateWorkshopData(e,t){var s=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(t);yield r.invalidateWsCacheForKey(s.getWorkshopDataCacheKey(e))}))()}invalidateWorkshopWSData(e,t){var s=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(t);yield r.invalidateWsCacheForKeyStartingWith(s.getWorkshopDataPrefixCacheKey(e))}))()}getWorkshopAccessInformation(e,t={}){var s=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(t.siteId),i={workshopid:e},o={cacheKey:s.getWorkshopAccessInformationDataCacheKey(e),component:g.Ug,componentId:t.cmId,...a.CoreSites.getReadingStrategyPreSets(t.readingStrategy)};return r.read("mod_workshop_get_workshop_access_information",i,o)}))()}invalidateWorkshopAccessInformationData(e,t){var s=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(t);yield r.invalidateWsCacheForKey(s.getWorkshopAccessInformationDataCacheKey(e))}))()}getUserPlanPhases(e,t={}){var s=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(t.siteId),i={workshopid:e},o={cacheKey:s.getUserPlanDataCacheKey(e),updateFrequency:y.CoreCacheUpdateFrequency.OFTEN,component:g.Ug,componentId:t.cmId,...a.CoreSites.getReadingStrategyPreSets(t.readingStrategy)},n=yield r.read("mod_workshop_get_user_plan",i,o);return u.R.toObject(n.userplan.phases,"code")}))()}invalidateUserPlanPhasesData(e,t){var s=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(t);yield r.invalidateWsCacheForKey(s.getUserPlanDataCacheKey(e))}))()}getSubmissions(e,t={}){var s=this;return(0,r.A)((function*(){const r=t.userId||0,i=t.groupId||0,o=yield a.CoreSites.getSite(t.siteId),n={workshopid:e,groupid:i};t.userId&&t.userId!==o.getUserId()&&(n.userid=t.userId);const d={cacheKey:s.getSubmissionsDataCacheKey(e,r,i),updateFrequency:y.CoreCacheUpdateFrequency.OFTEN,component:g.Ug,componentId:t.cmId,...a.CoreSites.getReadingStrategyPreSets(t.readingStrategy),...a.CoreSites.getFilterPresets(t.filter),fetchOriginalToo:t.canEdit&&!n.userid};return(yield o.read("mod_workshop_get_submissions",n,d)).submissions}))()}invalidateSubmissionsData(e,t=0,s=0,i){var o=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(i);yield r.invalidateWsCacheForKey(o.getSubmissionsDataCacheKey(e,t,s))}))()}getSubmission(e,t,s={}){var i=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(s.siteId),o={submissionid:t},n={cacheKey:i.getSubmissionDataCacheKey(e,t),component:g.Ug,componentId:s.cmId,...a.CoreSites.getReadingStrategyPreSets(s.readingStrategy),...a.CoreSites.getFilterPresets(s.filter),fetchOriginalToo:s.canEdit};return(yield r.read("mod_workshop_get_submission",o,n)).submission}))()}invalidateSubmissionData(e,t,s){var i=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(s);yield r.invalidateWsCacheForKey(i.getSubmissionDataCacheKey(e,t))}))()}getGrades(e,t={}){var s=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(t.siteId),i={workshopid:e},o={cacheKey:s.getGradesDataCacheKey(e),component:g.Ug,componentId:t.cmId,...a.CoreSites.getReadingStrategyPreSets(t.readingStrategy)};return r.read("mod_workshop_get_grades",i,o)}))()}invalidateGradesData(e,t){var s=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(t);yield r.invalidateWsCacheForKey(s.getGradesDataCacheKey(e))}))()}getGradesReport(e,t={}){var s=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(t.siteId),i={workshopid:e,groupid:t.groupId,page:t.page||0,perpage:t.perPage||g.Cy},o={cacheKey:s.getGradesReportDataCacheKey(e,t.groupId),updateFrequency:y.CoreCacheUpdateFrequency.OFTEN,component:g.Ug,componentId:t.cmId,...a.CoreSites.getReadingStrategyPreSets(t.readingStrategy)};return(yield r.read("mod_workshop_get_grades_report",i,o)).report}))()}fetchAllGradeReports(e,t={}){return this.fetchGradeReportsRecursive(e,[],{...t,page:0,perPage:t.perPage||g.Cy,siteId:t.siteId||a.CoreSites.getCurrentSiteId()})}fetchGradeReportsRecursive(e,t,s={}){var i=this;return(0,r.A)((function*(){var r,o;s.page=null!==(r=s.page)&&void 0!==r?r:0,s.perPage=null!==(o=s.perPage)&&void 0!==o?o:g.Cy;const n=yield i.getGradesReport(e,s);Array.prototype.push.apply(t,n.grades);return(s.page+1)*s.perPage<n.totalcount?(s.page++,i.fetchGradeReportsRecursive(e,t,s)):t}))()}invalidateGradeReportData(e,t=0,s){var i=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(s);yield r.invalidateWsCacheForKey(i.getGradesReportDataCacheKey(e,t))}))()}getSubmissionAssessments(e,t,s={}){var i=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(s.siteId),o={submissionid:t},n={cacheKey:i.getSubmissionAssessmentsDataCacheKey(e,t),component:g.Ug,componentId:s.cmId,...a.CoreSites.getReadingStrategyPreSets(s.readingStrategy)};return(yield r.read("mod_workshop_get_submission_assessments",o,n)).assessments}))()}invalidateSubmissionAssesmentsData(e,t,s){var i=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(s);yield r.invalidateWsCacheForKey(i.getSubmissionAssessmentsDataCacheKey(e,t))}))()}addSubmission(e,t,s,i,o,d,u=!1){var c=this;return(0,r.A)((function*(){d=d||a.CoreSites.getCurrentSiteId();const l=function(){var o=(0,r.A)((function*(){return yield h.AddonModWorkshopOffline.saveSubmission(e,t,s,i,void 0,void 0,"add",d),!1}));return function storeOffline(){return o.apply(this,arguments)}}();if(yield h.AddonModWorkshopOffline.deleteSubmissionAction(e,"add",d),!n.WE.isOnline()&&u)return l();try{return yield c.addSubmissionOnline(e,s,i,o,d)}catch(e){if(u&&!m.CoreWSError.isWebServiceError(e))return l();throw e}}))()}addSubmissionOnline(e,t,s,o,n){return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(n),d={workshopid:e,title:t,content:s,attachmentsid:o},u=yield r.write("mod_workshop_add_submission",d);if(c.CoreWS.throwOnFailedStatus(u,"Add submission failed"),!u.submissionid)throw new i.CoreError("Add submission failed, no submission id was returned");return u.submissionid}))()}updateSubmission(e,t,s,i,o,d,u,c=!1){var l=this;return(0,r.A)((function*(){u=u||a.CoreSites.getCurrentSiteId();const g=function(){var n=(0,r.A)((function*(){return yield h.AddonModWorkshopOffline.saveSubmission(e,s,i,o,void 0,t,"update",u),!1}));return function storeOffline(){return n.apply(this,arguments)}}();if(yield h.AddonModWorkshopOffline.deleteSubmissionAction(e,"update",u),!n.WE.isOnline()&&c)return g();try{return yield l.updateSubmissionOnline(t,i,o,d,u)}catch(e){if(c&&!m.CoreWSError.isWebServiceError(e))return g();throw e}}))()}updateSubmissionOnline(e,t,s,i,o){return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(o),n={submissionid:e,title:t,content:s,attachmentsid:i||0},d=yield r.write("mod_workshop_update_submission",n);return c.CoreWS.throwOnFailedStatus(d,"Update submission failed"),e}))()}deleteSubmission(e,t,s,i){var o=this;return(0,r.A)((function*(){i=i||a.CoreSites.getCurrentSiteId();const storeOffline=()=>h.AddonModWorkshopOffline.saveSubmission(e,s,"","",void 0,t,"delete",i);if(yield h.AddonModWorkshopOffline.deleteSubmissionAction(e,"delete",i),!n.WE.isOnline())return storeOffline();try{return yield o.deleteSubmissionOnline(t,i)}catch(e){if(!m.CoreWSError.isWebServiceError(e))return storeOffline();throw e}}))()}deleteSubmissionOnline(e,t){return(0,r.A)((function*(){const s=yield a.CoreSites.getSite(t),r={submissionid:e},i=yield s.write("mod_workshop_delete_submission",r);c.CoreWS.throwOnFailedStatus(i,"Delete submission failed")}))()}getReviewerAssessments(e,t={}){var s=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(t.siteId),i={workshopid:e};t.userId&&t.userId!==r.getUserId()&&(i.userid=t.userId);const o={cacheKey:s.getReviewerAssessmentsDataCacheKey(e,t.userId),component:g.Ug,componentId:t.cmId,...a.CoreSites.getReadingStrategyPreSets(t.readingStrategy),...a.CoreSites.getFilterPresets(t.filter),fetchOriginalToo:t.canAssess&&!i.userid};return(yield r.read("mod_workshop_get_reviewer_assessments",i,o)).assessments}))()}invalidateReviewerAssesmentsData(e,t,s){var i=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(s);yield r.invalidateWsCacheForKey(i.getReviewerAssessmentsDataCacheKey(e,t))}))()}getAssessment(e,t,s={}){var i=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(s.siteId),o={assessmentid:t},n={cacheKey:i.getAssessmentDataCacheKey(e,t),component:g.Ug,componentId:s.cmId,...a.CoreSites.getReadingStrategyPreSets(s.readingStrategy),...a.CoreSites.getFilterPresets(s.filter),fetchOriginalToo:s.canAssess};return(yield r.read("mod_workshop_get_assessment",o,n)).assessment}))()}invalidateAssessmentData(e,t,s){var i=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(s);yield r.invalidateWsCacheForKey(i.getAssessmentDataCacheKey(e,t))}))()}getAssessmentForm(e,t,s={}){var i=this;return(0,r.A)((function*(){const r=s.mode||"assessment",o=yield a.CoreSites.getSite(s.siteId),n={assessmentid:t,mode:r},d={cacheKey:i.getAssessmentFormDataCacheKey(e,t,r),updateFrequency:y.CoreCacheUpdateFrequency.RARELY,component:g.Ug,componentId:s.cmId,...a.CoreSites.getReadingStrategyPreSets(s.readingStrategy)},u=yield o.read("mod_workshop_get_assessment_form_definition",n,d);return{dimenssionscount:u.dimenssionscount,descriptionfiles:u.descriptionfiles,dimensionsinfo:u.dimensionsinfo,warnings:u.warnings,fields:i.parseFields(u.fields),current:i.parseFields(u.current),options:p.T.toKeyValueMap(u.options,"name","value")}}))()}parseFields(e){const t=[];return e.forEach((e=>{const s=e.name.split("_"),r=s[0],i=s[3],o=s[6],n=parseInt(s[3],10),a=parseInt(s[6],10);isNaN(n)||(t[i]||(t[i]={number:n+1}),isNaN(a)?t[i][r]=e.value:(t[i].fields||(t[i].fields=[]),t[i].fields[o]||(t[i].fields[o]={number:a+1}),t[i].fields[o][r]=e.value))})),t}invalidateAssessmentFormData(e,t,s="assessment",i){var o=this;return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(i);yield r.invalidateWsCacheForKey(o.getAssessmentFormDataCacheKey(e,t,s))}))()}updateAssessment(e,t,s,i,o,d=!1){var u=this;return(0,r.A)((function*(){o=o||a.CoreSites.getCurrentSiteId();const c=function(){var n=(0,r.A)((function*(){return yield h.AddonModWorkshopOffline.saveAssessment(e,t,s,i,o),!1}));return function storeOffline(){return n.apply(this,arguments)}}();if(yield h.AddonModWorkshopOffline.deleteAssessment(e,t,o),!n.WE.isOnline()&&d)return c();try{return yield u.updateAssessmentOnline(t,i,o),!0}catch(e){if(d&&!m.CoreWSError.isWebServiceError(e))return c();throw e}}))()}updateAssessmentOnline(e,t,s){return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(s),i={assessmentid:e,data:p.T.toArrayOfObjects(t,"name","value")},o=yield r.write("mod_workshop_update_assessment",i);c.CoreWS.throwOnFailedStatus(o,"Update assessment failed")}))()}evaluateSubmission(e,t,s,i,o,d,u){var c=this;return(0,r.A)((function*(){u=u||a.CoreSites.getCurrentSiteId();const storeOffline=()=>h.AddonModWorkshopOffline.saveEvaluateSubmission(e,t,s,i,o,d,u).then((()=>!1));if(yield h.AddonModWorkshopOffline.deleteEvaluateSubmission(e,t,u),!n.WE.isOnline())return storeOffline();try{return yield c.evaluateSubmissionOnline(t,i,o,d,u)}catch(e){if(m.CoreWSError.isWebServiceError(e))throw e;return storeOffline()}}))()}evaluateSubmissionOnline(e,t,s,i,o){return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(o),n={submissionid:e,feedbacktext:t||"",feedbackformat:d.C9,published:s,gradeover:i},u=yield r.write("mod_workshop_evaluate_submission",n);return c.CoreWS.throwOnFailedStatus(u,"Evaluate submission failed"),!0}))()}evaluateAssessment(e,t,s,i,o=0,d,u){var c=this;return(0,r.A)((function*(){u=u||a.CoreSites.getCurrentSiteId();const storeOffline=()=>h.AddonModWorkshopOffline.saveEvaluateAssessment(e,t,s,i,o,d,u).then((()=>!1));if(yield h.AddonModWorkshopOffline.deleteEvaluateAssessment(e,t,u),!n.WE.isOnline())return storeOffline();try{return yield c.evaluateAssessmentOnline(t,i,o,d,u)}catch(e){if(!m.CoreWSError.isWebServiceError(e))return storeOffline();throw e}}))()}evaluateAssessmentOnline(e,t,s,i,o){return(0,r.A)((function*(){const r=yield a.CoreSites.getSite(o),n={assessmentid:e,feedbacktext:t||"",feedbackformat:d.C9,weight:s,gradinggradeover:i},u=yield r.write("mod_workshop_evaluate_assessment",n);return c.CoreWS.throwOnFailedStatus(u,"Evaluate assessment failed"),!0}))()}invalidateContent(e,t,s){var i=this;return(0,r.A)((function*(){s=s||a.CoreSites.getCurrentSiteId();const r=yield i.getWorkshop(t,e,{readingStrategy:1,siteId:s});yield i.invalidateContentById(r.id,t,s)}))()}invalidateContentById(e,t,s){var i=this;return(0,r.A)((function*(){s=s||a.CoreSites.getCurrentSiteId();const r=[i.invalidateWorkshopData(t,s),i.invalidateWorkshopWSData(e,s)];yield Promise.all(r)}))()}logView(e,t){return(0,r.A)((function*(){const s={workshopid:e};yield o.CoreCourseLogHelper.log("mod_workshop_view_workshop",s,g.Ug,e,t)}))()}logViewSubmission(e,t,s){return(0,r.A)((function*(){const r={submissionid:e};yield o.CoreCourseLogHelper.log("mod_workshop_view_submission",r,g.Ug,t,s)}))()}}return(e=AddonModWorkshopProvider).ROOT_CACHE_KEY="mmaModWorkshop:",e.ɵfac=function AddonModWorkshopProvider_Factory(t){return new(t||e)},e.ɵprov=C.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModWorkshopProvider})();const v=(0,l.Qd)(f)}}]);