"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[61591],{61591:(e,r,a)=>{a.r(r),a.d(r,{default:()=>x});var o=a(10467),t=a(45155),l=a(52749),s=a(81690),c=a(22693),n=a(79555),i=a(8014),h=a(49882),u=a(89014),_=a(15324),S=a(75357),b=a(93589),d=a(55554),g=a(33014),p=a(86654),m=a(20871),f=a(4193),C=a(10883),G=a(54438),y=a(60177),I=a(2910),T=a(16986),R=a(66198),P=a(19858),k=a(86198),v=a(58197),F=a(88246),E=a(73955);const _c0=e=>({$a:e});function CoreSearchGlobalSearchPage_h1_6_Template(e,r){1&e&&(G.j41(0,"h1"),G.EFF(1),G.nI1(2,"translate"),G.k0s()),2&e&&(G.R7$(),G.JRh(G.bMT(2,1,"core.search")))}function CoreSearchGlobalSearchPage_h1_7_Template(e,r){1&e&&(G.j41(0,"h1"),G.EFF(1),G.nI1(2,"translate"),G.k0s()),2&e&&(G.R7$(),G.JRh(G.bMT(2,1,"core.search.globalsearch")))}function CoreSearchGlobalSearchPage_ion_card_12_Template(e,r){if(1&e&&(G.j41(0,"ion-card",12)(1,"ion-item"),G.nrm(2,"ion-icon",13),G.j41(3,"ion-label"),G.nrm(4,"core-format-text",1),G.k0s()()()),2&e){const e=G.XpG();G.R7$(4),G.Y8G("text",e.searchBanner)}}function CoreSearchGlobalSearchPage_ion_list_16_core_search_global_search_result_1_Template(e,r){if(1&e){const e=G.RV6();G.j41(0,"core-search-global-search-result",15),G.bIt("onClick",(function CoreSearchGlobalSearchPage_ion_list_16_core_search_global_search_result_1_Template_core_search_global_search_result_onClick_0_listener(){const r=G.eBV(e).$implicit,a=G.XpG(2);return G.Njj(a.visitResult(r))})),G.k0s()}if(2&e){G.Y8G("result",r.$implicit)}}function CoreSearchGlobalSearchPage_ion_list_16_Template(e,r){if(1&e&&(G.j41(0,"ion-list"),G.DNE(1,CoreSearchGlobalSearchPage_ion_list_16_core_search_global_search_result_1_Template,1,1,"core-search-global-search-result",14),G.k0s()),2&e){const e=G.XpG();G.R7$(),G.Y8G("ngForOf",e.resultsSource.getItems())}}function CoreSearchGlobalSearchPage_core_empty_box_18_p_1_Template(e,r){1&e&&(G.j41(0,"p",18),G.EFF(1),G.nI1(2,"translate"),G.k0s()),2&e&&(G.R7$(),G.JRh(G.bMT(2,1,"core.search.empty")))}function CoreSearchGlobalSearchPage_core_empty_box_18_ng_container_2_Template(e,r){if(1&e&&(G.qex(0),G.j41(1,"p")(2,"strong"),G.EFF(3),G.nI1(4,"translate"),G.k0s()(),G.j41(5,"p")(6,"small"),G.EFF(7),G.nI1(8,"translate"),G.k0s()(),G.bVm()),2&e){const e=G.XpG(2);G.R7$(3),G.JRh(G.i5U(4,2,"core.search.noresults",G.eq3(7,_c0,e.resultsSource.getQuery()))),G.R7$(4),G.JRh(G.bMT(8,5,"core.search.noresultshelp"))}}function CoreSearchGlobalSearchPage_core_empty_box_18_Template(e,r){if(1&e&&(G.j41(0,"core-empty-box",16),G.DNE(1,CoreSearchGlobalSearchPage_core_empty_box_18_p_1_Template,3,3,"p",17)(2,CoreSearchGlobalSearchPage_core_empty_box_18_ng_container_2_Template,9,9,"ng-container",2),G.k0s()),2&e){const e=G.XpG();G.Y8G("dimmed",!e.resultsSource.isLoaded()),G.R7$(),G.Y8G("ngIf",!e.resultsSource.isLoaded()),G.R7$(),G.Y8G("ngIf",e.resultsSource.isLoaded())}}let x=(()=>{var e;class CoreSearchGlobalSearchPage{constructor(){this.courseId=null,this.loadMoreError=!1,this.searchBanner=null,this.resultsSource=new t.u("",{})}ngOnInit(){var e,r,a;const o=l.CoreSites.getRequiredCurrentSite(),t=null!==(e=null===(r=o.config)||void 0===r||null===(r=r.searchbanner)||void 0===r?void 0:r.trim())&&void 0!==e?e:"",c=_.CoreNavigator.getRouteNumberParam("courseId");s.j.isTrueOrOne(null===(a=o.config)||void 0===a?void 0:a.searchbannerenable)&&t.length>0&&(this.searchBanner=t),c&&(this.courseId=c,this.resultsSource.setFilters({courseIds:[c]})),this.filtersObserver=h.z.on(u.CORE_SEARCH_GLOBAL_SEARCH_FILTERS_UPDATED,(e=>this.resultsSource.setFilters(e)))}ngAfterViewInit(){const e=_.CoreNavigator.getRouteParam("query");e&&(this.searchBox&&(this.searchBox.searchText=e),this.search(e))}ngOnDestroy(){var e;null===(e=this.filtersObserver)||void 0===e||e.off()}search(e){var r=this;return(0,o.A)((function*(){r.resultsSource.setQuery(e),r.resultsSource.hasEmptyQuery()||(yield g.CoreLoadings.showOperationModals("core.searching",!0,(0,o.A)((function*(){yield r.resultsSource.reload(),yield d.g.ignoreErrors(u.CoreSearchGlobalSearch.logViewResults(r.resultsSource.getQuery(),r.resultsSource.getFilters())),c.OF.logEvent({type:c.qr.VIEW_ITEM_LIST,ws:"core_search_view_results",name:n.HT.instant("core.search.globalsearch"),data:{query:e,filters:JSON.stringify(r.resultsSource.getFilters())},url:i.F.addParamsToUrl("/search/index.php",{q:e})})}))))}))()}clearSearch(){this.loadMoreError=!1,this.resultsSource.setQuery(""),this.resultsSource.reset()}openFilters(){var e=this;return(0,o.A)((function*(){const{CoreSearchGlobalSearchFiltersComponent:r}=yield a.e(54378).then(a.bind(a,54378));yield b.I.openSideModal({component:r,componentProps:{hideCourses:!!e.courseId,filters:e.resultsSource.getFilters()}}),!e.resultsSource.hasEmptyQuery()&&e.resultsSource.isDirty()&&(yield g.CoreLoadings.showOperationModals("core.searching",!0,(()=>e.resultsSource.reload())))}))()}visitResult(e){return(0,o.A)((function*(){yield C.CoreContentLinksHelper.visitLink(e.url)}))()}loadMoreResults(e){var r=this;return(0,o.A)((function*(){try{var a;yield null===(a=r.resultsSource)||void 0===a?void 0:a.load()}catch(e){r.loadMoreError=!0}finally{e()}}))()}}return(e=CoreSearchGlobalSearchPage).ɵfac=function CoreSearchGlobalSearchPage_Factory(r){return new(r||e)},e.ɵcmp=G.VBU({type:e,selectors:[["page-core-search-global-search"]],viewQuery:function CoreSearchGlobalSearchPage_Query(e,r){if(1&e&&G.GBs(S.CoreSearchBoxComponent,5),2&e){let e;G.mGM(e=G.lsd())&&(r.searchBox=e.first)}},standalone:!0,features:[G.aNF],decls:23,vars:20,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[1,"limited-width"],["class","core-danger-card",4,"ngIf"],["searchArea","CoreSearchGlobalSearch",3,"onSubmit","onClear","placeholder","searchLabel","autoFocus"],[3,"action","enabled","error"],["icon","fas-magnifying-glass",3,"dimmed",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-filter","aria-hidden","true"],[1,"core-danger-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"result","onClick",4,"ngFor","ngForOf"],[3,"onClick","result"],["icon","fas-magnifying-glass",3,"dimmed"],["role","alert",4,"ngIf"],["role","alert"]],template:function CoreSearchGlobalSearchPage_Template(e,r){1&e&&(G.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),G.nrm(3,"ion-back-button",1),G.nI1(4,"translate"),G.k0s(),G.j41(5,"ion-title"),G.DNE(6,CoreSearchGlobalSearchPage_h1_6_Template,3,3,"h1",2)(7,CoreSearchGlobalSearchPage_h1_7_Template,3,3,"h1",2),G.k0s(),G.j41(8,"ion-buttons",3),G.nrm(9,"core-user-menu-button"),G.k0s()()(),G.j41(10,"ion-content",4)(11,"div"),G.DNE(12,CoreSearchGlobalSearchPage_ion_card_12_Template,5,1,"ion-card",5),G.j41(13,"core-search-box",6),G.nI1(14,"translate"),G.nI1(15,"translate"),G.bIt("onSubmit",(function CoreSearchGlobalSearchPage_Template_core_search_box_onSubmit_13_listener(e){return r.search(e)}))("onClear",(function CoreSearchGlobalSearchPage_Template_core_search_box_onClear_13_listener(){return r.clearSearch()})),G.k0s(),G.DNE(16,CoreSearchGlobalSearchPage_ion_list_16_Template,2,1,"ion-list",2),G.j41(17,"core-infinite-loading",7),G.bIt("action",(function CoreSearchGlobalSearchPage_Template_core_infinite_loading_action_17_listener(e){return r.loadMoreResults(e)})),G.k0s(),G.DNE(18,CoreSearchGlobalSearchPage_core_empty_box_18_Template,3,3,"core-empty-box",8),G.j41(19,"ion-fab",9)(20,"ion-fab-button",10),G.nI1(21,"translate"),G.bIt("click",(function CoreSearchGlobalSearchPage_Template_ion_fab_button_click_20_listener(){return r.openFilters()})),G.nrm(22,"ion-icon",11),G.k0s()()()()),2&e&&(G.R7$(3),G.Y8G("text",G.bMT(4,12,"core.back")),G.R7$(3),G.Y8G("ngIf",r.courseId),G.R7$(),G.Y8G("ngIf",!r.courseId),G.R7$(5),G.Y8G("ngIf",r.searchBanner),G.R7$(),G.Y8G("placeholder",G.bMT(14,14,"core.search"))("searchLabel",G.bMT(15,16,"core.search"))("autoFocus",!0),G.R7$(3),G.Y8G("ngIf",r.resultsSource.isLoaded()),G.R7$(),G.Y8G("enabled",r.resultsSource.isLoaded()&&!r.resultsSource.isCompleted())("error",r.loadMoreError),G.R7$(),G.Y8G("ngIf",r.resultsSource.isEmpty()),G.R7$(2),G.BMQ("aria-label",G.bMT(21,18,"core.filter")))},dependencies:[p.n,y.Sq,y.bT,I.QW,I.b_,I.W9,I.Q8,I.YW,I.eU,I.iq,I.uz,I.he,I.nf,I.BC,I.ai,I.el,T.h,R.b,P.A,k.t,v.B,F.i,E.D9,m.U,S.CoreSearchBoxComponent,f.CoreSearchGlobalSearchResultComponent],encapsulation:2}),CoreSearchGlobalSearchPage})()}}]);