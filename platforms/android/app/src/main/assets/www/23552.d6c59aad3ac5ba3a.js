"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[23552],{23552:(e,s,o)=>{o.r(s),o.d(s,{AddonBlockRecentlyAccessedCoursesComponent:()=>E});var n=o(10467),t=o(49882),r=o(52749),c=o(66110),i=o(83219),l=o(78765),d=o(12808),a=o(3484),u=o(81690),C=o(86654),p=o(16449),m=o(9538),g=o(55554),y=o(54438),h=o(60177),f=o(2910),v=o(16986),A=o(64422),_=o(29210),R=o(74235),k=o(73955);function AddonBlockRecentlyAccessedCoursesComponent_core_empty_box_9_Template(e,s){1&e&&(y.nrm(0,"core-empty-box",11),y.nI1(1,"translate")),2&e&&y.Y8G("message",y.bMT(1,1,"addon.block_recentlyaccessedcourses.nocourses"))}function AddonBlockRecentlyAccessedCoursesComponent_ng_container_13_Template(e,s){if(1&e&&(y.qex(0),y.nrm(1,"core-courses-course-list-item",12),y.bVm()),2&e){const e=s.$implicit;y.R7$(),y.Y8G("course",e)}}let E=(()=>{var e;class AddonBlockRecentlyAccessedCoursesComponent extends a.d{constructor(){super("AddonBlockRecentlyAccessedCoursesComponent"),this.courses=[],this.isDestroyed=!1,this.fetchContentDefaultError="Error getting recent courses data.",this.site=r.CoreSites.getRequiredCurrentSite()}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,e=this;return(0,n.A)((function*(){const s=u.j.getUniqueId("AddonBlockRecentlyAccessedCoursesComponent-Scroll");e.scrollElementId=`addon-block-recentlyaccessedcourses-scroll-${s}`,e.coursesObserver=t.z.on(m.CORE_COURSES_MY_COURSES_UPDATED_EVENT,(s=>{e.refreshCourseList(s)}),e.site.getId()),_superprop_getNgOnInit().call(e)}))()}invalidateContent(){var e=this;return(0,n.A)((function*(){const s=e.courses.map((e=>e.id));yield e.invalidateCourses(s)}))()}invalidateCourseList(){var e=this;return(0,n.A)((function*(){return e.site.isVersionGreaterEqualThan("3.8")?c.CoreCourses.invalidateRecentCourses():c.CoreCourses.invalidateUserCourses()}))()}invalidateCourses(e){var s=this;return(0,n.A)((function*(){const o=[];o.push(s.invalidateCourseList().finally((()=>g.g.allPromises(e.map((e=>d.AddonCourseCompletion.invalidateCourseCompletion(e))))))),o.push(1==e.length?l.CoreCourseOptionsDelegate.clearAndInvalidateCoursesOptions(e[0]):l.CoreCourseOptionsDelegate.clearAndInvalidateCoursesOptions()),e.length>0&&o.push(c.CoreCourses.invalidateCoursesByField("ids",e.join(","))),yield g.g.allPromises(o)}))()}fetchContent(){var e=this;return(0,n.A)((function*(){const s=e.block.configsRecord&&e.block.configsRecord.displaycategories&&"1"==e.block.configsRecord.displaycategories.value;let o=[];try{o=yield c.CoreCourses.getRecentCourses()}catch{return e.courses=yield i.CoreCoursesHelper.getUserCoursesWithOptions("lastaccess",10,void 0,s),void 0}const n=o.map((e=>e.id)),t=yield c.CoreCourses.getCoursesByField("ids",n.join(","));e.courses=o.map((e=>{const s=t.find((s=>e.id==s.id));return Object.assign(e,s)}));const r=yield c.CoreCourses.getCoursesAdminAndNavOptions(n);e.courses.forEach((e=>{e.navOptions=r.navOptions[e.id],e.admOptions=r.admOptions[e.id],s||(e.categoryname="")}))}))()}refreshCourseList(e){var s=this;return(0,n.A)((function*(){if(e.action===m.CoreCoursesMyCoursesUpdatedEventAction.ENROL)return s.refreshContent();const o=s.courses.findIndex((s=>s.id==e.courseId)),n=s.courses[o];if(e.action===m.CoreCoursesMyCoursesUpdatedEventAction.VIEW&&e.courseId!=r.CoreSites.getCurrentSiteHomeId()){if(!n)return s.refreshContent();s.courses.splice(o,1),s.courses.unshift(n),yield s.invalidateCourseList()}e.action===m.CoreCoursesMyCoursesUpdatedEventAction.STATE_CHANGED&&e.state===m.CORE_COURSES_STATE_FAVOURITE&&n&&(n.isfavourite=!!e.value,yield s.invalidateCourseList())}))()}ngOnDestroy(){var e;this.isDestroyed=!0,null===(e=this.coursesObserver)||void 0===e||e.off()}}return(e=AddonBlockRecentlyAccessedCoursesComponent).ɵfac=function AddonBlockRecentlyAccessedCoursesComponent_Factory(s){return new(s||e)},e.ɵcmp=y.VBU({type:e,selectors:[["addon-block-recentlyaccessedcourses"]],standalone:!0,features:[y.Vt3,y.aNF],decls:15,vars:11,consts:[["scrollControls",""],[3,"sticky"],["slot","end",1,"flex-row"],[3,"aria-controls"],["placeholderType","row","placeholderWidth","280px","placeholderHeight","134px",3,"hideUntil","placeholderLimit"],["image","assets/img/icons/courses.svg",3,"message",4,"ngIf"],[1,"core-horizontal-scroll",3,"scroll","hidden","id"],[1,"flex-row","core-course-list",3,"onResize"],[1,"safe-area-pseudo-padding-start"],[4,"ngFor","ngForOf"],[1,"safe-area-pseudo-padding-end"],["image","assets/img/icons/courses.svg",3,"message"],["layout","summarycard",1,"core-recentlyaccessedcourses",3,"course"]],template:function AddonBlockRecentlyAccessedCoursesComponent_Template(e,s){if(1&e){const e=y.RV6();y.j41(0,"ion-item-divider",1)(1,"ion-label")(2,"h2"),y.EFF(3),y.nI1(4,"translate"),y.k0s()(),y.j41(5,"div",2),y.nrm(6,"core-horizontal-scroll-controls",3,0),y.k0s()(),y.j41(8,"core-loading",4),y.DNE(9,AddonBlockRecentlyAccessedCoursesComponent_core_empty_box_9_Template,2,3,"core-empty-box",5),y.j41(10,"div",6),y.bIt("scroll",(function AddonBlockRecentlyAccessedCoursesComponent_Template_div_scroll_10_listener(){y.eBV(e);const s=y.sdS(7);return y.Njj(s.updateScrollPosition())})),y.j41(11,"div",7),y.bIt("onResize",(function AddonBlockRecentlyAccessedCoursesComponent_Template_div_onResize_11_listener(){y.eBV(e);const s=y.sdS(7);return y.Njj(s.updateScrollPosition())})),y.nrm(12,"div",8),y.DNE(13,AddonBlockRecentlyAccessedCoursesComponent_ng_container_13_Template,2,1,"ng-container",9),y.nrm(14,"div",10),y.k0s()()()}2&e&&(y.Y8G("sticky",!0),y.R7$(3),y.JRh(y.bMT(4,9,"addon.block_recentlyaccessedcourses.pluginname")),y.R7$(3),y.Y8G("aria-controls",s.scrollElementId),y.R7$(2),y.Y8G("hideUntil",s.loaded)("placeholderLimit",4),y.R7$(),y.Y8G("ngIf",0===s.courses.length),y.R7$(),y.Y8G("hidden",0===s.courses.length)("id",s.scrollElementId),y.R7$(3),y.Y8G("ngForOf",s.courses))},dependencies:[C.n,h.Sq,h.bT,f.Dg,f.he,v.h,A.R,_.c,R.C,k.D9,p.CoreCoursesCourseListItemComponent],encapsulation:2}),AddonBlockRecentlyAccessedCoursesComponent})()}}]);