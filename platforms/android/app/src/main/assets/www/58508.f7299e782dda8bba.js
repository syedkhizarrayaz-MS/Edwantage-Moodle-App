"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[58508],{58508:(o,e,t)=>{t.r(e),t.d(e,{default:()=>b});var n=t(10467),r=t(12808),i=t(98870),a=t(22693),l=t(33014),s=t(15324),c=t(52749),d=t(79555),p=t(24742),_=t(25572),m=t(86654),u=t(54438),C=t(60177),R=t(2910),g=t(64422),f=t(16658),h=t(86198),T=t(58197),I=t(88246),k=t(43570),F=t(73955),$=t(59528);function AddonCourseCompletionReportPage_ion_item_14_Template(o,e){if(1&o&&(u.j41(0,"ion-item",8),u.nrm(1,"core-user-avatar",9),u.j41(2,"ion-label")(3,"p",10),u.EFF(4),u.k0s()()()),2&o){const o=u.XpG();u.R7$(),u.Y8G("user",o.user)("courseId",o.courseId)("linkProfile",!1),u.R7$(3),u.JRh(o.user.fullname)}}function AddonCourseCompletionReportPage_ion_card_15_p_14_Template(o,e){1&o&&(u.j41(0,"p"),u.EFF(1),u.nI1(2,"translate"),u.k0s()),2&o&&(u.R7$(),u.JRh(u.bMT(2,1,"addon.coursecompletion.criteriarequiredall")))}function AddonCourseCompletionReportPage_ion_card_15_p_15_Template(o,e){1&o&&(u.j41(0,"p"),u.EFF(1),u.nI1(2,"translate"),u.k0s()),2&o&&(u.R7$(),u.JRh(u.bMT(2,1,"addon.coursecompletion.criteriarequiredany")))}function AddonCourseCompletionReportPage_ion_card_15_Template(o,e){if(1&o&&(u.j41(0,"ion-card")(1,"ion-item",8)(2,"ion-label")(3,"p",10),u.EFF(4),u.nI1(5,"translate"),u.k0s(),u.j41(6,"p"),u.EFF(7),u.nI1(8,"translate"),u.k0s()()(),u.j41(9,"ion-item",8)(10,"ion-label")(11,"p",10),u.EFF(12),u.nI1(13,"translate"),u.k0s(),u.DNE(14,AddonCourseCompletionReportPage_ion_card_15_p_14_Template,3,3,"p",6)(15,AddonCourseCompletionReportPage_ion_card_15_p_15_Template,3,3,"p",6),u.k0s()()()),2&o){const o=u.XpG();u.R7$(4),u.JRh(u.bMT(5,5,"addon.coursecompletion.status")),u.R7$(3),u.JRh(u.bMT(8,7,o.statusText)),u.R7$(5),u.JRh(u.bMT(13,9,"addon.coursecompletion.required")),u.R7$(2),u.Y8G("ngIf",1===o.completion.aggregation),u.R7$(),u.Y8G("ngIf",2===o.completion.aggregation)}}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_6_Template(o,e){1&o&&(u.j41(0,"strong",17),u.EFF(1),u.nI1(2,"translate"),u.k0s()),2&o&&(u.R7$(),u.JRh(u.bMT(2,1,"core.yes")))}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_7_Template(o,e){1&o&&(u.j41(0,"strong",17),u.EFF(1),u.nI1(2,"translate"),u.k0s()),2&o&&(u.R7$(),u.JRh(u.bMT(2,1,"core.no")))}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_Template(o,e){if(1&o&&(u.j41(0,"ion-item",14)(1,"ion-label")(2,"p",10),u.nrm(3,"core-format-text",15),u.k0s(),u.j41(4,"p"),u.nrm(5,"core-format-text",15),u.k0s()(),u.DNE(6,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_6_Template,3,3,"strong",16)(7,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_7_Template,3,3,"strong",16),u.k0s()),2&o){const o=e.$implicit;u.R7$(3),u.Y8G("text",o.details.criteria)("filter",!1),u.R7$(2),u.Y8G("text",o.details.requirement)("filter",!1),u.R7$(),u.Y8G("ngIf",o.complete),u.R7$(),u.Y8G("ngIf",!o.complete)}}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_9_Template(o,e){1&o&&(u.j41(0,"ion-col"),u.EFF(1),u.nI1(2,"translate"),u.k0s()),2&o&&(u.R7$(),u.JRh(u.bMT(2,1,"core.yes")))}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_10_Template(o,e){1&o&&(u.j41(0,"ion-col"),u.EFF(1),u.nI1(2,"translate"),u.k0s()),2&o&&(u.R7$(),u.JRh(u.bMT(2,1,"core.no")))}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_11_Template(o,e){if(1&o&&(u.j41(0,"ion-col"),u.EFF(1),u.nI1(2,"coreFormatDate"),u.k0s()),2&o){const o=u.XpG().$implicit;u.R7$(),u.SpI(" ",u.i5U(2,1,1e3*o.timecompleted,"strftimedatetimeshort")," ")}}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_12_Template(o,e){1&o&&u.nrm(0,"ion-col")}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_Template(o,e){if(1&o&&(u.j41(0,"ion-row")(1,"ion-col"),u.nrm(2,"core-format-text",15),u.k0s(),u.j41(3,"ion-col"),u.nrm(4,"core-format-text",15),u.k0s(),u.j41(5,"ion-col"),u.nrm(6,"core-format-text",15),u.k0s(),u.j41(7,"ion-col"),u.nrm(8,"core-format-text",18),u.k0s(),u.DNE(9,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_9_Template,3,3,"ion-col",6)(10,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_10_Template,3,3,"ion-col",6)(11,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_11_Template,3,4,"ion-col",6)(12,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_12_Template,1,0,"ion-col",6),u.k0s()),2&o){const o=e.$implicit;u.R7$(2),u.Y8G("text",o.details.type)("filter",!1),u.R7$(2),u.Y8G("text",o.details.criteria)("filter",!1),u.R7$(2),u.Y8G("text",o.details.requirement)("filter",!1),u.R7$(2),u.Y8G("text",o.details.status)("filter",!1),u.R7$(),u.Y8G("ngIf",o.complete),u.R7$(),u.Y8G("ngIf",!o.complete),u.R7$(),u.Y8G("ngIf",o.timecompleted),u.R7$(),u.Y8G("ngIf",!o.timecompleted)}}function AddonCourseCompletionReportPage_ion_card_16_Template(o,e){if(1&o&&(u.j41(0,"ion-card")(1,"ion-item-divider")(2,"ion-label")(3,"h2"),u.EFF(4),u.nI1(5,"translate"),u.k0s()()(),u.DNE(6,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_Template,8,6,"ion-item",11),u.j41(7,"ion-item",12)(8,"ion-label")(9,"ion-row")(10,"ion-col")(11,"strong"),u.EFF(12),u.nI1(13,"translate"),u.k0s()(),u.j41(14,"ion-col")(15,"strong"),u.EFF(16),u.nI1(17,"translate"),u.k0s()(),u.j41(18,"ion-col")(19,"strong"),u.EFF(20),u.nI1(21,"translate"),u.k0s()(),u.j41(22,"ion-col")(23,"strong"),u.EFF(24),u.nI1(25,"translate"),u.k0s()(),u.j41(26,"ion-col")(27,"strong"),u.EFF(28),u.nI1(29,"translate"),u.k0s()(),u.j41(30,"ion-col")(31,"strong"),u.EFF(32),u.nI1(33,"translate"),u.k0s()()(),u.DNE(34,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_Template,13,12,"ion-row",13),u.k0s()()()),2&o){const o=u.XpG();u.R7$(4),u.JRh(u.bMT(5,9,"addon.coursecompletion.requiredcriteria")),u.R7$(2),u.Y8G("ngForOf",o.completion.completions),u.R7$(6),u.JRh(u.bMT(13,11,"addon.coursecompletion.criteriagroup")),u.R7$(4),u.JRh(u.bMT(17,13,"addon.coursecompletion.criteria")),u.R7$(4),u.JRh(u.bMT(21,15,"addon.coursecompletion.requirement")),u.R7$(4),u.JRh(u.bMT(25,17,"addon.coursecompletion.status")),u.R7$(4),u.JRh(u.bMT(29,19,"addon.coursecompletion.complete")),u.R7$(4),u.JRh(u.bMT(33,21,"addon.coursecompletion.completiondate")),u.R7$(2),u.Y8G("ngForOf",o.completion.completions)}}function AddonCourseCompletionReportPage_ion_card_17_Template(o,e){if(1&o){const o=u.RV6();u.j41(0,"ion-card")(1,"ion-item-divider")(2,"ion-label")(3,"h2"),u.EFF(4),u.nI1(5,"translate"),u.k0s()()(),u.j41(6,"ion-item")(7,"ion-label")(8,"ion-button",19),u.bIt("click",(function AddonCourseCompletionReportPage_ion_card_17_Template_ion_button_click_8_listener(){u.eBV(o);const e=u.XpG();return u.Njj(e.completeCourse())})),u.EFF(9),u.nI1(10,"translate"),u.k0s()()()()}2&o&&(u.R7$(4),u.JRh(u.bMT(5,2,"addon.coursecompletion.manualselfcompletion")),u.R7$(5),u.SpI(" ",u.bMT(10,4,"addon.coursecompletion.completecourse")," "))}function AddonCourseCompletionReportPage_ion_card_18_Template(o,e){1&o&&(u.j41(0,"ion-card",20)(1,"ion-item"),u.nrm(2,"ion-icon",21),u.j41(3,"ion-label"),u.EFF(4),u.nI1(5,"translate"),u.k0s()()()),2&o&&(u.R7$(4),u.JRh(u.bMT(5,1,"addon.coursecompletion.nottracked")))}let b=(()=>{var o;class AddonCourseCompletionReportPage{constructor(){this.completionLoaded=!1,this.showSelfComplete=!1,this.tracked=!0,this.logView=p.j.once((()=>{a.OF.logEvent({type:a.qr.VIEW_ITEM,ws:"core_completion_get_course_completion_status",name:d.HT.instant("addon.coursecompletion.coursecompletion"),data:{course:this.courseId,user:this.userId},url:`/blocks/completionstatus/details.php?course=${this.courseId}&user=${this.userId}`})}))}ngOnInit(){try{this.courseId=s.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.userId=s.CoreNavigator.getRouteNumberParam("userId")||c.CoreSites.getCurrentSiteUserId()}catch(o){return _.CoreAlerts.showError(o),s.CoreNavigator.back(),void 0}this.fetchCompletion().finally((()=>{this.completionLoaded=!0}))}fetchCompletion(){var o=this;return(0,n.A)((function*(){try{o.user=yield i.CoreUser.getProfile(o.userId,o.courseId,!0),o.completion=yield r.AddonCourseCompletion.getCompletion(o.courseId,o.userId),o.statusText=r.AddonCourseCompletion.getCompletedStatusText(o.completion),o.showSelfComplete=r.AddonCourseCompletion.canMarkSelfCompleted(o.userId,o.completion),o.tracked=!0,o.logView()}catch(e){e&&"notenroled"==e.errorcode?o.tracked=!1:_.CoreAlerts.showError(e,{default:d.HT.instant("addon.coursecompletion.couldnotloadreport")})}}))()}refreshCompletion(o){var e=this;return(0,n.A)((function*(){yield r.AddonCourseCompletion.invalidateCourseCompletion(e.courseId,e.userId).finally((()=>{e.fetchCompletion().finally((()=>{null==o||o.complete()}))}))}))()}completeCourse(){var o=this;return(0,n.A)((function*(){try{yield _.CoreAlerts.confirm(d.HT.instant("addon.coursecompletion.confirmselfcompletion"),{okText:d.HT.instant("core.yes"),cancelText:d.HT.instant("core.no")});const e=yield l.CoreLoadings.show("core.sending",!0);try{yield r.AddonCourseCompletion.markCourseAsSelfCompleted(o.courseId),yield o.refreshCompletion()}catch(o){_.CoreAlerts.showError(o)}finally{e.dismiss()}}catch{}}))()}}return(o=AddonCourseCompletionReportPage).ɵfac=function AddonCourseCompletionReportPage_Factory(e){return new(e||o)},o.ɵcmp=u.VBU({type:o,selectors:[["page-addon-course-completion-report"]],standalone:!0,features:[u.aNF],decls:19,vars:16,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],["class","core-warning-card",4,"ngIf"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId","linkProfile"],[1,"item-heading"],["class","ion-hide-md-up ion-text-wrap",4,"ngFor","ngForOf"],[1,"ion-hide-md-down","ion-text-wrap"],[4,"ngFor","ngForOf"],[1,"ion-hide-md-up","ion-text-wrap"],["clean","true",3,"text","filter"],["slot","end",4,"ngIf"],["slot","end"],[3,"text","filter"],["expand","block",3,"click"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"]],template:function AddonCourseCompletionReportPage_Template(o,e){1&o&&(u.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),u.nrm(3,"ion-back-button",1),u.nI1(4,"translate"),u.k0s(),u.j41(5,"ion-title")(6,"h1"),u.EFF(7),u.nI1(8,"translate"),u.k0s()()()(),u.j41(9,"ion-content")(10,"ion-refresher",2),u.bIt("ionRefresh",(function AddonCourseCompletionReportPage_Template_ion_refresher_ionRefresh_10_listener(o){return e.refreshCompletion(o.target)})),u.nrm(11,"ion-refresher-content",3),u.nI1(12,"translate"),u.k0s(),u.j41(13,"core-loading",4),u.DNE(14,AddonCourseCompletionReportPage_ion_item_14_Template,5,4,"ion-item",5)(15,AddonCourseCompletionReportPage_ion_card_15_Template,16,11,"ion-card",6)(16,AddonCourseCompletionReportPage_ion_card_16_Template,35,23,"ion-card",6)(17,AddonCourseCompletionReportPage_ion_card_17_Template,11,6,"ion-card",6)(18,AddonCourseCompletionReportPage_ion_card_18_Template,6,3,"ion-card",7),u.k0s()()),2&o&&(u.R7$(3),u.Y8G("text",u.bMT(4,10,"core.back")),u.R7$(4),u.JRh(u.bMT(8,12,"addon.coursecompletion.coursecompletion")),u.R7$(3),u.Y8G("disabled",!e.completionLoaded),u.R7$(),u.FS9("pullingText",u.bMT(12,14,"core.pulltorefresh")),u.R7$(2),u.Y8G("hideUntil",e.completionLoaded),u.R7$(),u.Y8G("ngIf",e.user),u.R7$(),u.Y8G("ngIf",e.completion&&e.tracked),u.R7$(),u.Y8G("ngIf",e.completion&&e.tracked),u.R7$(),u.Y8G("ngIf",e.showSelfComplete&&e.tracked),u.R7$(),u.Y8G("ngIf",!e.tracked))},dependencies:[m.n,C.Sq,C.bT,R.Jm,R.QW,R.b_,R.hU,R.W9,R.eU,R.iq,R.uz,R.Dg,R.he,R.To,R.Ki,R.ln,R.BC,R.ai,R.el,g.R,f.T,h.t,T.B,I.i,k.T,F.D9,$.f],encapsulation:2}),AddonCourseCompletionReportPage})()}}]);