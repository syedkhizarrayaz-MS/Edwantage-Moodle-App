"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[96698,69006],{96698:(e,t,n)=>{n.r(t),n.d(t,{AddonModH5PActivityIndexComponent:()=>Y});var i=n(10467),o=n(54438),r=n(74431),a=n(69006),s=n(51024),d=n(74691),l=n(53867),c=n(59863),p=n(65630),u=n(94455),m=n(88793),y=n(15324),f=n(52749),_=n(49882),v=n(34961),h=n(8257),A=n(88436),g=n(75383),C=n(55554),I=n(9153),M=n(33354),w=n(47551),P=n(79555),x=n(75629),T=n(49588),b=n(25572),S=n(30864),D=n(6736),O=n(86654),E=n(88695),F=n(2910),H=n(60177),k=n(69502),R=n(17388),U=n(64422),N=n(13988),G=n(49234),$=n(86198),L=n(66731),X=n(43570),j=n(73955);function AddonModH5PActivityIndexComponent_core_context_menu_item_2_Template(e,t){if(1&e){const e=o.RV6();o.j41(0,"core-context-menu-item",11),o.nI1(1,"translate"),o.bIt("action",(function AddonModH5PActivityIndexComponent_core_context_menu_item_2_Template_core_context_menu_item_action_0_listener(){o.eBV(e);const t=o.XpG();return o.Njj(t.viewMyAttempts())})),o.k0s()}2&e&&o.Y8G("priority",1e3)("content",o.bMT(1,2,"addon.mod_h5pactivity.attempts_report"))}function AddonModH5PActivityIndexComponent_core_context_menu_item_3_Template(e,t){if(1&e){const e=o.RV6();o.j41(0,"core-context-menu-item",11),o.nI1(1,"translate"),o.bIt("action",(function AddonModH5PActivityIndexComponent_core_context_menu_item_3_Template_core_context_menu_item_action_0_listener(){o.eBV(e);const t=o.XpG();return o.Njj(t.viewAllAttempts())})),o.k0s()}2&e&&o.Y8G("priority",1e3)("content",o.bMT(1,2,"addon.mod_h5pactivity.attempts_report"))}function AddonModH5PActivityIndexComponent_Conditional_4_Template(e,t){if(1&e){const e=o.RV6();o.j41(0,"core-context-menu-item",12),o.nI1(1,"translate"),o.bIt("action",(function AddonModH5PActivityIndexComponent_Conditional_4_Template_core_context_menu_item_action_0_listener(){o.eBV(e);const t=o.XpG();return o.Njj(t.openModuleSummary())})),o.k0s()}2&e&&o.Y8G("priority",5e3)("content",o.bMT(1,2,"core.info"))}function AddonModH5PActivityIndexComponent_Conditional_5_Template(e,t){if(1&e){const e=o.RV6();o.j41(0,"ion-button",13),o.nI1(1,"translate"),o.bIt("click",(function AddonModH5PActivityIndexComponent_Conditional_5_Template_ion_button_click_0_listener(){o.eBV(e);const t=o.XpG();return o.Njj(t.openModuleSummary())})),o.nrm(2,"ion-icon",14),o.k0s()}2&e&&o.Y8G("ariaLabel",o.bMT(1,1,"core.info"))}function AddonModH5PActivityIndexComponent_Conditional_8_Conditional_4_Template(e,t){1&e&&(o.EFF(0),o.nI1(1,"translate"),o.nI1(2,"translate")),2&e&&o.Lme(" ",o.bMT(1,2,"core.h5p.offlinedisabled")," ",o.bMT(2,4,"addon.mod_h5pactivity.offlinedisabledwarning")," ")}function AddonModH5PActivityIndexComponent_Conditional_8_Conditional_5_Template(e,t){1&e&&(o.EFF(0),o.nI1(1,"translate"),o.nI1(2,"translate")),2&e&&o.Lme(" ",o.bMT(1,2,"core.course.activitynotavailableoffline")," ",o.bMT(2,4,"core.needinternettoaccessit")," ")}function AddonModH5PActivityIndexComponent_Conditional_8_Template(e,t){if(1&e&&(o.j41(0,"ion-card",6)(1,"ion-item"),o.nrm(2,"ion-icon",15),o.j41(3,"ion-label"),o.DNE(4,AddonModH5PActivityIndexComponent_Conditional_8_Conditional_4_Template,3,6)(5,AddonModH5PActivityIndexComponent_Conditional_8_Conditional_5_Template,3,6),o.k0s()()()),2&e){const e=o.XpG();o.R7$(4),o.vxM(4,e.siteCanDownload?5:4)}}function AddonModH5PActivityIndexComponent_ion_card_9_Template(e,t){1&e&&(o.j41(0,"ion-card",6)(1,"ion-item"),o.nrm(2,"ion-icon",15),o.j41(3,"ion-label"),o.EFF(4),o.nI1(5,"translate"),o.k0s()()()),2&e&&(o.R7$(4),o.SpI(" ",o.bMT(5,1,"addon.mod_h5pactivity.previewmode")," "))}function AddonModH5PActivityIndexComponent_ion_list_10_ion_item_1_Template(e,t){if(1&e&&(o.j41(0,"ion-item",19)(1,"ion-label"),o.EFF(2),o.nI1(3,"translate"),o.k0s()()),2&e){const e=o.XpG(2);o.R7$(2),o.JRh(o.bMT(3,1,e.stateMessage))}}function AddonModH5PActivityIndexComponent_ion_list_10_ion_button_2_Template(e,t){if(1&e){const e=o.RV6();o.j41(0,"ion-button",20),o.bIt("click",(function AddonModH5PActivityIndexComponent_ion_list_10_ion_button_2_Template_ion_button_click_0_listener(t){o.eBV(e);const n=o.XpG(2);return o.Njj(n.downloadAndPlayManually(t))})),o.EFF(1),o.nI1(2,"translate"),o.k0s()}2&e&&(o.R7$(),o.SpI(" ",o.bMT(2,1,"addon.mod_h5pactivity.downloadh5pfile")," "))}function AddonModH5PActivityIndexComponent_ion_list_10_ion_item_3_p_4_Template(e,t){if(1&e&&(o.j41(0,"p",24),o.EFF(1),o.nI1(2,"translate"),o.k0s()),2&e){const e=o.XpG(3);o.R7$(),o.JRh(o.bMT(2,1,e.progressMessage))}}function AddonModH5PActivityIndexComponent_ion_list_10_ion_item_3_core_progress_bar_5_Template(e,t){if(1&e&&o.nrm(0,"core-progress-bar",25),2&e){const e=o.XpG(3);o.Y8G("progress",e.percentage)("a11yText",e.progressMessage)}}function AddonModH5PActivityIndexComponent_ion_list_10_ion_item_3_Template(e,t){if(1&e&&(o.j41(0,"ion-item",21)(1,"ion-label"),o.nrm(2,"ion-spinner"),o.nI1(3,"translate"),o.DNE(4,AddonModH5PActivityIndexComponent_ion_list_10_ion_item_3_p_4_Template,3,3,"p",22)(5,AddonModH5PActivityIndexComponent_ion_list_10_ion_item_3_core_progress_bar_5_Template,1,2,"core-progress-bar",23),o.k0s()()),2&e){const e=o.XpG(2);o.R7$(2),o.BMQ("aria-label",o.bMT(3,3,"core.loading")),o.R7$(2),o.Y8G("ngIf",e.progressMessage),o.R7$(),o.Y8G("ngIf",e.showPercentage)}}function AddonModH5PActivityIndexComponent_ion_list_10_Template(e,t){if(1&e&&(o.j41(0,"ion-list"),o.DNE(1,AddonModH5PActivityIndexComponent_ion_list_10_ion_item_1_Template,4,3,"ion-item",16)(2,AddonModH5PActivityIndexComponent_ion_list_10_ion_button_2_Template,3,3,"ion-button",17)(3,AddonModH5PActivityIndexComponent_ion_list_10_ion_item_3_Template,6,5,"ion-item",18),o.k0s()),2&e){const e=o.XpG();o.R7$(),o.Y8G("ngIf",e.stateMessage),o.R7$(),o.Y8G("ngIf",!e.downloading&&e.needsDownload),o.R7$(),o.Y8G("ngIf",e.downloading)}}function AddonModH5PActivityIndexComponent_core_h5p_iframe_11_Template(e,t){if(1&e&&o.nrm(0,"core-h5p-iframe",26),2&e){const e=o.XpG();o.Y8G("fileUrl",e.fileUrl)("displayOptions",e.displayOptions)("onlinePlayerUrl",e.onlinePlayerUrl)("trackComponent",e.trackComponent)("contextId",null==e.h5pActivity?null:e.h5pActivity.context)("enableInAppFullscreen",!0)("saveFreq",e.saveFreq)("state",e.contentState)("component",e.component)("componentId",e.componentId)("fileTimemodified",null==e.deployedFile?null:e.deployedFile.timemodified)}}let Y=(()=>{var e;class AddonModH5PActivityIndexComponent extends a.y{constructor(e,t){super("AddonModH5PActivityIndexComponent",e,t),this.content=e,this.onActivityFinish=new o.bkB,this.component=I.tU,this.pluginName="h5pactivity",this.downloading=!1,this.needsDownload=!1,this.showPercentage=!1,this.playing=!1,this.siteCanDownload=!1,this.hasOffline=!1,this.isOpeningPage=!1,this.canViewAllAttempts=!1,this.saveStateEnabled=!1,this.hasMissingDependencies=!1,this.triedToPlay=!1,this.fetchContentDefaultError="addon.mod_h5pactivity.errorgetactivity",this.syncEventName=I.EJ,this.checkCompletionAfterLog=!1,this.offlineErrorAlert=null,this.site=f.CoreSites.getRequiredCurrentSite(),this.siteCanDownload=this.site.canDownloadFiles()&&!l.CoreH5P.isOfflineDisabledInSite(),this.messageListenerFunction=e=>this.onIframeMessage(e),window.addEventListener("message",this.messageListenerFunction),this.isOnline=u.WE.isOnline(),this.onlineObserver=u.WE.onChange().subscribe((()=>{P.SK.run((()=>{this.networkChanged()}))}))}networkChanged(){var e=this;return(0,i.A)((function*(){const t=e.isOnline;return e.isOnline=u.WE.isOnline(),e.isOnline&&e.offlineErrorAlert&&(e.offlineErrorAlert.dismiss(),e.offlineErrorAlert=null),e.playing&&!e.fileUrl&&!e.isOnline&&t&&e.trackComponent?(e.offlineErrorAlert=yield b.CoreAlerts.showError(new x.CoreError(P.HT.instant("core.course.changesofflinemaybelost"),{title:P.HT.instant("core.youreoffline")})),void 0):e.isOnline&&e.triedToPlay?(e.triedToPlay=!1,e.play(),void 0):void 0}))()}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,e=this;return(0,i.A)((function*(){_superprop_getNgOnInit().call(e),e.loadContent(!1,!0)}))()}fetchContent(e,t=!1,n=!1){var o=this;return(0,i.A)((function*(){var e,i,a;o.showLoading=!0,o.playing=!1,o.h5pActivity=yield v.R.getH5PActivity(o.courseId,o.module.id,{siteId:o.siteId}),o.dataRetrieved.emit(o.h5pActivity),o.description=o.h5pActivity.intro,o.displayOptions=d.P.decodeDisplayOptions(o.h5pActivity.displayoptions),t&&(yield o.syncActivity(n)),yield Promise.all([o.checkHasOffline(),o.fetchAccessInfo(),o.fetchDeployedFileData()]),yield o.loadContentState(),o.trackComponent=null!==(e=o.accessInfo)&&void 0!==e&&e.cansubmit?I.$J:"",o.canViewAllAttempts=!!o.h5pActivity.enabletracking&&!(null===(i=o.accessInfo)||void 0===i||!i.canreviewattempts)&&v.R.canGetUsersAttemptsInSite(),o.h5pActivity.package&&o.h5pActivity.package[0]&&(o.onlinePlayerUrl=l.CoreH5P.h5pPlayer.calculateOnlinePlayerUrl(o.site.getURL(),o.h5pActivity.package[0].fileurl,o.displayOptions,o.trackComponent)),!o.siteCanDownload||o.state===r.DownloadStatus.DOWNLOADED||o.hasMissingDependencies?o.play():(o.state==r.DownloadStatus.DOWNLOADABLE_NOT_DOWNLOADED||o.state==r.DownloadStatus.OUTDATED)&&u.WE.isOnline()&&null!==(a=o.deployedFile)&&void 0!==a&&a.filesize&&m.CoreFilepool.shouldDownload(o.deployedFile.filesize)&&o.downloadAndPlay()}))()}checkHasOffline(){var e=this;return(0,i.A)((function*(){e.h5pActivity&&(e.hasOffline=yield c.CoreXAPIOffline.contextHasData(e.h5pActivity.context,e.siteId))}))()}fetchAccessInfo(){var e=this;return(0,i.A)((function*(){e.h5pActivity&&(e.accessInfo=yield v.R.getAccessInformation(e.h5pActivity.id,{cmId:e.module.id,siteId:e.siteId}))}))()}fetchDeployedFileData(){var e=this;return(0,i.A)((function*(){if(!e.siteCanDownload||!e.h5pActivity)return;const t=yield v.R.getDeployedFile(e.h5pActivity,{displayOptions:e.displayOptions,siteId:e.siteId});if(e.hasMissingDependencies=yield v.R.hasMissingDependencies(e.module.id,t),e.hasMissingDependencies)return;e.deployedFile=t,e.fileUrl=A.CoreFileHelper.getFileUrl(t);const n=yield m.CoreFilepool.getFileEventNameByUrl(e.site.getId(),e.fileUrl);e.observer||(e.observer=_.z.on(n,(()=>{e.calculateFileState()}))),yield e.calculateFileState()}))()}loadContentState(){var e=this;return(0,i.A)((function*(){var t;if(!e.h5pActivity||!e.accessInfo||!v.R.isSaveStateEnabled(e.h5pActivity,e.accessInfo))return e.saveStateEnabled=!1,e.contentState=void 0,void 0;e.saveStateEnabled=!0,e.saveFreq=e.h5pActivity.savestatefreq;const n=yield p.CoreXAPI.getState(I.$J,e.h5pActivity.context,I.HB,{appComponent:I.tU,appComponentId:e.h5pActivity.coursemodule,readingStrategy:3});if(null===n)return e.contentState=void 0,void 0;const i=g.Ni.parseJSON(n,{h5p:"{}"});e.contentState=null!==(t=i.h5p)&&void 0!==t?t:"{}"}))()}calculateFileState(){var e=this;return(0,i.A)((function*(){e.fileUrl&&e.deployedFile&&(e.state=yield m.CoreFilepool.getFileStateByUrl(e.site.getId(),e.fileUrl,e.deployedFile.timemodified),e.showFileState())}))()}invalidateContent(){return v.R.invalidateActivityData(this.courseId)}showFileState(){var e=this;return(0,i.A)((function*(){e.state===r.DownloadStatus.OUTDATED?(e.stateMessage="addon.mod_h5pactivity.filestateoutdated",e.needsDownload=!0):e.state===r.DownloadStatus.DOWNLOADABLE_NOT_DOWNLOADED?(e.stateMessage="addon.mod_h5pactivity.filestatenotdownloaded",e.needsDownload=!0):e.state===r.DownloadStatus.DOWNLOADING?(e.stateMessage="",e.downloading||(yield e.downloadDeployedFile(),e.play())):(e.stateMessage="",e.needsDownload=!1)}))()}downloadAndPlayManually(e){var t=this;return(0,i.A)((function*(){if(null==e||e.preventDefault(),null==e||e.stopPropagation(),t.deployedFile){if(!u.WE.isOnline())return b.CoreAlerts.showError(P.HT.instant("core.networkerrormsg")),void 0;try{yield b.CoreAlerts.confirmDownloadSize({size:t.deployedFile.filesize||0,total:!0})}catch(e){return}yield t.downloadAndPlay()}}))()}downloadAndPlay(){var e=this;return(0,i.A)((function*(){try{yield e.downloadDeployedFile(),e.isDestroyed||e.play()}catch(t){if(T.CoreErrorHelper.isCanceledError(t)||e.isDestroyed)return;if(T.CoreErrorHelper.isNetworkError(t))return b.CoreAlerts.showError(t,{default:P.HT.instant("core.errordownloading")}),void 0;e.hasMissingDependencies=t instanceof M.u,e.fileUrl=void 0,e.play(),w.CoreToasts.show({message:P.HT.instant("core.course.activityrequiresconnection"),duration:w.ToastDuration.LONG})}}))()}downloadDeployedFile(){var e=this;return(0,i.A)((function*(){if(!e.fileUrl||!e.deployedFile)return;const t=e.deployedFile;e.downloading=!0,e.progressMessage="core.downloading",e.deleteOfflineStates();try{yield m.CoreFilepool.downloadUrl(e.site.getId(),e.fileUrl,!1,e.component,e.componentId,t.timemodified,(n=>{if(n)if(e.percentage=void 0,e.showPercentage=!1,n.message)e.progressMessage=n.message;else if(void 0!==n.loaded){const i="core.downloading"==e.progressMessage?t.filesize:n.total;if(void 0!==i){const t=100*Number(n.loaded/i);e.percentage=t.toFixed(1),e.showPercentage=t>=0&&t<=100}}}))}finally{e.progressMessage=void 0,e.percentage=void 0,e.showPercentage=!1,e.downloading=!1}}))()}play(){var e=this;return(0,i.A)((function*(){if(e.h5pActivity){if(!e.fileUrl&&!e.isOnline)return e.triedToPlay=!0,b.CoreAlerts.showError(new x.CoreError(P.HT.instant("core.connectandtryagain"),{title:P.HT.instant("core.course.activitynotavailableoffline")})),void 0;e.playing=!0,yield v.R.logView(e.h5pActivity.id,e.siteId),e.checkCompletion(),e.analyticsLogEvent("mod_h5pactivity_view_h5pactivity"),!e.fileUrl&&e.trackComponent&&v.R.invalidateUserAttempts(e.h5pActivity.id,f.CoreSites.getCurrentSiteUserId())}}))()}viewMyAttempts(){var e=this;return(0,i.A)((function*(){e.isOpeningPage=!0;const t=f.CoreSites.getCurrentSiteUserId();try{!e.fileUrl&&e.trackComponent&&e.h5pActivity&&(yield v.R.invalidateUserAttempts(e.h5pActivity.id,f.CoreSites.getCurrentSiteUserId())),yield y.CoreNavigator.navigateToSitePath(`${I.zr}/${e.courseId}/${e.module.id}/userattempts/${t}`)}finally{e.isOpeningPage=!1}}))()}viewAllAttempts(){var e=this;return(0,i.A)((function*(){e.isOpeningPage=!0;try{yield y.CoreNavigator.navigateToSitePath(`${I.zr}/${e.courseId}/${e.module.id}/users`)}finally{e.isOpeningPage=!1}}))()}onIframeMessage(e){var t=this;return(0,i.A)((function*(){const n=e.data;n&&t.h5pActivity&&(p.CoreXAPI.canPostStatementsInSite(t.site)&&t.isCurrentXAPIPostStatement(n)?t.postStatements(n):t.saveStateEnabled&&t.isCurrentXAPIState(n,"xapi_post_state")&&t.isXAPIPostState(n)?t.postState(n):t.saveStateEnabled&&t.isCurrentXAPIState(n,"xapi_delete_state")&&t.deleteState(n))}))()}isH5PEventForApp(e){return"moodleapp"===e.environment&&"h5p"===e.context}activityIdIsCurrentActivity(e){if(!e||!this.h5pActivity)return!1;if(!this.site.containsUrl(e))return!1;const t=e.match(/xapi\/activity\/(\d+)/);return!!t&&Number(t[1])===this.h5pActivity.context}isCurrentXAPIPostStatement(e){return!!this.h5pActivity&&(!(!this.isH5PEventForApp(e)||"xapi_post_statement"!==e.action||!e.statements)&&this.activityIdIsCurrentActivity(e.statements[0]&&e.statements[0].object&&e.statements[0].object.id))}postStatements(e){var t=this;return(0,i.A)((function*(){if(t.h5pActivity)try{const n={offline:t.hasOffline,courseId:t.courseId,extra:t.h5pActivity.name,siteId:t.site.getId()},i=yield p.CoreXAPI.postStatements(t.h5pActivity.context,e.component,JSON.stringify(e.statements),n);if(t.hasOffline=!i,t.deleteOfflineStates(),i){try{yield v.R.invalidateUserAttempts(t.h5pActivity.id,void 0,t.siteId)}catch{}const n=e.statements.some((e=>!e.object.id.includes("subContentId=")));n&&(t.onActivityFinish.emit(n),t.checkCompletion())}}catch(e){b.CoreAlerts.showError(e,{default:"Error sending tracking data."})}}))()}isCurrentXAPIState(e,t){return!!this.h5pActivity&&(!(!this.isH5PEventForApp(e)||e.action!==t)&&this.activityIdIsCurrentActivity(e.activityId))}isXAPIPostState(e){return"stateData"in e}postState(e){var t=this;return(0,i.A)((function*(){try{var n;const i={offline:t.hasOffline,courseId:t.courseId,extra:null===(n=t.h5pActivity)||void 0===n?void 0:n.name,siteId:t.site.getId()},o=yield p.CoreXAPI.postState(e.component,e.activityId,e.agent,e.stateId,e.stateData,i);t.hasOffline=!o}catch(e){b.CoreAlerts.showError(e,{default:"Error sending tracking data."})}}))()}deleteState(e){var t=this;return(0,i.A)((function*(){try{yield p.CoreXAPI.deleteState(e.component,e.activityId,e.agent,e.stateId,{siteId:t.site.getId()})}catch(e){b.CoreAlerts.showError(e,{default:"Error sending tracking data."})}}))()}deleteOfflineStates(){var e=this;return(0,i.A)((function*(){e.h5pActivity&&(yield C.g.ignoreErrors(c.CoreXAPIOffline.deleteStates(I.$J,{itemId:e.h5pActivity.context})))}))()}sync(){var e=this;return(0,i.A)((function*(){return e.h5pActivity?h.U.syncActivity(e.h5pActivity.context,e.site.getId()):{updated:!1,warnings:[]}}))()}autoSyncEventReceived(){this.checkHasOffline()}ngOnDestroy(){var e;super.ngOnDestroy(),null===(e=this.observer)||void 0===e||e.off(),this.onlineObserver.unsubscribe(),setTimeout((()=>{window.removeEventListener("message",this.messageListenerFunction)}),2e3)}}return(e=AddonModH5PActivityIndexComponent).ɵfac=function AddonModH5PActivityIndexComponent_Factory(t){return new(t||e)(o.rXU(F.W9),o.rXU(s.A,8))},e.ɵcmp=o.VBU({type:e,selectors:[["addon-mod-h5pactivity-index"]],outputs:{onActivityFinish:"onActivityFinish"},standalone:!0,features:[o.Vt3,o.aNF],decls:13,vars:18,consts:[["slot","end"],["iconAction","fas-chart-bar",3,"priority","content","action",4,"ngIf"],["iconAction","fas-circle-info",3,"priority","content"],["fill","clear","aria-haspopup","true",3,"ariaLabel"],[3,"hideUntil"],[3,"completionChanged","module","description","component","componentId","courseId","hasDataToSync"],[1,"core-warning-card"],["class","core-warning-card",4,"ngIf"],[4,"ngIf"],[3,"fileUrl","displayOptions","onlinePlayerUrl","trackComponent","contextId","enableInAppFullscreen","saveFreq","state","component","componentId","fileTimemodified",4,"ngIf"],["collapsible-footer","",3,"hidden","courseId","currentModuleId"],["iconAction","fas-chart-bar",3,"action","priority","content"],["iconAction","fas-circle-info",3,"action","priority","content"],["fill","clear","aria-haspopup","true",3,"click","ariaLabel"],["name","fas-circle-info","slot","icon-only","aria-hidden","true"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-wrap ion-margin","expand","block",3,"click",4,"ngIf"],["class","ion-text-center",4,"ngIf"],[1,"ion-text-wrap"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"],[1,"ion-text-center"],["class","item-heading",4,"ngIf"],[3,"progress","a11yText",4,"ngIf"],[1,"item-heading"],[3,"progress","a11yText"],[3,"fileUrl","displayOptions","onlinePlayerUrl","trackComponent","contextId","enableInAppFullscreen","saveFreq","state","component","componentId","fileTimemodified"]],template:function AddonModH5PActivityIndexComponent_Template(e,t){1&e&&(o.j41(0,"core-navbar-buttons",0)(1,"core-context-menu"),o.DNE(2,AddonModH5PActivityIndexComponent_core_context_menu_item_2_Template,2,4,"core-context-menu-item",1)(3,AddonModH5PActivityIndexComponent_core_context_menu_item_3_Template,2,4,"core-context-menu-item",1)(4,AddonModH5PActivityIndexComponent_Conditional_4_Template,2,4,"core-context-menu-item",2),o.k0s(),o.DNE(5,AddonModH5PActivityIndexComponent_Conditional_5_Template,3,3,"ion-button",3),o.k0s(),o.j41(6,"core-loading",4)(7,"core-course-module-info",5),o.bIt("completionChanged",(function AddonModH5PActivityIndexComponent_Template_core_course_module_info_completionChanged_7_listener(){return t.onCompletionChange()})),o.k0s(),o.DNE(8,AddonModH5PActivityIndexComponent_Conditional_8_Template,6,1,"ion-card",6)(9,AddonModH5PActivityIndexComponent_ion_card_9_Template,6,3,"ion-card",7)(10,AddonModH5PActivityIndexComponent_ion_list_10_Template,4,3,"ion-list",8)(11,AddonModH5PActivityIndexComponent_core_h5p_iframe_11_Template,1,11,"core-h5p-iframe",9),o.k0s(),o.nrm(12,"core-course-module-navigation",10)),2&e&&(o.R7$(2),o.Y8G("ngIf",t.h5pActivity&&t.h5pActivity.enabletracking&&t.accessInfo&&!t.accessInfo.canreviewattempts),o.R7$(),o.Y8G("ngIf",t.canViewAllAttempts),o.R7$(),o.vxM(4,t.courseContentsPage?4:-1),o.R7$(),o.vxM(5,t.courseContentsPage?-1:5),o.R7$(),o.Y8G("hideUntil",!t.showLoading),o.R7$(),o.Y8G("module",t.module)("description",t.description)("component",t.component)("componentId",t.componentId)("courseId",t.courseId)("hasDataToSync",t.hasOffline),o.R7$(),o.vxM(8,!t.triedToPlay||t.isOnline||t.siteCanDownload&&!t.hasMissingDependencies?-1:8),o.R7$(),o.Y8G("ngIf",t.accessInfo&&!t.trackComponent),o.R7$(),o.Y8G("ngIf",t.deployedFile&&!t.playing),o.R7$(),o.Y8G("ngIf",t.playing),o.R7$(),o.Y8G("hidden",t.showLoading)("courseId",t.courseId)("currentModuleId",t.module.id))},dependencies:[O.n,H.bT,F.Jm,F.b_,F.iq,F.uz,F.he,F.nf,F.w2,k.B,R.Q,U.R,N.c,G.z,$.t,L.i,X.T,j.D9,D.CoreCourseModuleInfoComponent,S.CoreCourseModuleNavigationComponent,E.m],encapsulation:2}),AddonModH5PActivityIndexComponent})()},69006:(e,t,n)=>{n.d(t,{y:()=>f});var i=n(10467),o=n(23063),r=n(49882),a=n(44682),s=n(55554),d=n(51024),l=n(52749),c=n(25572),p=n(79555),u=n(95384),m=n(54438),y=n(2910);let f=(()=>{var e;class CoreCourseModuleMainActivityComponent extends o.x{constructor(e="CoreCourseModuleMainResourceComponent",t,n){super(e,n),this.content=t,this.moduleName=""}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,e=this;return(0,i.A)((function*(){yield _superprop_getNgOnInit().call(e),e.hasOffline=!1,e.moduleName=u.CoreCourseModuleHelper.translateModuleName(e.pluginName||e.moduleName||""),e.syncEventName&&(e.syncObserver=r.z.on(e.syncEventName,(t=>{e.autoSyncEventReceived(t)}),e.siteId))}))()}isRefreshSyncNeeded(e){return!1}autoSyncEventReceived(e){this.isRefreshSyncNeeded(e)&&this.showLoadingAndRefresh(!1)}refreshContent(e=!1,t=!1){var n=this;return(0,i.A)((function*(){n.module&&(yield s.g.ignoreErrors(Promise.all([n.invalidateContent(),n.showCompletion?a.CoreCourse.invalidateModule(n.module.id):void 0])),yield n.loadContent(!0,e,t))}))()}showLoadingAndFetch(e=!1,t=!1){var n=this;return(0,i.A)((function*(){var i;n.showLoading=!0,null===(i=n.content)||void 0===i||i.scrollToTop(),yield n.loadContent(!1,e,t)}))()}showLoadingAndRefresh(e=!1,t=!1){var n;return this.showLoading=!0,null===(n=this.content)||void 0===n||n.scrollToTop(),this.refreshContent(e,t)}fetchContent(e=!1,t=!1,n=!1){return(0,i.A)((function*(){}))()}loadContent(e,t=!1,n=!1){var o=this;return(0,i.A)((function*(){if(o.module)try{e&&o.showCompletion&&(yield s.g.ignoreErrors(o.fetchModule())),yield o.fetchContent(e,t,n),o.finishSuccessfulFetch()}catch(n){var i;if(!e&&(null===(i=l.CoreSites.getCurrentSite())||void 0===i||!i.isOfflineDisabled())&&u.CoreCourseModuleHelper.isNotFoundError(n))return yield o.refreshContent(t);c.CoreAlerts.showError(n,{default:p.HT.instant(o.fetchContentDefaultError)})}finally{o.showLoading=!1}}))()}sync(){return(0,i.A)((function*(){return{updated:!1,warnings:[]}}))()}hasSyncSucceed(e){return e.updated}syncActivity(e=!1){var t=this;return(0,i.A)((function*(){try{const e=yield t.sync();return e.warnings.length&&c.CoreAlerts.show({message:e.warnings[0]}),t.hasSyncSucceed(e)}catch(t){return e&&c.CoreAlerts.showError(t,{default:p.HT.instant("core.errorsync")}),!1}}))()}ngOnDestroy(){var e;super.ngOnDestroy(),null===(e=this.syncObserver)||void 0===e||e.off()}}return(e=CoreCourseModuleMainActivityComponent).ɵfac=function CoreCourseModuleMainActivityComponent_Factory(t){return new(t||e)(m.rXU("",8),m.rXU(y.W9),m.rXU(d.A))},e.ɵcmp=m.VBU({type:e,selectors:[["ng-component"]],inputs:{group:"group"},features:[m.Vt3],decls:0,vars:0,template:function CoreCourseModuleMainActivityComponent_Template(e,t){},encapsulation:2}),CoreCourseModuleMainActivityComponent})()}}]);