"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[92045],{18771:(e,n,t)=>{t.r(n),t.d(n,{default:()=>W});var a=t(10467),o=t(94455),d=t(49882),i=t(52749),r=t(83219),l=t(8224),s=t(57186),c=t(13462),_=t(68581),m=t(79555),h=t(54438),p=t(24742),g=t(24502),u=t(66110),f=t(55306),v=t(94398),C=t(47514),y=t(94339),I=t(22693),E=t(8014),b=t(91416),A=t(99234),O=t(25572),M=t(86654),k=t(60177),P=t(2910),T=t(69502),w=t(17388),x=t(64422),R=t(13988),F=t(86198),S=t(8199),D=t(43570),G=t(73955),$=t(59528),j=t(14028);const _c0=(e,n,t,a)=>({hasevents:e,today:n,weekend:t,duration_finish:a}),_c1=e=>({$a:e});function AddonCalendarCalendarComponent_core_context_menu_item_2_Template(e,n){if(1&e){const e=h.RV6();h.j41(0,"core-context-menu-item",17),h.nI1(1,"translate"),h.bIt("action",(function AddonCalendarCalendarComponent_core_context_menu_item_2_Template_core_context_menu_item_action_0_listener(){h.eBV(e);const n=h.XpG();return h.Njj(n.goToCurrentMonth())})),h.k0s()}2&e&&h.Y8G("priority",900)("content",h.bMT(1,2,"addon.calendar.currentmonth"))}function AddonCalendarCalendarComponent_For_13_Template(e,n){1&e&&(h.j41(0,"ion-col",10),h.nrm(1,"ion-skeleton-text",18),h.k0s()),2&e&&(h.R7$(),h.Y8G("animated",!0))}function AddonCalendarCalendarComponent_For_16_For_2_Template(e,n){1&e&&(h.j41(0,"ion-col",19)(1,"p",20),h.nrm(2,"ion-skeleton-text",18),h.k0s()()),2&e&&(h.R7$(2),h.Y8G("animated",!0))}function AddonCalendarCalendarComponent_For_16_Template(e,n){1&e&&(h.j41(0,"ion-row",9),h.Z7z(1,AddonCalendarCalendarComponent_For_16_For_2_Template,3,1,"ion-col",19,h.fX1),h.nI1(3,"coreTimes"),h.k0s()),2&e&&(h.R7$(),h.Dyx(h.bMT(3,0,7)))}function AddonCalendarCalendarComponent_ion_col_21_Template(e,n){if(1&e){const e=h.RV6();h.j41(0,"ion-col",21)(1,"ion-button",22),h.nI1(2,"translate"),h.bIt("click",(function AddonCalendarCalendarComponent_ion_col_21_Template_ion_button_click_1_listener(){h.eBV(e);const n=h.XpG();return h.Njj(n.loadPrevious())})),h.nrm(3,"ion-icon",23),h.k0s()()}2&e&&(h.R7$(),h.Y8G("ariaLabel",h.bMT(2,1,"addon.calendar.monthprev")))}function AddonCalendarCalendarComponent_ion_spinner_25_Template(e,n){1&e&&h.nrm(0,"ion-spinner",24)}function AddonCalendarCalendarComponent_ion_col_26_Template(e,n){if(1&e){const e=h.RV6();h.j41(0,"ion-col",25)(1,"ion-button",22),h.nI1(2,"translate"),h.bIt("click",(function AddonCalendarCalendarComponent_ion_col_26_Template_ion_button_click_1_listener(){h.eBV(e);const n=h.XpG();return h.Njj(n.loadNext())})),h.nrm(3,"ion-icon",26),h.k0s()()}2&e&&(h.R7$(),h.Y8G("ariaLabel",h.bMT(2,1,"addon.calendar.monthnext")))}function AddonCalendarCalendarComponent_ng_template_28_ion_col_3_Template(e,n){if(1&e&&(h.j41(0,"ion-col",32)(1,"span",33),h.EFF(2),h.nI1(3,"translate"),h.k0s(),h.j41(4,"span",34),h.EFF(5),h.nI1(6,"translate"),h.k0s(),h.j41(7,"span",35),h.EFF(8),h.nI1(9,"translate"),h.k0s()()),2&e){const e=n.$implicit;h.R7$(2),h.JRh(h.bMT(3,3,e.fullname)),h.R7$(3),h.JRh(h.bMT(6,5,e.shortname)),h.R7$(3),h.JRh(h.bMT(9,7,e.fullname))}}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_1_Template(e,n){1&e&&h.nrm(0,"ion-col",39)}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_span_8_Template(e,n){if(1&e&&h.nrm(0,"span"),2&e){h.ZvI("calendar_event_type calendar_event_",n.$implicit,"")}}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_div_1_ion_icon_2_Template(e,n){1&e&&(h.nrm(0,"ion-icon",55),h.nI1(1,"translate")),2&e&&h.BMQ("aria-label",h.bMT(1,1,"core.notsent"))}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_div_1_ion_icon_3_Template(e,n){1&e&&(h.nrm(0,"ion-icon",56),h.nI1(1,"translate")),2&e&&h.BMQ("aria-label",h.bMT(1,1,"core.deletedoffline"))}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_div_1_span_10_Template(e,n){if(1&e&&(h.j41(0,"span",33),h.EFF(1),h.k0s()),2&e){const e=h.XpG(2).$implicit;h.R7$(),h.SpI(" ",e.iconTitle," ")}}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_div_1_Template(e,n){if(1&e){const e=h.RV6();h.j41(0,"div",49),h.bIt("ariaButtonClick",(function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_div_1_Template_div_ariaButtonClick_0_listener(n){h.eBV(e);const t=h.XpG().$implicit,a=h.XpG(5);return h.Njj(a.eventClicked(t,n))})),h.nrm(1,"span"),h.DNE(2,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_div_1_ion_icon_2_Template,2,3,"ion-icon",50)(3,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_div_1_ion_icon_3_Template,2,3,"ion-icon",51),h.j41(4,"span",52),h.EFF(5),h.nI1(6,"coreFormatDate"),h.k0s(),h.j41(7,"span",33),h.EFF(8),h.nI1(9,"translate"),h.DNE(10,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_div_1_span_10_Template,2,1,"span",53),h.k0s(),h.j41(11,"span",54),h.EFF(12),h.k0s()()}if(2&e){const e=h.XpG().$implicit,n=h.XpG(4).active,t=h.XpG();h.AVh("addon-calendar-event-past",e.ispast),h.Y8G("tabindex",n?0:-1),h.R7$(),h.ZvI("calendar_event_type calendar_event_",e.formattedType,""),h.R7$(),h.Y8G("ngIf",e.offline&&!e.deleted),h.R7$(),h.Y8G("ngIf",e.deleted),h.R7$(2),h.SpI(" ",h.i5U(6,12,1e3*e.timestart,t.timeFormat)," "),h.R7$(3),h.SpI(" ",h.bMT(9,15,"addon.calendar.type"+e.formattedType)," "),h.R7$(2),h.Y8G("ngIf",e.iconTitle),h.R7$(2),h.JRh(e.name)}}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_Template(e,n){if(1&e&&(h.qex(0),h.DNE(1,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_div_1_Template,13,17,"div",48),h.bVm()),2&e){const e=n.index,t=h.XpG(2).$implicit;h.R7$(),h.Y8G("ngIf",e<3||4===t.filteredEvents.length)}}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_p_3_Template(e,n){if(1&e&&(h.j41(0,"p",57)(1,"strong"),h.EFF(2),h.nI1(3,"translate"),h.k0s()()),2&e){const e=h.XpG(2).$implicit;h.R7$(2),h.JRh(h.i5U(3,1,"core.nummore",h.eq3(4,_c1,e.filteredEvents.length-3)))}}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_Template(e,n){if(1&e&&(h.j41(0,"div",45),h.DNE(1,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_ng_container_1_Template,2,1,"ng-container",46),h.nI1(2,"slice"),h.DNE(3,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_p_3_Template,4,6,"p",47),h.k0s()),2&e){const e=h.XpG().$implicit;h.R7$(),h.Y8G("ngForOf",h.brH(2,2,e.filteredEvents,0,4)),h.R7$(2),h.Y8G("ngIf",e.filteredEvents.length>4)}}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_Template(e,n){if(1&e){const e=h.RV6();h.j41(0,"ion-col",40),h.bIt("ariaButtonClick",(function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_Template_ion_col_ariaButtonClick_0_listener(){const n=h.eBV(e).$implicit,t=h.XpG(3);return h.Njj(t.dayClicked(n.mday))})),h.j41(1,"p",20)(2,"span",41),h.EFF(3),h.k0s(),h.j41(4,"span",33),h.EFF(5),h.nI1(6,"translate"),h.k0s()(),h.j41(7,"p",42),h.DNE(8,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_span_8_Template,1,3,"span",43),h.k0s(),h.DNE(9,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_div_9_Template,4,6,"div",44),h.k0s()}if(2&e){const e=n.$implicit,t=h.XpG(2),a=t.item,o=t.active;h.AVh("addon-calendar-event-past-day",a.isPastMonth||e.ispast),h.Y8G("ngClass",h.ziG(11,_c0,e.hasevents,a.isCurrentMonth&&e.istoday,e.isweekend,e.haslastdayofevent))("tabindex",o?0:-1),h.BMQ("aria-current",a.isCurrentMonth&&e.istoday?"date":null),h.R7$(3),h.JRh(e.mday),h.R7$(2),h.JRh(h.bMT(6,9,e.periodName)),h.R7$(3),h.Y8G("ngForOf",e.calendareventtypes),h.R7$(),h.Y8G("ngIf",e.filteredEvents)}}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_3_Template(e,n){1&e&&h.nrm(0,"ion-col",39)}function AddonCalendarCalendarComponent_ng_template_28_ion_row_5_Template(e,n){if(1&e&&(h.j41(0,"ion-row",36),h.DNE(1,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_1_Template,1,0,"ion-col",37)(2,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_2_Template,10,16,"ion-col",38)(3,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_ion_col_3_Template,1,0,"ion-col",37),h.k0s()),2&e){const e=n.$implicit;h.R7$(),h.Y8G("ngForOf",e.prepadding),h.R7$(),h.Y8G("ngForOf",e.days),h.R7$(),h.Y8G("ngForOf",e.postpadding)}}function AddonCalendarCalendarComponent_ng_template_28_Template(e,n){if(1&e&&(h.j41(0,"ion-grid",27)(1,"div",28)(2,"ion-row",29),h.DNE(3,AddonCalendarCalendarComponent_ng_template_28_ion_col_3_Template,10,9,"ion-col",30),h.k0s()(),h.j41(4,"div",28),h.DNE(5,AddonCalendarCalendarComponent_ng_template_28_ion_row_5_Template,4,3,"ion-row",31),h.k0s()()),2&e){const e=n.item;h.R7$(3),h.Y8G("ngForOf",e.weekDays),h.R7$(2),h.Y8G("ngForOf",e.weeks)}}let N=(()=>{var e;class AddonCalendarCalendarComponent{constructor(e){var n;this.hidden=!1,this.canNavigate=!0,this.displayNavButtons=!0,this.onEventClicked=new h.bkB,this.onDayClicked=new h.bkB,this.loaded=!1,this.currentSiteId=i.CoreSites.getCurrentSiteId(),this.undeleteEventObserver=d.z.on(A.hZ,(e=>{var n,t;if(!e||!e.eventId)return;this.undeleteEvent(e.eventId);const a=null!==(n=null===(t=this.manager)||void 0===t?void 0:t.getSource().deletedEvents.indexOf(e.eventId))&&void 0!==n?n:-1;var o;-1!=a&&(null===(o=this.manager)||void 0===o||o.getSource().deletedEvents.splice(a,1))}),this.currentSiteId),this.hiddenDiffer=this.hidden,this.filterDiffer=e.find(null!==(n=this.filter)&&void 0!==n?n:{}).create(),this.logView=p.j.once((()=>{var e,n;if(!(null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem()))return;const t={course:null===(n=this.filter)||void 0===n?void 0:n.courseId,time:p.j.timestamp()};I.OF.logEvent({type:I.qr.VIEW_ITEM_LIST,ws:"core_calendar_get_calendar_monthly_view",name:m.HT.instant("addon.calendar.detailedmonthviewtitle",{$a:this.periodName}),data:{...t,category:"calendar"},url:E.F.addParamsToUrl("/calendar/view.php?view=month",t)})}))}get hiddenAttribute(){return this.hidden?"hidden":null}ngOnInit(){const e=new AddonCalendarMonthSlidesItemsManagerSource(this,(0,y.yf)({year:this.initialYear,month:this.initialMonth?this.initialMonth-1:void 0}).startOf("month"));this.manager=new C.E(e),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onMonthViewed(e)}}),this.fetchData()}ngDoCheck(){var e;const n=null===(e=this.manager)||void 0===e?void 0:e.getSource().getItems();if(null!=n&&n.length){var t;this.filterDiffer.diff(null!==(t=this.filter)&&void 0!==t?t:{})&&n.forEach((e=>{var n;e.loaded&&e.weeks&&(null===(n=this.manager)||void 0===n||n.getSource().filterEvents(e.weeks,this.filter))}))}var a;this.hiddenDiffer!==this.hidden&&(this.hiddenDiffer=this.hidden,this.hidden||null===(a=this.swipeSlidesComponent)||void 0===a||a.updateSlidesComponent())}get timeFormat(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().timeFormat)||"core.strftimetime"}fetchData(){var e=this;return(0,a.A)((function*(){try{var n,t,a;yield null===(n=e.manager)||void 0===n?void 0:n.getSource().fetchData(),yield null===(t=e.manager)||void 0===t?void 0:t.getSource().load(null===(a=e.manager)||void 0===a?void 0:a.getSelectedItem()),e.logView()}catch(e){O.CoreAlerts.showError(e,{default:m.HT.instant("addon.calendar.errorloadevents")})}e.loaded=!0}))()}onMonthViewed(e){this.periodName=p.j.userDate(e.dayJS.valueOf(),"core.strftimemonthyear")}refreshData(e=!1){var n=this;return(0,a.A)((function*(){var t,a;const o=(null===(t=n.manager)||void 0===t?void 0:t.getSelectedItem())||null;var d;e&&(null===(d=n.manager)||void 0===d||d.getSource().markAllItemsDirty());yield null===(a=n.manager)||void 0===a?void 0:a.getSource().invalidateContent(o),yield n.fetchData()}))()}loadNext(){var e;null===(e=this.swipeSlidesComponent)||void 0===e||e.slideNext()}loadPrevious(){var e;null===(e=this.swipeSlidesComponent)||void 0===e||e.slidePrev()}eventClicked(e,n){this.onEventClicked.emit(e.id),n.stopPropagation()}dayClicked(e){var n;const t=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();t&&this.onDayClicked.emit({day:e,month:t.dayJS.month()+1,year:t.dayJS.year()})}goToCurrentMonth(){var e=this;return(0,a.A)((function*(){const n=(0,y.yf)();yield e.viewMonth(n.month()+1,n.year())}))()}selectedMonthLoaded(){var e;return!(null===(e=this.manager)||void 0===e||null===(e=e.getSelectedItem())||void 0===e||!e.loaded)}selectedMonthIsCurrent(){var e;return!(null===(e=this.manager)||void 0===e||null===(e=e.getSelectedItem())||void 0===e||!e.isCurrentMonth)}undeleteEvent(e){var n=this;return(0,a.A)((function*(){var t;null===(t=n.manager)||void 0===t||null===(t=t.getSource().getItems())||void 0===t||t.some((n=>{var t;return!!n.loaded&&(null===(t=n.weeks)||void 0===t?void 0:t.some((n=>n.days.some((n=>{var t;const a=null===(t=n.eventsFormated)||void 0===t?void 0:t.find((n=>n.id==e));return!!a&&(a.deleted=!1,!0)})))))}))}))()}viewMonth(e,n){var t=this;return(0,a.A)((function*(){const a=t.manager;if(!a||!t.swipeSlidesComponent)return;t.loaded=!1;const o={dayJS:(0,y.yf)({year:n,month:e-1})};try{yield a.getSource().loadItem(o),t.swipeSlidesComponent.slideToItem(o)}catch(e){O.CoreAlerts.showError(e,{default:m.HT.instant("addon.calendar.errorloadevents")})}finally{t.loaded=!0}}))()}ngOnDestroy(){var e,n,t;null===(e=this.undeleteEventObserver)||void 0===e||e.off(),null===(n=this.manager)||void 0===n||n.destroy(),null===(t=this.managerUnsubscribe)||void 0===t||t.call(this),delete this.manager}}return(e=AddonCalendarCalendarComponent).ɵfac=function AddonCalendarCalendarComponent_Factory(n){return new(n||e)(h.rXU(h.MKu))},e.ɵcmp=h.VBU({type:e,selectors:[["addon-calendar-calendar"]],viewQuery:function AddonCalendarCalendarComponent_Query(e,n){if(1&e&&h.GBs(f.N,5),2&e){let e;h.mGM(e=h.lsd())&&(n.swipeSlidesComponent=e.first)}},hostVars:1,hostBindings:function AddonCalendarCalendarComponent_HostBindings(e,n){2&e&&h.BMQ("hidden",n.hiddenAttribute)},inputs:{initialYear:"initialYear",initialMonth:"initialMonth",filter:"filter",hidden:[h.Mj6.HasDecoratorInputTransform,"hidden","hidden",b.G],canNavigate:[h.Mj6.HasDecoratorInputTransform,"canNavigate","canNavigate",b.G],displayNavButtons:[h.Mj6.HasDecoratorInputTransform,"displayNavButtons","displayNavButtons",b.G]},outputs:{onEventClicked:"onEventClicked",onDayClicked:"onDayClicked"},standalone:!0,features:[h.GFd,h.aNF],decls:29,vars:12,consts:[["slot","end","prepend",""],["iconAction","fas-calendar-day",3,"priority","content","action",4,"ngIf"],["placeholderType","free",3,"hideUntil"],["loading-placeholder",""],[1,"ion-no-padding","addon-calendar-navigation"],[1,"ion-align-items-center"],[1,"ion-text-center","addon-calendar-period"],[2,"width","50%",3,"animated"],[1,"addon-calendar-months"],[1,"addon-calendar-week"],[1,"ion-text-center","addon-calendar-weekday",2,"width","60px"],[1,"core-swipe-slides-container"],["class","ion-text-start",4,"ngIf"],["id","addon-calendar-monthname"],["class","addon-calendar-loading-month",4,"ngIf"],["class","ion-text-end",4,"ngIf"],[3,"manager"],["iconAction","fas-calendar-day",3,"action","priority","content"],[1,"icon",3,"animated"],[1,"ion-text-center","dayblank","addon-calendar-day",2,"width","60px"],[1,"addon-calendar-day-number"],[1,"ion-text-start"],["fill","clear",3,"click","ariaLabel"],["name","fas-chevron-left","slot","icon-only","aria-hidden","true"],[1,"addon-calendar-loading-month"],[1,"ion-text-end"],["name","fas-chevron-right","slot","icon-only","aria-hidden","true"],["role","table","aria-describedby","addon-calendar-monthname",1,"addon-calendar-months"],["role","rowgroup"],["role","row"],["class","ion-text-center addon-calendar-weekday","role","columnheader",4,"ngFor","ngForOf"],["class","addon-calendar-week","role","row",4,"ngFor","ngForOf"],["role","columnheader",1,"ion-text-center","addon-calendar-weekday"],[1,"sr-only"],["aria-hidden","true",1,"ion-hide-md-up"],["aria-hidden","true",1,"ion-hide-md-down"],["role","row",1,"addon-calendar-week"],["class","dayblank addon-calendar-day","role","cell",4,"ngFor","ngForOf"],["class","addon-calendar-day ion-text-center","role","cell",3,"ngClass","addon-calendar-event-past-day","tabindex","ariaButtonClick",4,"ngFor","ngForOf"],["role","cell",1,"dayblank","addon-calendar-day"],["role","cell",1,"addon-calendar-day","ion-text-center",3,"ariaButtonClick","ngClass","tabindex"],["aria-hidden","true"],[1,"ion-hide-md-up","addon-calendar-dot-types"],[3,"class",4,"ngFor","ngForOf"],["class","ion-hide-md-down addon-calendar-day-events",4,"ngIf"],[1,"ion-hide-md-down","addon-calendar-day-events"],[4,"ngFor","ngForOf"],["class","addon-calendar-day-more",4,"ngIf"],["class","addon-calendar-event",3,"addon-calendar-event-past","tabindex","ariaButtonClick",4,"ngIf"],[1,"addon-calendar-event",3,"ariaButtonClick","tabindex"],["name","fas-clock",4,"ngIf"],["name","fas-trash",4,"ngIf"],[1,"addon-calendar-event-time"],["class","sr-only",4,"ngIf"],[1,"addon-calendar-event-name"],["name","fas-clock"],["name","fas-trash"],[1,"addon-calendar-day-more"]],template:function AddonCalendarCalendarComponent_Template(e,n){1&e&&(h.j41(0,"core-navbar-buttons",0)(1,"core-context-menu"),h.DNE(2,AddonCalendarCalendarComponent_core_context_menu_item_2_Template,2,4,"core-context-menu-item",1),h.k0s()(),h.j41(3,"core-loading",2)(4,"div",3)(5,"ion-grid",4)(6,"ion-row",5)(7,"ion-col",6)(8,"h2"),h.nrm(9,"ion-skeleton-text",7),h.k0s()()()(),h.j41(10,"ion-grid",8)(11,"ion-row",9),h.Z7z(12,AddonCalendarCalendarComponent_For_13_Template,2,1,"ion-col",10,h.fX1),h.nI1(14,"coreTimes"),h.k0s(),h.Z7z(15,AddonCalendarCalendarComponent_For_16_Template,4,2,"ion-row",9,h.fX1),h.nI1(17,"coreTimes"),h.k0s()(),h.j41(18,"div",11)(19,"ion-grid",4)(20,"ion-row",5),h.DNE(21,AddonCalendarCalendarComponent_ion_col_21_Template,4,3,"ion-col",12),h.j41(22,"ion-col",6)(23,"h2",13),h.EFF(24),h.DNE(25,AddonCalendarCalendarComponent_ion_spinner_25_Template,1,0,"ion-spinner",14),h.k0s()(),h.DNE(26,AddonCalendarCalendarComponent_ion_col_26_Template,4,3,"ion-col",15),h.k0s()(),h.j41(27,"core-swipe-slides",16),h.DNE(28,AddonCalendarCalendarComponent_ng_template_28_Template,6,2,"ng-template"),h.k0s()()()),2&e&&(h.R7$(2),h.Y8G("ngIf",n.canNavigate&&!n.selectedMonthIsCurrent()&&n.displayNavButtons),h.R7$(),h.Y8G("hideUntil",n.loaded),h.R7$(6),h.Y8G("animated",!0),h.R7$(3),h.Dyx(h.bMT(14,8,7)),h.R7$(3),h.Dyx(h.bMT(17,10,5)),h.R7$(6),h.Y8G("ngIf",n.canNavigate),h.R7$(3),h.SpI(" ",n.periodName," "),h.R7$(),h.Y8G("ngIf",!n.selectedMonthLoaded()),h.R7$(),h.Y8G("ngIf",n.canNavigate),h.R7$(),h.Y8G("manager",n.manager))},dependencies:[M.n,k.YU,k.Sq,k.bT,P.Jm,P.hU,P.lO,P.iq,P.ln,P.ds,P.w2,T.B,w.Q,x.R,R.c,f.N,F.t,S.a,D.T,k.P9,G.D9,$.f,j.O],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color: var(--light)}[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{flex:none;width:100%}[_nghost-%COMP%]   .addon-calendar-navigation[_ngcontent-%COMP%]{padding-top:5px;padding-left:10px;padding-right:10px}[_nghost-%COMP%]   .addon-calendar-months[_ngcontent-%COMP%]{background-color:var(--contrast-background);padding:0;font-size:var(--text-size)}[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]{border-bottom:1px solid var(--addon-calendar-border-color);border-inline-end:1px solid var(--addon-calendar-border-color);overflow:hidden;min-height:60px}[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]:first-child{padding-inline-start:10px}[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]:last-child{border-inline-end:0;padding-inline-start:8px}[_nghost-%COMP%]   .addon-calendar-day.addon-calendar-event-past-day[_ngcontent-%COMP%] > .addon-calendar-dot-types[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-calendar-day.addon-calendar-event-past-day[_ngcontent-%COMP%] > .addon-calendar-day-events[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]   .addon-calendar-day-number[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]   .addon-calendar-day-number[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{line-height:24px;font-weight:500;display:inline-block;margin:3px;width:max-content;width:24px;height:24px;text-align:center}@media (min-width: 768px){[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]   .addon-calendar-day-number[_ngcontent-%COMP%]{text-align:start}}[_nghost-%COMP%]   .addon-calendar-day.today[_ngcontent-%COMP%]   .addon-calendar-day-number[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{border:2px solid var(--addon-calendar-today-border-color);line-height:20px;border-radius:50%}[_nghost-%COMP%]   .addon-calendar-day.dayblank[_ngcontent-%COMP%]{cursor:auto;background-color:var(--addon-calendar-blank-day-background-color)}[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]   .addon-calendar-event[_ngcontent-%COMP%]{margin-top:.6em;margin-bottom:.6em;overflow:hidden;white-space:nowrap;color:var(--text-color);min-height:auto}[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]   .addon-calendar-event.addon-calendar-event-past[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]   .addon-calendar-event[_ngcontent-%COMP%]   .addon-calendar-event-name[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]   .addon-calendar-day-more[_ngcontent-%COMP%]{margin-inline-start:4px;margin-top:.6em;margin-bottom:.6em}[_nghost-%COMP%]   .addon-calendar-day[_ngcontent-%COMP%]   .addon-calendar-dot-types[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]{flex-grow:3}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:10px;font-size:1.2rem}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]   .addon-calendar-loading-month[_ngcontent-%COMP%]{height:20px}[_nghost-%COMP%]   .addon-calendar-weekday[_ngcontent-%COMP%]{border-bottom:1px solid var(--addon-calendar-border-color);font-weight:700}[_nghost-%COMP%]   .addon-calendar-day-events[_ngcontent-%COMP%]{text-align:start}[_nghost-%COMP%]   .addon-calendar-day-events[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-end:2px;font-size:1em}[_nghost-%COMP%]   .addon-calendar-event[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-calendar-day-number[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-calendar-day-more[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .calendar_event_type[_ngcontent-%COMP%]{display:inline-block;width:8px;height:8px;border-radius:50%;border:1px solid white;margin-right:1px;margin-left:1px}[_nghost-%COMP%]   .calendar_event_type.calendar_event_category[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .calendar_event_type.calendar_event_course[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .calendar_event_type.calendar_event_group[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .calendar_event_type.calendar_event_user[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .calendar_event_type.calendar_event_site[_ngcontent-%COMP%]{background-color:#10846c}[_nghost-%COMP%]   swiper-slide[_ngcontent-%COMP%]{display:block;justify-content:start;align-items:start;text-align:start}:root.dark[_nghost-%COMP%], :root.dark   [_nghost-%COMP%]{--addon-calendar-blank-day-background-color: var(--gray-900)}"]}),AddonCalendarCalendarComponent})();class AddonCalendarMonthSlidesItemsManagerSource extends v.h{constructor(e,n){super({dayJS:n}),this.offlineEvents={},this.offlineEditedEventsIds=[],this.deletedEvents=[],this.calendarComponent=e}fetchData(){var e=this;return(0,a.A)((function*(){yield Promise.all([e.loadCategories(),e.loadOfflineEvents(),e.loadOfflineDeletedEvents(),e.loadTimeFormat()])}))()}filterEvents(e,n){e.forEach((e=>{e.days.forEach((e=>{e.filteredEvents=_.AddonCalendarHelper.getFilteredEvents(e.eventsFormated||[],n,this.categories||{}),_.AddonCalendarHelper.calculateDayData(e,e.filteredEvents)}))}))}loadCategories(){var e=this;return(0,a.A)((function*(){if(!e.categories)try{const n=yield u.CoreCourses.getCategories(0,!0);e.categories=g.R.toObject(n,"id")}catch{}}))()}loadOfflineEvents(){var e=this;return(0,a.A)((function*(){const n=yield s.AddonCalendarOffline.getAllEditedEvents();e.offlineEvents=_.AddonCalendarHelper.classifyIntoMonths(n),e.offlineEditedEventsIds=n.filter((e=>e.id>0)).map((e=>e.id))}))()}loadOfflineDeletedEvents(){var e=this;return(0,a.A)((function*(){e.deletedEvents=yield s.AddonCalendarOffline.getAllDeletedEventsIds()}))()}loadTimeFormat(){var e=this;return(0,a.A)((function*(){e.timeFormat=yield l.AddonCalendar.getCalendarTimeFormat()}))()}getItemId(e){return _.AddonCalendarHelper.getMonthId(e.dayJS)}getPreviousItem(e){return{dayJS:e.dayJS.subtract(1,"month")}}getNextItem(e){return{dayJS:e.dayJS.add(1,"month")}}loadItemData(e,n=!1){var t=this;return(0,a.A)((function*(){let d;const i=e.dayJS.year(),r=e.dayJS.month()+1;if(n)d=yield _.AddonCalendarHelper.getOfflineMonthWeeks(i,r);else try{d=yield l.AddonCalendar.getMonthlyEvents(i,r)}catch(e){if(o.WE.isOnline())throw e;d=yield _.AddonCalendarHelper.getOfflineMonthWeeks(i,r)}const s=l.AddonCalendar.getWeekDays(d.daynames[0].dayno),c=d.weeks,m=(0,y.yf)().date(),h=p.j.timestamp(),g=(0,y.yf)(e.dayJS),u={...e,weeks:c,weekDays:s,isCurrentMonth:e.dayJS.isSame((0,y.yf)(),"month"),isPastMonth:e.dayJS.isBefore((0,y.yf)(),"month")};return yield Promise.all(c.map(function(){var e=(0,a.A)((function*(e){yield Promise.all(e.days.map(function(){var e=(0,a.A)((function*(e){e.periodName=p.j.userDate(g.date(e.mday).valueOf(),"core.strftimedaydate"),e.eventsFormated=e.eventsFormated||[],e.filteredEvents=e.filteredEvents||[];const n=yield Promise.all(e.events.map((e=>_.AddonCalendarHelper.formatEventData(e))));var a;(e.eventsFormated=e.eventsFormated.concat(n),u.isCurrentMonth)&&(e.istoday=e.mday==m,e.ispast=u.isPastMonth||e.mday<m,e.istoday&&(null===(a=e.eventsFormated)||void 0===a||a.forEach((e=>{e.ispast=t.isEventPast(e,h)}))))}));return function(n){return e.apply(this,arguments)}}()))}));return function(n){return e.apply(this,arguments)}}())),n||(t.mergeEvents(e,c),t.filterEvents(c,t.calendarComponent.filter)),u}))()}mergeEvents(e,n){const t=this.offlineEvents[_.AddonCalendarHelper.getMonthId(e.dayJS)];n.forEach((e=>{e.days.forEach((e=>{var n;this.deletedEvents.length&&(null===(n=e.eventsFormated)||void 0===n||n.forEach((e=>{e.deleted=-1!=this.deletedEvents.indexOf(e.id)})));this.offlineEditedEventsIds.length&&(e.events=e.events.filter((e=>-1==this.offlineEditedEventsIds.indexOf(e.id)))),t&&t[e.mday]&&e.eventsFormated&&(e.eventsFormated=_.AddonCalendarHelper.sortEvents(e.eventsFormated.concat(t[e.mday])))}))}))}isEventPast(e,n){return e.timestart+e.timeduration<n}invalidateContent(e){var n=this;return(0,a.A)((function*(){const t=[];e&&t.push(l.AddonCalendar.invalidateMonthlyEvents(e.dayJS.year(),e.dayJS.month()+1)),t.push(u.CoreCourses.invalidateCategories(0,!0)),t.push(l.AddonCalendar.invalidateTimeFormat()),n.categories=void 0,e&&(e.dirty=!0),yield Promise.all(t)}))()}}var Y=t(74431),U=t(16986),B=t(32572),J=t(58197);const upcoming_events_c0=e=>[e];function AddonCalendarUpcomingEventsComponent_core_empty_box_1_Template(e,n){1&e&&(h.nrm(0,"core-empty-box",3),h.nI1(1,"translate")),2&e&&h.Y8G("message",h.bMT(1,1,"addon.calendar.noevents"))}function AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_core_mod_icon_3_Template(e,n){if(1&e&&h.nrm(0,"core-mod-icon",15),2&e){const e=h.XpG().$implicit;h.Y8G("modicon",e.moduleIcon)("modname",e.modulename)("componentId",e.instance)("showAlt",!1)("purpose",e.purpose)("isBranded",e.branded)}}function AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_ion_icon_4_Template(e,n){if(1&e&&h.nrm(0,"ion-icon",16),2&e){const e=h.XpG().$implicit;h.Y8G("name",e.eventIcon)}}function AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_span_9_Template(e,n){if(1&e&&(h.j41(0,"span",9),h.EFF(1),h.k0s()),2&e){const e=h.XpG().$implicit;h.R7$(),h.JRh(e.iconTitle)}}function AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_ion_note_14_Template(e,n){1&e&&(h.j41(0,"ion-note",17),h.nrm(1,"ion-icon",18),h.j41(2,"span",19),h.EFF(3),h.nI1(4,"translate"),h.k0s()()),2&e&&(h.R7$(3),h.JRh(h.bMT(4,1,"core.notsent")))}function AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_ion_note_15_Template(e,n){1&e&&(h.j41(0,"ion-note",17),h.nrm(1,"ion-icon",20),h.j41(2,"span",19),h.EFF(3),h.nI1(4,"translate"),h.k0s()()),2&e&&(h.R7$(3),h.JRh(h.bMT(4,1,"core.deletedoffline")))}function AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_Template(e,n){if(1&e){const e=h.RV6();h.qex(0),h.j41(1,"ion-card")(2,"ion-item",6),h.bIt("click",(function AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_Template_ion_item_click_2_listener(){const n=h.eBV(e).$implicit,t=h.XpG(2);return h.Njj(t.eventClicked(n))})),h.DNE(3,AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_core_mod_icon_3_Template,1,6,"core-mod-icon",7)(4,AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_ion_icon_4_Template,1,1,"ion-icon",8),h.j41(5,"ion-label")(6,"span",9),h.EFF(7),h.nI1(8,"translate"),h.DNE(9,AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_span_9_Template,2,1,"span",10),h.k0s(),h.j41(10,"p",11),h.nrm(11,"core-format-text",12),h.k0s(),h.j41(12,"p"),h.nrm(13,"core-format-text",13),h.k0s()(),h.DNE(14,AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_ion_note_14_Template,5,3,"ion-note",14)(15,AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_ion_note_15_Template,5,3,"ion-note",14),h.k0s()(),h.bVm()}if(2&e){const e=n.$implicit;h.R7$(2),h.Y8G("ngClass",h.eq3(16,upcoming_events_c0,"addon-calendar-eventtype-"+e.eventtype))("detail",!1),h.BMQ("aria-label",e.name),h.R7$(),h.Y8G("ngIf",e.moduleIcon),h.R7$(),h.Y8G("ngIf",e.eventIcon&&!e.moduleIcon),h.R7$(3),h.SpI(" ",h.bMT(8,14,"addon.calendar.type"+e.formattedType)," "),h.R7$(2),h.Y8G("ngIf",e.moduleIcon&&e.iconTitle),h.R7$(2),h.Y8G("text",e.name)("contextLevel",e.contextLevel)("contextInstanceId",e.contextInstanceId),h.R7$(2),h.Y8G("text",e.formattedtime)("filter",!1),h.R7$(),h.Y8G("ngIf",e.offline&&!e.deleted),h.R7$(),h.Y8G("ngIf",e.deleted)}}function AddonCalendarUpcomingEventsComponent_ion_list_2_Template(e,n){if(1&e&&(h.j41(0,"ion-list",4),h.DNE(1,AddonCalendarUpcomingEventsComponent_ion_list_2_ng_container_1_Template,16,18,"ng-container",5),h.k0s()),2&e){const e=h.XpG();h.R7$(),h.Y8G("ngForOf",e.filteredEvents)}}let V=(()=>{var e;class AddonCalendarUpcomingEventsComponent{constructor(e){this.onEventClicked=new h.bkB,this.filteredEvents=[],this.loaded=!1,this.categoriesRetrieved=!1,this.categories={},this.events=[],this.onlineEvents=[],this.offlineEvents=[],this.deletedEvents=[],this.lookAhead=0,this.currentSiteId=i.CoreSites.getCurrentSiteId(),this.undeleteEventObserver=d.z.on(A.hZ,(e=>{if(!e||!e.eventId)return;this.undeleteEvent(e.eventId);const n=this.deletedEvents.indexOf(e.eventId);-1!=n&&this.deletedEvents.splice(n,1)}),this.currentSiteId),this.differ=e.find([]).create(),this.logView=p.j.once((()=>{var e;const n={course:null===(e=this.filter)||void 0===e?void 0:e.courseId};I.OF.logEvent({type:I.qr.VIEW_ITEM_LIST,ws:"core_calendar_get_calendar_upcoming_view",name:m.HT.instant("addon.calendar.upcomingevents"),data:{...n,category:"calendar"},url:E.F.addParamsToUrl("/calendar/view.php?view=upcoming",n)})}))}ngOnInit(){this.fetchData()}ngDoCheck(){this.differ.diff(this.filter||{})&&this.filterEvents()}fetchData(){var e=this;return(0,a.A)((function*(){const n=[];n.push(e.loadCategories()),n.push(s.AddonCalendarOffline.getAllEditedEvents().then((n=>{const t=n.map((e=>_.AddonCalendarHelper.formatOfflineEventData(e)));e.offlineEvents=_.AddonCalendarHelper.sortEvents(t)}))),n.push(s.AddonCalendarOffline.getAllDeletedEventsIds().then((n=>{e.deletedEvents=n}))),n.push(l.AddonCalendar.getCalendarLookAhead().then((n=>{e.lookAhead=n}))),n.push(l.AddonCalendar.getCalendarTimeFormat().then((n=>{e.timeFormat=n})));try{yield Promise.all(n),yield e.fetchEvents(),e.logView()}catch(e){O.CoreAlerts.showError(e,{default:m.HT.instant("addon.calendar.errorloadevents")})}e.loaded=!0}))()}fetchEvents(){var e=this;return(0,a.A)((function*(){const n=yield l.AddonCalendar.getUpcomingEvents();e.onlineEvents=yield Promise.all(n.events.map((e=>_.AddonCalendarHelper.formatEventData(e)))),e.events=e.mergeEvents(),e.filterEvents();const t=e.events.map((n=>l.AddonCalendar.formatEventTime(n,e.timeFormat).then((e=>{n.formattedtime=e}))));yield Promise.all(t)}))()}loadCategories(){var e=this;return(0,a.A)((function*(){if(!e.categoriesRetrieved)try{const n=yield u.CoreCourses.getCategories(0,!0);e.categoriesRetrieved=!0,e.categories={},n.forEach((n=>{e.categories[n.id]=n}))}catch{}}))()}filterEvents(){this.filteredEvents=_.AddonCalendarHelper.getFilteredEvents(this.events,this.filter,this.categories)}refreshData(){var e=this;return(0,a.A)((function*(){const n=[];n.push(l.AddonCalendar.invalidateAllUpcomingEvents()),n.push(u.CoreCourses.invalidateCategories(0,!0)),n.push(l.AddonCalendar.invalidateLookAhead()),n.push(l.AddonCalendar.invalidateTimeFormat()),e.categoriesRetrieved=!1,yield Promise.all(n),yield e.fetchData()}))()}eventClicked(e){this.onEventClicked.emit(e.id)}mergeEvents(){if(!this.offlineEvents.length&&!this.deletedEvents.length)return this.onlineEvents;const e=p.j.timestamp(),n=e+Y.CoreConstants.SECONDS_DAY*this.lookAhead;let t=this.onlineEvents;this.deletedEvents.length&&t.forEach((e=>{e.deleted=-1!=this.deletedEvents.indexOf(e.id)})),this.offlineEvents.length&&(t=t.filter((e=>!this.offlineEvents.find((n=>n.id==e.id)))));const a=this.offlineEvents.filter((t=>(t.timestart>=e||t.timestart+t.timeduration>=e)&&t.timestart<=n));return t=t.concat(a),_.AddonCalendarHelper.sortEvents(t)}undeleteEvent(e){const n=this.onlineEvents.find((n=>n.id==e));n&&(n.deleted=!1)}ngOnDestroy(){var e;null===(e=this.undeleteEventObserver)||void 0===e||e.off()}}return(e=AddonCalendarUpcomingEventsComponent).ɵfac=function AddonCalendarUpcomingEventsComponent_Factory(n){return new(n||e)(h.rXU(h.MKu))},e.ɵcmp=h.VBU({type:e,selectors:[["addon-calendar-upcoming-events"]],inputs:{filter:"filter"},outputs:{onEventClicked:"onEventClicked"},standalone:!0,features:[h.aNF],decls:3,vars:3,consts:[[3,"hideUntil"],["icon","fas-calendar",3,"message",4,"ngIf"],["class","list-item-limited-width",4,"ngIf"],["icon","fas-calendar",3,"message"],[1,"list-item-limited-width"],[4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap","addon-calendar-event",3,"click","ngClass","detail"],["slot","start",3,"modicon","modname","componentId","showAlt","purpose","isBranded",4,"ngIf"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],[1,"item-heading"],[3,"text","contextLevel","contextInstanceId"],[3,"text","filter"],["slot","end",4,"ngIf"],["slot","start",3,"modicon","modname","componentId","showAlt","purpose","isBranded"],["slot","start","aria-hidden","true",3,"name"],["slot","end"],["name","fas-clock","aria-hidden","true"],[1,"ion-text-wrap"],["name","fas-trash","aria-hidden","true"]],template:function AddonCalendarUpcomingEventsComponent_Template(e,n){1&e&&(h.j41(0,"core-loading",0),h.DNE(1,AddonCalendarUpcomingEventsComponent_core_empty_box_1_Template,2,3,"core-empty-box",1)(2,AddonCalendarUpcomingEventsComponent_ion_list_2_Template,2,1,"ion-list",2),h.k0s()),2&e&&(h.Y8G("hideUntil",n.loaded),h.R7$(),h.Y8G("ngIf",!n.filteredEvents||!n.filteredEvents.length),h.R7$(),h.Y8G("ngIf",n.filteredEvents&&n.filteredEvents.length))},dependencies:[M.n,k.YU,k.Sq,k.bT,P.b_,P.iq,P.uz,P.he,P.nf,P.JI,U.h,x.R,B.I,F.t,J.B,G.D9],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color: var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical: 12px;--margin-end: 12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-inline-end:var(--margin-end)}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#10846c}"]}),AddonCalendarUpcomingEventsComponent})();var L=t(15324),X=t(93589),H=t(20871),z=t(21182),q=t(19858),Q=t(88246);const index_c0=e=>({$a:e});function AddonCalendarIndexPage_p_9_Template(e,n){1&e&&(h.j41(0,"p",16),h.EFF(1),h.nI1(2,"translate"),h.k0s()),2&e&&(h.R7$(),h.JRh(h.bMT(2,1,"addon.calendar.upcomingevents")))}function AddonCalendarIndexPage_core_context_menu_item_15_Template(e,n){if(1&e){const e=h.RV6();h.j41(0,"core-context-menu-item",17),h.nI1(1,"translate"),h.bIt("action",(function AddonCalendarIndexPage_core_context_menu_item_15_Template_core_context_menu_item_action_0_listener(){h.eBV(e);const n=h.XpG();return h.Njj(n.toggleDisplay())})),h.k0s()}2&e&&h.Y8G("priority",800)("content",h.bMT(1,2,"addon.calendar.upcomingevents"))}function AddonCalendarIndexPage_core_context_menu_item_16_Template(e,n){if(1&e){const e=h.RV6();h.j41(0,"core-context-menu-item",18),h.nI1(1,"translate"),h.bIt("action",(function AddonCalendarIndexPage_core_context_menu_item_16_Template_core_context_menu_item_action_0_listener(){h.eBV(e);const n=h.XpG();return h.Njj(n.toggleDisplay())})),h.k0s()}2&e&&h.Y8G("priority",800)("content",h.bMT(1,2,"addon.calendar.monthlyview"))}function AddonCalendarIndexPage_ion_card_26_Template(e,n){1&e&&(h.j41(0,"ion-card",19)(1,"ion-item"),h.nrm(2,"ion-icon",20),h.j41(3,"ion-label"),h.EFF(4),h.nI1(5,"translate"),h.nI1(6,"translate"),h.k0s()()()),2&e&&(h.R7$(4),h.JRh(h.i5U(6,3,"core.hasdatatosync",h.eq3(6,index_c0,h.bMT(5,1,"addon.calendar.calendar")))))}function AddonCalendarIndexPage_addon_calendar_upcoming_events_28_Template(e,n){if(1&e){const e=h.RV6();h.j41(0,"addon-calendar-upcoming-events",21),h.bIt("onEventClicked",(function AddonCalendarIndexPage_addon_calendar_upcoming_events_28_Template_addon_calendar_upcoming_events_onEventClicked_0_listener(n){h.eBV(e);const t=h.XpG();return h.Njj(t.gotoEvent(n))})),h.k0s()}if(2&e){const e=h.XpG();h.Y8G("hidden",e.showCalendar)("filter",e.filter)}}function AddonCalendarIndexPage_ion_fab_29_Template(e,n){if(1&e){const e=h.RV6();h.j41(0,"ion-fab",22)(1,"ion-fab-button",23),h.nI1(2,"translate"),h.bIt("click",(function AddonCalendarIndexPage_ion_fab_29_Template_ion_fab_button_click_1_listener(){h.eBV(e);const n=h.XpG();return h.Njj(n.openEdit())})),h.nrm(3,"ion-icon",24),h.j41(4,"span",25),h.EFF(5),h.nI1(6,"translate"),h.k0s()()()}2&e&&(h.R7$(),h.BMQ("aria-label",h.bMT(2,2,"addon.calendar.newevent")),h.R7$(4),h.JRh(h.bMT(6,4,"addon.calendar.newevent")))}let W=(()=>{var e;class AddonCalendarIndexPage{constructor(e){var n=this;this.route=e,this.initialized=!1,this.canCreate=!1,this.courses=[],this.loaded=!1,this.hasOffline=!1,this.isOnline=!1,this.syncIcon=Y.CoreConstants.ICON_LOADING,this.showCalendar=!0,this.loadUpcoming=!1,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=i.CoreSites.getCurrentSiteId(),this.newEventObserver=d.z.on(A.zl,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.discardedObserver=d.z.on(A.D1,(()=>{this.loaded=!1,this.refreshData(!0,!1,!0)}),this.currentSiteId),this.editEventObserver=d.z.on(A.bp,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.syncObserver=d.z.on(A.FK,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.manualSyncObserver=d.z.on(A.y$,(e=>{e&&"index"!=e.source&&(this.loaded=!1,this.refreshData(!1,!1,!0))}),this.currentSiteId),this.deleteEventObserver=d.z.on(A.Mq,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.undeleteEventObserver=d.z.on(A.hZ,(0,a.A)((function*(){n.hasOffline=yield s.AddonCalendarOffline.hasOfflineData()})),this.currentSiteId),this.filterChangedObserver=d.z.on(A.Jj,function(){var e=(0,a.A)((function*(e){n.filter=e,n.canCreate=yield _.AddonCalendarHelper.canEditEvents(n.filter.courseId)}));return function(n){return e.apply(this,arguments)}}()),this.onlineObserver=o.WE.onChange().subscribe((()=>{m.SK.run((()=>{this.isOnline=o.WE.isOnline()}))}))}ngOnInit(){var e=this;this.loadUpcoming=!!L.CoreNavigator.getRouteBooleanParam("upcoming"),this.showCalendar=!this.loadUpcoming,this.route.queryParams.subscribe((0,a.A)((function*(){e.filter.courseId=L.CoreNavigator.getRouteNumberParam("courseId"),e.year=L.CoreNavigator.getRouteNumberParam("year"),e.month=L.CoreNavigator.getRouteNumberParam("month"),e.filter.filtered=!!e.filter.courseId,e.fetchData(!0,!1),void 0!==e.year&&void 0!==e.month&&e.calendarComponent&&e.calendarComponent.viewMonth(e.month,e.year)}))),i.CoreSites.loginNavigationFinished()}fetchData(e,n){var t=this;return(0,a.A)((function*(){t.syncIcon=Y.CoreConstants.ICON_LOADING,t.isOnline=o.WE.isOnline();let a=!1;if(e)try{const e=yield c.AddonCalendarSync.syncEvents();e.warnings&&e.warnings.length&&O.CoreAlerts.show({message:e.warnings[0]}),e.updated&&(a=t.initialized,e.source="index",d.z.trigger(A.y$,e,t.currentSiteId))}catch(e){n&&O.CoreAlerts.showError(e,{default:m.HT.instant("core.errorsync")})}try{const e=[];t.hasOffline=!1,e.push(r.CoreCoursesHelper.getCoursesForPopover(t.filter.courseId).then((e=>{t.courses=e.courses}))),e.push(_.AddonCalendarHelper.canEditEvents(t.filter.courseId).then((e=>{t.canCreate=e}))),e.push(s.AddonCalendarOffline.hasOfflineData().then((e=>{t.hasOffline=e}))),a&&e.push(t.refreshComponentData(!0)),yield Promise.all(e)}catch(e){O.CoreAlerts.showError(e,{default:m.HT.instant("addon.calendar.errorloadevents")})}t.loaded=!0,t.initialized=!0,t.syncIcon=Y.CoreConstants.ICON_SYNC}))()}doRefresh(e,n,t){var o=this;return(0,a.A)((function*(){o.loaded&&(yield o.refreshData(!0,t).finally((()=>{null==e||e.complete(),n&&n()})))}))()}refreshData(e=!1,n=!1,t=!1){var o=this;return(0,a.A)((function*(){o.syncIcon=Y.CoreConstants.ICON_LOADING;const a=[];a.push(l.AddonCalendar.invalidateAllowedEventTypes()),a.push(o.refreshComponentData(t)),yield Promise.all(a).finally((()=>o.fetchData(e,n)))}))()}refreshComponentData(e=!1){var n=this;return(0,a.A)((function*(){var t,a;n.showCalendar?yield null===(t=n.calendarComponent)||void 0===t?void 0:t.refreshData(e):yield null===(a=n.upcomingEventsComponent)||void 0===a?void 0:a.refreshData()}))()}gotoEvent(e){L.CoreNavigator.navigateToSitePath(`/calendar/event/${e}`)}gotoDay(e){const n={day:e.day,month:e.month,year:e.year};Object.keys(this.filter).forEach((e=>{n[e]=this.filter[e]})),L.CoreNavigator.navigateToSitePath("/calendar/day",{params:n})}openFilter(){var e=this;return(0,a.A)((function*(){const{AddonCalendarFilterComponent:n}=yield t.e(45393).then(t.bind(t,45393));yield X.I.openSideModal({component:n,componentProps:{courses:e.courses,filter:e.filter}})}))()}openEdit(e){const n={};e=e||0,this.filter.courseId&&(n.courseId=this.filter.courseId),L.CoreNavigator.navigateToSitePath(`/calendar/edit/${e}`,{params:n})}openSettings(){L.CoreNavigator.navigateToSitePath("/calendar/calendar-settings")}toggleDisplay(){this.showCalendar=!this.showCalendar,this.showCalendar||(this.loadUpcoming=!0)}ngOnDestroy(){var e,n,t,a,o,d,i,r,l;null===(e=this.newEventObserver)||void 0===e||e.off(),null===(n=this.discardedObserver)||void 0===n||n.off(),null===(t=this.editEventObserver)||void 0===t||t.off(),null===(a=this.deleteEventObserver)||void 0===a||a.off(),null===(o=this.undeleteEventObserver)||void 0===o||o.off(),null===(d=this.syncObserver)||void 0===d||d.off(),null===(i=this.manualSyncObserver)||void 0===i||i.off(),null===(r=this.filterChangedObserver)||void 0===r||r.off(),null===(l=this.onlineObserver)||void 0===l||l.unsubscribe()}}return(e=AddonCalendarIndexPage).ɵfac=function AddonCalendarIndexPage_Factory(n){return new(n||e)(h.rXU(z.nX))},e.ɵcmp=h.VBU({type:e,selectors:[["page-addon-calendar-index"]],viewQuery:function AddonCalendarIndexPage_Query(e,n){if(1&e&&(h.GBs(N,5),h.GBs(V,5)),2&e){let e;h.mGM(e=h.lsd())&&(n.calendarComponent=e.first),h.mGM(e=h.lsd())&&(n.upcomingEventsComponent=e.first)}},standalone:!0,features:[h.aNF],decls:30,vars:35,consts:[["slot","start"],[3,"text"],["class","subheading",4,"ngIf"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-table-list",3,"priority","content","action",4,"ngIf"],["iconAction","fas-calendar-days",3,"priority","content","action",4,"ngIf"],["iconAction","fas-gears",3,"action","priority","content"],[3,"action","hidden","priority","content","iconAction","closeOnClick"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["class","core-warning-card",4,"ngIf"],[3,"onEventClicked","onDayClicked","hidden","initialYear","initialMonth","filter","displayNavButtons"],[3,"hidden","filter","onEventClicked",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],[1,"subheading"],["iconAction","fas-table-list",3,"action","priority","content"],["iconAction","fas-calendar-days",3,"action","priority","content"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"onEventClicked","hidden","filter"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonCalendarIndexPage_Template(e,n){1&e&&(h.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),h.nrm(3,"ion-back-button",1),h.nI1(4,"translate"),h.k0s(),h.j41(5,"ion-title")(6,"h1"),h.EFF(7),h.nI1(8,"translate"),h.k0s(),h.DNE(9,AddonCalendarIndexPage_p_9_Template,3,3,"p",2),h.k0s(),h.j41(10,"ion-buttons",3)(11,"ion-button",4),h.nI1(12,"translate"),h.bIt("click",(function AddonCalendarIndexPage_Template_ion_button_click_11_listener(){return n.openFilter()})),h.nrm(13,"ion-icon",5),h.k0s(),h.j41(14,"core-context-menu"),h.DNE(15,AddonCalendarIndexPage_core_context_menu_item_15_Template,2,4,"core-context-menu-item",6)(16,AddonCalendarIndexPage_core_context_menu_item_16_Template,2,4,"core-context-menu-item",7),h.j41(17,"core-context-menu-item",8),h.nI1(18,"translate"),h.bIt("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_17_listener(){return n.openSettings()})),h.k0s(),h.j41(19,"core-context-menu-item",9),h.nI1(20,"translate"),h.bIt("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_19_listener(e){return n.doRefresh(void 0,e,!0)})),h.k0s()(),h.nrm(21,"core-user-menu-button"),h.k0s()()(),h.j41(22,"ion-content")(23,"ion-refresher",10),h.bIt("ionRefresh",(function AddonCalendarIndexPage_Template_ion_refresher_ionRefresh_23_listener(e){return n.doRefresh(e.target)})),h.nrm(24,"ion-refresher-content",11),h.nI1(25,"translate"),h.k0s(),h.DNE(26,AddonCalendarIndexPage_ion_card_26_Template,7,8,"ion-card",12),h.j41(27,"addon-calendar-calendar",13),h.bIt("onEventClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onEventClicked_27_listener(e){return n.gotoEvent(e)}))("onDayClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onDayClicked_27_listener(e){return n.gotoDay(e)})),h.k0s(),h.DNE(28,AddonCalendarIndexPage_addon_calendar_upcoming_events_28_Template,1,2,"addon-calendar-upcoming-events",14)(29,AddonCalendarIndexPage_ion_fab_29_Template,7,6,"ion-fab",15),h.k0s()),2&e&&(h.R7$(3),h.Y8G("text",h.bMT(4,23,"core.back")),h.R7$(4),h.JRh(h.bMT(8,25,"addon.calendar.calendar")),h.R7$(2),h.Y8G("ngIf",!n.showCalendar),h.R7$(2),h.Y8G("ariaLabel",h.bMT(12,27,"core.filter")),h.R7$(4),h.Y8G("ngIf",n.showCalendar),h.R7$(),h.Y8G("ngIf",!n.showCalendar),h.R7$(),h.Y8G("priority",600)("content",h.bMT(18,29,"core.settings.settings")),h.R7$(2),h.Y8G("hidden",!n.loaded||!n.hasOffline||!n.isOnline)("priority",400)("content",h.bMT(20,31,"core.settings.synchronizenow"))("iconAction",n.syncIcon)("closeOnClick",!1),h.R7$(4),h.Y8G("disabled",!n.loaded),h.R7$(),h.FS9("pullingText",h.bMT(25,33,"core.pulltorefresh")),h.R7$(2),h.Y8G("ngIf",n.hasOffline),h.R7$(),h.Y8G("hidden",!n.showCalendar)("initialYear",n.year)("initialMonth",n.month)("filter",n.filter)("displayNavButtons",n.showCalendar),h.R7$(),h.Y8G("ngIf",n.loadUpcoming),h.R7$(),h.Y8G("ngIf",n.canCreate))},dependencies:[M.n,k.bT,P.Jm,P.QW,P.b_,P.W9,P.Q8,P.YW,P.eU,P.iq,P.uz,P.he,P.To,P.Ki,P.BC,P.ai,P.el,T.B,w.Q,q.A,F.t,Q.i,D.T,G.D9,N,V,H.U],encapsulation:2}),AddonCalendarIndexPage})()},58866:(e,n,t)=>{t.d(n,{i:()=>CoreItemsManagerSource});class CoreItemsManagerSource{constructor(){this.items=null,this.listeners=[],this.dirty=!1,this.loaded=!1,this.loadedPromise=new Promise((e=>this.resolveLoaded=e))}isDirty(){return this.dirty}isLoaded(){return this.loaded}waitForLoaded(){return this.loadedPromise}setLoaded(){this.loaded=!0,this.resolveLoaded()}setDirty(e){this.dirty=e}getItems(){return this.items}reset(){this.items=null,this.dirty=!1,this.loaded=!1,this.listeners.forEach((e=>{var n;return null===(n=e.onReset)||void 0===n?void 0:n.call(e)}))}addListener(e){return this.listeners.push(e),()=>this.removeListener(e)}removeListener(e){const n=this.listeners.indexOf(e);-1!==n&&this.listeners.splice(n,1)}setItems(e){this.items=e,this.setLoaded(),this.notifyItemsUpdated()}notifyItemsUpdated(){this.listeners.forEach((e=>{var n;return null===(n=e.onItemsUpdated)||void 0===n?void 0:n.call(e,this.items)}))}}},42022:(e,n,t)=>{t.d(n,{f:()=>CoreItemsManager});var a=t(29306);class CoreItemsManager{constructor(e){this.itemsMap=null,this.selectedItem=null,this.listeners=[],this.setSource(e)}getSource(){if(!this.source)throw new a.CoreSilentError("Source is missing from items manager");return this.source.instance}setSource(e){if(this.source&&(this.source.unsubscribe(),delete this.source,this.onSourceReset()),e){this.source={instance:e,unsubscribe:e.addListener({onItemsUpdated:e=>this.onSourceItemsUpdated(e),onReset:()=>this.onSourceReset()})};const n=e.getItems();n&&this.onSourceItemsUpdated(n)}}destroy(){this.setSource(null)}getSelectedItem(){return this.selectedItem}setSelectedItem(e){e!==this.selectedItem&&(this.selectedItem=e,this.listeners.forEach((n=>{var t;return null===(t=n.onSelectedItemUpdated)||void 0===t?void 0:t.call(n,e)})))}addListener(e){return this.listeners.push(e),()=>this.removeListener(e)}removeListener(e){const n=this.listeners.indexOf(e);-1!==n&&this.listeners.splice(n,1)}onSourceItemsUpdated(e){this.itemsMap=e.reduce(((e,n)=>(e[this.getItemId(n)]=n,e)),{})}onSourceReset(){this.itemsMap=null,this.selectedItem=null}getItemById(e){var n,t;return null!==(n=null===(t=this.itemsMap)||void 0===t?void 0:t[e])&&void 0!==n?n:null}}}}]);