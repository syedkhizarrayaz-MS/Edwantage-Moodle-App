"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[42399],{42399:(e,s,n)=>{n.r(s),n.d(s,{default:()=>X});var t=n(10467),o=n(2910),i=n(49882),r=n(52749),a=n(20728),c=n(47050),d=n(59534),l=n(98870),g=n(55554),u=n(6787),m=n(66198),h=n(89377),f=n(94339),_=n(75629),M=n(79555),v=n(15324),b=n(74431),p=n(82907),I=n(44426),C=n(75383),y=n(53794),A=n(93589),P=n(33014),k=n(40152),w=n(25572),T=n(86654),D=n(54438),R=n(21182),O=n(60177),E=n(69502),x=n(17388),G=n(16986),F=n(64422),$=n(28042),S=n(13988),N=n(85122),j=n(16658),L=n(10892),q=n(19858),B=n(86198),U=n(58197),Y=n(88246),H=n(43570),z=n(73955),V=n(59528);const _c0=e=>({$a:e});function AddonMessagesDiscussionPage_img_7_Template(e,s){if(1&e&&D.nrm(0,"img",25),2&e){const e=D.XpG();D.Y8G("url",e.conversationImage)("siteId",e.siteId)}}function AddonMessagesDiscussionPage_core_user_avatar_8_Template(e,s){if(1&e&&D.nrm(0,"core-user-avatar",26),2&e){const e=D.XpG();D.Y8G("user",e.otherMember)("linkProfile",!1)("checkOnline",e.otherMember.showonlinestatus)}}function AddonMessagesDiscussionPage_ion_icon_10_Template(e,s){1&e&&(D.nrm(0,"ion-icon",27),D.nI1(1,"translate")),2&e&&D.BMQ("aria-label",D.bMT(1,1,"core.favourites"))}function AddonMessagesDiscussionPage_ion_icon_11_Template(e,s){1&e&&(D.nrm(0,"ion-icon",28),D.nI1(1,"translate")),2&e&&D.BMQ("aria-label",D.bMT(1,1,"addon.messages.mutedconversation"))}function AddonMessagesDiscussionPage_ng_container_43_Template(e,s){1&e&&(D.qex(0),D.j41(1,"p",29),D.EFF(2),D.nI1(3,"translate"),D.k0s(),D.j41(4,"p",29)(5,"em"),D.EFF(6),D.nI1(7,"translate"),D.k0s()(),D.bVm()),2&e&&(D.R7$(2),D.JRh(D.bMT(3,2,"addon.messages.selfconversation")),D.R7$(4),D.JRh(D.bMT(7,4,"addon.messages.selfconversationdefaultmessage")))}function AddonMessagesDiscussionPage_ng_container_47_h3_1_Template(e,s){if(1&e&&(D.j41(0,"h3",33),D.EFF(1),D.nI1(2,"coreFormatDate"),D.k0s()),2&e){const e=D.XpG().$implicit;D.R7$(),D.SpI(" ",D.i5U(2,1,e.timecreated,"strftimedayshort")," ")}}function AddonMessagesDiscussionPage_ng_container_47_ion_chip_2_Template(e,s){1&e&&(D.j41(0,"ion-chip",34)(1,"ion-label"),D.EFF(2),D.nI1(3,"translate"),D.k0s(),D.nrm(4,"ion-icon",35),D.k0s()),2&e&&(D.R7$(2),D.JRh(D.bMT(3,1,"addon.messages.newmessages")))}function AddonMessagesDiscussionPage_ng_container_47_Template(e,s){if(1&e){const e=D.RV6();D.qex(0),D.DNE(1,AddonMessagesDiscussionPage_ng_container_47_h3_1_Template,3,4,"h3",30)(2,AddonMessagesDiscussionPage_ng_container_47_ion_chip_2_Template,5,3,"ion-chip",31),D.j41(3,"core-message",32),D.bIt("afterRender",(function AddonMessagesDiscussionPage_ng_container_47_Template_core_message_afterRender_3_listener(){const s=D.eBV(e).last,n=D.XpG();return D.Njj(s&&n.scrollToBottom())}))("onDeleteMessage",(function AddonMessagesDiscussionPage_ng_container_47_Template_core_message_onDeleteMessage_3_listener(){const s=D.eBV(e),n=s.$implicit,t=s.index,o=D.XpG();return D.Njj(o.deleteMessage(n,t))})),D.k0s(),D.bVm()}if(2&e){const e=s.$implicit,n=D.XpG();D.R7$(),D.Y8G("ngIf",e.showDate),D.R7$(),D.Y8G("ngIf",n.unreadMessageFrom>0&&e.id===n.unreadMessageFrom),D.R7$(),D.Y8G("message",e)("user",n.members[e.useridfrom])("text",e.text)("showDelete",n.showDelete)("time",e.timecreated)}}function AddonMessagesDiscussionPage_core_empty_box_48_Template(e,s){1&e&&(D.nrm(0,"core-empty-box",36),D.nI1(1,"translate")),2&e&&D.Y8G("message",D.bMT(1,1,"addon.messages.nomessagesfound"))}function AddonMessagesDiscussionPage_ion_fab_49_Template(e,s){if(1&e){const e=D.RV6();D.j41(0,"ion-fab",37)(1,"ion-fab-button",38),D.nI1(2,"translate"),D.bIt("click",(function AddonMessagesDiscussionPage_ion_fab_49_Template_ion_fab_button_click_1_listener(){D.eBV(e);const s=D.XpG();return D.Njj(s.scrollToFirstUnreadMessage())})),D.nrm(3,"ion-icon",35),D.j41(4,"span",19),D.EFF(5),D.nI1(6,"translate"),D.k0s()(),D.j41(7,"ion-badge",39),D.EFF(8),D.k0s()()}if(2&e){const e=D.XpG();D.R7$(),D.BMQ("aria-label",D.bMT(2,3,"addon.messages.newmessages")),D.R7$(4),D.JRh(D.bMT(6,5,"addon.messages.newmessages")),D.R7$(3),D.JRh(e.newMessages)}}function AddonMessagesDiscussionPage_ion_footer_50_p_2_Template(e,s){1&e&&(D.j41(0,"p",45),D.EFF(1),D.nI1(2,"translate"),D.k0s()),2&e&&(D.R7$(),D.SpI(" ",D.bMT(2,1,"addon.messages.unabletomessage")," "))}function AddonMessagesDiscussionPage_ion_footer_50_div_3_Template(e,s){if(1&e){const e=D.RV6();D.j41(0,"div",46)(1,"p",29),D.EFF(2),D.nI1(3,"translate"),D.k0s(),D.j41(4,"ion-button",47),D.bIt("click",(function AddonMessagesDiscussionPage_ion_footer_50_div_3_Template_ion_button_click_4_listener(){D.eBV(e);const s=D.XpG(2);return D.Njj(s.unblockUser())})),D.EFF(5),D.nI1(6,"translate"),D.k0s()()}2&e&&(D.R7$(2),D.JRh(D.bMT(3,2,"addon.messages.youhaveblockeduser")),D.R7$(3),D.SpI(" ",D.bMT(6,4,"addon.messages.unblockuser")," "))}function AddonMessagesDiscussionPage_ion_footer_50_div_4_Template(e,s){if(1&e){const e=D.RV6();D.j41(0,"div",46)(1,"p",29)(2,"strong"),D.EFF(3),D.nI1(4,"translate"),D.k0s()(),D.j41(5,"p",29),D.EFF(6),D.nI1(7,"translate"),D.k0s(),D.j41(8,"ion-button",47),D.bIt("click",(function AddonMessagesDiscussionPage_ion_footer_50_div_4_Template_ion_button_click_8_listener(){D.eBV(e);const s=D.XpG(2);return D.Njj(s.createContactRequest())})),D.EFF(9),D.nI1(10,"translate"),D.k0s()()}if(2&e){const e=D.XpG(2);D.R7$(3),D.JRh(D.i5U(4,3,"addon.messages.isnotinyourcontacts",D.eq3(11,_c0,e.otherMember.fullname))),D.R7$(3),D.JRh(D.i5U(7,6,"addon.messages.requirecontacttomessage",D.eq3(13,_c0,e.otherMember.fullname))),D.R7$(3),D.SpI(" ",D.bMT(10,9,"addon.messages.sendcontactrequest")," ")}}function AddonMessagesDiscussionPage_ion_footer_50_div_5_Template(e,s){if(1&e){const e=D.RV6();D.j41(0,"div",46)(1,"p",29),D.EFF(2),D.nI1(3,"translate"),D.k0s(),D.j41(4,"ion-button",47),D.bIt("click",(function AddonMessagesDiscussionPage_ion_footer_50_div_5_Template_ion_button_click_4_listener(){D.eBV(e);const s=D.XpG(2);return D.Njj(s.confirmContactRequest())})),D.EFF(5),D.nI1(6,"translate"),D.k0s(),D.j41(7,"ion-button",48),D.bIt("click",(function AddonMessagesDiscussionPage_ion_footer_50_div_5_Template_ion_button_click_7_listener(){D.eBV(e);const s=D.XpG(2);return D.Njj(s.declineContactRequest())})),D.EFF(8),D.nI1(9,"translate"),D.k0s()()}if(2&e){const e=D.XpG(2);D.R7$(2),D.JRh(D.i5U(3,3,"addon.messages.userwouldliketocontactyou",D.eq3(10,_c0,e.otherMember.fullname))),D.R7$(3),D.SpI(" ",D.bMT(6,6,"addon.messages.acceptandaddcontact")," "),D.R7$(3),D.SpI(" ",D.bMT(9,8,"addon.messages.decline")," ")}}function AddonMessagesDiscussionPage_ion_footer_50_div_6_p_5_Template(e,s){if(1&e&&(D.j41(0,"p",29),D.EFF(1),D.nI1(2,"translate"),D.k0s()),2&e){const e=D.XpG(3);D.R7$(),D.SpI(" ",D.i5U(2,1,"addon.messages.yourcontactrequestpending",D.eq3(4,_c0,e.otherMember.fullname))," ")}}function AddonMessagesDiscussionPage_ion_footer_50_div_6_Template(e,s){if(1&e&&(D.j41(0,"div",46)(1,"p",29)(2,"strong"),D.EFF(3),D.nI1(4,"translate"),D.k0s()(),D.DNE(5,AddonMessagesDiscussionPage_ion_footer_50_div_6_p_5_Template,3,6,"p",49),D.k0s()),2&e){const e=D.XpG(2);D.R7$(3),D.JRh(D.bMT(4,2,"addon.messages.contactrequestsent")),D.R7$(2),D.Y8G("ngIf",e.otherMember)}}function AddonMessagesDiscussionPage_ion_footer_50_core_send_message_form_7_Template(e,s){if(1&e){const e=D.RV6();D.j41(0,"core-send-message-form",50),D.nI1(1,"translate"),D.bIt("onSubmit",(function AddonMessagesDiscussionPage_ion_footer_50_core_send_message_form_7_Template_core_send_message_form_onSubmit_0_listener(s){D.eBV(e);const n=D.XpG(2);return D.Njj(n.sendMessage(s))})),D.k0s()}if(2&e){const e=D.XpG(2);D.Y8G("showKeyboard",e.showKeyboard)("placeholder",D.bMT(1,2,"addon.messages.newmessage"))}}function AddonMessagesDiscussionPage_ion_footer_50_Template(e,s){if(1&e&&(D.j41(0,"ion-footer",40)(1,"ion-toolbar",41),D.DNE(2,AddonMessagesDiscussionPage_ion_footer_50_p_2_Template,3,3,"p",42)(3,AddonMessagesDiscussionPage_ion_footer_50_div_3_Template,7,6,"div",43)(4,AddonMessagesDiscussionPage_ion_footer_50_div_4_Template,11,15,"div",43)(5,AddonMessagesDiscussionPage_ion_footer_50_div_5_Template,10,12,"div",43)(6,AddonMessagesDiscussionPage_ion_footer_50_div_6_Template,6,4,"div",43)(7,AddonMessagesDiscussionPage_ion_footer_50_core_send_message_form_7_Template,2,4,"core-send-message-form",44),D.k0s()()),2&e){const e=D.XpG();D.R7$(),D.Y8G("color","message"===e.footerType?null:"light"),D.R7$(),D.Y8G("ngIf","unable"===e.footerType),D.R7$(),D.Y8G("ngIf","blocked"===e.footerType),D.R7$(),D.Y8G("ngIf","requiresContact"===e.footerType&&e.otherMember),D.R7$(),D.Y8G("ngIf","requestReceived"===e.footerType&&e.otherMember),D.R7$(),D.Y8G("ngIf","requestSent"===e.footerType||"message"===e.footerType&&e.requestContactSent),D.R7$(),D.Y8G("ngIf","message"===e.footerType)}}let X=(()=>{var e;class AddonMessagesDiscussionPage{constructor(e,s){this.route=e,this.elementRef=s,this.fetching=!1,this.messagesBeingSent=0,this.pagesLoaded=1,this.keepMessageMap={},this.oldContentHeight=0,this.scrollBottom=!0,this.viewDestroyed=!1,this.showLoadingModal=!1,this.showInfo=!1,this.loaded=!1,this.showKeyboard=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.messages=[],this.showDelete=!1,this.canDelete=!1,this.isGroup=!1,this.members={},this.favouriteIcon="fas-star",this.deleteIcon="fas-trash",this.blockIcon="fas-user-lock",this.addRemoveIcon="fas-user-plus",this.muteIcon="fas-bell-slash",this.muteEnabled=!1,this.footerType="unable",this.requestContactSent=!1,this.requestContactReceived=!1,this.isSelf=!1,this.newMessages=0,this.unreadMessageFrom=0,this.initialized=!1,this.hostElement=s.nativeElement,this.siteId=r.CoreSites.getCurrentSiteId(),this.currentUserId=r.CoreSites.getCurrentSiteUserId(),this.groupMessagingEnabled=a.AddonMessages.isGroupMessagingEnabled(),this.muteEnabled=a.AddonMessages.isMuteConversationEnabled(),this.logger=u.CoreLogger.getInstance("AddonMessagesDiscussionPage"),this.syncObserver=i.z.on(k.HA,(e=>{(e.userId&&e.userId==this.userId||e.conversationId&&e.conversationId==this.conversationId)&&(this.fetchMessages(),e.warnings&&e.warnings[0]&&w.CoreAlerts.show({message:e.warnings[0]}))}),this.siteId),this.memberInfoObserver=i.z.on(k.Ie,(e=>{e.userId&&(this.members[e.userId]||this.otherMember&&e.userId==this.otherMember.id)&&this.fetchData()}),this.siteId)}ngOnInit(){var e=this;return(0,t.A)((function*(){e.conversationId=v.CoreNavigator.getRouteNumberParam("conversationId"),e.userId=v.CoreNavigator.getRouteNumberParam("userId"),e.showInfo=!v.CoreNavigator.getRouteBooleanParam("hideInfo"),e.showKeyboard=!!v.CoreNavigator.getRouteBooleanParam("showKeyboard"),yield e.fetchData(),e.scrollToBottom(!0)}))()}ngAfterViewInit(){var e=this;return(0,t.A)((function*(){var s;e.scrollElement=yield null===(s=e.content)||void 0===s?void 0:s.getScrollElement()}))()}addMessage(e,s=!0){e.hash=h.V.hashAsciiStr(String(("id"in e?e.id:"")||e.text||""))+"#"+e.timecreated+"#"+e.useridfrom;let n=!1;return void 0===this.keepMessageMap[e.hash]&&(this.messages.push(e),n=e.useridfrom!=this.currentUserId),this.keepMessageMap[e.hash]=s,n}removeMessage(e){if(this.keepMessageMap[e])return this.keepMessageMap[e]=!1,void 0;delete this.keepMessageMap[e];const s=this.messages.findIndex((s=>s.hash==e));s>=0&&this.messages.splice(s,1)}fetchData(){var e=this;return(0,t.A)((function*(){let s;e.showLoadingModal&&(s=yield P.CoreLoadings.show()),!e.groupMessagingEnabled&&e.userId&&l.CoreUser.getProfile(e.userId,void 0,!0).then((s=>{e.title||(e.title=s.fullname),e.conversationImage=s.profileimageurl,e.members[s.id]=s})).catch((()=>{}));try{const s=yield d.AddonMessagesSync.syncDiscussion(e.conversationId,e.userId);s.warnings&&s.warnings[0]&&w.CoreAlerts.show({message:s.warnings[0]})}catch{}try{const s=[];if(e.groupMessagingEnabled){const n=yield e.getConversation(e.conversationId,e.userId);if(n&&s.push(e.fetchMessages()),e.userId){const o=e.userId;s.push(a.AddonMessages.invalidateMemberInfo(e.userId).then((0,t.A)((function*(){e.otherMember=yield a.AddonMessages.getMemberInfo(o),!n&&e.otherMember&&(e.conversationImage=e.otherMember.profileimageurl,e.title=e.otherMember.fullname),e.blockIcon=e.otherMember.isblocked?"fas-user-check":"fas-user-lock"}))))}else e.otherMember=void 0}else{if(e.userId){const n=e.userId;s.push(l.CoreUser.getProfile(e.userId).then(function(){var s=(0,t.A)((function*(s){e.otherMember={id:s.id,fullname:s.fullname,profileurl:"",profileimageurl:s.profileimageurl||"",profileimageurlsmall:s.profileimageurlsmall||"",isonline:!1,showonlinestatus:!1,isblocked:!1,iscontact:!1,isdeleted:!1,canmessageevenifblocked:!0,canmessage:!0,requirescontact:!1},e.otherMember.isblocked=yield a.AddonMessages.isBlocked(n),e.otherMember.iscontact=yield a.AddonMessages.isContact(n),e.blockIcon=e.otherMember.isblocked?"fas-user-check":"fas-user-lock"}));return function(e){return s.apply(this,arguments)}}()))}s.push(e.fetchMessages().then((()=>{if(!e.title&&e.messages.length){const s=e.messages[0];"usertofullname"in s&&(e.title=s.useridto!=e.currentUserId?s.usertofullname||"":s.userfromfullname||"")}})))}yield Promise.all(s)}catch(e){w.CoreAlerts.showError(e,{default:M.HT.instant("addon.messages.errorwhileretrievingmessages")})}finally{e.checkCanDelete(),e.loaded=!0,e.setPolling(),e.setContactRequestInfo(),e.setFooterType(),s&&s.dismiss()}}))()}ionViewDidEnter(){this.setPolling()}ionViewWillLeave(){this.unsetPolling()}fetchMessages(e=!0){var s=this;return(0,t.A)((function*(){if(s.loadMoreError=!1,!(s.messagesBeingSent>0||s.fetching)){if(s.groupMessagingEnabled&&!s.conversationId)throw new _.CoreError("No enough data provided to fetch messages");if(s.conversationId)s.logger.debug(`Polling new messages for conversation '${s.conversationId}'`);else{if(!s.userId)throw new _.CoreError("No enough data provided to fetch messages");s.logger.debug(`Polling new messages for discussion with user '${s.userId}'`)}s.fetching=!0;try{yield d.AddonMessagesSync.waitForSyncConversation(s.conversationId,s.userId);let n=[];s.groupMessagingEnabled?(yield a.AddonMessages.invalidateConversationMessages(s.conversationId),n=yield s.getConversationMessages(s.pagesLoaded)):(yield a.AddonMessages.invalidateDiscussionCache(s.userId),n=yield s.getDiscussionMessages(s.pagesLoaded)),s.loadMessages(n,e)}finally{s.fetching=!1}}}))()}loadMessages(e,s=!0){if(this.viewDestroyed)return;if(this.scrollBottom=p.y.scrollIsBottom(this.scrollElement,5),this.messagesBeingSent>0)return;const n=e.reduce(((e,s)=>e+(this.addMessage(s)?1:0)),0);s&&this.setNewMessagesBadge(this.newMessages+n);for(const e in this.keepMessageMap)this.removeMessage(e);a.AddonMessages.sortMessages(this.messages),this.messages.forEach(((e,s)=>{e.showDate=this.showDate(e,this.messages[s-1]),e.showUserData=this.showUserData(e,this.messages[s-1]),e.showTail=this.showTail(e,this.messages[s+1])}));const t=this.messages[this.messages.length-1],o=this.groupMessagingEnabled&&t&&t.useridfrom!==this.currentUserId&&!!this.lastMessage&&(t.text!==this.lastMessage.text||t.timecreated!==this.lastMessage.timecreated);this.notifyNewMessage(),this.markMessagesAsRead(o)}setNewMessagesBadge(e){0==this.newMessages&&e>0&&this.scrollFunction(),this.newMessages=e}scrollFunction(){var e;if(0==this.newMessages)return;if(p.y.scrollIsBottom(this.scrollElement,40))return this.setNewMessagesBadge(0),void 0;const s=null===(e=this.scrollElement)||void 0===e?void 0:e.getBoundingClientRect(),n=s&&s.bottom||0;if(0==n)return;const t=Array.from(this.hostElement.querySelectorAll("core-message:not(.is-mine)")).slice(-this.newMessages).reverse().findIndex((e=>{const s=e.getBoundingClientRect();return!!s&&s.bottom<=n}));t>0&&t<this.newMessages&&this.setNewMessagesBadge(t)}getConversation(e,s){var n=this;return(0,t.A)((function*(){let t;if(!e&&s)try{t=s===n.currentUserId&&a.AddonMessages.isSelfConversationEnabled()?yield a.AddonMessages.getSelfConversation():yield a.AddonMessages.getConversationBetweenUsers(s,void 0,!0),e=t.id}catch(e){n.isSelf=s===n.currentUserId;const t=yield c.AddonMessagesOffline.getMessages(s);if(t&&t.length)t.forEach((e=>{e.pending=!0,e.text=e.smallmessage})),n.loadMessages(t);else if("errorconversationdoesnotexist"!=e.errorcode)throw e;return!1}if(!e)return!1;yield a.AddonMessages.invalidateConversation(e);try{n.conversation=yield a.AddonMessages.getConversation(e,void 0,!0)}catch(e){if(!t)throw e;n.conversation=t}return!!n.conversation&&(n.conversationId=n.conversation.id,n.title=n.conversation.name,n.conversationImage=n.conversation.imageurl,n.isGroup=2===n.conversation.type,n.favouriteIcon="fas-star",n.muteIcon=n.conversation.ismuted?"fas-bell":"fas-bell-slash",n.isGroup||(n.userId=n.conversation.userid),n.isSelf=3===n.conversation.type,!0)}))()}getConversationMessages(e,s=0){var n=this;return(0,t.A)((function*(){if(!n.conversationId)return[];const t=s>0,o=yield a.AddonMessages.getConversationMessages(n.conversationId,{excludePending:t,limitFrom:s});e--,o.members&&o.members.forEach((e=>{n.members[e.id]=e}));const i=o.messages;if(e>0&&o.canLoadMore){s+=k.nq;const t=yield n.getConversationMessages(e,s);return i.concat(t)}return n.canLoadMore=!!o.canLoadMore,i}))()}getDiscussionMessages(e,s=0,n=0,o=0,i=0){var r=this;return(0,t.A)((function*(){const t=s>0||n>0||o>0||i>0,c=yield a.AddonMessages.getDiscussion(r.userId,t,s,n,o,i);if(--e>0&&c.canLoadMore){c.messages.forEach((e=>{!e.pending&&"read"in e&&(e.useridfrom==r.userId?e.read?n++:s++:e.read?i++:o++)}));const t=yield r.getDiscussionMessages(e,s,n,o,i);return c.messages.concat(t)}return r.canLoadMore=c.canLoadMore,c.messages}))()}markMessagesAsRead(e){var s=this;return(0,t.A)((function*(){let n=!1,t=!1;if(e)t=!0;else if(s.groupMessagingEnabled){var o,r;t=!!(null!==(o=s.conversation)&&void 0!==o&&o.unreadcount&&(null===(r=s.conversation)||void 0===r?void 0:r.unreadcount)>0&&s.conversationId&&s.conversationId>0)}else t=s.messages.some((e=>e.useridfrom!=s.currentUserId&&"read"in e&&!e.read));t&&(s.setUnreadLabelPosition(),s.groupMessagingEnabled?yield a.AddonMessages.markAllConversationMessagesRead(s.conversationId):(yield a.AddonMessages.markAllMessagesRead(s.userId),s.messages.forEach((e=>{"read"in e&&(e.read=!0)}))),n=!0),n&&i.z.trigger(k.j_,{conversationId:s.conversationId,userId:s.userId},s.siteId)}))()}notifyNewMessage(){var e,s;const n=this.messages[this.messages.length-1];let t=!1;if(n?n.text===(null===(e=this.lastMessage)||void 0===e?void 0:e.text)&&n.timecreated===(null===(s=this.lastMessage)||void 0===s?void 0:s.timecreated)||(this.lastMessage={text:n.text||"",timecreated:n.timecreated},t=!0):(this.lastMessage=void 0,t=!0),t){var o,r,a,c,d;i.z.trigger(k.cj,{conversationId:this.conversationId,userId:this.userId,message:null===(o=this.lastMessage)||void 0===o?void 0:o.text,timecreated:null!==(r=null===(a=this.lastMessage)||void 0===a?void 0:a.timecreated)&&void 0!==r?r:0,userFrom:null!=n&&n.useridfrom?this.members[n.useridfrom]:void 0,isfavourite:!(null===(c=this.conversation)||void 0===c||!c.isfavourite),type:null===(d=this.conversation)||void 0===d?void 0:d.type},this.siteId);this.canDelete!=(n&&"id"in n&&n.id&&1==this.messages.length||this.messages.length>1)&&this.checkCanDelete()}}setUnreadLabelPosition(){if(0==this.unreadMessageFrom){if(this.groupMessagingEnabled){var e,s;if(this.conversation&&null!==(e=this.conversation)&&void 0!==e&&e.unreadcount&&(null===(s=this.conversation)||void 0===s?void 0:s.unreadcount)>0&&this.messages){let e=0;for(let s=this.messages.length-1;s>=0;s--){const n=this.messages[s];if(!n.pending&&n.useridfrom!=this.currentUserId&&"id"in n&&(e++,e==this.conversation.unreadcount)){this.unreadMessageFrom=Number(n.id);break}}}}else{let e=!1;for(const s in this.messages){const n=this.messages[s];if(n.useridfrom!=this.currentUserId&&"read"in n){if(!n.read&&e){this.unreadMessageFrom=Number(n.id);break}e=!!n.read}}}0==this.unreadMessageFrom&&(this.unreadMessageFrom=-1)}}checkCanDelete(){const e=this.messages[0];this.canDelete=e&&!e.sending}hideUnreadLabel(){this.unreadMessageFrom>0&&(this.unreadMessageFrom=-1)}waitForFetch(){var e=this;return(0,t.A)((function*(){e.fetching&&(yield y.H.wait(400),yield g.g.ignoreErrors(e.waitForFetch()))}))()}setPolling(){this.groupMessagingEnabled&&!this.conversationId||this.polling||(this.polling=window.setInterval((()=>{this.fetchMessages().catch((()=>{}))}),k.ib))}unsetPolling(){this.polling&&(this.logger.debug(`Cancelling polling for conversation with user '${this.userId}'`),clearInterval(this.polling),this.polling=void 0)}copyMessage(e){C.Ni.copyToClipboard(C.Ni.decodeHTMLEntities("smallmessage"in e?e.smallmessage||e.text||"":e.text||""))}deleteMessage(e,s){var n=this;return(0,t.A)((function*(){const t=n.conversation&&n.conversation.candeletemessagesforallusers,o=e.pending||t||n.isSelf?"core.areyousure":"addon.messages.deletemessageconfirmation",i={};t&&!e.pending&&(i.inputs=[{type:"checkbox",name:"deleteforall",checked:!1,value:!0,label:M.HT.instant("addon.messages.deleteforeveryone")}]);try{const t=yield w.CoreAlerts.confirm(M.HT.instant(o),i),r=yield P.CoreLoadings.show("core.deleting",!0);try{yield a.AddonMessages.deleteMessage(e,t&&t[0]),n.messages.splice(s,1),n.removeMessage(e.hash),n.notifyNewMessage(),n.fetchMessages()}finally{r.dismiss()}}catch(e){w.CoreAlerts.showError(e,{default:M.HT.instant("addon.messages.errordeletemessage")})}}))()}loadPrevious(e){var s=this;return(0,t.A)((function*(){var n,t;if(!s.initialized)return e&&e(),void 0;let o=(null===(n=s.infinite)||void 0===n?void 0:n.hostElement.getBoundingClientRect().height)||0;const i=(null===(t=s.scrollElement)||void 0===t?void 0:t.scrollHeight)||0;try{yield s.waitForFetch()}finally{s.pagesLoaded++;try{var r,a;yield s.fetchMessages(!1);const e=i-((null===(r=s.scrollElement)||void 0===r?void 0:r.scrollTop)||0),n=(null===(a=s.infinite)||void 0===a?void 0:a.hostElement.getBoundingClientRect().height)||0;s.canLoadMore&&o&&s.infinite?o-=n:s.canLoadMore||(o=o||n),s.keepScroll(i,e,o)}catch(e){s.loadMoreError=!0,s.pagesLoaded--,w.CoreAlerts.showError(e,{default:M.HT.instant("addon.messages.errorwhileretrievingmessages")})}finally{e&&e()}}}))()}keepScroll(e,s,n,t=0){setTimeout((()=>{var o;if(((null===(o=this.scrollElement)||void 0===o?void 0:o.scrollHeight)||0)==e)return t<=10&&this.keepScroll(e,s,n,t+1),void 0;setTimeout((()=>{var e;const t=(null===(e=this.scrollElement)||void 0===e?void 0:e.scrollHeight)||0;this.content.scrollToPoint(0,t-s+n,0)}),30)}),30)}scrollToBottom(e=!1){var s=this;return(0,t.A)((function*(){(s.scrollBottom||e)&&(s.scrollBottom=!1,s.setNewMessagesBadge(0),yield y.H.nextTicks(5),!s.viewDestroyed&&s.content&&s.content.scrollToBottom(0),e&&(s.initialized=!0))}))()}scrollToFirstUnreadMessage(){if(this.newMessages>0){const e=Array.from(this.hostElement.querySelectorAll("core-message:not(.is-mine)"));p.y.scrollToElement(e[e.length-this.newMessages])}}sendMessage(e){var s=this;return(0,t.A)((function*(){s.hideUnreadLabel(),s.showDelete=!1,s.scrollBottom=!0,s.setNewMessagesBadge(0);const n={id:-1,pending:!0,sending:!0,useridfrom:s.currentUserId,smallmessage:e,text:e,timecreated:Date.now()};n.showDate=s.showDate(n,s.messages[s.messages.length-1]),s.addMessage(n,!1),s.messagesBeingSent++;try{yield s.waitForFetch()}finally{try{let t;t=s.conversationId?yield a.AddonMessages.sendMessageToConversation(s.conversation,e):yield a.AddonMessages.sendMessage(s.userId,e),s.messagesBeingSent--;let o=!1;if(t.sent)try{if(!s.conversationId&&t.message&&"conversationid"in t.message){yield s.getConversation(t.message.conversationid,s.userId);try{yield s.fetchMessages()}finally{s.setPolling()}}else yield s.fetchMessages()}catch{o=!0}!o&&t.sent||(n.sending=!1,t.sent?n.pending=!1:t.message&&(n.timecreated=t.message.timecreated||0),s.notifyNewMessage())}catch(e){s.messagesBeingSent--,I.p.close(),w.CoreAlerts.showError(e,{default:M.HT.instant("addon.messages.messagenotsent")}),s.removeMessage(n.hash)}}}))()}showDate(e,s){return!s||!(0,f.yf)(e.timecreated).isSame(s.timecreated,"day")}showUserData(e,s){return this.isGroup&&e.useridfrom!=this.currentUserId&&this.members[e.useridfrom||0]&&(!s||s.useridfrom!=e.useridfrom||!!e.showDate)}showTail(e,s){return!s||s.useridfrom!=e.useridfrom||!!s.showDate}viewInfo(){var e=this;return(0,t.A)((function*(){if(e.isGroup){const{AddonMessagesConversationInfoComponent:s}=yield n.e(21401).then(n.bind(n,21401)),t=yield A.I.openSideModal({component:s,componentProps:{conversationId:e.conversationId}});if(void 0!==t){v.CoreNavigator.isCurrentPathInTablet("**/messages/**/discussion/**")?i.z.trigger(k.mO,{userId:t},e.siteId):v.CoreNavigator.navigateToSitePath(`/messages/discussion/user/${t}`)}}else v.CoreNavigator.navigateToSitePath("/user/profile",{params:{userId:e.userId}})}))()}changeFavourite(e){var s=this;return(0,t.A)((function*(){if(s.conversation){s.favouriteIcon=b.CoreConstants.ICON_LOADING;try{yield a.AddonMessages.setFavouriteConversation(s.conversation.id,!s.conversation.isfavourite),s.conversation.isfavourite=!s.conversation.isfavourite,a.AddonMessages.getConversation(s.conversation.id,void 0,!0),i.z.trigger(k.I2,{conversationId:s.conversation.id,action:"favourite",value:s.conversation.isfavourite},s.siteId)}catch(e){w.CoreAlerts.showError(e,{default:"Error changing favourite state."})}finally{s.favouriteIcon="fas-star",e&&e()}}}))()}changeMute(e){var s=this;return(0,t.A)((function*(){if(s.conversation){s.muteIcon=b.CoreConstants.ICON_LOADING;try{yield a.AddonMessages.muteConversation(s.conversation.id,!s.conversation.ismuted),s.conversation.ismuted=!s.conversation.ismuted,a.AddonMessages.getConversation(s.conversation.id,void 0,!0),i.z.trigger(k.I2,{conversationId:s.conversation.id,action:"mute",value:s.conversation.ismuted},s.siteId)}catch(e){w.CoreAlerts.showError(e,{default:"Error changing muted state."})}finally{s.muteIcon=s.conversation.ismuted?"fas-bell":"fas-bell-slash",e&&e()}}}))()}setContactRequestInfo(){var e,s;(this.requestContactSent=!1,this.requestContactReceived=!1,this.otherMember&&!this.otherMember.iscontact)&&(this.requestContactSent=!(null===(e=this.otherMember.contactrequests)||void 0===e||!e.some((e=>e.userid==this.currentUserId&&e.requesteduserid==this.otherMember.id))),this.requestContactReceived=!(null===(s=this.otherMember.contactrequests)||void 0===s||!s.some((e=>e.userid==this.otherMember.id&&e.requesteduserid==this.currentUserId))))}setFooterType(){this.footerType=this.otherMember?this.otherMember.isblocked?"blocked":this.requestContactReceived?"requestReceived":this.otherMember.canmessage?"message":this.requestContactSent?"requestSent":this.otherMember.requirescontact?"requiresContact":"unable":"message"}blockUser(){var e=this;return(0,t.A)((function*(){if(!e.otherMember)throw new _.CoreError("No member selected to be blocked.");if(e.otherMember.canmessageevenifblocked)return w.CoreAlerts.showError(M.HT.instant("addon.messages.cantblockuser",{$a:e.otherMember.fullname})),void 0;try{yield w.CoreAlerts.confirm(M.HT.instant("addon.messages.blockuserconfirm",{$a:e.otherMember.fullname}),{okText:M.HT.instant("addon.messages.blockuser")}),e.blockIcon=b.CoreConstants.ICON_LOADING;const s=yield P.CoreLoadings.show("core.sending",!0);e.showLoadingModal=!0;try{try{yield a.AddonMessages.blockContact(e.otherMember.id)}finally{s.dismiss(),e.showLoadingModal=!1}}catch(e){w.CoreAlerts.showError(e,{default:M.HT.instant("core.error")})}finally{e.blockIcon=e.otherMember.isblocked?"fas-user-check":"fas-user-lock"}}catch{}}))()}deleteConversation(e){var s=this;return(0,t.A)((function*(){if(!s.conversation)return;const n="addon.messages."+(s.isSelf?"deleteallselfconfirm":"deleteallconfirm");try{yield w.CoreAlerts.confirmDelete(M.HT.instant(n)),s.deleteIcon=b.CoreConstants.ICON_LOADING;try{try{yield a.AddonMessages.deleteConversation(s.conversation.id),i.z.trigger(k.I2,{conversationId:s.conversation.id,action:"delete"},s.siteId),s.messages=[]}finally{e&&e()}}catch(e){w.CoreAlerts.showError(e,{default:"Error deleting conversation."})}finally{s.deleteIcon="fas-trash"}}catch{}}))()}unblockUser(){var e=this;return(0,t.A)((function*(){if(!e.otherMember)throw new _.CoreError("No member selected to be unblocked.");try{yield w.CoreAlerts.confirm(M.HT.instant("addon.messages.unblockuserconfirm",{$a:e.otherMember.fullname}),{okText:M.HT.instant("addon.messages.unblockuser")}),e.blockIcon=b.CoreConstants.ICON_LOADING;const s=yield P.CoreLoadings.show("core.sending",!0);e.showLoadingModal=!0;try{try{yield a.AddonMessages.unblockContact(e.otherMember.id)}finally{s.dismiss(),e.showLoadingModal=!1}}catch(e){w.CoreAlerts.showError(e,{default:M.HT.instant("core.error")})}finally{e.blockIcon=e.otherMember.isblocked?"fas-user-check":"fas-user-lock"}}catch{}}))()}createContactRequest(){var e=this;return(0,t.A)((function*(){if(!e.otherMember)throw new _.CoreError("No member selected to be requested.");try{yield w.CoreAlerts.confirm(M.HT.instant("addon.messages.addcontactconfirm",{$a:e.otherMember.fullname}),{okText:M.HT.instant("core.add")}),e.addRemoveIcon=b.CoreConstants.ICON_LOADING;const s=yield P.CoreLoadings.show("core.sending",!0);e.showLoadingModal=!0;try{try{yield a.AddonMessages.createContactRequest(e.otherMember.id)}finally{s.dismiss(),e.showLoadingModal=!1}}catch(e){w.CoreAlerts.showError(e,{default:M.HT.instant("core.error")})}finally{e.addRemoveIcon="fas-user-plus"}}catch{}}))()}confirmContactRequest(){var e=this;return(0,t.A)((function*(){if(!e.otherMember)throw new _.CoreError("No member selected to be confirmed.");const s=yield P.CoreLoadings.show("core.sending",!0);e.showLoadingModal=!0;try{try{yield a.AddonMessages.confirmContactRequest(e.otherMember.id)}finally{s.dismiss(),e.showLoadingModal=!1}}catch(e){w.CoreAlerts.showError(e,{default:M.HT.instant("core.error")})}}))()}declineContactRequest(){var e=this;return(0,t.A)((function*(){if(!e.otherMember)throw new _.CoreError("No member selected to be declined.");const s=yield P.CoreLoadings.show("core.sending",!0);e.showLoadingModal=!0;try{try{yield a.AddonMessages.declineContactRequest(e.otherMember.id)}finally{s.dismiss(),e.showLoadingModal=!1}}catch(e){w.CoreAlerts.showError(e,{default:M.HT.instant("core.error")})}}))()}removeContact(){var e=this;return(0,t.A)((function*(){if(!e.otherMember)throw new _.CoreError("No member selected to be removed.");try{yield w.CoreAlerts.confirm(M.HT.instant("addon.messages.removecontactconfirm",{$a:e.otherMember.fullname}),{okText:M.HT.instant("core.remove")}),e.addRemoveIcon=b.CoreConstants.ICON_LOADING;const s=yield P.CoreLoadings.show("core.sending",!0);e.showLoadingModal=!0;try{try{yield a.AddonMessages.removeContact(e.otherMember.id)}finally{s.dismiss(),e.showLoadingModal=!1}}catch(e){w.CoreAlerts.showError(e,{default:M.HT.instant("core.error")})}finally{e.addRemoveIcon="fas-user-plus"}}catch{}}))()}ngOnDestroy(){var e,s;this.unsetPolling(),null===(e=this.syncObserver)||void 0===e||e.off(),null===(s=this.memberInfoObserver)||void 0===s||s.off(),this.viewDestroyed=!0}}return(e=AddonMessagesDiscussionPage).ɵfac=function AddonMessagesDiscussionPage_Factory(s){return new(s||e)(D.rXU(R.nX),D.rXU(D.aKT))},e.ɵcmp=D.VBU({type:e,selectors:[["page-addon-messages-discussion"]],viewQuery:function AddonMessagesDiscussionPage_Query(e,s){if(1&e&&(D.GBs(o.W9,5),D.GBs(m.b,5)),2&e){let e;D.mGM(e=D.lsd())&&(s.content=e.first),D.mGM(e=D.lsd())&&(s.infinite=e.first)}},standalone:!0,features:[D.aNF],decls:51,vars:102,consts:[["slot","start"],[3,"text"],["class","core-bar-button-image","alt","","onError","this.src='assets/img/group-avatar.svg'","core-external-content","","role","presentation",3,"url","siteId",4,"ngIf"],["class","core-bar-button-image",3,"user","linkProfile","checkOnline",4,"ngIf"],["contextLevel","system",3,"text","contextInstanceId","wsNotFiltered"],["name","fas-star",4,"ngIf"],["name","fas-bell-slash",4,"ngIf"],["slot","end"],["iconAction","fas-circle-info",3,"action","hidden","priority","content"],[3,"action","hidden","priority","closeOnClick","content","iconAction"],[3,"action","hidden","priority","closeOnClick","content","iconAction","iconSlash"],[3,"action","hidden","priority","content","iconAction"],["iconAction","toggle",3,"toggleChange","hidden","priority","content","toggle"],[3,"action","hidden","priority","content","closeOnClick","iconAction"],[3,"action","hidden","priority","content","iconAction","iconSlash"],[3,"ionScroll"],["placeholderType","column","placeholderHeight","36px",3,"hideUntil"],["position","top",3,"action","enabled","error"],[4,"ngIf"],[1,"sr-only"],[1,"addon-messages-discussion-container"],[4,"ngFor","ngForOf"],["icon","far-comments",3,"message",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["class","footer-adjustable",4,"ngIf"],["alt","","onError","this.src='assets/img/group-avatar.svg'","core-external-content","","role","presentation",1,"core-bar-button-image",3,"url","siteId"],[1,"core-bar-button-image",3,"user","linkProfile","checkOnline"],["name","fas-star"],["name","fas-bell-slash"],[1,"ion-text-center"],["class","ion-text-center addon-messages-date",4,"ngIf"],["class","addon-messages-unreadfrom",4,"ngIf"],[3,"afterRender","onDeleteMessage","message","user","text","showDelete","time"],[1,"ion-text-center","addon-messages-date"],[1,"addon-messages-unreadfrom"],["name","fas-arrow-down","aria-hidden","true"],["icon","far-comments",3,"message"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],["size","small","color","light",3,"click"],[1,"core-discussion-messages-badge"],[1,"footer-adjustable"],[3,"color"],["class","ion-text-center ion-margin-horizontal",4,"ngIf"],["class","ion-padding-horizontal",4,"ngIf"],[3,"showKeyboard","placeholder","onSubmit",4,"ngIf"],[1,"ion-text-center","ion-margin-horizontal"],[1,"ion-padding-horizontal"],["expand","block",1,"ion-text-wrap","ion-margin-bottom",3,"click"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin-bottom",3,"click"],["class","ion-text-center",4,"ngIf"],[3,"onSubmit","showKeyboard","placeholder"]],template:function AddonMessagesDiscussionPage_Template(e,s){1&e&&(D.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),D.nrm(3,"ion-back-button",1),D.nI1(4,"translate"),D.k0s(),D.j41(5,"ion-title")(6,"h1"),D.DNE(7,AddonMessagesDiscussionPage_img_7_Template,1,2,"img",2)(8,AddonMessagesDiscussionPage_core_user_avatar_8_Template,1,3,"core-user-avatar",3),D.nrm(9,"core-format-text",4),D.DNE(10,AddonMessagesDiscussionPage_ion_icon_10_Template,2,3,"ion-icon",5)(11,AddonMessagesDiscussionPage_ion_icon_11_Template,2,3,"ion-icon",6),D.k0s()(),D.nrm(12,"ion-buttons",7),D.k0s(),D.j41(13,"core-navbar-buttons",7)(14,"core-context-menu"),D.nI1(15,"translate"),D.j41(16,"core-context-menu-item",8),D.nI1(17,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_16_listener(){return s.viewInfo()})),D.k0s(),D.j41(18,"core-context-menu-item",8),D.nI1(19,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_18_listener(){return s.viewInfo()})),D.k0s(),D.j41(20,"core-context-menu-item",9),D.nI1(21,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_20_listener(e){return s.changeFavourite(e)})),D.k0s(),D.j41(22,"core-context-menu-item",10),D.nI1(23,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_22_listener(e){return s.changeFavourite(e)})),D.k0s(),D.j41(24,"core-context-menu-item",11),D.nI1(25,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_24_listener(){return s.blockUser()})),D.k0s(),D.j41(26,"core-context-menu-item",11),D.nI1(27,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_26_listener(){return s.unblockUser()})),D.k0s(),D.j41(28,"core-context-menu-item",9),D.nI1(29,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_28_listener(e){return s.changeMute(e)})),D.k0s(),D.j41(30,"core-context-menu-item",9),D.nI1(31,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_30_listener(e){return s.changeMute(e)})),D.k0s(),D.j41(32,"core-context-menu-item",12),D.nI1(33,"translate"),D.mxI("toggleChange",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_toggleChange_32_listener(e){return D.DH7(s.showDelete,e)||(s.showDelete=e),e})),D.k0s(),D.j41(34,"core-context-menu-item",13),D.nI1(35,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_34_listener(e){return s.deleteConversation(e)})),D.k0s(),D.j41(36,"core-context-menu-item",11),D.nI1(37,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_36_listener(){return s.createContactRequest()})),D.k0s(),D.j41(38,"core-context-menu-item",14),D.nI1(39,"translate"),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_38_listener(){return s.removeContact()})),D.k0s()()()(),D.j41(40,"ion-content",15),D.bIt("ionScroll",(function AddonMessagesDiscussionPage_Template_ion_content_ionScroll_40_listener(){return s.scrollFunction()})),D.j41(41,"core-loading",16)(42,"core-infinite-loading",17),D.bIt("action",(function AddonMessagesDiscussionPage_Template_core_infinite_loading_action_42_listener(e){return s.loadPrevious(e)})),D.k0s(),D.DNE(43,AddonMessagesDiscussionPage_ng_container_43_Template,8,6,"ng-container",18),D.j41(44,"h2",19),D.EFF(45),D.k0s(),D.j41(46,"ion-list",20),D.DNE(47,AddonMessagesDiscussionPage_ng_container_47_Template,4,7,"ng-container",21),D.k0s(),D.DNE(48,AddonMessagesDiscussionPage_core_empty_box_48_Template,2,3,"core-empty-box",22),D.k0s(),D.DNE(49,AddonMessagesDiscussionPage_ion_fab_49_Template,9,7,"ion-fab",23),D.k0s(),D.DNE(50,AddonMessagesDiscussionPage_ion_footer_50_Template,8,7,"ion-footer",24)),2&e&&(D.R7$(3),D.Y8G("text",D.bMT(4,74,"core.back")),D.R7$(4),D.Y8G("ngIf",s.loaded&&!s.otherMember&&s.conversationImage),D.R7$(),D.Y8G("ngIf",s.loaded&&s.otherMember),D.R7$(),D.Y8G("text",s.title)("contextInstanceId",0)("wsNotFiltered",!0),D.R7$(),D.Y8G("ngIf",s.conversation&&s.conversation.isfavourite),D.R7$(),D.Y8G("ngIf",s.conversation&&s.conversation.ismuted),D.R7$(3),D.BMQ("aria-label",D.bMT(15,76,"addon.messages.conversationactions")),D.R7$(2),D.Y8G("hidden",s.isSelf||!s.showInfo||s.isGroup)("priority",1e3)("content",D.bMT(17,78,"addon.messages.info")),D.R7$(2),D.Y8G("hidden",s.isSelf||!s.showInfo||!s.isGroup)("priority",1e3)("content",D.bMT(19,80,"addon.messages.groupinfo")),D.R7$(2),D.Y8G("hidden",!s.groupMessagingEnabled||!s.conversation||s.conversation.isfavourite)("priority",800)("closeOnClick",!1)("content",D.bMT(21,82,"addon.messages.addtofavourites"))("iconAction",s.favouriteIcon),D.R7$(2),D.Y8G("hidden",!s.groupMessagingEnabled||!s.conversation||!s.conversation.isfavourite)("priority",800)("closeOnClick",!1)("content",D.bMT(23,84,"addon.messages.removefromfavourites"))("iconAction",s.favouriteIcon)("iconSlash",!0),D.R7$(2),D.Y8G("hidden",s.isSelf||!s.otherMember||s.otherMember.isblocked)("priority",700)("content",D.bMT(25,86,"addon.messages.blockuser"))("iconAction",s.blockIcon),D.R7$(2),D.Y8G("hidden",s.isSelf||!s.otherMember||!s.otherMember.isblocked)("priority",700)("content",D.bMT(27,88,"addon.messages.unblockuser"))("iconAction",s.blockIcon),D.R7$(2),D.Y8G("hidden",s.isSelf||!s.muteEnabled||!s.conversation||s.conversation.ismuted)("priority",600)("closeOnClick",!1)("content",D.bMT(29,90,"addon.messages.muteconversation"))("iconAction",s.muteIcon),D.R7$(2),D.Y8G("hidden",s.isSelf||!s.muteEnabled||!s.conversation||!s.conversation.ismuted)("priority",600)("closeOnClick",!1)("content",D.bMT(31,92,"addon.messages.unmuteconversation"))("iconAction",s.muteIcon),D.R7$(2),D.Y8G("hidden",!s.canDelete||!s.messages||!s.messages.length)("priority",400)("content",D.bMT(33,94,"addon.messages.showdeletemessages")),D.R50("toggle",s.showDelete),D.R7$(2),D.Y8G("hidden",!s.groupMessagingEnabled||!s.conversationId||s.isGroup||!s.messages||!s.messages.length)("priority",200)("content",D.bMT(35,96,"addon.messages.deleteconversation"))("closeOnClick",!1)("iconAction",s.deleteIcon),D.R7$(2),D.Y8G("hidden",s.isSelf||!s.otherMember||s.otherMember.iscontact||s.requestContactSent||s.requestContactReceived)("priority",100)("content",D.bMT(37,98,"addon.messages.addtoyourcontacts"))("iconAction",s.addRemoveIcon),D.R7$(2),D.Y8G("hidden",s.isSelf||!s.otherMember||!s.otherMember.iscontact)("priority",100)("content",D.bMT(39,100,"addon.messages.removefromyourcontacts"))("iconAction",s.addRemoveIcon)("iconSlash",!0),D.R7$(3),D.Y8G("hideUntil",s.loaded),D.R7$(),D.Y8G("enabled",s.canLoadMore)("error",s.loadMoreError),D.R7$(),D.Y8G("ngIf",s.isSelf&&!s.canLoadMore),D.R7$(2),D.JRh(s.title),D.R7$(),D.AVh("addon-messages-discussion-group",s.isGroup),D.BMQ("aria-live","polite"),D.R7$(),D.Y8G("ngForOf",s.messages),D.R7$(),D.Y8G("ngIf",!s.messages||s.messages.length<=0),D.R7$(),D.Y8G("ngIf",s.loaded&&s.newMessages>0),D.R7$(),D.Y8G("ngIf",s.loaded&&(!s.conversationId||s.conversation)))},dependencies:[T.n,O.Sq,O.bT,o.In,o.Jm,o.QW,o.ZB,o.W9,o.Q8,o.YW,o.M0,o.eU,o.iq,o.he,o.nf,o.BC,o.ai,o.el,E.B,x.Q,G.h,m.b,F.R,$.A,S.c,N.u,j.T,L.l,q.A,B.t,U.B,Y.i,H.T,z.D9,V.f],styles:[".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0px}ion-content[_ngcontent-%COMP%]{--content-background: var(--background-alternative);--background: var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}ion-content[_ngcontent-%COMP%]   core-empty-box[_ngcontent-%COMP%]{--core-empty-box-icon-color: var(--dark)}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}","[_nghost-%COMP%]   .addon-messages-unreadfrom[_ngcontent-%COMP%]{color:var(--primary);background-color:transparent;margin-top:6px;margin-left:auto;margin-right:auto}[_nghost-%COMP%]   .addon-messages-unreadfrom[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--primary);background-color:transparent}[_nghost-%COMP%]   .has-fab[_ngcontent-%COMP%]   .scroll-content[_ngcontent-%COMP%]{padding-bottom:0}[_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{position:absolute;color:var(--addon-messages-discussion-badge-text);background-color:var(--addon-messages-discussion-badge);display:block;top:0}@supports (inset-inline-start: 0){[_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{inset-inline-end:0px}}@supports not (inset-inline-start: 0){[_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{right:0}[dir=rtl][_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{left:unset;right:unset;left:0}@supports selector(:dir(rtl)){[_nghost-%COMP%]:dir(rtl)   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{left:unset;right:unset;left:0}}}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{padding:0}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .core-bar-button-image[_ngcontent-%COMP%]{--userpicture-padding: 4px;margin-inline-end:6px}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   img.core-bar-button-image[_ngcontent-%COMP%]{padding:var(--userpicture-padding);width:var(--core-header-toolbar-button-image-size);height:var(--core-header-toolbar-button-image-size);max-width:var(--core-header-toolbar-button-image-size);max-height:var(--core-header-toolbar-button-image-size);border-radius:var(--core-avatar-radius);display:block}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex-shrink:1;display:block}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:6px}.ios[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .ios   [_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{justify-content:center}"]}),AddonMessagesDiscussionPage})()}}]);