"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[80801],{18735:(e,t,o)=>{o.r(t),o.d(t,{default:()=>O});var n=o(10467),r=o(75629),i=o(62198),s=o(1602),a=o(55306),d=o(44682),l=o(8979),c=o(41094),u=o(94455),m=o(15324),g=o(49588),h=o(55554),p=o(79555),_=o(79313),v=o(22693),I=o(8014),C=o(492),f=o(93589),b=o(25572),k=o(25367),M=o(86654),T=o(54438),y=o(60177),A=o(2910),S=o(64422),B=o(46036),P=o(86198),R=o(58197),w=o(66731),x=o(88246),E=o(43570),L=o(61307),N=o(73955);function AddonModBookContentsPage_ion_button_9_Template(e,t){if(1&e){const e=T.RV6();T.j41(0,"ion-button",11),T.nI1(1,"translate"),T.bIt("click",(function AddonModBookContentsPage_ion_button_9_Template_ion_button_click_0_listener(){T.eBV(e);const t=T.XpG();return T.Njj(t.showToc())})),T.nrm(2,"ion-icon",12),T.k0s()}2&e&&T.Y8G("ariaLabel",T.bMT(1,1,"addon.mod_book.toc"))}function AddonModBookContentsPage_ng_template_17_div_2_Template(e,t){if(1&e&&(T.j41(0,"div",16)(1,"strong"),T.EFF(2),T.nI1(3,"translate"),T.k0s(),T.nrm(4,"core-tag-list",17),T.k0s()),2&e){const e=T.XpG().item;T.R7$(2),T.SpI("",T.bMT(3,2,"core.tag.tags"),": "),T.R7$(2),T.Y8G("tags",e.tags)}}function AddonModBookContentsPage_ng_template_17_Template(e,t){if(1&e&&(T.j41(0,"div",13),T.nrm(1,"core-format-text",14),T.DNE(2,AddonModBookContentsPage_ng_template_17_div_2_Template,5,4,"div",15),T.k0s()),2&e){const e=t.item,o=t.active,n=T.XpG();T.R7$(),T.Y8G("component",n.component)("componentId",n.cmId)("text",e.content)("contextInstanceId",n.cmId)("courseId",n.courseId)("disabled",!o),T.R7$(),T.Y8G("ngIf",(null==e.tags?null:e.tags.length)>0)}}function AddonModBookContentsPage_core_navigation_bar_18_Template(e,t){if(1&e){const e=T.RV6();T.j41(0,"core-navigation-bar",18),T.bIt("action",(function AddonModBookContentsPage_core_navigation_bar_18_Template_core_navigation_bar_action_0_listener(t){T.eBV(e);const o=T.XpG();return T.Njj(o.changeChapter(t.id))})),T.k0s()}if(2&e){const e=T.XpG();T.Y8G("items",e.navigationItems)}}let O=(()=>{var e;class AddonModBookContentsPage{constructor(){this.title="",this.component=C.Gn,this.displayNavBar=!0,this.navigationItems=[],this.swiperOpts={autoHeight:!0,observer:!0,observeParents:!0,scrollOnChange:"top"},this.loaded=!1}ngOnInit(){try{this.cmId=m.CoreNavigator.getRequiredRouteNumberParam("cmId"),this.courseId=m.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.initialChapterId=m.CoreNavigator.getRouteNumberParam("chapterId")}catch(e){return b.CoreAlerts.showError(e),m.CoreNavigator.back(),void 0}const e=new AddonModBookSlidesItemsManagerSource(this.courseId,this.cmId,c.CoreTag.areTagsAvailableInSite(),this.initialChapterId);this.manager=new i.N(e),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onChapterViewed(e.id)}}),this.fetchContent()}get module(){var e;return null===(e=this.manager)||void 0===e?void 0:e.getSource().module}get book(){var e;return null===(e=this.manager)||void 0===e?void 0:e.getSource().book}get chapters(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().chapters)||[]}fetchContent(e=!1){var t=this;return(0,n.A)((function*(){try{var o;const n=null===(o=t.manager)||void 0===o?void 0:o.getSource();if(!n)return;const{book:r}=yield n.loadBookData();t.displayNavBar=0!=r.navstyle,t.title=r.name,yield n.loadContents(e),yield n.load()}catch(e){b.CoreAlerts.showError(e,{default:p.HT.instant("core.course.errorgetmodule")})}finally{t.loaded=!0}}))()}changeChapter(e){var t;e&&(null===(t=this.swipeSlidesComponent)||void 0===t||t.slideToItem({id:e}))}doRefresh(e){var t=this;return(0,n.A)((function*(){t.manager&&(yield h.g.ignoreErrors(Promise.all([t.manager.getSource().invalidateContent(),l.CoreCourseModulePrefetchDelegate.invalidateCourseUpdates(t.courseId)]))),yield h.g.ignoreErrors(t.fetchContent(!0)),null==e||e.complete()}))()}showToc(){var e=this;return(0,n.A)((function*(){var t;const n=null===(t=e.manager)||void 0===t?void 0:t.getSelectedItem(),{AddonModBookTocComponent:r}=yield o.e(9213).then(o.bind(o,9213)),i=yield f.I.openSideModal({component:r,componentProps:{moduleId:e.cmId,chapters:e.chapters,selected:null==n?void 0:n.id,courseId:e.courseId,book:e.book}});i&&e.changeChapter(i)}))()}onChapterViewed(e){var t=this;return(0,n.A)((function*(){if(t.displayNavBar&&(t.navigationItems=t.getNavigationItems(e)),t.book&&_.A.storeLastChapterViewed(t.book.id,e,t.courseId),!t.module)return;yield h.g.ignoreErrors(_.A.logView(t.module.instance,e)),v.OF.logEvent({type:v.qr.VIEW_ITEM,ws:"mod_book_view_book",name:t.module.name,data:{id:t.module.instance,category:C.Iu,chapterid:e},url:I.F.addParamsToUrl(`/mod/book/view.php?id=${t.module.id}`,{chapterid:e})});const o=t.chapters.findIndex((t=>t.id==e));(o<0||void 0===t.chapters[o+1])&&d.CoreCourse.checkModuleCompletion(t.courseId,t.module.completiondata)}))()}getNavigationItems(e){return this.chapters.map((t=>({item:t,title:t.title,current:t.id==e,enabled:!0})))}ngOnDestroy(){var e,t;null===(e=this.manager)||void 0===e||e.destroy(),null===(t=this.managerUnsubscribe)||void 0===t||t.call(this),delete this.manager}}return(e=AddonModBookContentsPage).ɵfac=function AddonModBookContentsPage_Factory(t){return new(t||e)},e.ɵcmp=T.VBU({type:e,selectors:[["page-addon-mod-book-contents"]],viewQuery:function AddonModBookContentsPage_Query(e,t){if(1&e&&T.GBs(a.N,5),2&e){let e;T.mGM(e=T.lsd())&&(t.swipeSlidesComponent=e.first)}},standalone:!0,features:[T.aNF],decls:19,vars:15,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["aria-haspopup","true",3,"ariaLabel","click",4,"ngIf"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[1,"safe-area-padding-horizontal","core-swipe-slides-container"],[3,"manager","options"],["collapsible-footer","","appearOnBottom","","previousTranslate","addon.mod_book.navprevtitle","nextTranslate","addon.mod_book.navnexttitle","slot","fixed",3,"items","action",4,"ngIf"],["aria-haspopup","true",3,"click","ariaLabel"],["name","fas-list-ul","slot","icon-only","aria-hidden","true"],["core-reading-mode","",1,"ion-padding"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId","disabled"],["class","ion-margin-top",4,"ngIf"],[1,"ion-margin-top"],[3,"tags"],["collapsible-footer","","appearOnBottom","","previousTranslate","addon.mod_book.navprevtitle","nextTranslate","addon.mod_book.navnexttitle","slot","fixed",3,"action","items"]],template:function AddonModBookContentsPage_Template(e,t){1&e&&(T.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),T.nrm(3,"ion-back-button",1),T.nI1(4,"translate"),T.k0s(),T.j41(5,"ion-title")(6,"h1"),T.nrm(7,"core-format-text",2),T.k0s()(),T.j41(8,"ion-buttons",3),T.DNE(9,AddonModBookContentsPage_ion_button_9_Template,3,3,"ion-button",4),T.k0s()()(),T.j41(10,"ion-content")(11,"ion-refresher",5),T.bIt("ionRefresh",(function AddonModBookContentsPage_Template_ion_refresher_ionRefresh_11_listener(e){return t.doRefresh(e.target)})),T.nrm(12,"ion-refresher-content",6),T.nI1(13,"translate"),T.k0s(),T.j41(14,"core-loading",7)(15,"div",8)(16,"core-swipe-slides",9),T.DNE(17,AddonModBookContentsPage_ng_template_17_Template,3,7,"ng-template"),T.k0s()()(),T.DNE(18,AddonModBookContentsPage_core_navigation_bar_18_Template,1,1,"core-navigation-bar",10),T.k0s()),2&e&&(T.R7$(3),T.Y8G("text",T.bMT(4,11,"core.back")),T.R7$(4),T.Y8G("text",t.title)("contextInstanceId",t.cmId)("courseId",t.courseId),T.R7$(2),T.Y8G("ngIf",t.loaded),T.R7$(2),T.Y8G("disabled",!t.loaded),T.R7$(),T.FS9("pullingText",T.bMT(13,13,"core.pulltorefresh")),T.R7$(2),T.Y8G("hideUntil",t.loaded),T.R7$(2),T.Y8G("manager",t.manager)("options",t.swiperOpts),T.R7$(2),T.Y8G("ngIf",t.loaded&&t.displayNavBar&&t.navigationItems.length>1))},dependencies:[M.n,y.bT,A.Jm,A.QW,A.W9,A.eU,A.iq,A.To,A.Ki,A.BC,A.ai,A.el,S.R,B.o,a.N,P.t,R.B,w.i,x.i,E.T,L.O,N.D9,k.v],styles:["[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{flex:none}[_nghost-%COMP%]   .has-collapsible-footer[_ngcontent-%COMP%]     swiper-container::part(container){padding-bottom:50px}"]}),AddonModBookContentsPage})();class AddonModBookSlidesItemsManagerSource extends s.O{constructor(e,t,o,n){super(n?{id:n}:void 0),this.chapters=[],this.contentsMap={},this.COURSE_ID=e,this.CM_ID=t,this.TAGS_ENABLED=o}getItemId(e){return e.id}loadBookData(){var e=this;return(0,n.A)((function*(){if(e.module=yield d.CoreCourse.getModule(e.CM_ID,e.COURSE_ID),e.book=yield _.A.getBook(e.COURSE_ID,e.CM_ID),!e.initialItem){const t=yield _.A.getLastChapterViewed(e.book.id);t&&(e.initialItem={id:t})}return{module:e.module,book:e.book}}))()}loadContents(e=!1){var t=this;return(0,n.A)((function*(){if(!t.module)return;const o=yield t.getModuleContents(e);t.contentsMap=_.A.getContentsMap(o),t.chapters=_.A.getTocList(o)}))()}getModuleContents(e=!1){var t=this;return(0,n.A)((function*(){if(!t.module)return[];const o=e&&u.WE.isOnline();try{return yield d.CoreCourse.getModuleContents(t.module,t.COURSE_ID,void 0,!1,o)}catch(e){if(o&&!t.module.contents)return yield d.CoreCourse.getModuleContents(t.module);if(!t.module.contents)throw e;return t.module.contents}}))()}loadItems(){var e=this;return(0,n.A)((function*(){try{const t=yield Promise.all(e.chapters.map(function(){var t=(0,n.A)((function*(t){const o=yield _.A.getChapterContent(e.contentsMap,t.id,e.CM_ID);return{id:t.id,content:o,tags:e.TAGS_ENABLED?e.contentsMap[t.id].tags:[]}}));return function(e){return t.apply(this,arguments)}}()));return t}catch(e){if(!g.CoreErrorHelper.getErrorMessageFromError(e))throw new r.CoreError(p.HT.instant("addon.mod_book.errorchapter"));throw e}}))()}invalidateContent(){return _.A.invalidateContent(this.CM_ID,this.COURSE_ID)}}},58866:(e,t,o)=>{o.d(t,{i:()=>CoreItemsManagerSource});class CoreItemsManagerSource{constructor(){this.items=null,this.listeners=[],this.dirty=!1,this.loaded=!1,this.loadedPromise=new Promise((e=>this.resolveLoaded=e))}isDirty(){return this.dirty}isLoaded(){return this.loaded}waitForLoaded(){return this.loadedPromise}setLoaded(){this.loaded=!0,this.resolveLoaded()}setDirty(e){this.dirty=e}getItems(){return this.items}reset(){this.items=null,this.dirty=!1,this.loaded=!1,this.listeners.forEach((e=>{var t;return null===(t=e.onReset)||void 0===t?void 0:t.call(e)}))}addListener(e){return this.listeners.push(e),()=>this.removeListener(e)}removeListener(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}setItems(e){this.items=e,this.setLoaded(),this.notifyItemsUpdated()}notifyItemsUpdated(){this.listeners.forEach((e=>{var t;return null===(t=e.onItemsUpdated)||void 0===t?void 0:t.call(e,this.items)}))}}},42022:(e,t,o)=>{o.d(t,{f:()=>CoreItemsManager});var n=o(29306);class CoreItemsManager{constructor(e){this.itemsMap=null,this.selectedItem=null,this.listeners=[],this.setSource(e)}getSource(){if(!this.source)throw new n.CoreSilentError("Source is missing from items manager");return this.source.instance}setSource(e){if(this.source&&(this.source.unsubscribe(),delete this.source,this.onSourceReset()),e){this.source={instance:e,unsubscribe:e.addListener({onItemsUpdated:e=>this.onSourceItemsUpdated(e),onReset:()=>this.onSourceReset()})};const t=e.getItems();t&&this.onSourceItemsUpdated(t)}}destroy(){this.setSource(null)}getSelectedItem(){return this.selectedItem}setSelectedItem(e){e!==this.selectedItem&&(this.selectedItem=e,this.listeners.forEach((t=>{var o;return null===(o=t.onSelectedItemUpdated)||void 0===o?void 0:o.call(t,e)})))}addListener(e){return this.listeners.push(e),()=>this.removeListener(e)}removeListener(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}onSourceItemsUpdated(e){this.itemsMap=e.reduce(((e,t)=>(e[this.getItemId(t)]=t,e)),{})}onSourceReset(){this.itemsMap=null,this.selectedItem=null}getItemById(e){var t,o;return null!==(t=null===(o=this.itemsMap)||void 0===o?void 0:o[e])&&void 0!==t?t:null}}},25367:(e,t,o)=>{o.d(t,{v:()=>d});var n=o(15324),r=o(86654),i=o(54438),s=o(60177),a=o(2910);function CoreTagListComponent_ng_container_0_Template(e,t){if(1&e){const e=i.RV6();i.qex(0),i.j41(1,"ion-badge",1),i.bIt("click",(function CoreTagListComponent_ng_container_0_Template_ion_badge_click_1_listener(){const t=i.eBV(e).$implicit,o=i.XpG();return i.Njj(o.openTag(t))})),i.EFF(2),i.k0s(),i.bVm()}if(2&e){const e=t.$implicit;i.R7$(2),i.JRh(e.rawname)}}let d=(()=>{var e;class CoreTagListComponent{constructor(){this.tags=[]}openTag(e){n.CoreNavigator.navigateToSitePath("/tag/index",{params:{tagId:e.id,tagName:e.rawname,collectionId:e.tagcollid,fromContextId:e.taginstancecontextid}})}}return(e=CoreTagListComponent).ɵfac=function CoreTagListComponent_Factory(t){return new(t||e)},e.ɵcmp=i.VBU({type:e,selectors:[["core-tag-list"]],inputs:{tags:"tags"},standalone:!0,features:[i.aNF],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["role","link",1,"core-tag-list-tag",3,"click"]],template:function CoreTagListComponent_Template(e,t){1&e&&i.DNE(0,CoreTagListComponent_ng_container_0_Template,3,1,"ng-container",0),2&e&&i.Y8G("ngForOf",t.tags)},dependencies:[r.n,s.Sq,a.In],styles:["[_nghost-%COMP%]{line-height:1.6}[_nghost-%COMP%]   ion-badge[_ngcontent-%COMP%]{cursor:pointer;margin-left:4px;margin-right:4px}"]}),CoreTagListComponent})()}}]);