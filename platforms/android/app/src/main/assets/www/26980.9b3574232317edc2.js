"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[26980],{26980:(e,o,n)=>{n.r(o),n.d(o,{default:()=>Y});var i=n(10467),t=n(89417),r=n(75383),a=n(85505),l=n(99121),s=n(79555),c=n(999),g=n(82461),_=n(15324),p=n(63153),m=n(62398),u=n(8756),d=n(82907),f=n(30454),h=n(84129),C=n(69534),b=n(33014),P=n(55554),E=n(86552),R=n(25572),M=n(86654),k=n(11544),F=n(54438),y=n(60177),T=n(2910),v=n(25880),S=n(64422),O=n(17778),$=n(86198),I=n(58197),G=n(23007),L=n(88246),w=n(43570),x=n(73955);const j=["ageForm"],N=["signupFormEl"];function CoreLoginEmailSignupPage_ion_button_10_Template(e,o){if(1&e){const e=F.RV6();F.j41(0,"ion-button",9),F.nI1(1,"translate"),F.bIt("click",(function CoreLoginEmailSignupPage_ion_button_10_Template_ion_button_click_0_listener(){F.eBV(e);const o=F.XpG();return F.Njj(o.showAuthInstructions())})),F.nrm(2,"ion-icon",10),F.k0s()}2&e&&F.Y8G("ariaLabel",F.bMT(1,1,"core.login.instructions"))}function CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template(e,o){if(1&e&&(F.j41(0,"ion-list",13)(1,"ion-item",14)(2,"ion-label"),F.EFF(3),F.nI1(4,"translate"),F.k0s()(),F.j41(5,"ion-button",15),F.EFF(6),F.nI1(7,"translate"),F.k0s()()),2&e){const e=F.XpG(2);F.R7$(3),F.SpI(" ",F.bMT(4,5,"core.login.signuprequiredfieldnotsupported")," "),F.R7$(2),F.Y8G("href",e.signupUrl)("autoLogin",!1)("showBrowserWarning",!1),F.R7$(),F.SpI(" ",F.bMT(7,7,"core.openinbrowser")," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_23_Template(e,o){if(1&e&&(F.j41(0,"ion-select-option",25),F.EFF(1),F.k0s()),2&e){const e=o.$implicit;F.Y8G("value",e.code),F.R7$(),F.JRh(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template(e,o){if(1&e){const e=F.RV6();F.j41(0,"form",17,0),F.bIt("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template_form_ngSubmit_0_listener(o){F.eBV(e);const n=F.XpG(3);return F.Njj(n.verifyAge(o))})),F.j41(2,"ion-item-divider",14)(3,"ion-label")(4,"h2"),F.EFF(5),F.nI1(6,"translate"),F.k0s()()(),F.j41(7,"ion-item",14)(8,"ion-input",18)(9,"div",19),F.EFF(10),F.nI1(11,"translate"),F.k0s()()(),F.j41(12,"ion-item",14)(13,"ion-select",20),F.nI1(14,"translate"),F.nI1(15,"translate"),F.nI1(16,"translate"),F.j41(17,"div",19),F.EFF(18),F.nI1(19,"translate"),F.k0s(),F.j41(20,"ion-select-option",21),F.EFF(21),F.nI1(22,"translate"),F.k0s(),F.DNE(23,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_23_Template,2,2,"ion-select-option",22),F.k0s()(),F.j41(24,"div",13)(25,"ion-button",23),F.EFF(26),F.nI1(27,"translate"),F.k0s()(),F.j41(28,"ion-item",14)(29,"ion-label")(30,"p",24),F.EFF(31),F.nI1(32,"translate"),F.k0s(),F.j41(33,"p"),F.EFF(34),F.nI1(35,"translate"),F.k0s()()()()}if(2&e){const e=F.XpG(3);F.Y8G("formGroup",e.ageVerificationForm),F.R7$(5),F.JRh(F.bMT(6,15,"core.agelocationverification")),F.R7$(4),F.Y8G("core-mark-required",!0),F.R7$(),F.JRh(F.bMT(11,17,"core.whatisyourage")),F.R7$(3),F.Y8G("cancelText",F.bMT(14,19,"core.cancel"))("okText",F.bMT(15,21,"core.ok"))("placeholder",F.bMT(16,23,"core.login.selectacountry")),F.R7$(4),F.Y8G("core-mark-required",!0),F.R7$(),F.JRh(F.bMT(19,25,"core.wheredoyoulive")),F.R7$(3),F.JRh(F.bMT(22,27,"core.login.selectacountry")),F.R7$(2),F.Y8G("ngForOf",e.countries),F.R7$(2),F.Y8G("disabled",!e.ageVerificationForm.valid),F.R7$(),F.SpI(" ",F.bMT(27,29,"core.proceed")," "),F.R7$(5),F.JRh(F.bMT(32,31,"core.whyisthisrequired")),F.R7$(3),F.JRh(F.bMT(35,33,"core.explanationdigitalminor"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template(e,o){if(1&e&&(F.j41(0,"p",41),F.EFF(1),F.k0s()),2&e){const e=F.XpG(4);F.R7$(),F.JRh(e.site.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template(e,o){1&e&&(F.j41(0,"p",41),F.nrm(1,"core-format-text",42),F.k0s()),2&e&&(F.R7$(),F.Y8G("filter",!1))}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template(e,o){if(1&e&&(F.j41(0,"p"),F.EFF(1),F.k0s()),2&e){const e=F.XpG(4);F.R7$(),F.JRh(e.site.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_21_Template(e,o){if(1&e&&(F.j41(0,"p",43),F.EFF(1),F.k0s()),2&e){const e=F.XpG(4);F.R7$(),F.SpI(" ",e.settings.passwordpolicy," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_37_Template(e,o){if(1&e&&(F.j41(0,"ion-item",14)(1,"ion-input",44),F.nI1(2,"translate"),F.j41(3,"div",19),F.EFF(4),F.nI1(5,"translate"),F.k0s()(),F.nrm(6,"core-input-errors",29),F.k0s()),2&e){const e=o.$implicit,n=F.XpG(4);F.R7$(),F.FS9("formControlName",e),F.Y8G("name",e)("placeholder",F.bMT(2,7,"core.user."+e)),F.R7$(2),F.Y8G("core-mark-required",!0),F.R7$(),F.JRh(F.bMT(5,9,"core.user."+e)),F.R7$(2),F.Y8G("control",n.signupForm.controls[e])("errorMessages",n.namefieldsErrors[e])}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_51_Template(e,o){if(1&e&&(F.j41(0,"ion-select-option",25),F.EFF(1),F.k0s()),2&e){const e=o.$implicit;F.Y8G("value",e.code),F.R7$(),F.JRh(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_52_core_user_profile_field_5_Template(e,o){if(1&e&&F.nrm(0,"core-user-profile-field",46),2&e){const e=o.$implicit,n=F.XpG(5);F.Y8G("field",e)("edit",!0)("signup",!0)("form",n.signupForm)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_52_Template(e,o){if(1&e&&(F.qex(0),F.j41(1,"ion-item-divider",14)(2,"ion-label")(3,"p",24),F.EFF(4),F.k0s()()(),F.DNE(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_52_core_user_profile_field_5_Template,1,4,"core-user-profile-field",45),F.bVm()),2&e){const e=o.$implicit;F.R7$(4),F.JRh(e.name),F.R7$(),F.Y8G("ngForOf",e.fields)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_53_Template(e,o){if(1&e&&(F.qex(0),F.j41(1,"ion-item-divider",14)(2,"ion-label")(3,"h2",47),F.EFF(4),F.nI1(5,"translate"),F.k0s()()(),F.nrm(6,"core-recaptcha",48),F.bVm()),2&e){const e=F.XpG(4);F.R7$(3),F.Y8G("core-mark-required",!0),F.R7$(),F.JRh(F.bMT(5,6,"core.login.security_question")),F.R7$(2),F.Y8G("publicKey",e.settings.recaptchapublickey)("model",e.captcha)("siteUrl",e.site.siteUrl)("showRequiredError",e.formSubmitClicked)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_54_Template(e,o){if(1&e&&(F.qex(0),F.j41(1,"ion-item-divider",14)(2,"ion-label")(3,"h2"),F.EFF(4),F.nI1(5,"translate"),F.k0s()()(),F.j41(6,"ion-item",14)(7,"ion-label")(8,"a",49),F.EFF(9),F.nI1(10,"translate"),F.k0s()()(),F.j41(11,"ion-item",14)(12,"ion-checkbox",50)(13,"p",47),F.EFF(14),F.nI1(15,"translate"),F.k0s()(),F.nrm(16,"core-input-errors",29),F.k0s(),F.bVm()),2&e){const e=F.XpG(4);F.R7$(4),F.JRh(F.bMT(5,7,"core.policy.policyagreement")),F.R7$(4),F.Y8G("href",e.settings.sitepolicy,F.B4B),F.R7$(),F.SpI(" ",F.bMT(10,9,"core.policy.policyagreementclick")," "),F.R7$(4),F.Y8G("core-mark-required",!0),F.R7$(),F.JRh(F.bMT(15,11,"core.policy.policyacceptmandatory")),F.R7$(2),F.Y8G("control",e.signupForm.controls.policyagreed)("errorMessages",e.policyErrors)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template(e,o){if(1&e){const e=F.RV6();F.j41(0,"form",17,1),F.bIt("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template_form_ngSubmit_0_listener(o){F.eBV(e);const n=F.XpG(3);return F.Njj(n.create(o))})),F.j41(2,"ion-item",26)(3,"ion-label"),F.DNE(4,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template,2,1,"p",27)(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template,2,1,"p",27)(6,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template,2,1,"p",8),F.k0s()(),F.j41(7,"ion-item",14)(8,"ion-input",28),F.nI1(9,"translate"),F.j41(10,"div",19),F.EFF(11),F.nI1(12,"translate"),F.k0s()(),F.nrm(13,"core-input-errors",29),F.k0s(),F.j41(14,"ion-item",14)(15,"ion-input",30),F.nI1(16,"translate"),F.j41(17,"div",19),F.EFF(18),F.nI1(19,"translate"),F.k0s(),F.nrm(20,"ion-input-password-toggle",31),F.k0s(),F.DNE(21,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_21_Template,2,1,"p",32),F.nrm(22,"core-input-errors",29),F.k0s(),F.j41(23,"ion-item",14)(24,"ion-input",33),F.nI1(25,"translate"),F.j41(26,"div",19),F.EFF(27),F.nI1(28,"translate"),F.k0s()(),F.nrm(29,"core-input-errors",29),F.k0s(),F.j41(30,"ion-item",14)(31,"ion-input",34),F.nI1(32,"translate"),F.j41(33,"div",19),F.EFF(34),F.nI1(35,"translate"),F.k0s()(),F.nrm(36,"core-input-errors",29),F.k0s(),F.DNE(37,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_37_Template,7,11,"ion-item",35),F.j41(38,"ion-item",14),F.nrm(39,"ion-input",36),F.nI1(40,"translate"),F.nI1(41,"translate"),F.k0s(),F.j41(42,"ion-item",14)(43,"ion-select",37),F.nI1(44,"translate"),F.nI1(45,"translate"),F.nI1(46,"translate"),F.nI1(47,"translate"),F.j41(48,"ion-select-option",21),F.EFF(49),F.nI1(50,"translate"),F.k0s(),F.DNE(51,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_51_Template,2,2,"ion-select-option",22),F.k0s()(),F.DNE(52,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_52_Template,6,2,"ng-container",38)(53,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_53_Template,7,8,"ng-container",8)(54,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_54_Template,17,13,"ng-container",8),F.j41(55,"div",13)(56,"ion-button",39),F.EFF(57),F.nI1(58,"translate"),F.k0s(),F.nrm(59,"input",40),F.k0s()()}if(2&e){const e=F.XpG(3);F.Y8G("formGroup",e.signupForm),F.R7$(4),F.Y8G("ngIf",!e.siteName&&e.displaySiteUrl),F.R7$(),F.Y8G("ngIf",e.siteName),F.R7$(),F.Y8G("ngIf",e.siteName&&e.displaySiteUrl),F.R7$(2),F.FS9("placeholder",F.bMT(9,40,"core.login.username")),F.R7$(2),F.Y8G("core-mark-required",!0),F.R7$(),F.JRh(F.bMT(12,42,"core.login.username")),F.R7$(2),F.Y8G("control",e.signupForm.controls.username)("errorMessages",e.usernameErrors),F.R7$(2),F.FS9("placeholder",F.bMT(16,44,"core.login.password")),F.Y8G("clearOnEdit",!1),F.R7$(2),F.Y8G("core-mark-required",!0),F.R7$(),F.JRh(F.bMT(19,46,"core.login.password")),F.R7$(3),F.Y8G("ngIf",e.settings.passwordpolicy),F.R7$(),F.Y8G("control",e.signupForm.controls.password)("errorMessages",e.passwordErrors),F.R7$(2),F.FS9("placeholder",F.bMT(25,48,"core.user.email")),F.R7$(2),F.Y8G("core-mark-required",!0),F.R7$(),F.JRh(F.bMT(28,50,"core.user.email")),F.R7$(2),F.Y8G("control",e.signupForm.controls.email)("errorMessages",e.emailErrors),F.R7$(2),F.FS9("placeholder",F.bMT(32,52,"core.user.emailagain")),F.Y8G("pattern",e.escapeMail(e.signupForm.controls.email.value)),F.R7$(2),F.Y8G("core-mark-required",!0),F.R7$(),F.JRh(F.bMT(35,54,"core.user.emailagain")),F.R7$(2),F.Y8G("control",e.signupForm.controls.email2)("errorMessages",e.email2Errors),F.R7$(),F.Y8G("ngForOf",e.settings.namefields),F.R7$(2),F.FS9("placeholder",F.bMT(40,56,"core.user.city")),F.Y8G("label",F.bMT(41,58,"core.user.city")),F.R7$(4),F.Y8G("placeholder",F.bMT(44,60,"core.login.selectacountry"))("cancelText",F.bMT(45,62,"core.cancel"))("okText",F.bMT(46,64,"core.ok"))("label",F.bMT(47,66,"core.user.country")),F.R7$(6),F.JRh(F.bMT(50,68,"core.login.selectacountry")),F.R7$(2),F.Y8G("ngForOf",e.countries),F.R7$(),F.Y8G("ngForOf",e.categories),F.R7$(),F.Y8G("ngIf",e.settings.recaptchapublickey),F.R7$(),F.Y8G("ngIf",e.settings.sitepolicy),F.R7$(3),F.JRh(F.bMT(58,70,"core.login.createaccount"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template(e,o){if(1&e&&(F.qex(0),F.DNE(1,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template,36,35,"form",16)(2,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template,60,72,"form",16),F.bVm()),2&e){const e=F.XpG(2);F.R7$(),F.Y8G("ngIf",e.ageDigitalConsentVerification),F.R7$(),F.Y8G("ngIf",!e.ageDigitalConsentVerification&&e.site)}}function CoreLoginEmailSignupPage_core_loading_12_Template(e,o){if(1&e&&(F.j41(0,"core-loading",11)(1,"div",7),F.DNE(2,CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template,8,9,"ion-list",12)(3,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template,3,2,"ng-container",8),F.k0s()()),2&e){const e=F.XpG();F.Y8G("hideUntil",e.settingsLoaded),F.R7$(2),F.Y8G("ngIf",!e.allRequiredSupported),F.R7$(),F.Y8G("ngIf",e.allRequiredSupported&&e.settingsLoaded&&e.settings)}}function CoreLoginEmailSignupPage_ion_list_14_h2_3_Template(e,o){if(1&e&&(F.j41(0,"h2",52),F.nrm(1,"core-format-text",42),F.k0s()),2&e){const e=F.XpG(2);F.R7$(),F.Y8G("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_ion_list_14_Template(e,o){if(1&e&&(F.j41(0,"ion-list")(1,"ion-item-divider",14)(2,"ion-label"),F.DNE(3,CoreLoginEmailSignupPage_ion_list_14_h2_3_Template,2,2,"h2",51),F.k0s()(),F.j41(4,"ion-item",14)(5,"ion-label")(6,"p",24),F.EFF(7),F.nI1(8,"translate"),F.k0s(),F.j41(9,"p"),F.EFF(10),F.nI1(11,"translate"),F.k0s()()()()),2&e){const e=F.XpG();F.R7$(3),F.Y8G("ngIf",e.siteName),F.R7$(4),F.JRh(F.bMT(8,3,"core.considereddigitalminor")),F.R7$(3),F.JRh(F.bMT(11,5,"core.digitalminor_desc"))}}let Y=(()=>{var e;class CoreLoginEmailSignupPage{constructor(e,o,n){this.fb=e,this.elementRef=o,this.changeDetector=n,this.displaySiteUrl=!1,this.authInstructions="",this.settingsLoaded=!1,this.allRequiredSupported=!0,this.formSubmitClicked=!1,this.captcha={recaptcharesponse:""},this.isMinor=!1,this.ageVerificationForm=this.fb.group({age:["",t.k0.required]}),this.countryControl=this.fb.control("",{validators:t.k0.required,nonNullable:!0}),this.ageVerificationForm.addControl("country",this.countryControl),this.signupForm=this.fb.group({password:["",t.k0.required],email:["",t.k0.compose([t.k0.required,t.k0.email])],email2:["",t.k0.compose([t.k0.required,t.k0.email])]}),this.usernameErrors={required:"core.login.usernamerequired",pattern:{[CoreLoginEmailSignupPage.USERNAME_STRICT_CHARS_PATTERN]:"core.login.invalidusername",[CoreLoginEmailSignupPage.USERNAME_LOWERCASE_PATTERN]:"core.login.usernamelowercase"}},this.passwordErrors={required:"core.login.passwordrequired"},this.emailErrors={required:"core.login.missingemail"},this.policyErrors={required:"core.policy.policyagree"},this.email2Errors={required:"core.login.missingemail",pattern:"core.login.emailnotmatch"}}ngOnInit(){const e=_.CoreNavigator.getRouteParam("siteUrl");if(!e)return R.CoreAlerts.showError("Site URL not supplied."),_.CoreNavigator.back(),void 0;this.site=f.a.makeUnauthenticatedSite(e),this.displaySiteUrl=this.site.shouldDisplayInformativeLinks(),this.fetchData().finally((()=>{this.settingsLoaded=!0}))}completeFormGroup(){var e,o,n,i;const r=!1===(null===(e=this.settings)||void 0===e?void 0:e.extendedusernamechars);this.signupForm.addControl("username",this.fb.control("",t.k0.compose([t.k0.required,t.k0.pattern(CoreLoginEmailSignupPage.USERNAME_LOWERCASE_PATTERN),r?t.k0.pattern(CoreLoginEmailSignupPage.USERNAME_STRICT_CHARS_PATTERN):void 0]))),this.signupForm.addControl("city",this.fb.control((null===(o=this.settings)||void 0===o?void 0:o.defaultcity)||"")),this.signUpCountryControl=this.fb.control((null===(n=this.settings)||void 0===n?void 0:n.country)||"",{nonNullable:!0}),this.signupForm.addControl("country",this.signUpCountryControl);for(const e in null===(a=this.settings)||void 0===a?void 0:a.namefields){var a,l;this.signupForm.addControl(null===(l=this.settings)||void 0===l?void 0:l.namefields[e],this.fb.control("",t.k0.required))}null!==(i=this.settings)&&void 0!==i&&i.sitepolicy&&this.signupForm.addControl("policyagreed",this.fb.control(!1,t.k0.requiredTrue))}fetchData(){var e=this;return(0,i.A)((function*(){try{e.siteConfig=yield e.site.getPublicConfig(),e.signupUrl=u.$.concatenatePaths(e.siteConfig.httpswwwroot,"login/signup.php");if(yield e.treatSiteConfig()){if(void 0===e.ageDigitalConsentVerification){const o=yield P.g.ignoreErrors(l.CoreWS.callAjax("core_auth_is_age_digital_consent_verification_enabled",{},{siteUrl:e.site.getURL()}));e.ageDigitalConsentVerification=!(null==o||!o.status)}yield e.getSignupSettings()}e.completeFormGroup()}catch(o){e.allRequiredSupported&&R.CoreAlerts.showError(o)}}))()}getSignupSettings(){var e=this;return(0,i.A)((function*(){if(e.settings=yield g.CoreLoginHelper.getEmailSignupSettings(e.site.getURL()),c.CoreUserProfileFieldDelegate.hasRequiredUnsupportedField(e.settings.profilefields))throw e.allRequiredSupported=!1,new Error(s.HT.instant("core.login.signuprequiredfieldnotsupported"));e.categories=g.CoreLoginHelper.formatProfileFieldsForSignup(e.settings.profilefields),e.settings.recaptchapublickey&&(e.captcha.recaptcharesponse=""),e.countryControl.value||e.countryControl.setValue(e.settings.country||"");const o={};e.settings.namefields&&e.settings.namefields.forEach((e=>{o[e]={required:`core.login.missing${e}`}})),e.namefieldsErrors=o,e.countries=yield a.A.getCountryListSorted()}))()}treatSiteConfig(){var e=this;return(0,i.A)((function*(){var o;return"email"!=(null===(o=e.siteConfig)||void 0===o?void 0:o.registerauth)||e.site.isFeatureDisabled(h.ty)?(R.CoreAlerts.showError(s.HT.instant("core.login.signupplugindisabled",{$a:s.HT.instant("core.login.auth_email")})),_.CoreNavigator.back(),!1):(e.siteName=yield e.site.getSiteName(),e.authInstructions=e.siteConfig.authinstructions,e.ageDigitalConsentVerification=e.siteConfig.agedigitalconsentverification,e.supportName=e.siteConfig.supportname,e.supportEmail=e.siteConfig.supportemail,e.countryControl.setValue(e.siteConfig.country||""),!0)}))()}create(e){var o=this;return(0,i.A)((function*(){var n,i,t;if(e.preventDefault(),e.stopPropagation(),o.formSubmitClicked=!0,!o.signupForm.valid||null!==(n=o.settings)&&void 0!==n&&n.recaptchapublickey&&!o.captcha.recaptcharesponse){for(const e in o.signupForm.controls)o.signupForm.controls[e].markAsDirty();o.changeDetector.detectChanges();return(yield d.y.scrollToInputError(o.elementRef.nativeElement))||R.CoreAlerts.showError(s.HT.instant("core.errorinvalidform")),void 0}const a=yield b.CoreLoadings.show("core.sending",!0),m={username:o.signupForm.value.username.trim().toLowerCase(),password:o.signupForm.value.password,firstname:r.Ni.cleanTags(o.signupForm.value.firstname),lastname:r.Ni.cleanTags(o.signupForm.value.lastname),email:o.signupForm.value.email.trim(),city:r.Ni.cleanTags(o.signupForm.value.city),country:o.signupForm.value.country};null!==(i=o.siteConfig)&&void 0!==i&&i.launchurl&&(m.redirect=yield g.CoreLoginHelper.prepareForSSOLogin(o.site.getURL(),void 0,o.siteConfig.launchurl)),null!==(t=o.settings)&&void 0!==t&&t.recaptchapublickey&&o.captcha.recaptcharesponse&&(m.recaptcharesponse=o.captcha.recaptcharesponse);try{var u;m.customprofilefields=yield c.CoreUserProfileFieldDelegate.getDataForFields(null===(u=o.settings)||void 0===u?void 0:u.profilefields,!0,"email",o.signupForm.value);const e=yield l.CoreWS.callAjax("auth_email_signup_user",m,{siteUrl:o.site.getURL()});if(e.success){p.R.triggerFormSubmittedEvent(o.signupFormElement,!0);const e=s.HT.instant("core.login.emailconfirmsent",{$a:m.email});R.CoreAlerts.show({header:s.HT.instant("core.success"),message:e}),_.CoreNavigator.back()}else{var f,h;null===(f=o.recaptchaComponent)||void 0===f||f.expireRecaptchaAnswer();const n=null===(h=e.warnings)||void 0===h?void 0:h[0];if(n){let e=n.message;("incorrect-captcha-sol"==e||!e&&"recaptcharesponse"==n.item)&&(e=s.HT.instant("core.login.recaptchaincorrect")),R.CoreAlerts.showError(e)}else R.CoreAlerts.showError(s.HT.instant("core.login.usernotaddederror"))}}catch(e){R.CoreAlerts.showError(e,{default:s.HT.instant("core.login.usernotaddederror")})}finally{a.dismiss()}}))()}escapeMail(e){return r.Ni.escapeForRegex(e)}showAuthInstructions(){C.m.viewText(s.HT.instant("core.login.instructions"),this.authInstructions)}showContactOnSite(){E.j.openInBrowser(u.$.concatenatePaths(this.site.getURL(),"/login/verify_age_location.php"),{showBrowserWarning:!1})}verifyAge(e){var o=this;return(0,i.A)((function*(){if(e.preventDefault(),e.stopPropagation(),!o.ageVerificationForm.valid)return R.CoreAlerts.showError(s.HT.instant("core.errorinvalidform")),void 0;const n=yield b.CoreLoadings.show("core.sending",!0),i=o.ageVerificationForm.value;i.age=parseInt(i.age,10);try{const e=yield l.CoreWS.callAjax("core_auth_is_minor",i,{siteUrl:o.site.getURL()});if(p.R.triggerFormSubmittedEvent(o.ageFormElement,!0),e.status)o.isMinor=!0;else{var t;if(o.countryControl.value)null===(t=o.signUpCountryControl)||void 0===t||t.setValue(o.countryControl.value);o.ageDigitalConsentVerification=!1}}catch{R.CoreAlerts.showError("There was an error verifying your age, please try again using the browser.")}finally{n.dismiss()}}))()}}return(e=CoreLoginEmailSignupPage).USERNAME_STRICT_CHARS_PATTERN="^[A-Z-.@_a-z0-9]*$",e.USERNAME_LOWERCASE_PATTERN="^[^A-Z]*$",e.ɵfac=function CoreLoginEmailSignupPage_Factory(o){return new(o||e)(F.rXU(t.ok),F.rXU(F.aKT),F.rXU(F.gRc))},e.ɵcmp=F.VBU({type:e,selectors:[["page-core-login-email-signup"]],viewQuery:function CoreLoginEmailSignupPage_Query(e,o){if(1&e&&(F.GBs(m.i,5),F.GBs(j,5),F.GBs(N,5)),2&e){let e;F.mGM(e=F.lsd())&&(o.recaptchaComponent=e.first),F.mGM(e=F.lsd())&&(o.ageFormElement=e.first),F.mGM(e=F.lsd())&&(o.signupFormElement=e.first)}},standalone:!0,features:[F.aNF],decls:15,vars:9,consts:[["ageForm",""],["signupFormEl",""],["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"ariaLabel","click",4,"ngIf"],[3,"hideUntil",4,"ngIf"],[1,"list-item-limited-width"],[4,"ngIf"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","far-circle-question","aria-hidden","true"],[3,"hideUntil"],["class","ion-padding",4,"ngIf"],[1,"ion-padding"],[1,"ion-text-wrap"],["expand","block","core-link","",3,"href","autoLogin","showBrowserWarning"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],["labelPlacement","stacked","type","number","name","age","placeholder","0","formControlName","age","autocapitalize","none","autocorrect","off"],["slot","label",3,"core-mark-required"],["labelPlacement","stacked","name","country","formControlName","country",3,"cancelText","okText","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],["expand","block","type","submit",3,"disabled"],[1,"item-heading"],[3,"value"],[1,"ion-text-wrap","ion-text-center"],["class","ion-padding item-heading",4,"ngIf"],["labelPlacement","stacked","type","text","name","username","formControlName","username","autocapitalize","none","autocorrect","off",3,"placeholder"],[3,"control","errorMessages"],["labelPlacement","stacked","name","password","type","password","formControlName","password","autocomplete","new-password","required","true",3,"placeholder","clearOnEdit"],["slot","end","showIcon","fas-eye","hideIcon","fas-eye-slash"],["class","core-input-footnote",4,"ngIf"],["labelPlacement","stacked","type","email","name","email","formControlName","email","autocapitalize","none","autocorrect","off",3,"placeholder"],["labelPlacement","stacked","type","email","name","email2","autocapitalize","none","formControlName","email2","autocorrect","off",3,"placeholder","pattern"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["labelPlacement","stacked","type","text","name","city","formControlName","city","autocorrect","off",3,"placeholder","label"],["labelPlacement","stacked","name","country","formControlName","country",3,"placeholder","cancelText","okText","label"],[4,"ngFor","ngForOf"],["expand","block","type","submit"],["type","submit",1,"core-submit-hidden-enter"],[1,"ion-padding","item-heading"],[3,"text","filter"],[1,"core-input-footnote"],["labelPlacement","stacked","type","text","autocorrect","off",3,"name","formControlName","placeholder"],["registerAuth","email",3,"field","edit","signup","form",4,"ngFor","ngForOf"],["registerAuth","email",3,"field","edit","signup","form"],[3,"core-mark-required"],[3,"publicKey","model","siteUrl","showRequiredError"],["core-link","","capture","false",3,"href"],["labelPlacement","start","justify","space-between","name","policyagreed","formControlName","policyagreed"],["class","item-heading ion-padding",4,"ngIf"],[1,"item-heading","ion-padding"]],template:function CoreLoginEmailSignupPage_Template(e,o){1&e&&(F.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),F.nrm(3,"ion-back-button",3),F.nI1(4,"translate"),F.k0s(),F.j41(5,"ion-title")(6,"h1"),F.EFF(7),F.nI1(8,"translate"),F.k0s()(),F.j41(9,"ion-buttons",4),F.DNE(10,CoreLoginEmailSignupPage_ion_button_10_Template,3,3,"ion-button",5),F.k0s()()(),F.j41(11,"ion-content"),F.DNE(12,CoreLoginEmailSignupPage_core_loading_12_Template,4,3,"core-loading",6),F.j41(13,"div",7),F.DNE(14,CoreLoginEmailSignupPage_ion_list_14_Template,12,7,"ion-list",8),F.k0s()()),2&e&&(F.R7$(3),F.Y8G("text",F.bMT(4,5,"core.back")),F.R7$(4),F.JRh(F.bMT(8,7,"core.login.newaccount")),F.R7$(3),F.Y8G("ngIf",o.authInstructions),F.R7$(2),F.Y8G("ngIf",!o.isMinor),F.R7$(2),F.Y8G("ngIf",o.allRequiredSupported&&o.isMinor))},dependencies:[M.n,y.Sq,y.bT,t.qT,t.BC,t.cb,t.YS,t.R_,T.Jm,T.QW,T.eY,T.W9,T.eU,T.iq,T.$w,T.Wv,T.uz,T.Dg,T.he,T.nf,T.Nm,T.Ip,T.BC,T.ai,T.hB,T.su,T.Je,T.Gw,T.el,t.j4,t.JD,v.q,S.R,O.j,m.i,$.t,I.B,G.j,L.i,w.T,x.D9,k.CoreUserProfileFieldComponent],styles:['[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background: var(--core-login-background);--ion-item-background: var(--core-login-background);--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color: var(--core-login-text-color);text-decoration-color:var(--color)}[_nghost-%COMP%]   .core-login-reconnect-warning[_ngcontent-%COMP%]{margin:0 0 32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]{margin-bottom:32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   core-site-logo[_ngcontent-%COMP%]{--core-site-logo-max-height: 120px;--core-site-logo-sitename-margin-bottom: 8px;--core-site-logo-sitename-font: var(--mdl-typography-subtitle-font-lg);--core-site-logo-max-width: 300px;--core-site-logo-width: 90%;--core-site-logo-margin: 0 auto}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-siteurl[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%] + .core-login-user[_ngcontent-%COMP%]{margin-top:24px}[_nghost-%COMP%]   core-user-avatar.large-avatar[_ngcontent-%COMP%]{--core-avatar-size: var(--core-large-avatar-size)}[_nghost-%COMP%]   .core-login-fullname[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background: var(--core-login-input-background);--color: var(--core-login-input-color)}[_nghost-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:0;margin-right:0}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]{position:relative;padding:8px 0}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:var(--core-login-background);padding:0 8px}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]:before{height:1px;position:absolute;top:50%;left:0;right:0;border-bottom:1px solid var(--gray-300);content:"";z-index:-1}[_nghost-%COMP%]   .core-login-login-button[_ngcontent-%COMP%]{margin-top:32px}[_nghost-%COMP%]   .core-login-login-inbrowser-button[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   p.core-login-inbrowser[_ngcontent-%COMP%]{font:var(--mdl-typography-body-font-sm);margin-top:8px;margin-bottom:8px}[_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid var(--gray-300)}[_nghost-%COMP%]   .core-login-identity-providers[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px;font:var(--mdl-typography-heading6-font)}:root.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], :root.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background: var(--core-login-background-dark);--loading-text-color: #ffffff;--loading-spinner: #ffffff}']}),CoreLoginEmailSignupPage})()}}]);