"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1227],{1227:(e,o,r)=>{r.r(o),r.d(o,{AddonBlockStarredCoursesComponent:()=>R});var s=r(10467),t=r(49882),n=r(52749),i=r(66110),d=r(78765),a=r(12808),c=r(3484),l=r(81690),u=r(79555),C=r(54438);let p=(()=>{var e;class AddonBlockStarredCoursesProvider{getStarredCoursesCacheKey(){return`${AddonBlockStarredCoursesProvider.ROOT_CACHE_KEY}:starredcourses`}getStarredCourses(e){var o=this;return(0,s.A)((function*(){const r=yield n.CoreSites.getSite(e),s={cacheKey:o.getStarredCoursesCacheKey()};return r.read("block_starredcourses_get_starred_courses",void 0,s)}))()}invalidateStarredCourses(e){var o=this;return(0,s.A)((function*(){const r=yield n.CoreSites.getSite(e);yield r.invalidateWsCacheForKey(o.getStarredCoursesCacheKey())}))()}}return(e=AddonBlockStarredCoursesProvider).ROOT_CACHE_KEY="AddonBlockStarredCourses:",e.ɵfac=function AddonBlockStarredCoursesProvider_Factory(o){return new(o||e)},e.ɵprov=C.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonBlockStarredCoursesProvider})();const m=(0,u.Qd)(p);var g=r(86654),v=r(16449),f=r(9538),h=r(55554),_=r(60177),S=r(2910),A=r(16986),k=r(64422),y=r(29210),E=r(74235),O=r(73955);function AddonBlockStarredCoursesComponent_core_empty_box_9_Template(e,o){1&e&&(C.nrm(0,"core-empty-box",11),C.nI1(1,"translate")),2&e&&C.Y8G("message",C.bMT(1,1,"addon.block_starredcourses.nocourses"))}function AddonBlockStarredCoursesComponent_ng_container_13_Template(e,o){if(1&e&&(C.qex(0),C.nrm(1,"core-courses-course-list-item",12),C.bVm()),2&e){const e=o.$implicit;C.R7$(),C.Y8G("course",e)}}let R=(()=>{var e;class AddonBlockStarredCoursesComponent extends c.d{constructor(){super("AddonBlockStarredCoursesComponent"),this.courses=[],this.isDestroyed=!1,this.fetchContentDefaultError="Error getting starred courses data.",this.site=n.CoreSites.getRequiredCurrentSite()}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,e=this;return(0,s.A)((function*(){const o=l.j.getUniqueId("AddonBlockStarredCoursesComponent-Scroll");e.scrollElementId=`addon-block-starredcourses-scroll-${o}`,e.coursesObserver=t.z.on(f.CORE_COURSES_MY_COURSES_UPDATED_EVENT,(o=>{e.refreshCourseList(o)}),n.CoreSites.getCurrentSiteId()),_superprop_getNgOnInit().call(e)}))()}invalidateContent(){var e=this;return(0,s.A)((function*(){const o=e.courses.map((e=>e.id));yield e.invalidateCourses(o)}))()}invalidateCourseList(){return(0,s.A)((function*(){return m.invalidateStarredCourses()}))()}invalidateCourses(e){var o=this;return(0,s.A)((function*(){const r=[];r.push(o.invalidateCourseList().finally((()=>h.g.allPromises(e.map((e=>a.AddonCourseCompletion.invalidateCourseCompletion(e))))))),r.push(1==e.length?d.CoreCourseOptionsDelegate.clearAndInvalidateCoursesOptions(e[0]):d.CoreCourseOptionsDelegate.clearAndInvalidateCoursesOptions()),e.length>0&&r.push(i.CoreCourses.invalidateCoursesByField("ids",e.join(","))),yield h.g.allPromises(r)}))()}fetchContent(){var e=this;return(0,s.A)((function*(){const o=e.block.configsRecord&&e.block.configsRecord.displaycategories&&"1"==e.block.configsRecord.displaycategories.value,r=yield m.getStarredCourses(),s=r.map((e=>e.id)),t=yield i.CoreCourses.getCoursesByField("ids",s.join(","));e.courses=r.map((e=>{const o=t.find((o=>e.id==o.id));return Object.assign(e,o)}));const n=yield i.CoreCourses.getCoursesAdminAndNavOptions(s);e.courses.forEach((e=>{e.navOptions=n.navOptions[e.id],e.admOptions=n.admOptions[e.id],o||(e.categoryname="")}))}))()}refreshCourseList(e){var o=this;return(0,s.A)((function*(){if(e.action===f.CoreCoursesMyCoursesUpdatedEventAction.ENROL)return o.refreshContent();if(e.action===f.CoreCoursesMyCoursesUpdatedEventAction.STATE_CHANGED&&e.state==f.CORE_COURSES_STATE_FAVOURITE){const r=o.courses.findIndex((o=>o.id==e.courseId));if(r<0)return o.refreshContent();const s=o.courses[r];!1===e.value?o.courses.splice(r,1):(s.isfavourite=!!e.value,o.courses.splice(r,1),o.courses.unshift(s)),yield o.invalidateCourseList()}}))()}ngOnDestroy(){var e;this.isDestroyed=!0,null===(e=this.coursesObserver)||void 0===e||e.off()}}return(e=AddonBlockStarredCoursesComponent).ɵfac=function AddonBlockStarredCoursesComponent_Factory(o){return new(o||e)},e.ɵcmp=C.VBU({type:e,selectors:[["addon-block-starredcourses"]],standalone:!0,features:[C.Vt3,C.aNF],decls:15,vars:11,consts:[["scrollControls",""],[3,"sticky"],["slot","end",1,"flex-row"],[3,"aria-controls"],["placeholderType","row","placeholderWidth","280px","placeholderHeight","134px",3,"hideUntil","placeholderLimit"],["image","assets/img/icons/courses.svg",3,"message",4,"ngIf"],[1,"core-horizontal-scroll",3,"scroll","hidden","id"],[1,"flex-row","core-course-list",3,"onResize"],[1,"safe-area-pseudo-padding-start"],[4,"ngFor","ngForOf"],[1,"safe-area-pseudo-padding-end"],["image","assets/img/icons/courses.svg",3,"message"],["layout","summarycard",1,"core-block_starredcourses",3,"course"]],template:function AddonBlockStarredCoursesComponent_Template(e,o){if(1&e){const e=C.RV6();C.j41(0,"ion-item-divider",1)(1,"ion-label")(2,"h2"),C.EFF(3),C.nI1(4,"translate"),C.k0s()(),C.j41(5,"div",2),C.nrm(6,"core-horizontal-scroll-controls",3,0),C.k0s()(),C.j41(8,"core-loading",4),C.DNE(9,AddonBlockStarredCoursesComponent_core_empty_box_9_Template,2,3,"core-empty-box",5),C.j41(10,"div",6),C.bIt("scroll",(function AddonBlockStarredCoursesComponent_Template_div_scroll_10_listener(){C.eBV(e);const o=C.sdS(7);return C.Njj(o.updateScrollPosition())})),C.j41(11,"div",7),C.bIt("onResize",(function AddonBlockStarredCoursesComponent_Template_div_onResize_11_listener(){C.eBV(e);const o=C.sdS(7);return C.Njj(o.updateScrollPosition())})),C.nrm(12,"div",8),C.DNE(13,AddonBlockStarredCoursesComponent_ng_container_13_Template,2,1,"ng-container",9),C.nrm(14,"div",10),C.k0s()()()}2&e&&(C.Y8G("sticky",!0),C.R7$(3),C.JRh(C.bMT(4,9,"addon.block_starredcourses.pluginname")),C.R7$(3),C.Y8G("aria-controls",o.scrollElementId),C.R7$(2),C.Y8G("hideUntil",o.loaded)("placeholderLimit",4),C.R7$(),C.Y8G("ngIf",0===o.courses.length),C.R7$(),C.Y8G("hidden",0===o.courses.length)("id",o.scrollElementId),C.R7$(3),C.Y8G("ngForOf",o.courses))},dependencies:[g.n,_.Sq,_.bT,S.Dg,S.he,A.h,k.R,y.c,E.C,O.D9,v.CoreCoursesCourseListItemComponent],encapsulation:2}),AddonBlockStarredCoursesComponent})()}}]);