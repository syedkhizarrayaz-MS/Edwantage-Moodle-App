"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[26327],{26327:(e,t,s)=>{s.r(t),s.d(t,{AddonModWorkshopOffline:()=>m,AddonModWorkshopOfflineProvider:()=>g});var i=s(10467),r=s(45507),o=s(52749),n=s(75383),d=s(24742),a=s(79555),u=s(8756),l=s(38641),c=s(54438);let g=(()=>{var e;class AddonModWorkshopOfflineProvider{getAllWorkshops(e){var t=this;return(0,i.A)((function*(){const s=yield Promise.all([t.getAllSubmissions(e),t.getAllAssessments(e),t.getAllEvaluateSubmissions(e),t.getAllEvaluateAssessments(e)]),i={};return s.forEach((e=>{e.forEach((e=>{i[e.workshopid]=e.workshopid}))})),Object.values(i)}))()}hasWorkshopOfflineData(e,t){var s=this;return(0,i.A)((function*(){try{return(yield Promise.all([s.getSubmissions(e,t),s.getAssessments(e,t),s.getEvaluateSubmissions(e,t),s.getEvaluateAssessments(e,t)])).some((e=>e&&e.length))}catch{return!1}}))()}deleteSubmissionAction(e,t,s){return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(s),r={workshopid:e,action:t};yield i.getDb().deleteRecords(l.P5,r)}))()}deleteAllSubmissionActions(e,t){return(0,i.A)((function*(){const s=yield o.CoreSites.getSite(t),i={workshopid:e};yield s.getDb().deleteRecords(l.P5,i)}))()}getAllSubmissions(e){var t=this;return(0,i.A)((function*(){const s=yield o.CoreSites.getSite(e);return(yield s.getDb().getRecords(l.P5)).map((e=>t.parseSubmissionRecord(e)))}))()}getSubmissions(e,t){var s=this;return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(t),r={workshopid:e};return(yield i.getDb().getRecords(l.P5,r)).map((e=>s.parseSubmissionRecord(e)))}))()}getSubmissionAction(e,t,s){var r=this;return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(s),n={workshopid:e,action:t},d=yield i.getDb().getRecord(l.P5,n);return r.parseSubmissionRecord(d)}))()}saveSubmission(e,t,s,r,n,a=0,u,c){return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(c),g=d.j.timestamp(),m={workshopid:e,courseid:t,title:s,content:r,attachmentsid:JSON.stringify(n),action:u,submissionid:a,timemodified:g};yield i.getDb().insertRecord(l.P5,m)}))()}parseSubmissionRecord(e){return{...e,attachmentsid:n.Ni.parseJSON(e.attachmentsid)}}deleteAssessment(e,t,s){return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(s),r={workshopid:e,assessmentid:t};yield i.getDb().deleteRecords(l.zC,r)}))()}getAllAssessments(e){var t=this;return(0,i.A)((function*(){const s=yield o.CoreSites.getSite(e);return(yield s.getDb().getRecords(l.zC)).map((e=>t.parseAssessmentRecord(e)))}))()}getAssessments(e,t){var s=this;return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(t),r={workshopid:e};return(yield i.getDb().getRecords(l.zC,r)).map((e=>s.parseAssessmentRecord(e)))}))()}getAssessment(e,t,s){var r=this;return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(s),n={workshopid:e,assessmentid:t},d=yield i.getDb().getRecord(l.zC,n);return r.parseAssessmentRecord(d)}))()}saveAssessment(e,t,s,r,n){return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(n),a={workshopid:e,courseid:s,inputdata:JSON.stringify(r),assessmentid:t,timemodified:d.j.timestamp()};yield i.getDb().insertRecord(l.zC,a)}))()}parseAssessmentRecord(e){return{...e,inputdata:n.Ni.parseJSON(e.inputdata)}}deleteEvaluateSubmission(e,t,s){return(0,i.A)((function*(){const i={workshopid:e,submissionid:t},r=yield o.CoreSites.getSite(s);yield r.getDb().deleteRecords(l.Vz,i)}))()}getAllEvaluateSubmissions(e){var t=this;return(0,i.A)((function*(){const s=yield o.CoreSites.getSite(e);return(yield s.getDb().getRecords(l.Vz)).map((e=>t.parseEvaluateSubmissionRecord(e)))}))()}getEvaluateSubmissions(e,t){var s=this;return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(t),r={workshopid:e};return(yield i.getDb().getRecords(l.Vz,r)).map((e=>s.parseEvaluateSubmissionRecord(e)))}))()}getEvaluateSubmission(e,t,s){var r=this;return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(s),n={workshopid:e,submissionid:t},d=yield i.getDb().getRecord(l.Vz,n);return r.parseEvaluateSubmissionRecord(d)}))()}saveEvaluateSubmission(e,t,s,r="",n,a,u){return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(u),c={workshopid:e,courseid:s,submissionid:t,timemodified:d.j.timestamp(),feedbacktext:r,published:Number(n),gradeover:JSON.stringify(a)};yield i.getDb().insertRecord(l.Vz,c)}))()}parseEvaluateSubmissionRecord(e){return{...e,published:Boolean(e.published),gradeover:n.Ni.parseJSON(e.gradeover)}}deleteEvaluateAssessment(e,t,s){return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(s),r={workshopid:e,assessmentid:t};yield i.getDb().deleteRecords(l.NM,r)}))()}getAllEvaluateAssessments(e){var t=this;return(0,i.A)((function*(){const s=yield o.CoreSites.getSite(e);return(yield s.getDb().getRecords(l.NM)).map((e=>t.parseEvaluateAssessmentRecord(e)))}))()}getEvaluateAssessments(e,t){var s=this;return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(t),r={workshopid:e};return(yield i.getDb().getRecords(l.NM,r)).map((e=>s.parseEvaluateAssessmentRecord(e)))}))()}getEvaluateAssessment(e,t,s){var r=this;return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(s),n={workshopid:e,assessmentid:t},d=yield i.getDb().getRecord(l.NM,n);return r.parseEvaluateAssessmentRecord(d)}))()}saveEvaluateAssessment(e,t,s,r,n=0,a,u){return(0,i.A)((function*(){const i=yield o.CoreSites.getSite(u),c={workshopid:e,courseid:s,assessmentid:t,timemodified:d.j.timestamp(),feedbacktext:r||"",weight:n,gradinggradeover:JSON.stringify(a)};yield i.getDb().insertRecord(l.NM,c)}))()}parseEvaluateAssessmentRecord(e){return{...e,gradinggradeover:n.Ni.parseJSON(e.gradinggradeover)}}getWorkshopFolder(e,t){return(0,i.A)((function*(){const s=yield o.CoreSites.getSite(t),i=r.CoreFile.getSiteFolder(s.getId());return u.$.concatenatePaths(i,`offlineworkshop/${e}/`)}))()}getSubmissionFolder(e,t){var s=this;return(0,i.A)((function*(){const i=yield s.getWorkshopFolder(e,t);return u.$.concatenatePaths(i,"submission")}))()}getAssessmentFolder(e,t,s){var r=this;return(0,i.A)((function*(){let i=yield r.getWorkshopFolder(e,s);return i+="assessment/",u.$.concatenatePaths(i,String(t))}))()}}return(e=AddonModWorkshopOfflineProvider).ɵfac=function AddonModWorkshopOfflineProvider_Factory(t){return new(t||e)},e.ɵprov=c.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModWorkshopOfflineProvider})();const m=(0,a.Qd)(g)}}]);