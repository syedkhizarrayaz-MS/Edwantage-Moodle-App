"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[25236],{25236:(e,o,t)=>{t.r(o),t.d(o,{default:()=>R});var r=t(10467),n=t(74431),i=t(75629),a=t(44682),s=t(8979),c=t(94455),d=t(15324),l=t(49588),u=t(55554),m=t(79555),f=t(99201),p=t(93589),I=t(25572),g=t(86654),h=t(54438),_=t(60177),w=t(2910),b=t(7476),v=t(64422),C=t(46036),M=t(86198),T=t(58197),y=t(66731),A=t(88246),H=t(43570),P=t(73955);function AddonModImscpViewPage_ion_button_9_Template(e,o){if(1&e){const e=h.RV6();h.j41(0,"ion-button",9),h.nI1(1,"translate"),h.bIt("click",(function AddonModImscpViewPage_ion_button_9_Template_ion_button_click_0_listener(){h.eBV(e);const o=h.XpG();return h.Njj(o.showToc())})),h.nrm(2,"ion-icon",10),h.k0s()}2&e&&h.Y8G("ariaLabel",h.bMT(1,1,"addon.mod_imscp.toc"))}function AddonModImscpViewPage_ion_card_12_Template(e,o){if(1&e&&(h.j41(0,"ion-card",11)(1,"ion-item"),h.nrm(2,"ion-icon",12),h.j41(3,"ion-label"),h.nrm(4,"span",13),h.k0s()()()),2&e){const e=h.XpG();h.R7$(4),h.Y8G("innerHTML",e.warning,h.npT)}}function AddonModImscpViewPage_core_iframe_13_Template(e,o){if(1&e&&h.nrm(0,"core-iframe",14),2&e){const e=h.XpG();h.Y8G("src",e.src)("showFullscreenOnToolbar",!0)("autoFullscreenOnRotate",!0)}}function AddonModImscpViewPage_core_navigation_bar_14_Template(e,o){if(1&e){const e=h.RV6();h.j41(0,"core-navigation-bar",15),h.bIt("action",(function AddonModImscpViewPage_core_navigation_bar_14_Template_core_navigation_bar_action_0_listener(o){h.eBV(e);const t=h.XpG();return h.Njj(t.loadItem(o))})),h.k0s()}if(2&e){const e=h.XpG();h.Y8G("items",e.navigationItems)}}let R=(()=>{var e;class AddonModImscpViewPage{constructor(){this.title="",this.src="",this.warning="",this.navigationItems=[],this.loaded=!1,this.items=[]}ngOnInit(){try{this.cmId=d.CoreNavigator.getRequiredRouteNumberParam("cmId"),this.courseId=d.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.initialItemHref=d.CoreNavigator.getRouteParam("initialHref")}catch(e){return I.CoreAlerts.showError(e),d.CoreNavigator.back(),void 0}this.fetchContent()}fetchContent(e=!1){var o=this;return(0,r.A)((function*(){try{const{module:t,imscp:r}=yield o.loadImscpData();o.title=r.name;const n=yield o.downloadResourceIfNeeded(t,e),s=yield a.CoreCourse.getModuleContents(t,o.courseId);if(o.items=f.x.createItemList(s),o.items.length&&(o.initialItemHref&&o.items.some((e=>e.href===o.initialItemHref))&&(o.currentHref=o.initialItemHref),void 0===o.currentHref)){const e=yield f.x.getLastItemViewed(r.id);o.currentHref=void 0!==e?e:o.items[0].href}if(void 0===o.currentHref)throw new i.CoreError("Empty TOC");try{yield o.loadItemHref(o.currentHref)}catch(e){return I.CoreAlerts.showError(e,{default:m.HT.instant("addon.mod_imscp.deploymenterror")}),void 0}if(null!=n&&n.failed){const e=l.CoreErrorHelper.getErrorMessageFromError(n.error)||n.error;o.warning=m.HT.instant("core.errordownloadingsomefiles")+(e?` ${e}`:"")}else o.warning=""}catch(e){I.CoreAlerts.showError(e,{default:m.HT.instant("core.course.errorgetmodule")})}finally{o.loaded=!0}}))()}loadImscpData(){var e=this;return(0,r.A)((function*(){return e.module=yield a.CoreCourse.getModule(e.cmId,e.courseId),e.imscp=yield f.x.getImscp(e.courseId,e.cmId),{module:e.module,imscp:e.imscp}}))()}downloadResourceIfNeeded(e,o=!1){var t=this;return(0,r.A)((function*(){var r;const i={failed:!1};let d=!1;if((yield s.CoreCourseModulePrefetchDelegate.getModuleStatus(e,t.courseId,void 0,o))!==n.DownloadStatus.DOWNLOADED)try{yield s.CoreCourseModulePrefetchDelegate.downloadModule(e,t.courseId),d=!0}catch(e){i.failed=!0,i.error=e}if(null===(r=e.contents)||void 0===r||!r.length||o&&!d){const t=o&&c.WE.isOnline();try{yield a.CoreCourse.loadModuleContents(e,void 0,void 0,!1,t)}catch(o){if(t&&!e.contents)yield a.CoreCourse.loadModuleContents(e);else if(!e.contents)throw o}}return i}))()}doRefresh(e){var o=this;return(0,r.A)((function*(){yield u.g.ignoreErrors(Promise.all([f.x.invalidateContent(o.cmId,o.courseId),s.CoreCourseModulePrefetchDelegate.invalidateCourseUpdates(o.courseId)])),yield u.g.ignoreErrors(o.fetchContent(!0)),null==e||e.complete()}))()}loadItemHref(e){var o=this;return(0,r.A)((function*(){if(!o.module)return;const t=yield f.x.getIframeSrc(o.module,e);o.currentHref=e,o.navigationItems=o.items.map((e=>({item:e,current:e.href==o.currentHref,enabled:!!e.href}))),o.src&&t==o.src?(o.src="",setTimeout((()=>{o.src=t}))):o.src=t,o.imscp&&f.x.storeLastItemViewed(o.imscp.id,e,o.courseId)}))()}loadItem(e){this.loadItemHref(e.href)}showToc(){var e=this;return(0,r.A)((function*(){const{AddonModImscpTocComponent:o}=yield t.e(93158).then(t.bind(t,93158)),r=yield p.I.openSideModal({component:o,componentProps:{items:e.items,selected:e.currentHref}});r&&e.loadItemHref(r)}))()}}return(e=AddonModImscpViewPage).ɵfac=function AddonModImscpViewPage_Factory(o){return new(o||e)},e.ɵcmp=h.VBU({type:e,selectors:[["page-addon-mod-imscp-view"]],standalone:!0,features:[h.aNF],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["aria-haspopup","true",3,"ariaLabel","click",4,"ngIf"],[3,"hideUntil"],["class","core-warning-card",4,"ngIf"],[3,"src","showFullscreenOnToolbar","autoFullscreenOnRotate",4,"ngIf"],["collapsible-footer","","appearOnBottom","",3,"items","action",4,"ngIf"],["aria-haspopup","true",3,"click","ariaLabel"],["name","fas-list-ul","slot","icon-only","aria-hidden","true"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"innerHTML"],[3,"src","showFullscreenOnToolbar","autoFullscreenOnRotate"],["collapsible-footer","","appearOnBottom","",3,"action","items"]],template:function AddonModImscpViewPage_Template(e,o){1&e&&(h.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),h.nrm(3,"ion-back-button",1),h.nI1(4,"translate"),h.k0s(),h.j41(5,"ion-title")(6,"h1"),h.nrm(7,"core-format-text",2),h.k0s()(),h.j41(8,"ion-buttons",3),h.DNE(9,AddonModImscpViewPage_ion_button_9_Template,3,3,"ion-button",4),h.k0s()()(),h.j41(10,"ion-content")(11,"core-loading",5),h.DNE(12,AddonModImscpViewPage_ion_card_12_Template,5,1,"ion-card",6)(13,AddonModImscpViewPage_core_iframe_13_Template,1,3,"core-iframe",7),h.k0s(),h.DNE(14,AddonModImscpViewPage_core_navigation_bar_14_Template,1,1,"core-navigation-bar",8),h.k0s()),2&e&&(h.R7$(3),h.Y8G("text",h.bMT(4,9,"core.back")),h.R7$(4),h.Y8G("text",o.title)("contextInstanceId",o.cmId)("courseId",o.courseId),h.R7$(2),h.Y8G("ngIf",o.loaded),h.R7$(2),h.Y8G("hideUntil",o.loaded),h.R7$(),h.Y8G("ngIf",o.warning),h.R7$(),h.Y8G("ngIf",o.loaded),h.R7$(),h.Y8G("ngIf",o.loaded&&o.navigationItems.length>1))},dependencies:[g.n,_.bT,w.Jm,w.QW,w.b_,w.W9,w.eU,w.iq,w.uz,w.he,w.BC,w.ai,w.el,b.l,v.R,C.o,M.t,T.B,y.i,A.i,H.T,P.D9],encapsulation:2}),AddonModImscpViewPage})()}}]);