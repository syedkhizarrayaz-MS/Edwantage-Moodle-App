"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[83890],{83890:(e,t,a)=>{a.r(t),a.d(t,{default:()=>C});var s=a(10467),i=a(52749),n=a(58364),o=a(49882),r=a(87455),c=a(55554),l=a(86654),g=a(54438),p=a(60177),d=a(2910),u=a(64422),S=a(13988),h=a(69418),f=a(86198),m=a(88246),_=a(43570),U=a(73955),b=a(78913);const _c0=e=>({name:e});function CoreSettingsSpaceUsagePage_ng_template_18_ion_badge_0_Template(e,t){if(1&e&&(g.j41(0,"ion-badge",13),g.EFF(1),g.nI1(2,"coreBytesToSize"),g.k0s()),2&e){const e=g.XpG().site;g.R7$(),g.JRh(g.bMT(2,1,e.spaceUsage))}}function CoreSettingsSpaceUsagePage_ng_template_18_Template(e,t){if(1&e&&g.DNE(0,CoreSettingsSpaceUsagePage_ng_template_18_ion_badge_0_Template,3,3,"ion-badge",12),2&e){g.Y8G("ngIf",void 0!==t.site.spaceUsage)}}function CoreSettingsSpaceUsagePage_ng_template_20_Template(e,t){if(1&e){const e=g.RV6();g.j41(0,"ion-button",14),g.bIt("click",(function CoreSettingsSpaceUsagePage_ng_template_20_Template_ion_button_click_0_listener(){const t=g.eBV(e).site,a=g.XpG();return g.Njj(a.deleteSiteStorage(t))})),g.nrm(1,"ion-icon",15),g.nI1(2,"translate"),g.k0s()}if(2&e){const e=t.site;g.Y8G("hidden",e.spaceUsage<=0&&!e.hasCacheEntries),g.R7$(),g.BMQ("aria-label",g.i5U(2,2,"addon.storagemanager.deletedatafrom",g.eq3(5,_c0,e.siteName)))}}let C=(()=>{var e;class CoreSettingsSpaceUsagePage{constructor(){var e=this;this.loaded=!1,this.totalSpaceUsage=0,this.accountsList={sameSite:[],otherSites:[],count:0},this.sitesObserver=o.z.on(o.z.SITE_UPDATED,function(){var t=(0,s.A)((function*(t){var a;const s=t.siteId;let n=s===(null===(a=e.accountsList.currentSite)||void 0===a?void 0:a.id)?e.accountsList.currentSite:void 0;if(n||(n=e.accountsList.sameSite.find((e=>e.id===s))),n||e.accountsList.otherSites.some((e=>(n=e.find((e=>e.id===s)),n))),!n)return;const o=yield i.CoreSites.getSite(s),r=o.getInfo();n.siteName=yield o.getSiteName(),r&&(n.fullname=r.fullname)}));return function(e){return t.apply(this,arguments)}}())}ngOnInit(){this.loadSiteData().finally((()=>{this.loaded=!0}))}loadSiteData(){var e=this;return(0,s.A)((function*(){let t=0;const a=yield c.g.ignoreErrors(i.CoreSites.getSortedSites(),[]),s=yield Promise.all(a.map((t=>e.getSiteWithUsage(t))));let o="";const r=i.CoreSites.getCurrentSiteId();if(r){const a=s.findIndex((e=>e.id===r)),i=s.splice(a,1)[0];e.accountsList.currentSite=i,t+=i.spaceUsage||0,o=e.accountsList.currentSite.siteUrlWithoutProtocol}const l={};s.forEach((a=>{t+=a.spaceUsage||0,a.siteUrlWithoutProtocol===o?e.accountsList.sameSite.push(a):(void 0===l[a.siteUrlWithoutProtocol]&&(l[a.siteUrlWithoutProtocol]=[]),l[a.siteUrlWithoutProtocol].push(a))})),e.accountsList.otherSites=n.T.toArray(l),e.accountsList.count=a.length,e.totalSpaceUsage=t}))()}getSiteWithUsage(e){return(0,s.A)((function*(){const t=yield r.CoreSettingsHelper.getSiteSpaceUsage(e.id);return Object.assign(e,{hasCacheEntries:t.cacheEntries>0,spaceUsage:t.spaceUsage})}))()}refreshData(e){this.loadSiteData().finally((()=>{null==e||e.complete()}))}deleteSiteStorage(e){var t=this;return(0,s.A)((function*(){try{const a=yield r.CoreSettingsHelper.deleteSiteStorage(e.siteName||"",e.id);t.totalSpaceUsage-=e.spaceUsage-a.spaceUsage,e.spaceUsage=a.spaceUsage,e.hasCacheEntries=a.cacheEntries>0}catch{}}))()}ngOnDestroy(){this.sitesObserver.off()}}return(e=CoreSettingsSpaceUsagePage).ɵfac=function CoreSettingsSpaceUsagePage_Factory(t){return new(t||e)},e.ɵcmp=g.VBU({type:e,selectors:[["page-core-app-settings-space-usage"]],standalone:!0,features:[g.aNF],decls:30,vars:19,consts:[["siteLabel",""],["siteItem",""],["slot","start"],[3,"text"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["placeholderType","column","placeholderHeight","128px",3,"hideUntil","placeholderLimit"],[3,"accountsList"],[1,"item-heading"],["slot","end",1,"ion-margin-end"],["color","light",4,"ngIf"],["color","light"],["fill","clear","color","danger","slot","end",3,"click","hidden"],["name","fas-trash","slot","icon-only"]],template:function CoreSettingsSpaceUsagePage_Template(e,t){if(1&e){const e=g.RV6();g.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),g.nrm(3,"ion-back-button",3),g.nI1(4,"translate"),g.k0s(),g.j41(5,"ion-title")(6,"h1"),g.EFF(7),g.nI1(8,"translate"),g.k0s()(),g.j41(9,"ion-buttons",4),g.nrm(10,"core-navbar-buttons"),g.k0s()()(),g.j41(11,"ion-content",5)(12,"ion-refresher",6),g.bIt("ionRefresh",(function CoreSettingsSpaceUsagePage_Template_ion_refresher_ionRefresh_12_listener(a){return g.eBV(e),g.Njj(t.refreshData(a.target))})),g.nrm(13,"ion-refresher-content",7),g.nI1(14,"translate"),g.k0s(),g.j41(15,"core-loading",8)(16,"ion-list",5)(17,"core-sites-list",9),g.DNE(18,CoreSettingsSpaceUsagePage_ng_template_18_Template,1,1,"ng-template",null,0,g.C5r)(20,CoreSettingsSpaceUsagePage_ng_template_20_Template,3,7,"ng-template",null,1,g.C5r),g.k0s(),g.j41(22,"ion-item-divider")(23,"ion-label")(24,"p",10),g.EFF(25),g.nI1(26,"translate"),g.k0s()(),g.j41(27,"p",11),g.EFF(28),g.nI1(29,"coreBytesToSize"),g.k0s()()()()()}2&e&&(g.R7$(3),g.Y8G("text",g.bMT(4,9,"core.back")),g.R7$(4),g.JRh(g.bMT(8,11,"core.settings.spaceusage")),g.R7$(5),g.Y8G("disabled",!t.loaded),g.R7$(),g.FS9("pullingText",g.bMT(14,13,"core.pulltorefresh")),g.R7$(2),g.Y8G("hideUntil",t.loaded)("placeholderLimit",8),g.R7$(2),g.Y8G("accountsList",t.accountsList),g.R7$(8),g.JRh(g.bMT(26,15,"core.settings.total")),g.R7$(3),g.SpI(" ",g.bMT(29,17,t.totalSpaceUsage)," "))},dependencies:[l.n,p.bT,d.In,d.Jm,d.QW,d.W9,d.eU,d.iq,d.Dg,d.he,d.nf,d.To,d.Ki,d.BC,d.ai,d.el,u.R,S.c,h.L,f.t,m.i,_.T,U.D9,b.b],encapsulation:2}),CoreSettingsSpaceUsagePage})()}}]);