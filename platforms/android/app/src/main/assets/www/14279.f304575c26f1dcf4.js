"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[14279,69006],{14279:(e,n,o)=>{o.r(n),o.d(n,{AddonModChoiceIndexComponent:()=>S});var t=o(10467),i=o(75629),d=o(69006),c=o(51024),r=o(52749),s=o(24742),a=o(79555),l=o(49882),_=o(11793),u=o(68511),p=o(7265),h=o(72890),m=o(33014),f=o(25572),g=o(86654),C=o(30864),I=o(6736),x=o(15221),M=o(54438),b=o(2910),v=o(60177),A=o(89417),w=o(47222),R=o(69502),T=o(17388),y=o(97818),k=o(64422),G=o(13988),E=o(16658),$=o(86198),j=o(58197),O=o(37557),F=o(66731),N=o(43570),Y=o(73955);const _c0=e=>({option:e}),_c1=e=>({$a:e});function AddonModChoiceIndexComponent_Conditional_1_Template(e,n){if(1&e){const e=M.RV6();M.j41(0,"ion-button",8),M.nI1(1,"translate"),M.bIt("click",(function AddonModChoiceIndexComponent_Conditional_1_Template_ion_button_click_0_listener(){M.eBV(e);const n=M.XpG();return M.Njj(n.openModuleSummary())})),M.nrm(2,"ion-icon",9),M.k0s()}2&e&&M.Y8G("ariaLabel",M.bMT(1,1,"core.info"))}function AddonModChoiceIndexComponent_Conditional_2_Template(e,n){if(1&e){const e=M.RV6();M.j41(0,"core-context-menu")(1,"core-context-menu-item",10),M.nI1(2,"translate"),M.bIt("action",(function AddonModChoiceIndexComponent_Conditional_2_Template_core_context_menu_item_action_1_listener(){M.eBV(e);const n=M.XpG();return M.Njj(n.openModuleSummary())})),M.k0s()()}2&e&&(M.R7$(),M.Y8G("priority",5e3)("content",M.bMT(2,2,"core.info")))}function AddonModChoiceIndexComponent_ion_card_5_Template(e,n){1&e&&(M.j41(0,"ion-card",11)(1,"ion-item"),M.nrm(2,"ion-icon",12),M.j41(3,"ion-label")(4,"p"),M.EFF(5),M.nI1(6,"translate"),M.k0s()()()()),2&e&&(M.R7$(5),M.JRh(M.bMT(6,1,"addon.mod_choice.previewing")))}function AddonModChoiceIndexComponent_ion_card_6_Template(e,n){if(1&e&&(M.j41(0,"ion-card",11)(1,"ion-item"),M.nrm(2,"ion-icon",12),M.j41(3,"ion-label"),M.EFF(4),M.nI1(5,"translate"),M.k0s()()()),2&e){const e=M.XpG();M.R7$(4),M.JRh(M.bMT(5,1,e.publishInfo))}}function AddonModChoiceIndexComponent_ion_card_7_ng_container_1_ion_item_1_ng_container_2_Template(e,n){1&e&&M.eu8(0)}function AddonModChoiceIndexComponent_ion_card_7_ng_container_1_ion_item_1_Template(e,n){if(1&e){const e=M.RV6();M.j41(0,"ion-item",15)(1,"ion-checkbox",16),M.mxI("ngModelChange",(function AddonModChoiceIndexComponent_ion_card_7_ng_container_1_ion_item_1_Template_ion_checkbox_ngModelChange_1_listener(n){const o=M.eBV(e).$implicit;return M.DH7(o.checked,n)||(o.checked=n),M.Njj(n)})),M.DNE(2,AddonModChoiceIndexComponent_ion_card_7_ng_container_1_ion_item_1_ng_container_2_Template,1,0,"ng-container",17),M.k0s()()}if(2&e){const e=n.$implicit,o=M.XpG(3),t=M.sdS(13);M.R7$(),M.R50("ngModel",e.checked),M.Y8G("disabled",e.disabled||o.showPreview),M.R7$(),M.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",M.eq3(4,_c0,e))}}function AddonModChoiceIndexComponent_ion_card_7_ng_container_1_Template(e,n){if(1&e&&(M.qex(0),M.DNE(1,AddonModChoiceIndexComponent_ion_card_7_ng_container_1_ion_item_1_Template,3,6,"ion-item",14),M.bVm()),2&e){const e=M.XpG(2);M.R7$(),M.Y8G("ngForOf",e.options)}}function AddonModChoiceIndexComponent_ion_card_7_ion_radio_group_2_ion_item_1_ng_container_2_Template(e,n){1&e&&M.eu8(0)}function AddonModChoiceIndexComponent_ion_card_7_ion_radio_group_2_ion_item_1_Template(e,n){if(1&e&&(M.j41(0,"ion-item",15)(1,"ion-radio",19),M.DNE(2,AddonModChoiceIndexComponent_ion_card_7_ion_radio_group_2_ion_item_1_ng_container_2_Template,1,0,"ng-container",17),M.k0s()()),2&e){const e=n.$implicit,o=M.XpG(3),t=M.sdS(13);M.R7$(),M.Y8G("value",e.id)("disabled",e.disabled||o.showPreview),M.R7$(),M.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",M.eq3(4,_c0,e))}}function AddonModChoiceIndexComponent_ion_card_7_ion_radio_group_2_Template(e,n){if(1&e){const e=M.RV6();M.j41(0,"ion-radio-group",18),M.mxI("ngModelChange",(function AddonModChoiceIndexComponent_ion_card_7_ion_radio_group_2_Template_ion_radio_group_ngModelChange_0_listener(n){M.eBV(e);const o=M.XpG(2);return M.DH7(o.selectedOption.id,n)||(o.selectedOption.id=n),M.Njj(n)})),M.DNE(1,AddonModChoiceIndexComponent_ion_card_7_ion_radio_group_2_ion_item_1_Template,3,6,"ion-item",14),M.k0s()}if(2&e){const e=M.XpG(2);M.R50("ngModel",e.selectedOption.id),M.R7$(),M.Y8G("ngForOf",e.options)}}function AddonModChoiceIndexComponent_ion_card_7_Template(e,n){if(1&e&&(M.j41(0,"ion-card"),M.DNE(1,AddonModChoiceIndexComponent_ion_card_7_ng_container_1_Template,2,1,"ng-container",6)(2,AddonModChoiceIndexComponent_ion_card_7_ion_radio_group_2_Template,2,2,"ion-radio-group",13),M.k0s()),2&e){const e=M.XpG();M.R7$(),M.Y8G("ngIf",e.choice.allowmultiple),M.R7$(),M.Y8G("ngIf",!e.choice.allowmultiple)}}function AddonModChoiceIndexComponent_ion_card_8_ng_container_6_ion_item_1_Template(e,n){if(1&e&&(M.j41(0,"ion-item",15)(1,"ion-label"),M.nrm(2,"core-format-text",22),M.k0s()()),2&e){const e=M.XpG().$implicit,n=M.XpG(2);M.R7$(2),M.Y8G("text",e.text)("contextInstanceId",n.module.id)("courseId",n.courseId)}}function AddonModChoiceIndexComponent_ion_card_8_ng_container_6_Template(e,n){if(1&e&&(M.qex(0),M.DNE(1,AddonModChoiceIndexComponent_ion_card_8_ng_container_6_ion_item_1_Template,3,3,"ion-item",21),M.bVm()),2&e){const e=n.$implicit;M.R7$(),M.Y8G("ngIf",e.checked)}}function AddonModChoiceIndexComponent_ion_card_8_Template(e,n){if(1&e&&(M.j41(0,"ion-card")(1,"ion-item-divider")(2,"ion-label")(3,"h2"),M.EFF(4),M.nI1(5,"translate"),M.k0s()()(),M.DNE(6,AddonModChoiceIndexComponent_ion_card_8_ng_container_6_Template,2,1,"ng-container",20),M.k0s()),2&e){const e=M.XpG();M.R7$(4),M.JRh(M.bMT(5,2,"addon.mod_choice.yourselection")),M.R7$(2),M.Y8G("ngForOf",e.options)}}function AddonModChoiceIndexComponent_ng_container_9_Conditional_6_Template(e,n){if(1&e){const e=M.RV6();M.j41(0,"core-group-selector",30),M.mxI("selectedChange",(function AddonModChoiceIndexComponent_ng_container_9_Conditional_6_Template_core_group_selector_selectedChange_0_listener(n){M.eBV(e);const o=M.XpG(2);return M.DH7(o.groupId,n)||(o.groupId=n),M.Njj(n)})),M.bIt("selectedChange",(function AddonModChoiceIndexComponent_ng_container_9_Conditional_6_Template_core_group_selector_selectedChange_0_listener(){M.eBV(e);const n=M.XpG(2);return M.Njj(n.groupChanged())})),M.k0s()}if(2&e){const e=M.XpG(2);M.Y8G("groupInfo",e.groupInfo),M.R50("selected",e.groupId),M.Y8G("courseId",e.courseId)}}function AddonModChoiceIndexComponent_ng_container_9_ion_item_11_Template(e,n){1&e&&(M.j41(0,"ion-item",31),M.nrm(1,"ion-icon",32),M.j41(2,"ion-label"),M.EFF(3),M.nI1(4,"translate"),M.k0s()()),2&e&&(M.R7$(3),M.JRh(M.bMT(4,1,"addon.mod_choice.resultsnotsynced")))}function AddonModChoiceIndexComponent_ng_container_9_ion_col_15_ion_item_group_1_p_11_Template(e,n){if(1&e&&(M.j41(0,"p"),M.EFF(1),M.nI1(2,"translate"),M.k0s()),2&e){const e=M.XpG().$implicit;M.R7$(),M.SpI(" ",M.i5U(2,1,"addon.mod_choice.limita",M.eq3(4,_c1,e.maxanswer))," ")}}function AddonModChoiceIndexComponent_ng_container_9_ion_col_15_ion_item_group_1_ng_container_12_ion_item_1_Template(e,n){if(1&e&&(M.j41(0,"ion-item",37),M.nrm(1,"core-user-avatar",38),M.j41(2,"ion-label")(3,"p"),M.EFF(4),M.k0s()()()),2&e){const e=n.$implicit,o=M.XpG(5);M.Y8G("courseId",o.courseId)("userId",e.userid),M.BMQ("aria-label",e.fullname),M.R7$(),M.Y8G("user",e)("courseId",o.courseId)("linkProfile",!1),M.R7$(3),M.JRh(e.fullname)}}function AddonModChoiceIndexComponent_ng_container_9_ion_col_15_ion_item_group_1_ng_container_12_Template(e,n){if(1&e&&(M.qex(0),M.DNE(1,AddonModChoiceIndexComponent_ng_container_9_ion_col_15_ion_item_group_1_ng_container_12_ion_item_1_Template,5,7,"ion-item",36),M.bVm()),2&e){const e=M.XpG().$implicit;M.R7$(),M.Y8G("ngForOf",e.userresponses)}}function AddonModChoiceIndexComponent_ng_container_9_ion_col_15_ion_item_group_1_Template(e,n){if(1&e){const e=M.RV6();M.j41(0,"ion-item-group")(1,"ion-item",33),M.nI1(2,"translate"),M.bIt("click",(function AddonModChoiceIndexComponent_ng_container_9_ion_col_15_ion_item_group_1_Template_ion_item_click_1_listener(){const n=M.eBV(e).$implicit,o=M.XpG(3);return M.Njj(o.toggle(n))})),M.nrm(3,"ion-icon",34),M.j41(4,"ion-label")(5,"h3",35),M.nrm(6,"core-format-text",22),M.k0s(),M.j41(7,"p"),M.EFF(8),M.nI1(9,"translate"),M.nI1(10,"translate"),M.k0s(),M.DNE(11,AddonModChoiceIndexComponent_ng_container_9_ion_col_15_ion_item_group_1_p_11_Template,3,6,"p",6),M.k0s()(),M.DNE(12,AddonModChoiceIndexComponent_ng_container_9_ion_col_15_ion_item_group_1_ng_container_12_Template,2,1,"ng-container",6),M.k0s()}if(2&e){const e=n.$implicit,o=M.XpG(3);M.R7$(),M.Y8G("button",e.numberofuser>0)("detail",!1),M.BMQ("aria-label",M.bMT(2,14,e.expanded?"core.collapse":"core.expand")),M.R7$(2),M.AVh("expandable-status-icon-expanded",e.expanded),M.Y8G("name",e.numberofuser>0?"fas-chevron-right":""),M.R7$(3),M.Y8G("text",e.text)("contextInstanceId",o.module.id)("courseId",o.courseId),M.R7$(2),M.E5c(" ",M.bMT(9,16,"addon.mod_choice.numberofuser"),": ",e.numberofuser," (",M.i5U(10,18,"core.percentagenumber",M.eq3(21,_c1,e.percentageamountfixed)),") "),M.R7$(3),M.Y8G("ngIf",o.choice.limitanswers&&o.choice.showavailable),M.R7$(),M.Y8G("ngIf",e.expanded)}}function AddonModChoiceIndexComponent_ng_container_9_ion_col_15_Template(e,n){if(1&e&&(M.j41(0,"ion-col",26),M.DNE(1,AddonModChoiceIndexComponent_ng_container_9_ion_col_15_ion_item_group_1_Template,13,23,"ion-item-group",20),M.k0s()),2&e){const e=M.XpG(2);M.R7$(),M.Y8G("ngForOf",e.results)}}function AddonModChoiceIndexComponent_ng_container_9_Template(e,n){if(1&e&&(M.qex(0),M.j41(1,"ion-item-divider")(2,"ion-label")(3,"h2"),M.EFF(4),M.nI1(5,"translate"),M.k0s()()(),M.DNE(6,AddonModChoiceIndexComponent_ng_container_9_Conditional_6_Template,1,3,"core-group-selector",23),M.j41(7,"core-loading",24)(8,"ion-grid",25)(9,"ion-row")(10,"ion-col",26),M.DNE(11,AddonModChoiceIndexComponent_ng_container_9_ion_item_11_Template,5,3,"ion-item",27),M.j41(12,"ion-item")(13,"ion-label"),M.nrm(14,"core-chart",28),M.k0s()()(),M.DNE(15,AddonModChoiceIndexComponent_ng_container_9_ion_col_15_Template,2,1,"ion-col",29),M.k0s()()(),M.bVm()),2&e){const e=M.XpG();M.R7$(4),M.JRh(M.bMT(5,10,"addon.mod_choice.responses")),M.R7$(2),M.vxM(6,e.groupsSupported&&e.groupInfo?6:-1),M.R7$(),M.Y8G("hideUntil",!e.showResultsLoading)("fullscreen",!1),M.R7$(4),M.Y8G("ngIf",e.hasOffline),M.R7$(3),M.Y8G("data",e.data)("labels",e.labels)("contextInstanceId",e.module.id)("courseId",e.courseId),M.R7$(),M.Y8G("ngIf",e.choice.publish&&e.results)}}function AddonModChoiceIndexComponent_ion_card_10_Template(e,n){1&e&&(M.j41(0,"ion-card",11)(1,"ion-item"),M.nrm(2,"ion-icon",12),M.j41(3,"ion-label")(4,"p"),M.EFF(5),M.nI1(6,"translate"),M.k0s()()()()),2&e&&(M.R7$(5),M.JRh(M.bMT(6,1,"addon.mod_choice.noresultsviewable")))}function AddonModChoiceIndexComponent_div_11_div_1_ion_button_1_Template(e,n){if(1&e){const e=M.RV6();M.j41(0,"ion-button",45),M.bIt("click",(function AddonModChoiceIndexComponent_div_11_div_1_ion_button_1_Template_ion_button_click_0_listener(){M.eBV(e);const n=M.XpG(3);return M.Njj(n.delete())})),M.EFF(1),M.nI1(2,"translate"),M.k0s()}2&e&&(M.R7$(),M.SpI(" ",M.bMT(2,1,"addon.mod_choice.removemychoice")," "))}function AddonModChoiceIndexComponent_div_11_div_1_ion_button_2_Template(e,n){if(1&e){const e=M.RV6();M.j41(0,"ion-button",46),M.bIt("click",(function AddonModChoiceIndexComponent_div_11_div_1_ion_button_2_Template_ion_button_click_0_listener(){M.eBV(e);const n=M.XpG(3);return M.Njj(n.save())})),M.EFF(1),M.nI1(2,"translate"),M.k0s()}if(2&e){const e=M.XpG(3);M.Y8G("disabled",!e.canSave()),M.R7$(),M.SpI(" ",M.bMT(2,2,"addon.mod_choice.savemychoice")," ")}}function AddonModChoiceIndexComponent_div_11_div_1_Template(e,n){if(1&e&&(M.j41(0,"div",42),M.DNE(1,AddonModChoiceIndexComponent_div_11_div_1_ion_button_1_Template,3,3,"ion-button",43)(2,AddonModChoiceIndexComponent_div_11_div_1_ion_button_2_Template,3,4,"ion-button",44),M.k0s()),2&e){const e=M.XpG(2);M.R7$(),M.Y8G("ngIf",e.canDelete),M.R7$(),M.Y8G("ngIf",e.canEdit)}}function AddonModChoiceIndexComponent_div_11_Template(e,n){if(1&e&&(M.j41(0,"div",39),M.DNE(1,AddonModChoiceIndexComponent_div_11_div_1_Template,3,2,"div",40),M.nrm(2,"core-course-module-navigation",41),M.k0s()),2&e){const e=M.XpG();M.R7$(),M.Y8G("ngIf",e.options.length&&e.choice&&(e.canEdit||e.canDelete)),M.R7$(),M.Y8G("courseId",e.courseId)("currentModuleId",e.module.id)}}function AddonModChoiceIndexComponent_ng_template_12_span_2_Template(e,n){1&e&&(M.j41(0,"span"),M.EFF(1),M.nI1(2,"translate"),M.k0s()),2&e&&(M.R7$(),M.SpI(" ",M.bMT(2,1,"addon.mod_choice.full")," "))}function AddonModChoiceIndexComponent_ng_template_12_ng_container_3_Template(e,n){if(1&e&&(M.qex(0),M.j41(1,"p"),M.EFF(2),M.nI1(3,"translate"),M.k0s(),M.j41(4,"p"),M.EFF(5),M.nI1(6,"translate"),M.k0s(),M.bVm()),2&e){const e=M.XpG().option;M.R7$(2),M.JRh(M.i5U(3,2,"addon.mod_choice.responsesa",M.eq3(8,_c1,e.countanswers))),M.R7$(3),M.JRh(M.i5U(6,5,"addon.mod_choice.limita",M.eq3(10,_c1,e.maxanswers)))}}function AddonModChoiceIndexComponent_ng_template_12_Template(e,n){if(1&e&&(M.j41(0,"p",35),M.nrm(1,"core-format-text",22),M.DNE(2,AddonModChoiceIndexComponent_ng_template_12_span_2_Template,3,3,"span",6),M.k0s(),M.DNE(3,AddonModChoiceIndexComponent_ng_template_12_ng_container_3_Template,7,12,"ng-container",6)),2&e){const e=n.option,o=M.XpG();M.R7$(),M.Y8G("text",e.text)("contextInstanceId",o.module.id)("courseId",o.courseId),M.R7$(),M.Y8G("ngIf",o.choice.limitanswers&&e.countanswers>=e.maxanswers),M.R7$(),M.Y8G("ngIf",o.choice.limitanswers&&o.choice.showavailable)}}let S=(()=>{var e;class AddonModChoiceIndexComponent extends d.y{constructor(e,n){super("AddonModChoiceIndexComponent",e,n),this.content=e,this.component=h.ou,this.pluginName="choice",this.options=[],this.selectedOption={id:-1},this.showPreview=!1,this.showResultsMessage=!1,this.canEdit=!1,this.canDelete=!1,this.canSeeResults=!1,this.showResultsLoading=!0,this.data=[],this.labels=[],this.results=[],this.groupsSupported=!1,this.groupId=0,this.syncEventName=h.zp,this.hasAnsweredOnline=!1,this.now=s.j.timestamp()}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,e=this;return(0,t.A)((function*(){_superprop_getNgOnInit().call(e),e.userId=r.CoreSites.getCurrentSiteUserId();try{yield e.loadContent(!1,!0)}finally{e.showResultsLoading=!1}}))()}invalidateContent(){var e=this;return(0,t.A)((function*(){const n=[];n.push(_.u.invalidateChoiceData(e.courseId)),e.choice&&(n.push(_.u.invalidateOptions(e.choice.id)),n.push(_.u.invalidateResults(e.choice.id))),yield Promise.all(n)}))()}isRefreshSyncNeeded(e){var n;return!(!this.choice||e.choiceId!=this.choice.id||e.userId!=this.userId)&&(null===(n=this.content)||void 0===n||n.scrollToTop(),!0)}fetchContent(e,n=!1,o=!1){var i=this;return(0,t.A)((function*(){if(i.now=s.j.timestamp(),i.choice=yield _.u.getChoice(i.courseId,i.module.id),n){(yield i.syncActivity(o))&&(i.choice=yield _.u.getChoice(i.courseId,i.module.id))}i.description=i.choice.intro,i.dataRetrieved.emit(i.choice),i.hasOffline=yield u.R.hasResponse(i.choice.id),yield i.fetchOptions(i.choice),yield i.fetchGroupsAndResults(i.choice)}))()}fetchOptions(e){var n=this;return(0,t.A)((function*(){let o=yield _.u.getOptions(e.id,{cmId:n.module.id});n.hasAnsweredOnline=o.some((e=>e.checked)),n.hasOffline&&(o=yield n.getOfflineResponses(e,o));const t=_.u.choiceHasBeenOpened(e,n.now)&&!_.u.choiceHasBeenClosed(e,n.now);n.selectedOption={id:-1};const i=o.some((o=>!!o.checked&&(e.allowmultiple||(n.selectedOption.id=o.id),!0)));n.canEdit=t&&(!!e.allowupdate||!i),n.canDelete=t&&!!e.allowupdate&&i,n.options=o,n.setPublishInfo(e,i)}))()}setPublishInfo(e,n){const o=!_.u.choiceHasBeenOpened(e,this.now)&&!_.u.choiceHasBeenClosed(e,this.now);if(!e.allowupdate&&n||!o)return this.showPreview=!1,this.showResultsMessage=!0,this.publishInfo="",void 0;switch(this.showResultsMessage=!1,this.showPreview=!!e.showpreview,e.showresults){case 0:this.publishInfo="addon.mod_choice.publishinfonever";break;case 1:this.publishInfo=e.publish===h.MO?"addon.mod_choice.publishinfoanonafter":"addon.mod_choice.publishinfofullafter";break;case 2:this.publishInfo=e.publish===h.MO?"addon.mod_choice.publishinfoanonclose":"addon.mod_choice.publishinfofullclose";break;default:this.publishInfo=""}}getOfflineResponses(e,n){return(0,t.A)((function*(){const o=yield u.R.getResponse(e.id),t={};return n.forEach((e=>{t[e.id]=e})),o.deleting?o.responses.length>0?o.responses.forEach((e=>{t[e]&&t[e].checked&&(t[e].checked=!1,t[e].countanswers--)})):Object.keys(t).forEach((e=>{t[e].checked&&(t[e].checked=!1,t[e].countanswers--)})):(Object.keys(t).forEach((e=>{t[e].checked&&(t[e].checked=!1,t[e].countanswers--)})),o.responses.forEach((e=>{t[e]&&(t[e].checked=!0,t[e].countanswers++)}))),Object.keys(t).map((e=>t[e]))}))()}fetchGroupsAndResults(e){var n=this;return(0,t.A)((function*(){if(!_.u.choiceHasBeenOpened(e,n.now))return n.canSeeResults=!1,void 0;n.groupsSupported=yield _.u.areGroupsSupported(),n.groupsSupported&&(n.groupInfo=yield x.CoreGroups.getActivityGroupInfo(n.module.id,!1),n.groupId=x.CoreGroups.validateGroupId(n.groupId,n.groupInfo)),yield n.fetchResults(e)}))()}fetchResults(e){var n=this;return(0,t.A)((function*(){if(!_.u.choiceHasBeenOpened(e,n.now))return n.canSeeResults=!1,void 0;const o=yield _.u.getResults(e.id,{cmId:n.module.id,groupId:n.groupId});let t=!1;n.data=[],n.labels=[],n.results=o.map((e=>(e.numberofuser>0&&(t=!0),n.data.push(e.numberofuser),n.labels.push(e.text),Object.assign(e,{percentageamountfixed:e.percentageamount.toFixed(1)})))),n.canSeeResults=t||_.u.canStudentSeeResults(e,n.hasAnsweredOnline,n.now)}))()}logActivity(){var e=this;return(0,t.A)((function*(){e.choice&&(yield _.u.logView(e.choice.id),e.analyticsLogEvent("mod_choice_view_choice"))}))()}canSave(){return!!this.choice&&(this.choice.allowmultiple?this.options.some((e=>e.checked)):-1!==this.selectedOption.id)}save(){var e=this;return(0,t.A)((function*(){if(!e.choice)return;e.choice.allowupdate||(yield f.CoreAlerts.confirm(a.HT.instant("core.areyousure")));const n=[];e.choice.allowmultiple?e.options.forEach((e=>{e.checked&&n.push(e.id)})):n.push(e.selectedOption.id);const o=yield m.CoreLoadings.show("core.sending",!0);try{var t;const o=yield _.u.submitResponse(e.choice.id,e.choice.name,e.courseId,n);null===(t=e.content)||void 0===t||t.scrollToTop(),o&&(l.z.trigger(l.z.ACTIVITY_DATA_SENT,{module:e.moduleName}),e.checkCompletion()),e.analyticsLogEvent("mod_choice_view_choice",{data:{notify:"choicesaved"}}),yield e.dataUpdated(o)}catch(e){f.CoreAlerts.showError(e,{default:a.HT.instant("addon.mod_choice.cannotsubmit")})}finally{o.dismiss()}}))()}delete(){var e=this;return(0,t.A)((function*(){if(!e.choice)return;try{yield f.CoreAlerts.confirmDelete(a.HT.instant("core.areyousure"))}catch{return}const n=yield m.CoreLoadings.show("core.sending",!0);try{var o;yield _.u.deleteResponses(e.choice.id,e.choice.name,e.courseId),null===(o=e.content)||void 0===o||o.scrollToTop(),e.analyticsLogEvent("mod_choice_view_choice",{data:{action:"delchoice"}}),yield e.refreshContent(!1)}catch(e){f.CoreAlerts.showError(e,{default:a.HT.instant("addon.mod_choice.cannotsubmit")})}finally{n.dismiss()}}))()}dataUpdated(e){var n=this;return(0,t.A)((function*(){if(!e||!n.isPrefetched())return n.refreshContent(!1);try{yield p.j.prefetchModuleAfterUpdate(n.module,n.courseId),n.showLoadingAndFetch(!1,!1)}catch{return n.refreshContent(!1)}}))()}toggle(e){e.expanded=!e.expanded}sync(){if(!this.choice)throw new i.CoreError("Cannot sync without a choice.");return p.j.syncChoice(this.choice.id,this.userId)}groupChanged(){var e=this;return(0,t.A)((function*(){if(e.choice){e.showResultsLoading=!0;try{yield e.fetchResults(e.choice)}catch(e){f.CoreAlerts.showError(e)}finally{e.showResultsLoading=!1}}}))()}}return(e=AddonModChoiceIndexComponent).ɵfac=function AddonModChoiceIndexComponent_Factory(n){return new(n||e)(M.rXU(b.W9),M.rXU(c.A,8))},e.ɵcmp=M.VBU({type:e,selectors:[["addon-mod-choice-index"]],standalone:!0,features:[M.Vt3,M.aNF],decls:14,vars:15,consts:[["optionLabelTemplate",""],["slot","end"],["fill","clear","aria-haspopup","true",3,"ariaLabel"],[3,"hideUntil"],[3,"completionChanged","module","description","component","componentId","courseId","hasDataToSync"],["class","core-info-card",4,"ngIf"],[4,"ngIf"],["collapsible-footer","","slot","fixed",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click","ariaLabel"],["name","fas-circle-info","slot","icon-only","aria-hidden","true"],["iconAction","fas-circle-info",3,"action","priority","content"],[1,"core-info-card"],["name","fas-circle-info","slot","start","aria-hidden","true"],[3,"ngModel","ngModelChange",4,"ngIf"],["class","ion-text-wrap",4,"ngFor","ngForOf"],[1,"ion-text-wrap"],[3,"ngModelChange","ngModel","disabled"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"ngModelChange","ngModel"],[3,"value","disabled"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[3,"groupInfo","selected","courseId"],[3,"hideUntil","fullscreen"],[1,"ion-no-padding","addon-mod-choice-chart-results"],["size","12","size-lg","6"],["class","ion-text-wrap core-warning-item",4,"ngIf"],["type","pie","height","300","contextLevel","module",3,"data","labels","contextInstanceId","courseId"],["size","12","size-lg","6",4,"ngIf"],[3,"selectedChange","groupInfo","selected","courseId"],[1,"ion-text-wrap","core-warning-item"],["slot","start","name","fas-triangle-exclamation","color","warning","aria-hidden","true"],[1,"divider","ion-text-wrap",3,"click","button","detail"],["flip-rtl","","slot","start","aria-hidden","true",1,"expandable-status-icon",3,"name"],[1,"item-heading"],["core-user-link","","class","ion-text-wrap",3,"courseId","userId",4,"ngFor","ngForOf"],["core-user-link","",1,"ion-text-wrap",3,"courseId","userId"],["slot","start",3,"user","courseId","linkProfile"],["collapsible-footer","","slot","fixed"],["class","list-item-limited-width adaptable-buttons-row",4,"ngIf"],[3,"courseId","currentModuleId"],[1,"list-item-limited-width","adaptable-buttons-row"],["expand","block","fill","outline","class","ion-margin ion-text-wrap",3,"click",4,"ngIf"],["expand","block","class","ion-margin ion-text-wrap",3,"disabled","click",4,"ngIf"],["expand","block","fill","outline",1,"ion-margin","ion-text-wrap",3,"click"],["expand","block",1,"ion-margin","ion-text-wrap",3,"click","disabled"]],template:function AddonModChoiceIndexComponent_Template(e,n){if(1&e){const e=M.RV6();M.j41(0,"core-navbar-buttons",1),M.DNE(1,AddonModChoiceIndexComponent_Conditional_1_Template,3,3,"ion-button",2)(2,AddonModChoiceIndexComponent_Conditional_2_Template,3,4),M.k0s(),M.j41(3,"core-loading",3)(4,"core-course-module-info",4),M.bIt("completionChanged",(function AddonModChoiceIndexComponent_Template_core_course_module_info_completionChanged_4_listener(){return M.eBV(e),M.Njj(n.onCompletionChange())})),M.k0s(),M.DNE(5,AddonModChoiceIndexComponent_ion_card_5_Template,7,3,"ion-card",5)(6,AddonModChoiceIndexComponent_ion_card_6_Template,6,3,"ion-card",5)(7,AddonModChoiceIndexComponent_ion_card_7_Template,3,2,"ion-card",6)(8,AddonModChoiceIndexComponent_ion_card_8_Template,7,4,"ion-card",6)(9,AddonModChoiceIndexComponent_ng_container_9_Template,16,12,"ng-container",6)(10,AddonModChoiceIndexComponent_ion_card_10_Template,7,3,"ion-card",5)(11,AddonModChoiceIndexComponent_div_11_Template,3,3,"div",7),M.k0s(),M.DNE(12,AddonModChoiceIndexComponent_ng_template_12_Template,4,5,"ng-template",null,0,M.C5r)}2&e&&(M.R7$(),M.vxM(1,n.courseContentsPage?2:1),M.R7$(2),M.Y8G("hideUntil",!n.showLoading),M.R7$(),M.Y8G("module",n.module)("description",n.description)("component",n.component)("componentId",n.componentId)("courseId",n.courseId)("hasDataToSync",n.hasOffline),M.R7$(),M.Y8G("ngIf",n.showPreview&&n.options.length),M.R7$(),M.Y8G("ngIf",n.publishInfo&&n.options.length),M.R7$(),M.Y8G("ngIf",n.options.length&&n.choice&&(n.canEdit||n.showPreview)),M.R7$(),M.Y8G("ngIf",n.options.length&&n.choice&&!n.canEdit&&!n.showPreview),M.R7$(),M.Y8G("ngIf",n.canSeeResults&&n.choice),M.R7$(),M.Y8G("ngIf",!n.canSeeResults&&n.showResultsMessage),M.R7$(),M.Y8G("ngIf",!n.showLoading))},dependencies:[g.n,v.Sq,v.bT,v.T3,A.BC,A.vS,b.Jm,b.b_,b.eY,b.hU,b.lO,b.iq,b.uz,b.Dg,b.jh,b.he,b.KO,b.f0,b.ln,b.hB,b.Je,w.B,R.B,T.Q,y.F,k.R,G.c,E.T,$.t,j.B,O.O,F.i,N.T,Y.D9,I.CoreCourseModuleInfoComponent,C.CoreCourseModuleNavigationComponent],styles:["[_nghost-%COMP%]   .addon-mod-choice-chart-results[_ngcontent-%COMP%]{width:100%}"]}),AddonModChoiceIndexComponent})()},69006:(e,n,o)=>{o.d(n,{y:()=>m});var t=o(10467),i=o(23063),d=o(49882),c=o(44682),r=o(55554),s=o(51024),a=o(52749),l=o(25572),_=o(79555),u=o(95384),p=o(54438),h=o(2910);let m=(()=>{var e;class CoreCourseModuleMainActivityComponent extends i.x{constructor(e="CoreCourseModuleMainResourceComponent",n,o){super(e,o),this.content=n,this.moduleName=""}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,e=this;return(0,t.A)((function*(){yield _superprop_getNgOnInit().call(e),e.hasOffline=!1,e.moduleName=u.CoreCourseModuleHelper.translateModuleName(e.pluginName||e.moduleName||""),e.syncEventName&&(e.syncObserver=d.z.on(e.syncEventName,(n=>{e.autoSyncEventReceived(n)}),e.siteId))}))()}isRefreshSyncNeeded(e){return!1}autoSyncEventReceived(e){this.isRefreshSyncNeeded(e)&&this.showLoadingAndRefresh(!1)}refreshContent(e=!1,n=!1){var o=this;return(0,t.A)((function*(){o.module&&(yield r.g.ignoreErrors(Promise.all([o.invalidateContent(),o.showCompletion?c.CoreCourse.invalidateModule(o.module.id):void 0])),yield o.loadContent(!0,e,n))}))()}showLoadingAndFetch(e=!1,n=!1){var o=this;return(0,t.A)((function*(){var t;o.showLoading=!0,null===(t=o.content)||void 0===t||t.scrollToTop(),yield o.loadContent(!1,e,n)}))()}showLoadingAndRefresh(e=!1,n=!1){var o;return this.showLoading=!0,null===(o=this.content)||void 0===o||o.scrollToTop(),this.refreshContent(e,n)}fetchContent(e=!1,n=!1,o=!1){return(0,t.A)((function*(){}))()}loadContent(e,n=!1,o=!1){var i=this;return(0,t.A)((function*(){if(i.module)try{e&&i.showCompletion&&(yield r.g.ignoreErrors(i.fetchModule())),yield i.fetchContent(e,n,o),i.finishSuccessfulFetch()}catch(o){var t;if(!e&&(null===(t=a.CoreSites.getCurrentSite())||void 0===t||!t.isOfflineDisabled())&&u.CoreCourseModuleHelper.isNotFoundError(o))return yield i.refreshContent(n);l.CoreAlerts.showError(o,{default:_.HT.instant(i.fetchContentDefaultError)})}finally{i.showLoading=!1}}))()}sync(){return(0,t.A)((function*(){return{updated:!1,warnings:[]}}))()}hasSyncSucceed(e){return e.updated}syncActivity(e=!1){var n=this;return(0,t.A)((function*(){try{const e=yield n.sync();return e.warnings.length&&l.CoreAlerts.show({message:e.warnings[0]}),n.hasSyncSucceed(e)}catch(n){return e&&l.CoreAlerts.showError(n,{default:_.HT.instant("core.errorsync")}),!1}}))()}ngOnDestroy(){var e;super.ngOnDestroy(),null===(e=this.syncObserver)||void 0===e||e.off()}}return(e=CoreCourseModuleMainActivityComponent).ɵfac=function CoreCourseModuleMainActivityComponent_Factory(n){return new(n||e)(p.rXU("",8),p.rXU(h.W9),p.rXU(s.A))},e.ɵcmp=p.VBU({type:e,selectors:[["ng-component"]],inputs:{group:"group"},features:[p.Vt3],decls:0,vars:0,template:function CoreCourseModuleMainActivityComponent_Template(e,n){},encapsulation:2}),CoreCourseModuleMainActivityComponent})()}}]);