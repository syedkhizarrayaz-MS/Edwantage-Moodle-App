"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[66562],{66562:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Y});var o=r(10467),i=r(15324),a=r(52749),s=r(48966),n=r(24742),c=r(55554),d=r(49882),l=r(81690),m=r(1717),u=r(50891);let h="^[\\u0000-\\uFFFF]{0,255}$",f="^[\\u0000-\\uFFFF]{0,4096}$";const v="^([0-2]{1}[0-9]{1}):([0-5]{1}[0-9]{1}):([0-5]{1}[0-9]{1})(.[0-9]{1,2})?$",p="^([0-9]{2,4}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$",g="^-?([0-9]+)$",_="^-?([0-9]{0,3})(.[0-9]*)?$",I="^[\\u0021-\\u007E]{0,255}$",w=h,S="[._](\\d+).",y="raw,min,max",b="0#100",T={0:"No error",101:"General exception",201:"Invalid argument error",202:"Element cannot have children",203:"Element not an array - cannot have count",301:"Not initialized",401:"Not implemented error",402:"Invalid set value, element is a keyword",403:"Element is read only",404:"Element is write only",405:"Incorrect data type"};class AddonModScormDataModel12{constructor(e,t,r,o,i,a="normal",s=!1,n=!0){this.siteId=e,this.scorm=t,this.scoId=r,this.attempt=o,this.userData=i,this.mode=a,this.offline=s,this.canSaveTracks=n,this.currentUserData={},this.def={},this.defExtra={},this.dataModel={},this.initialized=!1,this.errorCode="0",this.init(i)}addTime(e,t){const r=e.split(":"),o=t.split(":"),i=r[2].split("."),a=o[2].split(".");let s=0,n=0;i.length>1&&(n=parseInt(i[1],10));let c=0;a.length>1&&(c=parseInt(a[1],10));let d=n+c;s=Math.floor(d/100),d-=100*s,Math.floor(d)<10&&(d="0"+d.toString());let l=parseInt(i[0],10)+parseInt(a[0],10)+s;s=Math.floor(l/60),l-=60*s,Math.floor(l)<10&&(l="0"+l.toString());let m=parseInt(r[1],10)+parseInt(o[1],10)+s;s=Math.floor(m/60),m-=60*s,m<10&&(m="0"+m.toString());let u=parseInt(r[0],10)+parseInt(o[0],10)+s;return u<10&&(u="0"+u.toString()),"0"!=d?u+":"+m+":"+l+"."+d:u+":"+m+":"+l}collectData(){if(!this.currentUserData[this.scoId])return[];const e=[];for(const t in this.currentUserData[this.scoId].userdata){if("cmi"!=t.substring(0,3)||"cmi.core.session_time"==t)continue;const r=new RegExp(S,"g"),o=t.replace(r,".n.");if(void 0===this.dataModel[this.scoId][t]&&void 0!==this.dataModel[this.scoId][o]&&(this.dataModel[this.scoId][t]=l.j.clone(this.dataModel[this.scoId][o])),void 0===this.dataModel[this.scoId][t]||"r"==this.dataModel[this.scoId][t].mod)continue;const i={element:t.replace(r,"_$1."),value:this.getEl(t)};void 0!==this.dataModel[this.scoId][t].defaultvalue?this.dataModel[this.scoId][t].defaultvalue!==i.value&&(e.push(i),this.dataModel[this.scoId][t].defaultvalue=i.value):(e.push(i),this.dataModel[this.scoId][t].defaultvalue=i.value)}return e}getEl(e){return this.currentUserData[this.scoId]&&void 0!==this.currentUserData[this.scoId].userdata[e]?this.currentUserData[this.scoId].userdata[e]:""}init(e){this.scorm.scormStandard||(h="^[\\u0000-\\uFFFF]{0,64000}$",f=h);for(const t in e){const r=e[t];this.def[t]=r.defaultdata,this.defExtra[t]=r.userdata}for(const e in this.def){this.dataModel[e]={"cmi._children":{defaultvalue:"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions",mod:"r",writeerror:"402"},"cmi._version":{defaultvalue:"3.4",mod:"r",writeerror:"402"},"cmi.core._children":{defaultvalue:"student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time",mod:"r",writeerror:"402"},"cmi.core.student_id":{defaultvalue:this.def[e]["cmi.core.student_id"],mod:"r",writeerror:"403"},"cmi.core.student_name":{defaultvalue:this.def[e]["cmi.core.student_name"],mod:"r",writeerror:"403"},"cmi.core.lesson_location":{defaultvalue:this.def[e]["cmi.core.lesson_location"],format:h,mod:"rw",writeerror:"405"},"cmi.core.credit":{defaultvalue:this.def[e]["cmi.core.credit"],mod:"r",writeerror:"403"},"cmi.core.lesson_status":{defaultvalue:this.def[e]["cmi.core.lesson_status"],format:"^passed$|^completed$|^failed$|^incomplete$|^browsed$",mod:"rw",writeerror:"405"},"cmi.core.entry":{defaultvalue:this.def[e]["cmi.core.entry"],mod:"r",writeerror:"403"},"cmi.core.score._children":{defaultvalue:y,mod:"r",writeerror:"402"},"cmi.core.score.raw":{defaultvalue:this.def[e]["cmi.core.score.raw"],format:_,range:b,mod:"rw",writeerror:"405"},"cmi.core.score.max":{defaultvalue:this.def[e]["cmi.core.score.max"],format:_,range:b,mod:"rw",writeerror:"405"},"cmi.core.score.min":{defaultvalue:this.def[e]["cmi.core.score.min"],format:_,range:b,mod:"rw",writeerror:"405"},"cmi.core.total_time":{defaultvalue:this.def[e]["cmi.core.total_time"],mod:"r",writeerror:"403"},"cmi.core.lesson_mode":{defaultvalue:this.def[e]["cmi.core.lesson_mode"],mod:"r",writeerror:"403"},"cmi.core.exit":{defaultvalue:this.def[e]["cmi.core.exit"],format:"^time-out$|^suspend$|^logout$|^$",mod:"w",readerror:"404",writeerror:"405"},"cmi.core.session_time":{format:p,mod:"w",defaultvalue:"00:00:00",readerror:"404",writeerror:"405"},"cmi.suspend_data":{defaultvalue:this.def[e]["cmi.suspend_data"],format:f,mod:"rw",writeerror:"405"},"cmi.launch_data":{defaultvalue:this.def[e]["cmi.launch_data"],mod:"r",writeerror:"403"},"cmi.comments":{defaultvalue:this.def[e]["cmi.comments"],format:f,mod:"rw",writeerror:"405"},"cmi.evaluation.comments._count":{defaultvalue:"0",mod:"r",writeerror:"402"},"cmi.evaluation.comments._children":{defaultvalue:"content,location,time",mod:"r",writeerror:"402"},"cmi.evaluation.comments.n.content":{defaultvalue:"",pattern:S,format:h,mod:"rw",writeerror:"405"},"cmi.evaluation.comments.n.location":{defaultvalue:"",pattern:S,format:h,mod:"rw",writeerror:"405"},"cmi.evaluation.comments.n.time":{defaultvalue:"",pattern:S,format:v,mod:"rw",writeerror:"405"},"cmi.comments_from_lms":{mod:"r",writeerror:"403"},"cmi.objectives._children":{defaultvalue:"id,score,status",mod:"r",writeerror:"402"},"cmi.objectives._count":{mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.objectives.n.id":{pattern:S,format:I,mod:"rw",writeerror:"405"},"cmi.objectives.n.score._children":{pattern:S,mod:"r",writeerror:"402"},"cmi.objectives.n.score.raw":{defaultvalue:"",pattern:S,format:_,range:b,mod:"rw",writeerror:"405"},"cmi.objectives.n.score.min":{defaultvalue:"",pattern:S,format:_,range:b,mod:"rw",writeerror:"405"},"cmi.objectives.n.score.max":{defaultvalue:"",pattern:S,format:_,range:b,mod:"rw",writeerror:"405"},"cmi.objectives.n.status":{pattern:S,format:"^passed$|^completed$|^failed$|^incomplete$|^browsed$|^not attempted$",mod:"rw",writeerror:"405"},"cmi.student_data._children":{defaultvalue:"mastery_score,max_time_allowed,time_limit_action",mod:"r",writeerror:"402"},"cmi.student_data.mastery_score":{defaultvalue:this.def[e]["cmi.student_data.mastery_score"],mod:"r",writeerror:"403"},"cmi.student_data.max_time_allowed":{defaultvalue:this.def[e]["cmi.student_data.max_time_allowed"],mod:"r",writeerror:"403"},"cmi.student_data.time_limit_action":{defaultvalue:this.def[e]["cmi.student_data.time_limit_action"],mod:"r",writeerror:"403"},"cmi.student_preference._children":{defaultvalue:"audio,language,speed,text",mod:"r",writeerror:"402"},"cmi.student_preference.audio":{defaultvalue:this.def[e]["cmi.student_preference.audio"],format:g,range:"-1#100",mod:"rw",writeerror:"405"},"cmi.student_preference.language":{defaultvalue:this.def[e]["cmi.student_preference.language"],format:h,mod:"rw",writeerror:"405"},"cmi.student_preference.speed":{defaultvalue:this.def[e]["cmi.student_preference.speed"],format:g,range:"-100#100",mod:"rw",writeerror:"405"},"cmi.student_preference.text":{defaultvalue:this.def[e]["cmi.student_preference.text"],format:g,range:"-1#1",mod:"rw",writeerror:"405"},"cmi.interactions._children":{defaultvalue:"id,objectives,time,type,correct_responses,weighting,student_response,result,latency",mod:"r",writeerror:"402"},"cmi.interactions._count":{mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.id":{pattern:S,format:I,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.objectives._count":{pattern:S,mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.objectives.n.id":{pattern:S,format:I,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.time":{pattern:S,format:v,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.type":{pattern:S,format:"^true-false$|^choice$|^fill-in$|^matching$|^performance$|^sequencing$|^likert$|^numeric$",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.correct_responses._count":{pattern:S,mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.correct_responses.n.pattern":{pattern:S,format:w,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.weighting":{pattern:S,format:_,range:"-100#100",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.student_response":{pattern:S,format:w,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.result":{pattern:S,format:"^correct$|^wrong$|^unanticipated$|^neutral$|^([0-9]{0,3})?(.[0-9]*)?$",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.latency":{pattern:S,format:p,mod:"w",readerror:"404",writeerror:"405"},"nav.event":{defaultvalue:"",format:"^previous$|^continue$",mod:"w",readerror:"404",writeerror:"405"}},this.currentUserData[e]={scoid:Number(e),userdata:{},defaultdata:{}};for(const t in this.dataModel[e])if(null===t.match(/\.n\./)){const r=this.dataModel[e][t].defaultvalue;void 0!==r&&(this.currentUserData[e].userdata[t]=r)}for(const t in this.def[e])if(null===t.match(/\.n\./)){const r=this.dataModel[e][t].defaultvalue;this.currentUserData[e].userdata[t]=void 0!==r?r:void 0!==this.defExtra[e][t]?this.defExtra[e][t]:""}const c=new RegExp(S,"g");for(const d in this.defExtra[e]){let l="",m="0";if(d.match(c)){const u=d.replace(c,".$1.");var t;if(this.currentUserData[e].userdata[u]=this.defExtra[e][d],0===u.indexOf("cmi.evaluation.comments"))l="cmi.evaluation.comments._count",m=(null===(t=u.match(/.(\d+)./))||void 0===t?void 0:t[1])||"0";else if(0===u.indexOf("cmi.objectives")){var r;l="cmi.objectives._count",m=(null===(r=u.match(/.(\d+)./))||void 0===r?void 0:r[1])||"0"}else if(0===u.indexOf("cmi.interactions"))if(u.indexOf(".objectives.")>0){var o,i;const e=null===(o=u.match(/cmi.interactions.(\d+)./))||void 0===o?void 0:o[1];m=(null===(i=u.match(/objectives.(\d+)./))||void 0===i?void 0:i[1])||"0",l="cmi.interactions."+e+".objectives._count"}else if(u.indexOf(".correct_responses.")>0){var a,s;const e=null===(a=u.match(/cmi.interactions.(\d+)./))||void 0===a?void 0:a[1];m=(null===(s=u.match(/correct_responses.(\d+)./))||void 0===s?void 0:s[1])||"0",l="cmi.interactions."+e+".correct_responses._count"}else{var n;l="cmi.interactions._count",m=(null===(n=u.match(/.(\d+)./))||void 0===n?void 0:n[1])||"0"}if(l){const t=this.currentUserData[e].userdata[l];void 0===t&&(this.currentUserData[e].userdata[l]=0),Number(m)==Number(t)&&(this.currentUserData[e].userdata[l]=Number(t)+1),Number(m)>Number(t)&&(this.currentUserData[e].userdata[l]=Number(m)-1)}}}""===this.currentUserData[e].userdata["cmi.core.lesson_status"]&&(this.currentUserData[e].userdata["cmi.core.lesson_status"]="not attempted"),this.currentUserData[e].userdata["cmi.core.credit"]="normal"===this.mode?"credit":"no-credit",this.currentUserData[e].userdata["cmi.core.lesson_mode"]=this.mode}}LMSCommit(e){if(this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.errorCode="0",""==e){if(this.initialized){const e=this.storeData(!1);return this.triggerEvent(u.lt),this.errorCode=e?"0":"101",e?"true":"false"}this.errorCode="301"}else this.errorCode="201";return"false"}LMSFinish(e){if(this.errorCode="0",""==e){if(this.initialized){this.initialized=!1;const e=this.storeData(!0);return""!=this.getEl("nav.event")?"continue"==this.getEl("nav.event")?this.triggerEvent(u.UK):this.triggerEvent(u.M2):this.scorm.auto&&this.triggerEvent(u.UK),this.errorCode=e?"0":"101",this.triggerEvent(u.lt),e?"true":"false"}this.errorCode="301"}else this.errorCode="201";return"false"}LMSGetDiagnostic(e){return""==e&&(e=this.errorCode),e}LMSGetErrorString(e){return""!=e?T[e]:""}LMSGetLastError(){return this.errorCode}LMSGetValue(e){if(this.errorCode="0",this.initialized)if(""!=e){const t=new RegExp(S,"g"),r=String(e).replace(t,".n.");if(void 0!==this.dataModel[this.scoId][r]){if("w"!=this.dataModel[this.scoId][r].mod)return this.errorCode="0",this.getEl(e);this.errorCode=this.dataModel[this.scoId][r].readerror||"0"}else{const e="._children",t="._count";if(r.substring(r.length-e.length)==e){const t=r.substring(0,r.length-e.length);this.errorCode=void 0!==this.dataModel[this.scoId][t]?"202":"201"}else if(r.substring(r.length-t.length)==t){const e=r.substring(0,r.length-t.length);this.errorCode=void 0!==this.dataModel[this.scoId][e]?"203":"201"}else this.errorCode="201"}}else this.errorCode="201";else this.errorCode="301";return""}LMSInitialize(e){if(this.errorCode="0",""==e){if(!this.initialized)return this.initialized=!0,this.errorCode="0","true";this.errorCode="101"}else this.errorCode="201";return"false"}LMSSetValue(e,t){if(this.errorCode="0",this.initialized)if(""!=e){let a=new RegExp(S,"g");const s=String(e).replace(a,".n.");if(void 0!==this.dataModel[this.scoId][s])if("r"!=this.dataModel[this.scoId][s].mod){var r;a=new RegExp(null!==(r=this.dataModel[this.scoId][s].format)&&void 0!==r?r:"");if(null!=(t+="").match(a)){if(e!=s){if(0===e.indexOf("cmi.objectives")){var o;const t="cmi.objectives."+(null===(o=e.match(/cmi.objectives.(\d+)./))||void 0===o?void 0:o[1])+".score";void 0===this.currentUserData[this.scoId].userdata[t+"._children"]&&(this.setEl(this.currentUserData[this.scoId].userdata[t+"._children"],y),this.setEl(this.currentUserData[this.scoId].userdata[t+".raw"],""),this.setEl(this.currentUserData[this.scoId].userdata[t+".min"],""),this.setEl(this.currentUserData[this.scoId].userdata[t+".max"],""))}else if(0===e.indexOf("cmi.interactions")){var i;const t=null===(i=e.match(/cmi.interactions.(\d+)./))||void 0===i?void 0:i[1];let r="cmi.interactions."+t+".objectives._count";void 0===this.currentUserData[this.scoId].userdata[r]&&this.setEl(r,0),r="cmi.interactions."+t+".correct_responses._count",void 0===this.currentUserData[this.scoId].userdata[r]&&this.setEl(r,0)}const t=e.split(".");let r="cmi";for(let e=1;e<t.length-1;e++){const o=t[e];if(t[e+1].match(/^\d+$/)){const i=r+"."+o+"._count";if(void 0===this.currentUserData[this.scoId].userdata[i]&&this.setEl(i,0),t[e+1]==this.getEl(i)){const e=this.getEl(i);this.setEl(i,Number(e)+1)}t[e+1]>this.getEl(i)&&(this.errorCode="201"),r=r.concat("."+o+"."+t[e+1]),e++}else r=r.concat("."+o)}e=r.concat("."+t[t.length-1])}if("0"==this.errorCode){this.scorm.autocommit&&!this.timeout&&(this.timeout=window.setTimeout((()=>this.LMSCommit("")),6e4));const r=this.dataModel[this.scoId][s].range;if(void 0===r)return"cmi.comments"==e?this.setEl("cmi.comments",this.getEl("cmi.comments")+t):this.setEl(e,t),this.errorCode="0","true";{const o=r.split("#");if((t=Number(t))>=Number(o[0])&&t<=Number(o[1]))return this.setEl(e,Number(t)),this.errorCode="0","true";this.errorCode=this.dataModel[this.scoId][s].writeerror}}}else this.errorCode=this.dataModel[this.scoId][s].writeerror}else this.errorCode=this.dataModel[this.scoId][s].writeerror;else this.errorCode="201"}else this.errorCode="201";else this.errorCode="301";return"false"}loadSco(e){this.scoId=e}setEl(e,t){this.currentUserData[this.scoId]=this.currentUserData[this.scoId]||{scoid:this.scoId,userdata:{},defaultdata:{}},this.currentUserData[this.scoId].userdata[e]=t}setOffline(e){this.offline=e}storeData(e){if(!this.canSaveTracks)return!0;let t;e?("not attempted"==this.getEl("cmi.core.lesson_status")&&this.setEl("cmi.core.lesson_status","completed"),"normal"===this.getEl("cmi.core.lesson_mode")&&"credit"===this.getEl("cmi.core.credit")&&""!==this.getEl("cmi.student_data.mastery_score")&&""!==this.getEl("cmi.core.score.raw")&&(parseFloat(this.getEl("cmi.core.score.raw"))>=parseFloat(this.getEl("cmi.student_data.mastery_score"))?this.setEl("cmi.core.lesson_status","passed"):this.setEl("cmi.core.lesson_status","failed")),"browse"===this.getEl("cmi.core.lesson_mode")&&""==this.dataModel[this.scoId]["cmi.core.lesson_status"].defaultvalue&&"not attempted"==this.getEl("cmi.core.lesson_status")&&this.setEl("cmi.core.lesson_status","browsed"),t=this.collectData(),t.push(this.totalTime())):t=this.collectData();const r=m.v.saveTracksSync(this.scoId,this.attempt,t,this.scorm,this.offline,this.currentUserData);return this.offline||r?r:(this.offline=!0,this.triggerEvent(u.Bm),m.v.saveTracksSync(this.scoId,this.attempt,t,this.scorm,this.offline,this.currentUserData))}totalTime(){return{element:"cmi.core.total_time",value:this.addTime(this.getEl("cmi.core.total_time"),this.getEl("cmi.core.session_time"))}}triggerEvent(e){d.z.trigger(e,{scormId:this.scorm.id,scoId:this.scoId,attempt:this.attempt},this.siteId)}}var A=r(8214),M=r(98045),E=r(22693),C=r(53794),D=r(93589),x=r(25572),P=r(79555),$=r(86654),U=r(54438),O=r(60177),k=r(2910),N=r(76954),j=r(7476),F=r(64422),z=r(46036),R=r(86198),G=r(58197),V=r(66731),H=r(88246),L=r(43570),B=r(73955);function AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template(e,t){if(1&e){const e=U.RV6();U.j41(0,"ion-button",11),U.nI1(1,"translate"),U.bIt("click",(function AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template_ion_button_click_0_listener(){U.eBV(e);const t=U.XpG(2);return U.Njj(t.openToc())})),U.nrm(2,"ion-icon",12),U.k0s()}2&e&&U.Y8G("ariaLabel",U.bMT(1,1,"addon.mod_scorm.toc"))}function AddonModScormPlayerPage_core_button_with_spinner_9_Template(e,t){if(1&e&&(U.j41(0,"core-button-with-spinner",9),U.DNE(1,AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template,3,3,"ion-button",10),U.k0s()),2&e){const e=U.XpG();U.Y8G("loading",e.loadingToc),U.R7$(),U.Y8G("ngIf",e.toc.length)}}function AddonModScormPlayerPage_core_iframe_12_Template(e,t){if(1&e&&U.nrm(0,"core-iframe",13),2&e){const e=U.XpG();U.Y8G("src",e.src)("iframeWidth",e.scormWidth)("iframeHeight",e.scormHeight)("showFullscreenOnToolbar",!0)("autoFullscreenOnRotate",!0)}}function AddonModScormPlayerPage_p_13_Template(e,t){if(1&e&&(U.j41(0,"p"),U.EFF(1),U.nI1(2,"translate"),U.k0s()),2&e){const e=U.XpG();U.R7$(),U.JRh(U.bMT(2,1,e.errorMessage))}}function AddonModScormPlayerPage_core_navigation_bar_14_Template(e,t){if(1&e){const e=U.RV6();U.j41(0,"core-navigation-bar",14),U.bIt("action",(function AddonModScormPlayerPage_core_navigation_bar_14_Template_core_navigation_bar_action_0_listener(t){U.eBV(e);const r=U.XpG();return U.Njj(r.loadSco(t))})),U.k0s()}if(2&e){const e=U.XpG();U.Y8G("items",e.navigationItems)}}let Y=(()=>{var e;class AddonModScormPlayerPage{constructor(){this.showToc=!1,this.loadingToc=!0,this.toc=[],this.loaded=!1,this.incomplete=!1,this.navigationItems=[],this.newAttempt=!1,this.attempt=0,this.offline=!1}ngOnInit(){var e=this;return(0,o.A)((function*(){try{e.cmId=i.CoreNavigator.getRequiredRouteNumberParam("cmId"),e.courseId=i.CoreNavigator.getRequiredRouteNumberParam("courseId"),e.mode=i.CoreNavigator.getRouteParam("mode")||"normal",e.moduleUrl=i.CoreNavigator.getRouteParam("moduleUrl")||"",e.newAttempt=!!i.CoreNavigator.getRouteBooleanParam("newAttempt"),e.organizationId=i.CoreNavigator.getRouteParam("organizationId"),e.initialScoId=i.CoreNavigator.getRouteNumberParam("scoId"),e.siteId=a.CoreSites.getRequiredCurrentSite().getId()}catch(e){return x.CoreAlerts.showError(e),i.CoreNavigator.back(),void 0}try{if(yield e.fetchData(),!e.currentSco)return i.CoreNavigator.back(),void 0;if(e.newAttempt)try{yield e.setStartTime(e.currentSco.id)}catch(e){x.CoreAlerts.showError(e,{default:P.HT.instant("addon.mod_scorm.errorgetscorm")})}e.loadSco(e.currentSco)}finally{e.loaded=!0}}))()}get canSaveTracks(){return!this.accessInfo||!!this.accessInfo.cansavetrack}initialize(){var e=this;return(0,o.A)((function*(){e.scorm=yield m.v.getScorm(e.courseId,e.cmId,{moduleUrl:e.moduleUrl,readingStrategy:1}),s.CoreSync.blockOperation(u.Rz,e.scorm.id,"player"),e.title=e.scorm.name,e.showToc=m.v.displayTocInPlayer(e.scorm),e.scorm.popup&&e.scorm.width&&e.scorm.width>100&&(e.scormWidth=e.scorm.width,e.scorm.height&&e.scorm.height>100&&(e.scormHeight=e.scorm.height)),e.tocObserver=d.z.on(u.lt,(t=>{t.scormId===e.scorm.id&&(e.offline?setTimeout((()=>e.refreshToc()),100):e.refreshToc())}),e.siteId),e.launchNextObserver=d.z.on(u.UK,(t=>{if(t.scormId===e.scorm.id&&e.currentSco){const t=A.V.getNextScoFromToc(e.toc,e.currentSco.id);t&&e.loadSco(t)}}),e.siteId),e.launchPrevObserver=d.z.on(u.M2,(t=>{if(t.scormId===e.scorm.id&&e.currentSco){const t=A.V.getPreviousScoFromToc(e.toc,e.currentSco.id);t&&e.loadSco(t)}}),e.siteId),e.goOfflineObserver=d.z.on(u.Bm,(t=>{t.scormId!==e.scorm.id||e.offline||(e.offline=!0,setTimeout((0,o.A)((function*(){try{A.V.convertAttemptToOffline(e.scorm,e.attempt)}catch(e){x.CoreAlerts.showError(e,{default:P.HT.instant("core.error")})}e.refreshToc()})),200))}),e.siteId)}))()}calculateNavigationItems(e){this.navigationItems=this.toc.filter((e=>e.isvisible)).map((t=>({item:t,title:t.title,current:t.id==e,enabled:!(!t.prereq||!t.launch)})))}determineAttemptAndMode(e,t){var r=this;return(0,o.A)((function*(){const o=yield A.V.determineAttemptToContinue(r.scorm,e);let i=!1;r.attempt=o.num,r.offline=o.offline,r.attempt!=e.lastAttempt.num&&(r.attemptToContinue=r.attempt),r.attempt>0&&(i=yield m.v.isAttemptIncomplete(r.scorm.id,r.attempt,{offline:r.offline,cmId:r.cmId}));const a=m.v.determineAttemptAndMode(r.scorm,r.mode,r.attempt,r.newAttempt,i,t.cansavetrack);if(a.attempt>r.attempt)if(r.offline)yield A.V.createOfflineAttempt(r.scorm,a.attempt,e.online.length);else try{yield m.v.getScormUserData(r.scorm.id,a.attempt,{cmId:r.cmId,readingStrategy:2})}catch{r.offline=!0,yield A.V.createOfflineAttempt(r.scorm,a.attempt,e.online.length)}r.mode=a.mode,r.newAttempt=a.newAttempt,r.attempt=a.attempt}))()}fetchData(){var e=this;return(0,o.A)((function*(){e.scorm||(yield e.initialize()),yield M.S.waitForSync(e.scorm.id);try{const[t,r]=yield Promise.all([m.v.getAttemptCount(e.scorm.id,{cmId:e.cmId}),m.v.getAccessInformation(e.scorm.id,{cmId:e.cmId})]);e.accessInfo=r,yield e.determineAttemptAndMode(t,r);const[o]=yield Promise.all([m.v.getScormUserData(e.scorm.id,e.attempt,{cmId:e.cmId,offline:e.offline}),e.fetchToc()]);e.userData=o}catch(e){x.CoreAlerts.showError(e,{default:P.HT.instant("addon.mod_scorm.errorgetscorm")})}}))()}fetchToc(){var e=this;return(0,o.A)((function*(){e.loadingToc=!0;try{if(e.incomplete=yield m.v.isAttemptIncomplete(e.scorm.id,e.attempt,{offline:e.offline,cmId:e.cmId}),e.toc=yield A.V.getToc(e.scorm.id,e.attempt,e.incomplete,{organization:e.organizationId,offline:e.offline,cmId:e.cmId}),e.currentSco)return;if(e.newAttempt&&(e.initialScoId=e.scorm.launch),e.initialScoId&&e.initialScoId>0&&(e.currentSco=A.V.getScoFromToc(e.toc,e.initialScoId)),e.currentSco)return;const t=yield A.V.getFirstSco(e.scorm.id,e.attempt,{toc:e.toc,organization:e.organizationId,mode:e.mode,offline:e.offline,cmId:e.cmId});t?e.currentSco=t:e.errorMessage="addon.mod_scorm.errornovalidsco"}finally{e.loadingToc=!1}}))()}loadSco(e){var t=this;return(0,o.A)((function*(){var r;t.dataModel?(t.src="",yield C.H.nextTick(),t.dataModel.loadSco(e.id)):(t.dataModel=new AddonModScormDataModel12(t.siteId,t.scorm,e.id,t.attempt,null!==(r=t.userData)&&void 0!==r?r:{},t.mode,t.offline,t.canSaveTracks),window.API=t.dataModel);t.currentSco=e,t.title=e.title||t.scorm.name,t.calculateNavigationItems(e.id),t.src=yield m.v.getScoSrc(t.scorm,e),"asset"==e.scormtype&&t.markCompleted(e),t.logEvent(e.id)}))()}markCompleted(e){var t=this;return(0,o.A)((function*(){if(!t.canSaveTracks)return;const r=[{element:"cmi.core.lesson_status",value:"completed"}];try{m.v.saveTracks(e.id,t.attempt,r,t.scorm,t.offline)}catch{if(t.offline)return;const i=yield m.v.getScormUserData(t.scorm.id,t.attempt,{cmId:t.cmId});if(i[e.id]&&"completed"==i[e.id].userdata["cmi.core.lesson_status"])return;try{var o;yield A.V.convertAttemptToOffline(t.scorm,t.attempt),t.offline=!0,null===(o=t.dataModel)||void 0===o||o.setOffline(!0),yield m.v.saveTracks(e.id,t.attempt,r,t.scorm,!0)}catch(e){x.CoreAlerts.showError(e,{default:P.HT.instant("core.error")})}}finally{t.refreshToc()}}))()}openToc(){var e=this;return(0,o.A)((function*(){const{AddonModScormTocComponent:t}=yield r.e(75640).then(r.bind(r,75640)),o=yield D.I.openSideModal({component:t,componentProps:{toc:e.toc,attemptToContinue:e.attemptToContinue,selected:e.currentSco&&e.currentSco.id,moduleId:e.cmId,courseId:e.courseId,accessInfo:e.accessInfo,mode:e.mode}});o&&e.loadSco(o)}))()}refreshToc(){var e=this;return(0,o.A)((function*(){try{yield c.g.ignoreErrors(m.v.invalidateAllScormData(e.scorm.id)),yield e.fetchToc()}catch(e){x.CoreAlerts.showError(e,{default:P.HT.instant("addon.mod_scorm.errorgetscorm")})}}))()}setStartTime(e){var t=this;return(0,o.A)((function*(){if(!t.canSaveTracks)return;const r=[{element:"x.start.time",value:String(n.j.timestamp())}];yield m.v.saveTracks(e,t.attempt,r,t.scorm,t.offline),t.offline||(yield c.g.ignoreErrors(m.v.getAttemptCount(t.scorm.id,{cmId:t.cmId,readingStrategy:2})))}))()}logEvent(e){var t=this;return(0,o.A)((function*(){yield c.g.ignoreErrors(m.v.logLaunchSco(t.scorm.id,e));let r="/mod/scorm/player.php";t.scorm.popup&&(r+=`?a=${t.scorm.id}&currentorg=${t.organizationId}&scoid=${e}&display=popup&mode=${t.mode}`),E.OF.logEvent({type:E.qr.VIEW_ITEM,ws:"mod_scorm_get_scorm_user_data",name:t.scorm.name,data:{id:t.scorm.id,scoid:e,organization:t.organizationId,category:"scorm"},url:r})}))()}ngOnDestroy(){var e,t,r;this.src="",d.z.trigger(d.z.ACTIVITY_DATA_SENT,{module:"scorm"}),null===(e=this.tocObserver)||void 0===e||e.off(),null===(t=this.launchNextObserver)||void 0===t||t.off(),null===(r=this.launchPrevObserver)||void 0===r||r.off(),setTimeout((()=>{var e;null===(e=this.goOfflineObserver)||void 0===e||e.off()}),500),s.CoreSync.unblockOperation(u.Rz,this.scorm.id,"player")}}return(e=AddonModScormPlayerPage).ɵfac=function AddonModScormPlayerPage_Factory(t){return new(t||e)},e.ɵcmp=U.VBU({type:e,selectors:[["page-addon-mod-scorm-player"]],standalone:!0,features:[U.aNF],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[3,"loading",4,"ngIf"],[3,"hideUntil"],["id","scorm_object",3,"src","iframeWidth","iframeHeight","showFullscreenOnToolbar","autoFullscreenOnRotate",4,"ngIf"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",3,"items","action",4,"ngIf"],[3,"loading"],["fill","clear","aria-haspopup","true",3,"ariaLabel","click",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click","ariaLabel"],["name","fas-list-ul","slot","icon-only","aria-hidden","true"],["id","scorm_object",3,"src","iframeWidth","iframeHeight","showFullscreenOnToolbar","autoFullscreenOnRotate"],["collapsible-footer","","appearOnBottom","","slot","fixed",3,"action","items"]],template:function AddonModScormPlayerPage_Template(e,t){1&e&&(U.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),U.nrm(3,"ion-back-button",1),U.nI1(4,"translate"),U.k0s(),U.j41(5,"ion-title")(6,"h1"),U.nrm(7,"core-format-text",2),U.k0s()(),U.j41(8,"ion-buttons",3),U.DNE(9,AddonModScormPlayerPage_core_button_with_spinner_9_Template,2,2,"core-button-with-spinner",4),U.k0s()()(),U.j41(10,"ion-content")(11,"core-loading",5),U.DNE(12,AddonModScormPlayerPage_core_iframe_12_Template,1,5,"core-iframe",6)(13,AddonModScormPlayerPage_p_13_Template,3,3,"p",7),U.k0s(),U.DNE(14,AddonModScormPlayerPage_core_navigation_bar_14_Template,1,1,"core-navigation-bar",8),U.k0s()),2&e&&(U.R7$(3),U.Y8G("text",U.bMT(4,9,"core.back")),U.R7$(4),U.Y8G("text",t.title)("contextInstanceId",t.cmId)("courseId",t.courseId),U.R7$(2),U.Y8G("ngIf",t.showToc),U.R7$(2),U.Y8G("hideUntil",t.loaded),U.R7$(),U.Y8G("ngIf",t.loaded),U.R7$(),U.Y8G("ngIf",!t.src&&t.errorMessage),U.R7$(),U.Y8G("ngIf",t.loaded&&t.navigationItems.length>1))},dependencies:[$.n,O.bT,k.Jm,k.QW,k.W9,k.eU,k.iq,k.BC,k.ai,k.el,N.q,j.l,F.R,z.o,R.t,G.B,V.i,H.i,L.T,B.D9],encapsulation:2}),AddonModScormPlayerPage})()},8214:(e,t,r)=>{r.d(t,{V:()=>v});var o=r(10467),i=r(75629),a=r(52749),s=r(81690),n=r(79555),c=r(1717),d=r(85387),l=r(55554),m=r(25572),u=r(54438);const h=["status","score_raw","total_time","session_time","student_id","student_name","credit","mode","entry"];let f=(()=>{var e;class AddonModScormHelperProvider{confirmDownload(e,t){return(0,o.A)((function*(){if(!(yield c.v.shouldDownloadMainFile(e,t)))return;let r=e.packagesize;return r||(r=yield c.v.calculateScormSize(e),e.packagesize=r),m.CoreAlerts.confirmDownloadSize({size:r,total:!0})}))()}convertAttemptToOffline(e,t,r){return(0,o.A)((function*(){r=r||a.CoreSites.getCurrentSiteId();const o=yield l.g.ignoreErrors(c.v.getScormUserData(e.id,t,{cmId:e.coursemodule,siteId:r}));if(!o)throw new i.CoreError(n.HT.instant("addon.mod_scorm.errorcreateofflineattempt"));const m=yield l.g.ignoreErrors(d.o.getScormUserData(e.id,t,void 0,r)),u=s.j.clone(o);for(const e in u){const t=u[e];if(h.forEach((e=>{delete t.userdata[e]})),m&&m[t.scoid]&&m[t.scoid].userdata){const e={};for(const r in t.userdata)m[t.scoid].userdata[r]||(e[r]=t.userdata[r]);t.userdata=e}}yield d.o.createNewAttempt(e,t,u,o,r)}))()}createOfflineAttempt(e,t,r,s){var c=this;return(0,o.A)((function*(){s=s||a.CoreSites.getCurrentSiteId();const o=yield l.g.ignoreErrors(c.searchOnlineAttemptUserData(e.id,r,{cmId:e.coursemodule,siteId:s}));if(!o)throw new i.CoreError(n.HT.instant("addon.mod_scorm.errorcreateofflineattempt"));for(const e in o){const t=o[e],r={};for(const e in t.userdata)-1==e.indexOf(".")&&-1==h.indexOf(e)&&(r[e]=t.userdata[e]);t.userdata=r}return d.o.createNewAttempt(e,t,o,void 0,s)}))()}determineAttemptToContinue(e,t,r){var i=this;return(0,o.A)((function*(){let o;if(t.online.length&&(o=Math.max.apply(Math,t.online)),!o)return i.getLastBeforeMax(e,t);const a=t.offline.indexOf(o)>-1;return(yield c.v.isAttemptIncomplete(e.id,o,{offline:a,cmId:e.coursemodule,siteId:r}))?{num:o,offline:a}:i.getLastBeforeMax(e,t)}))()}getFirstSco(e,t,r={}){return(0,o.A)((function*(){const o="normal"===(r.mode||"normal");let i=r.toc;i&&i.length||(i=yield c.v.getScosWithData(e,t,r));return i.find((e=>e.isvisible&&e.launch&&e.prereq&&(!o||c.v.isStatusIncomplete(e.status))))||i[0]}))()}getLastBeforeMax(e,t){return e.maxattempt&&t.lastAttempt.num>e.maxattempt?{num:e.maxattempt,offline:t.offline.indexOf(e.maxattempt)>-1}:{num:t.lastAttempt.num,offline:t.lastAttempt.offline}}getNextScoFromToc(e,t){for(let r=e.findIndex((e=>e.id==t))+1;r<e.length;r++)if(e[r].isvisible&&e[r].prereq&&e[r].launch)return e[r]}getPreviousScoFromToc(e,t){for(let r=e.findIndex((e=>e.id==t))-1;r>=0;r--)if(e[r].isvisible&&e[r].prereq&&e[r].launch)return e[r]}getScoFromToc(e,t){return e.find((e=>e.id==t))}getToc(e,t,r,i={}){return(0,o.A)((function*(){const o=yield c.v.getOrganizationToc(e,t,i),a=c.v.formatTocToArray(o);return a.forEach((e=>{e.icon=c.v.getScoStatusIcon(e,r)})),a}))()}searchOnlineAttemptUserData(e,t,r={}){var i=this;return(0,o.A)((function*(){r.siteId=r.siteId||a.CoreSites.getCurrentSiteId();try{return yield c.v.getScormUserData(e,t,r)}catch(o){if(t<=0)throw o;try{return yield i.searchOnlineAttemptUserData(e,t-1,r)}catch{throw o}}}))()}}return(e=AddonModScormHelperProvider).ɵfac=function AddonModScormHelperProvider_Factory(t){return new(t||e)},e.ɵprov=u.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModScormHelperProvider})();const v=(0,n.Qd)(f)}}]);