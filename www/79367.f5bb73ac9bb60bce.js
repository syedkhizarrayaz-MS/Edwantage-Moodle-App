"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[79367],{6369:(o,n,t)=>{t.d(n,{a:()=>_});var e=t(10467),s=t(99522),i=t(98870),r=t(15221),a=t(43411),d=t(16179),c=t(11945),u=t(2216),m=t(52749),l=t(55554);let _=(()=>{class AddonModForumDiscussionsSource extends s.F{constructor(o,n,t){super(),this.trackPosts=!1,this.usesGroups=!1,this.supportsChangeGroup=!1,this.selectedSortOrder=null,this.groupId=0,this.canAddDiscussionToGroup=!0,this.errorLoadingDiscussions=!1,this.DISCUSSIONS_PATH_PREFIX=t,this.COURSE_ID=o,this.CM_ID=n}isNewDiscussionForm(o){return"newDiscussion"in o}isOfflineDiscussion(o){return!this.isNewDiscussionForm(o)&&!this.isOnlineDiscussion(o)}isOnlineDiscussion(o){return"id"in o}getItemPath(o){return this.isOnlineDiscussion(o)?this.DISCUSSIONS_PATH_PREFIX+o.discussion:this.isOfflineDiscussion(o)?`${this.DISCUSSIONS_PATH_PREFIX}new/${o.timecreated}`:`${this.DISCUSSIONS_PATH_PREFIX}new/0`}getItemQueryParams(o){var n;const t={courseId:this.COURSE_ID,cmId:this.CM_ID,forumId:null===(n=this.forum)||void 0===n?void 0:n.id};return this.isOnlineDiscussion(o)?(t.discussion=o,t.trackPosts=this.trackPosts):this.isNewDiscussionForm(o)&&(t.groupId=this.usesGroups?this.groupId:void 0),t}getPagesLoaded(){if(null===this.items)return 0;const o=this.items.filter((o=>this.isOnlineDiscussion(o)));return Math.ceil(o.length/this.getPageLength())}getPageLength(){return u.eG}loadForum(){var o=this;return(0,e.A)((function*(){o.forum=yield d.AddonModForum.getForum(o.COURSE_ID,o.CM_ID),void 0!==o.forum.istracked&&(o.trackPosts=o.forum.istracked)}))()}loadGroupInfo(o){var n=this;return(0,e.A)((function*(){[n.groupInfo,n.allPartsPermissions]=yield Promise.all([r.CoreGroups.getActivityGroupInfo(n.CM_ID,!1),l.g.ignoreErrors(d.AddonModForum.canAddDiscussionToAll(o,{cmId:n.CM_ID}))]),n.supportsChangeGroup=d.AddonModForum.isGetDiscussionPostsAvailable(),n.usesGroups=!(!n.groupInfo.separateGroups&&!n.groupInfo.visibleGroups),n.groupId=r.CoreGroups.validateGroupId(n.groupId,n.groupInfo),yield n.loadSelectedGroupData()}))()}loadSelectedGroupData(){var o=this;return(0,e.A)((function*(){if(o.usesGroups)if(0===o.groupId)o.canAddDiscussionToGroup=!o.allPartsPermissions||o.allPartsPermissions.status;else if(o.forum){const n=yield d.AddonModForum.canAddDiscussion(o.forum.id,o.groupId,{cmId:o.CM_ID});o.canAddDiscussionToGroup=n.status}else o.canAddDiscussionToGroup=!0;else o.canAddDiscussionToGroup=!0}))()}loadPageItems(o){var n=this;return(0,e.A)((function*(){var t;const e=[];if(0===o){const o=yield n.loadOfflineDiscussions();e.push(AddonModForumDiscussionsSource.NEW_DISCUSSION),e.push(...o)}const{discussions:s,canLoadMore:i}=yield n.loadOnlineDiscussions(o);if(e.push(...s),n.canAddDiscussionToGroup&&"eachuser"===(null===(t=n.forum)||void 0===t?void 0:t.type)){const o=m.CoreSites.getCurrentSiteUserId();n.canAddDiscussionToGroup=!e.some((t=>n.isOfflineDiscussion(t)||!n.isNewDiscussionForm(t)&&t.userid===o))}return{items:e,hasMoreItems:i}}))()}loadOnlineDiscussions(o){var n=this;return(0,e.A)((function*(){if(!n.forum||!n.selectedSortOrder)throw new Error("Can't load discussions without a forum or selected sort order");let t=[],e=!1;try{const s=yield d.AddonModForum.getDiscussions(n.forum.id,{cmId:n.forum.cmid,sortOrder:n.selectedSortOrder.value,page:o,groupId:n.groupId});t=s.discussions,e=s.canLoadMore,n.errorLoadingDiscussions=!1}catch(t){if(o>0||a.CoreWSError.isWebServiceError(t))throw t;n.errorLoadingDiscussions=!0}if(n.usesGroups&&(t=yield d.AddonModForum.formatDiscussionsGroups(n.forum.cmid,t)),"single"===n.forum.type)for(const o of t)if(o.userfullname&&0===o.parent){o.userfullname=!1;break}if(void 0===n.forum.istracked&&!n.trackPosts)for(const o of t)if(o.numunread>0){n.trackPosts=!0;break}return{discussions:t,canLoadMore:e}}))()}loadOfflineDiscussions(){var o=this;return(0,e.A)((function*(){if(!o.forum)throw new Error("Can't load discussions without a forum");const n=o.forum;let t=yield c.p.getNewDiscussions(n.id);if(0===t.length)return[];o.usesGroups&&(t=yield d.AddonModForum.formatDiscussionsGroups(n.cmid,t));const s=t.map(function(){var t=(0,e.A)((function*(t){const e=t;if(0!==e.parent&&"single"!==n.type)try{const n=yield i.CoreUser.getProfile(e.userid,o.COURSE_ID,!0);e.userfullname=n.fullname,e.userpictureurl=n.profileimageurl}catch{}}));return function(o){return t.apply(this,arguments)}}());return yield Promise.all(s),t.sort(((o,n)=>n.timecreated-o.timecreated)),t}))()}invalidateCache(){var o=this;return(0,e.A)((function*(){const n=[];n.push(d.AddonModForum.invalidateForumData(o.COURSE_ID)),o.forum&&(n.push(d.AddonModForum.invalidateDiscussionsList(o.forum.id)),n.push(d.AddonModForum.invalidateCanAddDiscussion(o.forum.id)),n.push(r.CoreGroups.invalidateActivityGroupInfo(o.forum.cmid))),yield Promise.all(n)}))()}invalidateList(){var o=this;return(0,e.A)((function*(){o.forum&&(yield d.AddonModForum.invalidateDiscussionsList(o.forum.id))}))()}}return AddonModForumDiscussionsSource.NEW_DISCUSSION={newDiscussion:!0},AddonModForumDiscussionsSource})()},79367:(o,n,t)=>{t.r(n),t.d(n,{default:()=>ho});var e=t(10467),s=t(74431),i=t(83696),r=t(16082),a=t(87326),d=t(32440),c=t(82308),u=t(98870),m=t(2910),l=t(94455),_=t(15324),p=t(93417),f=t(52749),g=t(81690),h=t(79555),I=t(82907),P=t(49882),C=t(6369),M=t(16450),v=t(16179),D=t(93956),F=t(11945),A=t(86275),b=t(22693),y=t(2216),T=t(51024),O=t(47551),R=t(33014),S=t(55554),G=t(58364),j=t(25572),k=t(54438),E=t(89417),x=t(41094),w=t(48966),$=t(75383),N=t(87809),Y=t(63153),L=t(88436),V=t(91416),U=t(24813),X=t(43411),B=t(41450),H=t(25367),q=t(86654),z=t(55608),W=t(76990),J=t(60177),Q=t(95638),K=t(31498),Z=t(16658),oo=t(86198),no=t(58197),to=t(43570),eo=t(73955),so=t(59528);const io=["replyFormEl"],_c1=o=>({$a:o}),_c2=o=>({reply:o});function AddonModForumPostComponent_ng_container_1_div_4_ion_icon_2_Template(o,n){1&o&&(k.nrm(0,"ion-icon",24),k.nI1(1,"translate")),2&o&&k.BMQ("aria-label",k.bMT(1,1,"addon.mod_forum.discussionpinned"))}function AddonModForumPostComponent_ng_container_1_div_4_ion_icon_3_Template(o,n){1&o&&(k.nrm(0,"ion-icon",25),k.nI1(1,"translate")),2&o&&k.BMQ("aria-label",k.bMT(1,1,"addon.mod_forum.favourites"))}function AddonModForumPostComponent_ng_container_1_div_4_ion_note_5_Template(o,n){1&o&&(k.j41(0,"ion-note",26),k.nI1(1,"translate"),k.nrm(2,"ion-icon",27),k.k0s()),2&o&&k.BMQ("aria-label",k.bMT(1,1,"addon.mod_forum.unread"))}function AddonModForumPostComponent_ng_container_1_div_4_ion_button_6_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"ion-button",28),k.nI1(1,"translate"),k.bIt("click",(function AddonModForumPostComponent_ng_container_1_div_4_ion_button_6_Template_ion_button_click_0_listener(n){k.eBV(o);const t=k.XpG(3);return k.Njj(t.showOptionsMenu(n))})),k.nrm(2,"ion-icon",29),k.k0s()}2&o&&k.Y8G("ariaLabel",k.bMT(1,1,"core.displayoptions"))}function AddonModForumPostComponent_ng_container_1_div_4_Template(o,n){if(1&o&&(k.j41(0,"div",18)(1,"h2",5),k.DNE(2,AddonModForumPostComponent_ng_container_1_div_4_ion_icon_2_Template,2,3,"ion-icon",19)(3,AddonModForumPostComponent_ng_container_1_div_4_ion_icon_3_Template,2,3,"ion-icon",20),k.nrm(4,"core-format-text",21),k.k0s(),k.DNE(5,AddonModForumPostComponent_ng_container_1_div_4_ion_note_5_Template,3,3,"ion-note",22)(6,AddonModForumPostComponent_ng_container_1_div_4_ion_button_6_Template,3,3,"ion-button",23),k.k0s()),2&o){const o=k.XpG(2);k.R7$(2),k.Y8G("ngIf",o.discussion&&!o.post.parentid&&o.discussion.pinned),k.R7$(),k.Y8G("ngIf",o.discussion&&!o.post.parentid&&!o.discussion.pinned&&o.discussion.starred),k.R7$(),k.Y8G("text",o.post.subject)("contextInstanceId",o.forum&&o.forum.cmid)("courseId",o.courseId)("sanitize",!o.post.id||o.post.id<0),k.R7$(),k.Y8G("ngIf",o.trackPosts&&o.post.unread),k.R7$(),k.Y8G("ngIf",o.optionsMenuEnabled)}}function AddonModForumPostComponent_ng_container_1_core_user_avatar_6_Template(o,n){if(1&o&&k.nrm(0,"core-user-avatar",30),2&o){const o=k.XpG(2);k.Y8G("user",o.post.author)("courseId",o.courseId)}}function AddonModForumPostComponent_ng_container_1_span_8_Template(o,n){if(1&o&&(k.j41(0,"span",31),k.EFF(1),k.k0s()),2&o){const o=k.XpG(2);k.R7$(),k.SpI(" ",o.post.author.fullname," ")}}function AddonModForumPostComponent_ng_container_1_div_9_p_1_Template(o,n){if(1&o&&(k.j41(0,"p",33),k.nrm(1,"ion-icon",34),k.nI1(2,"translate"),k.nrm(3,"core-format-text",35),k.k0s()),2&o){const o=n.$implicit,t=k.XpG(3);k.R7$(),k.BMQ("aria-label",k.bMT(2,4,"addon.mod_forum.group")),k.R7$(2),k.Y8G("text",o.name)("contextInstanceId",t.courseId)("wsNotFiltered",!0)}}function AddonModForumPostComponent_ng_container_1_div_9_Template(o,n){if(1&o&&(k.j41(0,"div"),k.DNE(1,AddonModForumPostComponent_ng_container_1_div_9_p_1_Template,4,6,"p",32),k.k0s()),2&o){const o=k.XpG(2);k.R7$(),k.Y8G("ngForOf",o.post.author.groups)}}function AddonModForumPostComponent_ng_container_1_p_10_Template(o,n){if(1&o&&(k.j41(0,"p"),k.EFF(1),k.nI1(2,"coreFormatDate"),k.k0s()),2&o){const o=k.XpG(2);k.R7$(),k.JRh(k.i5U(2,1,1e3*o.post.timecreated,"strftimerecentfull"))}}function AddonModForumPostComponent_ng_container_1_p_11_Template(o,n){1&o&&(k.j41(0,"p"),k.nrm(1,"ion-icon",36),k.EFF(2),k.nI1(3,"translate"),k.k0s()),2&o&&(k.R7$(2),k.SpI(" ",k.bMT(3,1,"core.notsent")," "))}function AddonModForumPostComponent_ng_container_1_ng_container_12_ion_note_1_Template(o,n){1&o&&(k.j41(0,"ion-note",26),k.nI1(1,"translate"),k.nrm(2,"ion-icon",27),k.k0s()),2&o&&k.BMQ("aria-label",k.bMT(1,1,"addon.mod_forum.unread"))}function AddonModForumPostComponent_ng_container_1_ng_container_12_ion_button_2_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"ion-button",28),k.nI1(1,"translate"),k.bIt("click",(function AddonModForumPostComponent_ng_container_1_ng_container_12_ion_button_2_Template_ion_button_click_0_listener(n){k.eBV(o);const t=k.XpG(3);return k.Njj(t.showOptionsMenu(n))})),k.nrm(2,"ion-icon",29),k.k0s()}2&o&&k.Y8G("ariaLabel",k.bMT(1,1,"core.displayoptions"))}function AddonModForumPostComponent_ng_container_1_ng_container_12_Template(o,n){if(1&o&&(k.qex(0),k.DNE(1,AddonModForumPostComponent_ng_container_1_ng_container_12_ion_note_1_Template,3,3,"ion-note",22)(2,AddonModForumPostComponent_ng_container_1_ng_container_12_ion_button_2_Template,3,3,"ion-button",23),k.bVm()),2&o){const o=k.XpG(2);k.R7$(),k.Y8G("ngIf",o.trackPosts&&o.post.unread),k.R7$(),k.Y8G("ngIf",o.optionsMenuEnabled)}}function AddonModForumPostComponent_ng_container_1_div_14_Template(o,n){1&o&&(k.j41(0,"div",37)(1,"ion-note",38),k.EFF(2),k.nI1(3,"translate"),k.k0s()()),2&o&&(k.R7$(2),k.JRh(k.bMT(3,1,"addon.mod_forum.postisprivatereply")))}function AddonModForumPostComponent_ng_container_1_p_16_Template(o,n){if(1&o&&(k.j41(0,"p")(1,"em"),k.EFF(2),k.nI1(3,"translate"),k.k0s()()),2&o){const o=k.XpG(2);k.R7$(2),k.JRh(k.i5U(3,1,"core.numwords",k.eq3(4,_c1,o.post.wordcount)))}}function AddonModForumPostComponent_ng_container_1_div_17_Template(o,n){if(1&o&&(k.j41(0,"div"),k.nrm(1,"core-files",39),k.k0s()),2&o){const o=k.XpG(2);k.R7$(),k.Y8G("files",o.post.attachments)("component",o.component)("componentId",o.componentId)}}function AddonModForumPostComponent_ng_container_1_ion_item_19_Template(o,n){if(1&o&&(k.j41(0,"ion-item",5)(1,"div",40),k.EFF(2),k.nI1(3,"translate"),k.k0s(),k.j41(4,"ion-label"),k.nrm(5,"core-tag-list",41),k.k0s()()),2&o){const o=k.XpG(2);k.R7$(2),k.SpI("",k.bMT(3,2,"core.tag.tags"),":"),k.R7$(3),k.Y8G("tags",o.post.tags)}}function AddonModForumPostComponent_ng_container_1_core_rating_rate_20_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"core-rating-rate",42),k.bIt("onUpdate",(function AddonModForumPostComponent_ng_container_1_core_rating_rate_20_Template_core_rating_rate_onUpdate_0_listener(){k.eBV(o);const n=k.XpG(2);return k.Njj(n.ratingUpdated())})),k.k0s()}if(2&o){const o=k.XpG(2);k.Y8G("ratingInfo",o.ratingInfo)("instanceId",o.componentId)("itemId",o.post.id)("itemSetId",o.discussionId)("courseId",o.courseId)("aggregateMethod",o.forum.assessed)("scaleId",o.forum.scale)("userId",o.post.author.id)}}function AddonModForumPostComponent_ng_container_1_core_rating_aggregate_21_Template(o,n){if(1&o&&k.nrm(0,"core-rating-aggregate",43),2&o){const o=k.XpG(2);k.Y8G("ratingInfo",o.ratingInfo)("instanceId",o.componentId)("itemId",o.post.id)("courseId",o.courseId)("aggregateMethod",o.forum.assessed)("scaleId",o.forum.scale)}}function AddonModForumPostComponent_ng_container_1_ion_item_22_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"ion-item",44)(1,"ion-label")(2,"ion-button",45),k.bIt("click",(function AddonModForumPostComponent_ng_container_1_ion_item_22_Template_ion_button_click_2_listener(n){k.eBV(o);const t=k.XpG(2);return k.Njj(t.showReplyForm(n))})),k.nrm(3,"ion-icon",46),k.EFF(4),k.nI1(5,"translate"),k.k0s()()()}if(2&o){const o=k.XpG(2);k.R7$(2),k.BMQ("aria-controls","addon-forum-reply-edit-form-"+o.uniqueId)("aria-expanded",o.formData.replyingTo===o.post.id),k.R7$(2),k.SpI(" ",k.bMT(5,3,"addon.mod_forum.reply")," ")}}function AddonModForumPostComponent_ng_container_1_Template(o,n){if(1&o&&(k.qex(0),k.j41(1,"ion-card-header",4)(2,"ion-item",5)(3,"ion-label"),k.DNE(4,AddonModForumPostComponent_ng_container_1_div_4_Template,7,8,"div",6),k.j41(5,"div",7),k.DNE(6,AddonModForumPostComponent_ng_container_1_core_user_avatar_6_Template,1,2,"core-user-avatar",8),k.j41(7,"div",9),k.DNE(8,AddonModForumPostComponent_ng_container_1_span_8_Template,2,1,"span",10)(9,AddonModForumPostComponent_ng_container_1_div_9_Template,2,1,"div",2)(10,AddonModForumPostComponent_ng_container_1_p_10_Template,3,4,"p",2)(11,AddonModForumPostComponent_ng_container_1_p_11_Template,4,3,"p",2),k.k0s(),k.DNE(12,AddonModForumPostComponent_ng_container_1_ng_container_12_Template,3,2,"ng-container",2),k.k0s()()()(),k.j41(13,"ion-card-content"),k.DNE(14,AddonModForumPostComponent_ng_container_1_div_14_Template,4,3,"div",11),k.nrm(15,"core-format-text",12),k.DNE(16,AddonModForumPostComponent_ng_container_1_p_16_Template,4,6,"p",2)(17,AddonModForumPostComponent_ng_container_1_div_17_Template,2,3,"div",2),k.k0s(),k.j41(18,"div",13),k.DNE(19,AddonModForumPostComponent_ng_container_1_ion_item_19_Template,6,4,"ion-item",14)(20,AddonModForumPostComponent_ng_container_1_core_rating_rate_20_Template,1,8,"core-rating-rate",15)(21,AddonModForumPostComponent_ng_container_1_core_rating_aggregate_21_Template,1,6,"core-rating-aggregate",16)(22,AddonModForumPostComponent_ng_container_1_ion_item_22_Template,6,5,"ion-item",17),k.k0s(),k.bVm()),2&o){const o=k.XpG();k.R7$(),k.Mz_("id","addon-mod_forum-post-",o.post.id,""),k.R7$(),k.AVh("highlight",o.highlight),k.R7$(2),k.Y8G("ngIf",o.displaySubject),k.R7$(2),k.Y8G("ngIf",o.post.author&&o.post.author.fullname),k.R7$(2),k.Y8G("ngIf",o.post.author&&o.post.author.fullname),k.R7$(),k.Y8G("ngIf",o.post.author&&o.post.author.groups),k.R7$(),k.Y8G("ngIf",o.post.timecreated),k.R7$(),k.Y8G("ngIf",!o.post.timecreated),k.R7$(),k.Y8G("ngIf",!o.displaySubject),k.R7$(),k.HbH(0===o.post.parentid?"ion-padding-top":""),k.R7$(),k.Y8G("ngIf",o.post.isprivatereply),k.R7$(),k.Y8G("component",o.component)("componentId",o.componentId)("text",o.post.message)("contextInstanceId",o.forum&&o.forum.cmid)("courseId",o.courseId)("sanitize",!o.post.id||o.post.id<0),k.R7$(),k.Y8G("ngIf",o.post.haswordcount&&o.post.wordcount),k.R7$(),k.Y8G("ngIf",o.post.attachments&&o.post.attachments.length>0),k.R7$(2),k.Y8G("ngIf",o.tagsEnabled&&o.post.tags&&o.post.tags.length>0),k.R7$(),k.Y8G("ngIf",o.forum&&o.ratingInfo),k.R7$(),k.Y8G("ngIf",o.forum&&o.ratingInfo),k.R7$(),k.Y8G("ngIf",o.post.id>0&&o.post.capabilities.reply&&!o.post.isprivatereply)}}function AddonModForumPostComponent_form_2_ion_item_12_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"ion-item",5)(1,"ion-checkbox",53),k.mxI("ngModelChange",(function AddonModForumPostComponent_form_2_ion_item_12_Template_ion_checkbox_ngModelChange_1_listener(n){k.eBV(o);const t=k.XpG(2);return k.DH7(t.formData.isprivatereply,n)||(t.formData.isprivatereply=n),k.Njj(n)})),k.EFF(2),k.nI1(3,"translate"),k.k0s()()}if(2&o){const o=k.XpG(2);k.R7$(),k.R50("ngModel",o.formData.isprivatereply),k.R7$(),k.SpI(" ",k.bMT(3,2,"addon.mod_forum.privatereply")," ")}}function AddonModForumPostComponent_form_2_ng_container_13_Template(o,n){if(1&o){const o=k.RV6();k.qex(0),k.j41(1,"ion-accordion-group",54),k.bIt("ionChange",(function AddonModForumPostComponent_form_2_ng_container_13_Template_ion_accordion_group_ionChange_1_listener(n){k.eBV(o);const t=k.XpG(2);return k.Njj(t.onAdvancedChanged(n))})),k.j41(2,"ion-accordion",55)(3,"ion-item",56)(4,"ion-label")(5,"h3",57),k.EFF(6),k.nI1(7,"translate"),k.k0s()()(),k.j41(8,"div",58),k.nrm(9,"core-attachments",59),k.k0s()()(),k.bVm()}if(2&o){const o=k.XpG(2);k.R7$(),k.Y8G("value",o.advanced?"advanced":""),k.R7$(5),k.JRh(k.bMT(7,9,"addon.mod_forum.advanced")),k.R7$(3),k.Y8G("files",o.formData.files)("maxSize",o.forum.maxbytes)("maxSubmissions",o.forum.maxattachments)("component",o.component)("componentId",o.forum.cmid)("allowOffline",!0)("courseId",o.courseId)}}function AddonModForumPostComponent_form_2_span_22_Template(o,n){1&o&&(k.j41(0,"span"),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&o&&(k.R7$(),k.JRh(k.bMT(2,1,"core.savechanges")))}function AddonModForumPostComponent_form_2_span_23_Template(o,n){1&o&&(k.j41(0,"span"),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&o&&(k.R7$(),k.JRh(k.bMT(2,1,"addon.mod_forum.posttoforum")))}function AddonModForumPostComponent_form_2_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"form",47,0)(2,"ion-item",5)(3,"ion-input",48),k.nI1(4,"translate"),k.nI1(5,"translate"),k.mxI("ngModelChange",(function AddonModForumPostComponent_form_2_Template_ion_input_ngModelChange_3_listener(n){k.eBV(o);const t=k.XpG();return k.DH7(t.formData.subject,n)||(t.formData.subject=n),k.Njj(n)})),k.k0s()(),k.j41(6,"ion-item")(7,"ion-label",49),k.EFF(8),k.nI1(9,"translate"),k.k0s(),k.j41(10,"core-rich-text-editor",50),k.nI1(11,"translate"),k.bIt("contentChanged",(function AddonModForumPostComponent_form_2_Template_core_rich_text_editor_contentChanged_10_listener(n){k.eBV(o);const t=k.XpG();return k.Njj(t.onMessageChange(n))})),k.k0s()(),k.DNE(12,AddonModForumPostComponent_form_2_ion_item_12_Template,4,4,"ion-item",14)(13,AddonModForumPostComponent_form_2_ng_container_13_Template,10,11,"ng-container",2),k.j41(14,"ion-grid")(15,"ion-row")(16,"ion-col")(17,"ion-button",51),k.bIt("click",(function AddonModForumPostComponent_form_2_Template_ion_button_click_17_listener(){k.eBV(o);const n=k.XpG();return k.Njj(n.cancel())})),k.EFF(18),k.nI1(19,"translate"),k.k0s()(),k.j41(20,"ion-col")(21,"ion-button",52),k.bIt("click",(function AddonModForumPostComponent_form_2_Template_ion_button_click_21_listener(){k.eBV(o);const n=k.XpG();return k.Njj(n.send())})),k.DNE(22,AddonModForumPostComponent_form_2_span_22_Template,3,3,"span",2)(23,AddonModForumPostComponent_form_2_span_23_Template,3,3,"span",2),k.k0s()()()()()}if(2&o){const o=k.XpG();k.Y8G("id","addon-forum-reply-edit-form-"+o.uniqueId),k.R7$(3),k.Y8G("placeholder",k.bMT(4,19,"addon.mod_forum.subject")),k.R50("ngModel",o.formData.subject),k.Y8G("label",k.bMT(5,21,"addon.mod_forum.subject")),k.R7$(5),k.JRh(k.bMT(9,23,"addon.mod_forum.message")),k.R7$(2),k.Y8G("control",o.messageControl)("placeholder",k.bMT(11,25,"addon.mod_forum.replyplaceholder"))("name","mod_forum_reply_"+o.post.id)("component",o.component)("componentId",o.componentId)("autoSave",!0)("contextInstanceId",o.forum&&o.forum.cmid)("draftExtraParams",k.eq3(29,_c2,o.post.id)),k.R7$(2),k.Y8G("ngIf",o.accessInfo.canpostprivatereply),k.R7$(),k.Y8G("ngIf",o.forum.id&&o.forum.maxattachments>0),k.R7$(5),k.JRh(k.bMT(19,27,"core.cancel")),k.R7$(3),k.Y8G("disabled",""===o.formData.subject||null===o.formData.message),k.R7$(),k.Y8G("ngIf",o.formData.isEditing),k.R7$(),k.Y8G("ngIf",!o.formData.isEditing)}}let ro=(()=>{var o;class AddonModForumPostComponent{constructor(o){this.elementRef=o,this.trackPosts=!1,this.leavingPage=!1,this.highlight=!1,this.onPostChange=new k.bkB,this.messageControl=new E.MJ(null),this.advanced=!1,this.displaySubject=!0,this.optionsMenuEnabled=!1}get showForm(){return this.post.id>0?!this.formData.isEditing&&this.formData.replyingTo===this.post.id||!!this.formData.isEditing&&this.formData.id===this.post.id:!!this.formData.isEditing&&this.formData.replyingTo===this.post.parentid}ngOnInit(){this.tagsEnabled=x.CoreTag.areTagsAvailableInSite(),this.uniqueId=this.post.id>0?`reply${this.post.id}`:`edit${this.post.parentid}`;const o=h.HT.instant("addon.mod_forum.re");this.displaySubject=!this.parentSubject||this.post.subject!==this.parentSubject&&this.post.subject!==`Re: ${this.parentSubject}`&&this.post.subject!==`${o} ${this.parentSubject}`,this.defaultReplySubject=this.post.subject,this.optionsMenuEnabled=this.post.id<0||(void 0!==this.post.capabilities.delete?!0===this.post.capabilities.delete||!0===this.post.capabilities.edit:this.post.id<0||v.AddonModForum.isGetDiscussionPostAvailable()&&(v.AddonModForum.isDeletePostAvailable()||v.AddonModForum.isUpdatePostAvailable()))}ngOnChanges(o){o.leavingPage&&this.leavingPage&&Y.R.triggerFormCancelledEvent(this.formElement,f.CoreSites.getCurrentSiteId())}deletePost(){var o=this;return(0,e.A)((function*(){o.analyticsLogEvent("mod_forum_delete_post",`/mod/forum/post.php?delete=${o.post.id}`);try{yield j.CoreAlerts.confirmDelete(h.HT.instant("addon.mod_forum.deletesure"));const n=yield R.CoreLoadings.show("core.deleting",!0);try{const n=yield v.AddonModForum.deletePost(o.post.id);P.z.trigger(y.rh,{forumId:o.forum.id,discussionId:o.discussionId,cmId:o.forum.cmid,deleted:n.status,post:o.post},f.CoreSites.getCurrentSiteId()),O.CoreToasts.show({message:"addon.mod_forum.deletedpost",translateMessage:!0})}catch(o){j.CoreAlerts.showError(o)}finally{n.dismiss()}}catch(o){}}))()}setFormData(o,n,t,e,s,i,a){r.CoreFileUploader.clearTmpFiles(this.formData.files),this.formData.replyingTo=o||0,this.formData.isEditing=!!n,this.formData.subject=t||this.defaultReplySubject||"",this.formData.message=e||null,this.formData.files=(null!=s?s:[]).slice(),this.formData.isprivatereply=!!i,this.formData.id=a,this.messageControl.setValue(this.formData.message),this.originalData.subject=this.formData.subject,this.originalData.message=this.formData.message,this.originalData.files=this.formData.files.slice(),this.originalData.isprivatereply=this.formData.isprivatereply,this.advanced=this.formData.files.length>0,(!n||!a||a<=0)&&(this.preparePostData=void 0)}showOptionsMenu(o){var n=this;return(0,e.A)((function*(){const{AddonModForumPostOptionsMenuComponent:e}=yield t.e(80697).then(t.bind(t,80697)),s=yield U.CorePopovers.open({component:e,componentProps:{post:n.post,forumId:n.forum.id,cmId:n.forum.cmid},event:o,waitForDismissCompleted:!0});if(s&&s.action)switch(s.action){case"edit":n.editPost();break;case"delete":n.deletePost();break;case"deleteoffline":n.discardOfflineReply()}}))()}showReplyForm(o){var n=this;return(0,e.A)((function*(){if(o.preventDefault(),o.stopPropagation(),n.formData.isEditing)try{yield n.confirmDiscard(),n.setFormData(n.post.id),n.scrollToForm()}catch{}else n.formData.replyingTo?(n.formData.replyingTo=n.post.id,n.formData.subject==n.originalData.subject&&(n.formData.subject=n.defaultReplySubject,n.originalData.subject=n.defaultReplySubject),n.messageControl.setValue(n.formData.message)):n.setFormData(n.post.id),n.scrollToForm(),n.analyticsLogEvent("mod_forum_add_discussion_post",`/mod/forum/post.php?reply=${n.post.id}`)}))()}editPost(){var o=this;return(0,e.A)((function*(){try{yield o.confirmDiscard()}catch{return}const n=yield R.CoreLoadings.show();try{let n=o.post.message;if(o.post.id>0){var t,e;o.preparePostData=yield v.AddonModForum.preparePostForEdition(o.post.id,"post");const{text:s}=L.CoreFileHelper.replaceDraftfileUrls(f.CoreSites.getRequiredCurrentSite().getURL(),o.preparePostData.messagetext,null!==(t=o.post.messageinlinefiles)&&void 0!==t&&t.length?o.post.messageinlinefiles:null!==(e=o.preparePostData.files)&&void 0!==e?e:[]);n=s}o.formData.syncId=A.F.getDiscussionSyncId(o.discussionId),w.CoreSync.blockOperation(y.Ep,o.formData.syncId),o.setFormData(o.post.parentid,!0,o.post.subject,n,o.post.attachments,o.post.isprivatereply,o.post.id>0?o.post.id:void 0),o.scrollToForm(),o.analyticsLogEvent("mod_forum_update_discussion_post",`/mod/forum/post.php?edit=${o.post.id}`)}catch(o){j.CoreAlerts.showError(o,{default:h.HT.instant("addon.mod_forum.errorgetpost")})}finally{n.dismiss()}}))()}onMessageChange(o){this.formData.message=null!=o?o:null}send(){var o=this;return(0,e.A)((function*(){var n;if(!o.formData.subject)return j.CoreAlerts.showError(h.HT.instant("addon.mod_forum.erroremptysubject")),void 0;if(!o.formData.message)return j.CoreAlerts.showError(h.HT.instant("addon.mod_forum.erroremptymessage")),void 0;let t=o.formData.message;const e=o.formData.subject,s=null!==(n=o.formData.replyingTo)&&void 0!==n?n:0,i=o.formData.files||[],r=o.formData.id&&o.formData.id>0,a=yield R.CoreLoadings.show("core.sending",!0);var d,c;r&&o.preparePostData&&(t=L.CoreFileHelper.restoreDraftfileUrls(f.CoreSites.getRequiredCurrentSite().getURL(),t,o.preparePostData.messagetext,null!==(d=o.post.messageinlinefiles)&&void 0!==d&&d.length?o.post.messageinlinefiles:null!==(c=o.preparePostData.files)&&void 0!==c?c:[]));t=$.Ni.formatHtmlLines(t);try{let n=!1;if(o.formData.id&&o.formData.id>0){var u;const s=yield o.uploadAttachmentsForEditOnline(o.formData.id);n=yield v.AddonModForum.updatePost(o.formData.id,e,t,{attachmentsid:s,inlineattachmentsid:null===(u=o.preparePostData)||void 0===u?void 0:u.draftitemid})}else{const{attachments:r,saveOffline:a}=yield o.uploadAttachmentsForReply(s);a?(yield F.p.replyPost(s,o.discussionId,o.forum.id,o.forum.name,o.courseId,e,t,{attachmentsid:r,private:!!o.formData.isprivatereply}),n=!1):n=yield v.AddonModForum.replyPost(s,o.discussionId,o.forum.id,o.forum.name,o.courseId,e,t,{attachmentsid:r,private:!!o.formData.isprivatereply},void 0,!i.length)}n&&o.forum.id&&D.i.deleteReplyStoredFiles(o.forum.id,s),o.setFormData(),o.onPostChange.emit(),Y.R.triggerFormSubmittedEvent(o.formElement,n,f.CoreSites.getCurrentSiteId()),o.unblockOperation()}catch(o){j.CoreAlerts.showError(o,{default:h.HT.instant(r?"addon.mod_forum.couldnotupdate":"addon.mod_forum.couldnotadd")})}finally{a.dismiss()}}))()}uploadAttachmentsForEditOnline(o){var n=this;return(0,e.A)((function*(){var t,e;const s=n.formData.files||[],i=null!==(t=n.post.attachments)&&void 0!==t?t:[];if(!r.CoreFileUploader.areFileListDifferent(s,i))return;let a,d=s.filter((o=>!N.H.isFileEntry(o)));var c,u;i.length&&!d.length&&(d=[i[0]],a=[{filename:null!==(c=i[0].filename)&&void 0!==c?c:"",filepath:null!==(u=i[0].filepath)&&void 0!==u?u:""}]);const m=yield v.AddonModForum.preparePostForEdition(o,"attachment",{filesToKeep:d});return null!==(e=a)&&void 0!==e&&e.length&&(yield r.CoreFileUploader.deleteDraftFiles(m.draftitemid,a)),yield r.CoreFileUploader.uploadFiles(m.draftitemid,s),m.draftitemid}))()}uploadAttachmentsForReply(o){var n=this;return(0,e.A)((function*(){const t=n.formData.files||[];if(!t.length)return{attachments:void 0,saveOffline:!1};try{return{attachments:yield D.i.uploadOrStoreReplyFiles(n.forum.id,o,t,!1),saveOffline:!1}}catch(e){if(!n.forum.id||X.CoreWSError.isWebServiceError(e))throw e;return{attachments:yield D.i.uploadOrStoreReplyFiles(n.forum.id,o,t,!0),saveOffline:!0}}}))()}cancel(){var o=this;return(0,e.A)((function*(){try{yield o.confirmDiscard(),o.setFormData(),Y.R.triggerFormCancelledEvent(o.formElement,f.CoreSites.getCurrentSiteId()),o.unblockOperation()}catch(o){}}))()}discardOfflineReply(){var o=this;return(0,e.A)((function*(){if(void 0!==o.post.parentid)try{yield j.CoreAlerts.confirmDelete(h.HT.instant("core.areyousure"));const n=[];n.push(F.p.deleteReply(o.post.parentid)),o.forum.id&&n.push(D.i.deleteReplyStoredFiles(o.forum.id,o.post.parentid)),yield S.g.allPromisesIgnoringErrors(n),o.setFormData(),o.onPostChange.emit(),o.unblockOperation()}catch{}}))()}ratingUpdated(){v.AddonModForum.invalidateDiscussionPosts(this.discussionId,this.forum.id)}onAdvancedChanged(o){this.advanced="advanced"===o.detail.value}ngOnDestroy(){this.unblockOperation()}confirmDiscard(){var o=this;return(0,e.A)((function*(){D.i.hasPostDataChanged(o.formData,o.originalData)&&(yield j.CoreAlerts.confirm(h.HT.instant("core.confirmloss"))),o.unblockOperation()}))()}unblockOperation(){this.formData.syncId&&(w.CoreSync.unblockOperation(y.Ep,this.formData.syncId),delete this.formData.syncId)}scrollToForm(){var o=this;return(0,e.A)((function*(){yield I.y.scrollToElement(o.elementRef.nativeElement,`#addon-forum-reply-edit-form-${o.uniqueId}`)}))()}analyticsLogEvent(o,n){this.post.id<=0||b.OF.logEvent({type:b.qr.VIEW_ITEM,ws:o,name:this.post.subject,data:{id:this.post.id,forumid:this.forum.id,category:"forum"},url:n})}}return(o=AddonModForumPostComponent).ɵfac=function AddonModForumPostComponent_Factory(n){return new(n||o)(k.rXU(k.aKT))},o.ɵcmp=k.VBU({type:o,selectors:[["addon-mod-forum-post"]],viewQuery:function AddonModForumPostComponent_Query(o,n){if(1&o&&k.GBs(io,5),2&o){let o;k.mGM(o=k.lsd())&&(n.formElement=o.first)}},inputs:{post:"post",courseId:"courseId",discussionId:"discussionId",discussion:"discussion",component:"component",componentId:"componentId",formData:"formData",originalData:"originalData",trackPosts:[k.Mj6.HasDecoratorInputTransform,"trackPosts","trackPosts",V.G],forum:"forum",accessInfo:"accessInfo",parentSubject:"parentSubject",ratingInfo:"ratingInfo",leavingPage:[k.Mj6.HasDecoratorInputTransform,"leavingPage","leavingPage",V.G],highlight:[k.Mj6.HasDecoratorInputTransform,"highlight","highlight",V.G]},outputs:{onPostChange:"onPostChange"},standalone:!0,features:[k.GFd,k.OA$,k.aNF],decls:3,vars:2,consts:[["replyFormEl",""],[1,"addon-mod_forum-post"],[4,"ngIf"],[3,"id",4,"ngIf"],[1,"ion-text-wrap","ion-no-padding",3,"id"],[1,"ion-text-wrap"],["class","addon-mod-forum-post-title",4,"ngIf"],[1,"addon-mod-forum-post-info"],["slot","start",3,"user","courseId",4,"ngIf"],[1,"addon-mod-forum-post-author"],["class","core-discussionusername",4,"ngIf"],["class","ion-padding-bottom",4,"ngIf"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId","sanitize"],[1,"addon-mod-forum-post-more-info"],["class","ion-text-wrap",4,"ngIf"],["contextLevel","module",3,"ratingInfo","instanceId","itemId","itemSetId","courseId","aggregateMethod","scaleId","userId","onUpdate",4,"ngIf"],["contextLevel","module",3,"ratingInfo","instanceId","itemId","courseId","aggregateMethod","scaleId",4,"ngIf"],["class","ion-no-padding ion-text-end addon-forum-reply-button",4,"ngIf"],[1,"addon-mod-forum-post-title"],["name","fas-map-pin",4,"ngIf"],["name","fas-star","class","addon-forum-star",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId","sanitize"],["class","ion-float-end ion-padding-start ion-text-end",4,"ngIf"],["fill","clear",3,"ariaLabel","click",4,"ngIf"],["name","fas-map-pin"],["name","fas-star",1,"addon-forum-star"],[1,"ion-float-end","ion-padding-start","ion-text-end"],["name","fas-circle","color","primary","aria-hidden","true"],["fill","clear",3,"click","ariaLabel"],["name","ellipsis-vertical","slot","icon-only","aria-hidden","true"],["slot","start",3,"user","courseId"],[1,"core-discussionusername"],["class","core-groupname",4,"ngFor","ngForOf"],[1,"core-groupname"],["name","fas-users"],["contextLevel","course",3,"text","contextInstanceId","wsNotFiltered"],["name","fas-clock","aria-hidden","true"],[1,"ion-padding-bottom"],["color","danger"],["showInline","true",3,"files","component","componentId"],["slot","start"],[3,"tags"],["contextLevel","module",3,"onUpdate","ratingInfo","instanceId","itemId","itemSetId","courseId","aggregateMethod","scaleId","userId"],["contextLevel","module",3,"ratingInfo","instanceId","itemId","courseId","aggregateMethod","scaleId"],[1,"ion-no-padding","ion-text-end","addon-forum-reply-button"],["fill","clear","size","small",3,"click"],["name","fas-reply","slot","start","aria-hidden","true"],[3,"id"],["labelPlacement","stacked","type","text","name","subject",3,"ngModelChange","placeholder","ngModel","label"],["position","stacked"],["elementId","message","contextLevel","module",3,"contentChanged","control","placeholder","name","component","componentId","autoSave","contextInstanceId","draftExtraParams"],["expand","block","fill","outline",3,"click"],["expand","block",3,"click","disabled"],["name","isprivatereply",3,"ngModelChange","ngModel"],[3,"ionChange","value"],["value","advanced","toggleIconSlot","start"],["slot","header"],[1,"item-heading"],["slot","content"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId"]],template:function AddonModForumPostComponent_Template(o,n){1&o&&(k.j41(0,"div",1),k.DNE(1,AddonModForumPostComponent_ng_container_1_Template,23,26,"ng-container",2)(2,AddonModForumPostComponent_form_2_Template,24,31,"form",3),k.k0s()),2&o&&(k.R7$(),k.Y8G("ngIf",!n.formData.isEditing||!n.showForm),k.R7$(),k.Y8G("ngIf",n.showForm))},dependencies:[q.n,J.Sq,J.bT,E.qT,E.BC,E.cb,E.vS,E.cV,m.xk,m.YH,m.Jm,m.I9,m.ME,m.eY,m.hU,m.lO,m.iq,m.$w,m.uz,m.he,m.JI,m.ln,m.hB,m.Gw,Q.V,K.Y,Z.T,oo.t,no.B,to.T,eo.D9,so.f,H.v,W.w,z.z,B.CoreEditorRichTextEditorComponent],styles:["[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]{background-color:var(--ion-item-background);border-bottom:var(--addon-forum-border-color, 1px) solid var(--addon-forum-border-color)}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   .addon-forum-star[_ngcontent-%COMP%]{color:var(--core-star-color)}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   .core-groupname[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item.highlight[_ngcontent-%COMP%]::part(native){background-color:var(--addon-forum-highlight-color)}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:4px}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px;font-weight:700;flex-grow:1}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:0;margin-inline-end:6px;margin-top:0;margin-bottom:0}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   core-user-avatar[_ngcontent-%COMP%]{--core-avatar-size: var(--addon-forum-avatar-size);margin-inline-start:0;margin-inline-end:8px;margin-top:0;margin-bottom:0}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-title[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-info[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-info[_ngcontent-%COMP%]{margin-top:8px}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-title[_ngcontent-%COMP%] + .addon-mod-forum-post-info[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-title[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-info[_ngcontent-%COMP%]   .addon-mod-forum-post-author[_ngcontent-%COMP%]{flex-grow:1}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-top:14px}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .item-inner[_ngcontent-%COMP%]{border-bottom:0}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   .addon-mod-forum-post-more-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:1rem}"]}),AddonModForumPostComponent})();var ao=t(29492),co=t(21182),uo=t(69502),mo=t(17388),lo=t(64422),_o=t(13988),po=t(4060),fo=t(28988),go=t(88246);const discussion_c0=o=>({$a:o}),discussion_c1=o=>({post:o});function AddonModForumDiscussionPage_h1_6_Template(o,n){if(1&o&&(k.j41(0,"h1"),k.nrm(1,"core-format-text",23),k.k0s()),2&o){const o=k.XpG();k.R7$(),k.Y8G("text",o.startingPost.subject)("contextInstanceId",o.cmId)("courseId",o.courseId)("sanitize",!o.startingPost.id||o.startingPost.id<0)}}function AddonModForumDiscussionPage_core_context_menu_item_10_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"core-context-menu-item",24),k.nI1(1,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(n){k.eBV(o);const t=k.XpG();return k.Njj(t.doRefresh(null,n))})),k.k0s()}if(2&o){const o=k.XpG();k.Y8G("priority",650)("content",k.bMT(1,4,"addon.mod_forum.refreshposts"))("iconAction",o.refreshIcon)("closeOnClick",!1)}}function AddonModForumDiscussionPage_core_context_menu_item_11_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"core-context-menu-item",24),k.nI1(1,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_core_context_menu_item_11_Template_core_context_menu_item_action_0_listener(n){k.eBV(o);const t=k.XpG();return k.Njj(t.doRefresh(null,n,!0))})),k.k0s()}if(2&o){const o=k.XpG();k.Y8G("priority",550)("content",k.bMT(1,4,"core.settings.synchronizenow"))("iconAction",o.syncIcon)("closeOnClick",!1)}}function AddonModForumDiscussionPage_ion_card_37_Template(o,n){if(1&o&&(k.j41(0,"ion-card",25)(1,"ion-item"),k.nrm(2,"ion-icon",26),k.j41(3,"ion-label"),k.EFF(4),k.nI1(5,"translate"),k.k0s()()()),2&o){const o=k.XpG();k.R7$(4),k.JRh(k.i5U(5,1,"core.hasdatatosync",k.eq3(4,discussion_c0,o.discussionStr)))}}function AddonModForumDiscussionPage_ion_card_38_Template(o,n){if(1&o&&(k.j41(0,"ion-card",27)(1,"ion-item"),k.nrm(2,"ion-icon",28),k.j41(3,"ion-label"),k.EFF(4),k.k0s()()()),2&o){const o=k.XpG();k.R7$(4),k.JRh(o.availabilityMessage)}}function AddonModForumDiscussionPage_ion_card_39_Template(o,n){1&o&&(k.j41(0,"ion-card",27)(1,"ion-item"),k.nrm(2,"ion-icon",29),k.j41(3,"ion-label"),k.EFF(4),k.nI1(5,"translate"),k.k0s()()()),2&o&&(k.R7$(4),k.JRh(k.bMT(5,1,"addon.mod_forum.discussionlocked")))}function AddonModForumDiscussionPage_ion_card_40_Template(o,n){1&o&&(k.j41(0,"ion-card",27)(1,"ion-item"),k.nrm(2,"ion-icon",28),k.j41(3,"ion-label"),k.EFF(4),k.nI1(5,"translate"),k.k0s()()()),2&o&&(k.R7$(4),k.JRh(k.bMT(5,1,"addon.mod_forum.qandanotify")))}function AddonModForumDiscussionPage_div_41_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"div",30)(1,"addon-mod-forum-post",31),k.bIt("onPostChange",(function AddonModForumDiscussionPage_div_41_Template_addon_mod_forum_post_onPostChange_1_listener(){k.eBV(o);const n=k.XpG();return k.Njj(n.postListChanged())})),k.k0s()()}if(2&o){const o=k.XpG();k.R7$(),k.Y8G("post",o.startingPost)("discussion",o.discussion)("courseId",o.courseId)("highlight",!0)("discussionId",o.discussionId)("component",o.component)("componentId",o.cmId)("formData",o.formData)("originalData",o.originalData)("forum",o.forum)("accessInfo",o.accessInfo)("trackPosts",o.trackPosts)("ratingInfo",o.ratingInfo)("leavingPage",o.leavingPage)}}function AddonModForumDiscussionPage_ion_card_42_ng_container_1_core_spacer_1_Template(o,n){1&o&&k.nrm(0,"core-spacer")}function AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template(o,n){if(1&o){const o=k.RV6();k.qex(0),k.DNE(1,AddonModForumDiscussionPage_ion_card_42_ng_container_1_core_spacer_1_Template,1,0,"core-spacer",3),k.j41(2,"addon-mod-forum-post",33),k.bIt("onPostChange",(function AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template_addon_mod_forum_post_onPostChange_2_listener(){k.eBV(o);const n=k.XpG(2);return k.Njj(n.postListChanged())})),k.k0s(),k.bVm()}if(2&o){const o=n.$implicit,t=n.first,e=k.XpG(2);k.R7$(),k.Y8G("ngIf",!t),k.R7$(),k.Y8G("post",o)("courseId",e.courseId)("discussionId",e.discussionId)("component",e.component)("componentId",e.cmId)("formData",e.formData)("originalData",e.originalData)("parentSubject",e.postSubjects[o.parentid])("forum",e.forum)("accessInfo",e.accessInfo)("trackPosts",e.trackPosts)("ratingInfo",e.ratingInfo)("leavingPage",e.leavingPage)}}function AddonModForumDiscussionPage_ion_card_42_Template(o,n){if(1&o&&(k.j41(0,"ion-card"),k.DNE(1,AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template,3,14,"ng-container",32),k.k0s()),2&o){const o=k.XpG();k.R7$(),k.Y8G("ngForOf",o.posts)}}function AddonModForumDiscussionPage_ng_container_43_ng_container_1_ng_container_1_Template(o,n){1&o&&k.eu8(0)}function AddonModForumDiscussionPage_ng_container_43_ng_container_1_Template(o,n){if(1&o&&(k.qex(0),k.DNE(1,AddonModForumDiscussionPage_ng_container_43_ng_container_1_ng_container_1_Template,1,0,"ng-container",34),k.bVm()),2&o){const o=n.$implicit;k.XpG(2);const t=k.sdS(45);k.R7$(),k.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",k.eq3(2,discussion_c1,o))}}function AddonModForumDiscussionPage_ng_container_43_Template(o,n){if(1&o&&(k.qex(0),k.DNE(1,AddonModForumDiscussionPage_ng_container_43_ng_container_1_Template,2,4,"ng-container",32),k.bVm()),2&o){const o=k.XpG();k.R7$(),k.Y8G("ngForOf",o.posts)}}function AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_ng_container_1_Template(o,n){1&o&&k.eu8(0)}function AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_Template(o,n){if(1&o&&(k.qex(0),k.DNE(1,AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_ng_container_1_Template,1,0,"ng-container",34),k.bVm()),2&o){const o=n.$implicit;k.XpG(3);const t=k.sdS(45);k.R7$(),k.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",k.eq3(2,discussion_c1,o))}}function AddonModForumDiscussionPage_ng_template_44_div_2_Template(o,n){if(1&o&&(k.j41(0,"div",36),k.DNE(1,AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_Template,2,4,"ng-container",32),k.k0s()),2&o){const o=k.XpG().post;k.R7$(),k.Y8G("ngForOf",o.children)}}function AddonModForumDiscussionPage_ng_template_44_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"ion-card")(1,"addon-mod-forum-post",33),k.bIt("onPostChange",(function AddonModForumDiscussionPage_ng_template_44_Template_addon_mod_forum_post_onPostChange_1_listener(){k.eBV(o);const n=k.XpG();return k.Njj(n.postListChanged())})),k.k0s()(),k.DNE(2,AddonModForumDiscussionPage_ng_template_44_div_2_Template,2,1,"div",35)}if(2&o){const o=n.post,t=k.XpG();k.R7$(),k.Y8G("post",o)("courseId",t.courseId)("discussionId",t.discussionId)("component",t.component)("componentId",t.cmId)("formData",t.formData)("originalData",t.originalData)("parentSubject",t.postSubjects[o.parentid])("forum",t.forum)("accessInfo",t.accessInfo)("trackPosts",t.trackPosts)("ratingInfo",t.ratingInfo)("leavingPage",t.leavingPage),k.R7$(),k.Y8G("ngIf",o.children&&o.children.length&&o.children[0].subject)}}let ho=(()=>{var o;class AddonModForumDiscussionPage{constructor(o,n,t,e){this.splitView=o,this.elementRef=n,this.route=t,this.courseContentsPage=e,this.forum={},this.accessInfo={},this.posts=[],this.discussionLoaded=!1,this.sort="nested",this.formData={replyingTo:0,isEditing:!1,subject:"",message:null,files:[],isprivatereply:!1},this.originalData={subject:null,message:null,files:[],isprivatereply:!1},this.refreshIcon=s.CoreConstants.ICON_LOADING,this.syncIcon=s.CoreConstants.ICON_LOADING,this.discussionStr="",this.component=y.CT,this.canPin=!1,this.availabilityMessage=null,this.showQAMessage=!1,this.leavingPage=!1,this.hasOfflineRatings=!1}get isMobile(){return p.CoreScreen.isMobile}ngOnInit(){var o=this;return(0,e.A)((function*(){try{var n;const e=_.CoreNavigator.getRouteData(o.route);var t;if(o.courseId=_.CoreNavigator.getRouteNumberParam("courseId"),o.cmId=_.CoreNavigator.getRouteNumberParam("cmId"),o.forumId=_.CoreNavigator.getRouteNumberParam("forumId"),o.discussion=_.CoreNavigator.getRouteParam("discussion"),o.discussionId=o.discussion?o.discussion.discussion:_.CoreNavigator.getRequiredRouteNumberParam("discussionId"),o.trackPosts=_.CoreNavigator.getRouteBooleanParam("trackPosts")||!1,o.postId=_.CoreNavigator.getRouteNumberParam("postId"),o.parent=_.CoreNavigator.getRouteNumberParam("parent"),o.courseId&&o.cmId&&(null===(n=e.swipeEnabled)||void 0===n||n))o.discussions=new AddonModForumDiscussionDiscussionsSwipeManager(i.u.getOrCreateSource(C.a,[o.courseId,o.cmId,null!==(t=e.discussionsPathPrefix)&&void 0!==t?t:""])),yield o.discussions.start()}catch(n){return j.CoreAlerts.showError(n),o.goBack(),void 0}const e=f.CoreSites.getCurrentSite();o.isOnline=l.WE.isOnline(),o.externalUrl=e&&e.shouldDisplayInformativeLinks()?e.createSiteUrl("/mod/forum/discuss.php",{d:o.discussionId.toString()}):void 0,o.onlineObserver=l.WE.onChange().subscribe((()=>{h.SK.run((()=>{o.isOnline=l.WE.isOnline()}))})),o.discussionStr=h.HT.instant("addon.mod_forum.discussion")}))()}ngAfterViewInit(){var o=this;return(0,e.A)((function*(){o.sort=o.parent?"nested":yield o.getUserSort(),yield o.fetchPosts(!0,!1,!0);const n=o.postId||o.parent;n&&I.y.scrollToElement(o.elementRef.nativeElement,`#addon-mod_forum-post-${n}`)}))()}ionViewDidEnter(){var o=this;return(0,e.A)((function*(){if(o.syncObserver)return;o.discussion||(yield o.loadDiscussion(o.discussionId,o.forumId,o.cmId));const n=o.discussion;o.syncObserver=P.z.on(y.D7,(n=>{n.forumId==o.forumId&&o.discussionId==n.discussionId&&n.userId==f.CoreSites.getCurrentSiteUserId()&&(o.discussionLoaded=!1,o.refreshPosts())}),f.CoreSites.getCurrentSiteId()),o.syncManualObserver=P.z.on(y.uP,(n=>{"discussion"!=n.source&&n.forumId==o.forumId&&n.userId==f.CoreSites.getCurrentSiteUserId()&&(o.discussionLoaded=!1,o.refreshPosts())}),f.CoreSites.getCurrentSiteId()),o.forumId&&n&&n.numunread>0&&v.AddonModForum.invalidateDiscussionsList(o.forumId),o.ratingOfflineObserver=P.z.on(a.CoreRatingProvider.RATING_SAVED_EVENT,(n=>{"mod_forum"==n.component&&"post"==n.ratingArea&&"module"==n.contextLevel&&n.instanceId==o.cmId&&n.itemSetId==o.discussionId&&(o.hasOfflineRatings=!0)})),o.ratingSyncObserver=P.z.on(c.CoreRatingSyncProvider.SYNCED_EVENT,function(){var n=(0,e.A)((function*(n){"mod_forum"==n.component&&"post"==n.ratingArea&&"module"==n.contextLevel&&n.instanceId==o.cmId&&n.itemSetId==o.discussionId&&(o.hasOfflineRatings=!1)}));return function(o){return n.apply(this,arguments)}}()),o.changeDiscObserver=P.z.on(y.rh,(t=>{n&&o.forumId&&(o.forumId===t.forumId||t.cmId===o.cmId)&&v.AddonModForum.invalidateDiscussionsList(o.forumId).finally((()=>{var e;(void 0!==t.locked&&(n.locked=t.locked),void 0!==t.pinned&&(n.pinned=t.pinned),void 0!==t.starred&&(n.starred=t.starred),void 0!==t.deleted&&t.deleted)&&(null!==(e=t.post)&&void 0!==e&&e.parentid?(o.discussionLoaded=!1,o.refreshPosts()):o.goBack())}))}))}))()}canLeave(){var o=this;return(0,e.A)((function*(){return D.i.hasPostDataChanged(o.formData,o.originalData)&&(yield j.CoreAlerts.confirmLeaveWithChanges()),r.CoreFileUploader.clearTmpFiles(o.formData.files),o.leavingPage=!0,!0}))()}goBack(){var o;this.leavingPage||(null!==(o=this.splitView)&&void 0!==o&&o.outletActivated?_.CoreNavigator.navigate((this.courseContentsPage?"../":"")+"../"):_.CoreNavigator.back())}ionViewWillLeave(){var o,n,t,e,s;null===(o=this.syncObserver)||void 0===o||o.off(),null===(n=this.syncManualObserver)||void 0===n||n.off(),null===(t=this.ratingOfflineObserver)||void 0===t||t.off(),null===(e=this.ratingSyncObserver)||void 0===e||e.off(),null===(s=this.changeDiscObserver)||void 0===s||s.off(),delete this.syncObserver}ngOnDestroy(){var o,n;null===(o=this.onlineObserver)||void 0===o||o.unsubscribe(),null===(n=this.discussions)||void 0===n||n.destroy()}getUserSort(){return(0,e.A)((function*(){try{return yield f.CoreSites.getRequiredCurrentSite().getLocalSiteConfig("AddonModForumDiscussionSort")}catch(o){try{const o=yield u.CoreUser.getUserPreference("forum_displaymode");switch(Number(o)){case 1:return"flat-oldest";case-1:return"flat-newest";case 3:return"nested"}}catch{}}return"flat-oldest"}))()}fetchForum(){if(this.courseId&&this.cmId)return v.AddonModForum.getForum(this.courseId,this.cmId);if(this.courseId&&this.forumId)return v.AddonModForum.getForumById(this.courseId,this.forumId);throw new Error("Cannot get the forum")}fetchPosts(o,n,t){var i=this;return(0,e.A)((function*(){let r=[];const a=[];let c=!1;try{o&&(yield S.g.ignoreErrors(i.syncDiscussion(!!n)));const t=yield v.AddonModForum.getDiscussionPosts(i.discussionId,{cmId:i.cmId}),s=yield F.p.getDiscussionReplies(i.discussionId);i.ratingInfo=t.ratinginfo,r=t.posts,i.courseId=t.courseid||i.courseId,i.forumId=t.forumid||i.forumId,i.postHasOffline=!!s.length;const u=[],m={};r.forEach((o=>{m[o.id]=o,c=c||!!o.unread})),s.forEach((o=>{i.forumId||(i.forumId=o.forumid),i.courseId||(i.courseId=o.courseid),u.push(D.i.instance.convertOfflineReplyToOnline(o).then(function(){var o=(0,e.A)((function*(o){a.push(o),o.parentid&&(m[o.parentid].capabilities.reply=!1)}));return function(n){return o.apply(this,arguments)}}()))})),yield Promise.all(u),r=G.T.toArray(m);let l=a.concat(r);if(i.startingPost=v.AddonModForum.extractStartingPost(l),"nested"==i.sort){v.AddonModForum.sortDiscussionPosts(l,"ASC");l=g.j.formatTree(l,"parentid","id",i.startingPost?i.startingPost.id:i.discussion?i.discussion.id:0)}else{v.AddonModForum.sortDiscussionPosts(l,"flat-newest"==i.sort?"DESC":"ASC")}try{const o=yield i.fetchForum();void 0!==o.istracked&&(i.trackPosts=o.istracked),i.forumId=o.id,i.cmId=o.cmid,i.courseId=o.course,i.forum=o,i.availabilityMessage=D.i.getAvailabilityMessage(o);const n=[];n.push(v.AddonModForum.instance.getAccessInformation(i.forumId,{cmId:i.cmId}).then(function(){var n=(0,e.A)((function*(n){i.accessInfo=n,D.i.isCutoffDateReached(o)&&!n.cancanoverridecutoff&&l.forEach((o=>{o.capabilities.reply=!1}));const t=f.CoreSites.getCurrentSiteUserId();i.showQAMessage="qanda"===o.type&&!n.canviewqandawithoutposting&&!l.some((o=>o.author.id===t))}));return function(o){return n.apply(this,arguments)}}())),i.discussion||n.push(i.loadDiscussion(i.discussionId,i.forumId,i.cmId)),yield Promise.all(n)}catch{}if(!i.discussion&&!i.startingPost)throw new Error("Invalid forum discussion.");if(i.startingPost&&i.startingPost.author&&"single"===i.forum.type&&(delete i.startingPost.author.fullname,delete i.startingPost.author.groups),i.posts=l,i.postSubjects=i.getAllPosts().reduce(((o,n)=>(o[n.id]=n.subject,o)),i.startingPost?{[i.startingPost.id]:i.startingPost.subject}:{}),v.AddonModForum.isSetPinStateAvailableForSite()&&i.forumId)try{const o=yield v.AddonModForum.canAddDiscussionToAll(i.forumId,{cmId:i.cmId});i.canPin=!!o.canpindiscussions}catch(o){i.canPin=!1}else i.canPin=!1;i.hasOfflineRatings=yield d.CoreRatingOffline.hasRatings("mod_forum","post","module",i.cmId,i.discussionId)}catch(o){j.CoreAlerts.showError(o)}finally{i.discussionLoaded=!0,i.refreshIcon=s.CoreConstants.ICON_REFRESH,i.syncIcon=s.CoreConstants.ICON_SYNC,(t||c&&i.trackPosts)&&i.logDiscussionView(t)}}))()}loadDiscussion(o,n,t){var s=this;return(0,e.A)((function*(){!s.discussion&&n&&t&&(s.discussion=yield D.i.getDiscussionById(n,t,o),s.discussionId=s.discussion.discussion)}))()}syncDiscussion(o){var n=this;return(0,e.A)((function*(){const t=[];t.push(A.F.instance.syncDiscussionReplies(n.discussionId).then((o=>{o.warnings&&o.warnings.length&&j.CoreAlerts.show({message:o.warnings[0]}),o&&o.updated&&n.forumId&&P.z.trigger(y.uP,{forumId:n.forumId,userId:f.CoreSites.getCurrentSiteUserId(),source:"discussion"},f.CoreSites.getCurrentSiteId())}))),t.push(A.F.instance.syncRatings(n.cmId,n.discussionId).then((o=>{o.warnings&&o.warnings.length&&j.CoreAlerts.show({message:o.warnings[0]})})));try{yield Promise.all(t)}catch(n){throw o&&j.CoreAlerts.showError(n,{default:h.HT.instant("core.errorsync")}),new Error("Failed syncing discussion")}}))()}doRefresh(o,n,t=!1){var s=this;return(0,e.A)((function*(){s.discussionLoaded&&(yield s.refreshPosts(!0,t).finally((()=>{null==o||o.complete(),n&&n()})))}))()}refreshPosts(o,n){var t=this;return(0,e.A)((function*(){t.content.scrollToTop(),t.refreshIcon=s.CoreConstants.ICON_LOADING,t.syncIcon=s.CoreConstants.ICON_LOADING;const e=[];t.courseId&&e.push(v.AddonModForum.invalidateForumData(t.courseId)),e.push(v.AddonModForum.invalidateDiscussionPosts(t.discussionId,t.forumId)),t.forumId&&e.push(v.AddonModForum.invalidateAccessInformation(t.forumId)),t.forumId&&e.push(v.AddonModForum.invalidateCanAddDiscussion(t.forumId)),yield S.g.allPromisesIgnoringErrors(e),yield t.fetchPosts(o,n)}))()}changeSort(o){return this.discussionLoaded=!1,this.sort=o,f.CoreSites.getRequiredCurrentSite().setLocalSiteConfig("AddonModForumDiscussionSort",this.sort),this.content.scrollToTop(),this.fetchPosts()}setLockState(o){var n=this;return(0,e.A)((function*(){if(!n.discussion||!n.forumId||!n.cmId)return;const t=yield R.CoreLoadings.show("core.sending",!0);try{const t=yield v.AddonModForum.setLockState(n.forumId,n.discussionId,o);n.discussion.locked=t.locked;P.z.trigger(y.rh,{forumId:n.forumId,discussionId:n.discussionId,cmId:n.cmId,locked:n.discussion.locked},f.CoreSites.getCurrentSiteId()),O.CoreToasts.show({message:"addon.mod_forum.lockupdated",translateMessage:!0})}catch(o){j.CoreAlerts.showError(o)}finally{t.dismiss()}}))()}setPinState(o){var n=this;return(0,e.A)((function*(){if(!n.discussion||!n.forumId||!n.cmId)return;const t=yield R.CoreLoadings.show("core.sending",!0);try{yield v.AddonModForum.setPinState(n.discussionId,o),n.discussion.pinned=o;P.z.trigger(y.rh,{forumId:n.forumId,discussionId:n.discussionId,cmId:n.cmId,pinned:n.discussion.pinned},f.CoreSites.getCurrentSiteId()),O.CoreToasts.show({message:"addon.mod_forum.pinupdated",translateMessage:!0})}catch(o){j.CoreAlerts.showError(o)}finally{t.dismiss()}}))()}toggleFavouriteState(o){var n=this;return(0,e.A)((function*(){if(!n.discussion||!n.forumId||!n.cmId)return;const t=yield R.CoreLoadings.show("core.sending",!0);try{yield v.AddonModForum.toggleFavouriteState(n.discussionId,o),n.discussion.starred=o;P.z.trigger(y.rh,{forumId:n.forumId,discussionId:n.discussionId,cmId:n.cmId,starred:n.discussion.starred},f.CoreSites.getCurrentSiteId()),O.CoreToasts.show({message:"addon.mod_forum.favouriteupdated",translateMessage:!0})}catch(o){j.CoreAlerts.showError(o)}finally{t.dismiss()}}))()}postListChanged(){if(!this.forumId||!this.cmId)return;P.z.trigger(y.L4,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId},f.CoreSites.getCurrentSiteId()),this.discussionLoaded=!1,this.refreshPosts().finally((()=>{this.discussionLoaded=!0}))}getAllPosts(){return this.posts.map((o=>this.flattenPostHierarchy(o))).flat()}flattenPostHierarchy(o){const n=[o],t=o.children||[];for(const o of t)n.push(...this.flattenPostHierarchy(o));return n}logDiscussionView(o=!1){var n=this;return(0,e.A)((function*(){var t,e,s;(yield S.g.ignoreErrors(v.AddonModForum.logDiscussionView(n.discussionId,n.forumId||-1)),o)&&b.OF.logEvent({type:b.qr.VIEW_ITEM,ws:"mod_forum_view_forum_discussion",name:null!==(t=null!==(e=null===(s=n.startingPost)||void 0===s?void 0:s.subject)&&void 0!==e?e:n.forum.name)&&void 0!==t?t:"",data:{id:n.discussionId,forumid:n.forumId,category:"forum"},url:`/mod/forum/discuss.php?d=${n.discussionId}`+(n.postId?`#p${n.postId}`:"")});n.courseId&&n.cmId&&n.trackPosts&&P.z.trigger(y.C7,{courseId:n.courseId,moduleId:n.cmId},f.CoreSites.getCurrentSiteId())}))()}}return(o=AddonModForumDiscussionPage).ɵfac=function AddonModForumDiscussionPage_Factory(n){return new(n||o)(k.rXU(ao.M,8),k.rXU(k.aKT),k.rXU(co.nX),k.rXU(T.A,8))},o.ɵcmp=k.VBU({type:o,selectors:[["page-addon-mod-forum-discussion"]],viewQuery:function AddonModForumDiscussionPage_Query(o,n){if(1&o&&k.GBs(m.W9,5),2&o){let o;k.mGM(o=k.lsd())&&(n.content=o.first)}},standalone:!0,features:[k.aNF],decls:46,vars:73,consts:[["nestedPosts",""],["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[3,"priority","content","iconAction","closeOnClick","action",4,"ngIf"],["iconAction","fas-arrow-down",3,"action","hidden","priority","content"],["iconAction","fas-arrow-up",3,"action","hidden","priority","content"],["iconAction","fas-right-left",3,"action","hidden","priority","content"],["iconAction","fas-lock",3,"action","hidden","priority","content"],["iconAction","fas-unlock",3,"action","hidden","priority","content"],["iconAction","fas-map-pin",3,"action","hidden","priority","content"],["iconAction","fas-map-pin",3,"action","hidden","priority","content","iconSlash"],["iconAction","fas-star",3,"action","hidden","priority","content"],["iconAction","fas-star",3,"action","hidden","priority","content","iconSlash"],["iconAction","fas-up-right-from-square",3,"hidden","priority","content","href","showBrowserWarning"],[1,"limited-width",3,"core-swipe-navigation"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],["class","core-warning-card",4,"ngIf"],["class","core-info-card",4,"ngIf"],["class","ion-margin-bottom",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId","sanitize"],[3,"action","priority","content","iconAction","closeOnClick"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[1,"core-info-card"],["name","fas-circle-info","slot","start","aria-hidden","true"],["name","fas-lock","slot","start","aria-hidden","true"],[1,"ion-margin-bottom"],[3,"onPostChange","post","discussion","courseId","highlight","discussionId","component","componentId","formData","originalData","forum","accessInfo","trackPosts","ratingInfo","leavingPage"],[4,"ngFor","ngForOf"],[3,"onPostChange","post","courseId","discussionId","component","componentId","formData","originalData","parentSubject","forum","accessInfo","trackPosts","ratingInfo","leavingPage"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","ion-padding-start",4,"ngIf"],[1,"ion-padding-start"]],template:function AddonModForumDiscussionPage_Template(o,n){if(1&o){const o=k.RV6();k.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),k.nrm(3,"ion-back-button",2),k.nI1(4,"translate"),k.k0s(),k.j41(5,"ion-title"),k.DNE(6,AddonModForumDiscussionPage_h1_6_Template,2,4,"h1",3),k.k0s(),k.nrm(7,"ion-buttons",4),k.k0s()(),k.j41(8,"core-navbar-buttons",4)(9,"core-context-menu"),k.DNE(10,AddonModForumDiscussionPage_core_context_menu_item_10_Template,2,6,"core-context-menu-item",5)(11,AddonModForumDiscussionPage_core_context_menu_item_11_Template,2,6,"core-context-menu-item",5),k.j41(12,"core-context-menu-item",6),k.nI1(13,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_12_listener(){return k.eBV(o),k.Njj(n.changeSort("flat-oldest"))})),k.k0s(),k.j41(14,"core-context-menu-item",7),k.nI1(15,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_14_listener(){return k.eBV(o),k.Njj(n.changeSort("flat-newest"))})),k.k0s(),k.j41(16,"core-context-menu-item",8),k.nI1(17,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_16_listener(){return k.eBV(o),k.Njj(n.changeSort("nested"))})),k.k0s(),k.j41(18,"core-context-menu-item",9),k.nI1(19,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_18_listener(){return k.eBV(o),k.Njj(n.setLockState(!0))})),k.k0s(),k.j41(20,"core-context-menu-item",10),k.nI1(21,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_20_listener(){return k.eBV(o),k.Njj(n.setLockState(!1))})),k.k0s(),k.j41(22,"core-context-menu-item",11),k.nI1(23,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_22_listener(){return k.eBV(o),k.Njj(n.setPinState(!0))})),k.k0s(),k.j41(24,"core-context-menu-item",12),k.nI1(25,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_24_listener(){return k.eBV(o),k.Njj(n.setPinState(!1))})),k.k0s(),k.j41(26,"core-context-menu-item",13),k.nI1(27,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_26_listener(){return k.eBV(o),k.Njj(n.toggleFavouriteState(!0))})),k.k0s(),k.j41(28,"core-context-menu-item",14),k.nI1(29,"translate"),k.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_28_listener(){return k.eBV(o),k.Njj(n.toggleFavouriteState(!1))})),k.k0s(),k.nrm(30,"core-context-menu-item",15),k.nI1(31,"translate"),k.k0s()(),k.j41(32,"ion-content",16)(33,"ion-refresher",17),k.bIt("ionRefresh",(function AddonModForumDiscussionPage_Template_ion_refresher_ionRefresh_33_listener(t){return k.eBV(o),k.Njj(n.doRefresh(t.target))})),k.nrm(34,"ion-refresher-content",18),k.nI1(35,"translate"),k.k0s(),k.j41(36,"core-loading",19),k.DNE(37,AddonModForumDiscussionPage_ion_card_37_Template,6,6,"ion-card",20)(38,AddonModForumDiscussionPage_ion_card_38_Template,5,1,"ion-card",21)(39,AddonModForumDiscussionPage_ion_card_39_Template,6,3,"ion-card",21)(40,AddonModForumDiscussionPage_ion_card_40_Template,6,3,"ion-card",21)(41,AddonModForumDiscussionPage_div_41_Template,2,14,"div",22)(42,AddonModForumDiscussionPage_ion_card_42_Template,2,1,"ion-card",3)(43,AddonModForumDiscussionPage_ng_container_43_Template,2,1,"ng-container",3)(44,AddonModForumDiscussionPage_ng_template_44_Template,3,14,"ng-template",null,0,k.C5r),k.k0s()()}2&o&&(k.R7$(3),k.Y8G("text",k.bMT(4,49,"core.back")),k.R7$(3),k.Y8G("ngIf",n.startingPost),k.R7$(4),k.Y8G("ngIf",n.discussionLoaded&&!n.postHasOffline&&n.isOnline),k.R7$(),k.Y8G("ngIf",n.discussionLoaded&&n.isMobile&&n.postHasOffline&&n.isOnline),k.R7$(),k.Y8G("hidden","flat-oldest"===n.sort)("priority",500)("content",k.bMT(13,51,"addon.mod_forum.modeflatoldestfirst")),k.R7$(2),k.Y8G("hidden","flat-newest"===n.sort)("priority",450)("content",k.bMT(15,53,"addon.mod_forum.modeflatnewestfirst")),k.R7$(2),k.Y8G("hidden","nested"===n.sort)("priority",400)("content",k.bMT(17,55,"addon.mod_forum.modenested")),k.R7$(2),k.Y8G("hidden",!n.discussion||!n.discussion.canlock||n.discussion.locked)("priority",300)("content",k.bMT(19,57,"addon.mod_forum.lockdiscussion")),k.R7$(2),k.Y8G("hidden",!n.discussion||!n.discussion.canlock||!n.discussion.locked)("priority",300)("content",k.bMT(21,59,"addon.mod_forum.unlockdiscussion")),k.R7$(2),k.Y8G("hidden",!n.discussion||!n.canPin||n.discussion.pinned)("priority",250)("content",k.bMT(23,61,"addon.mod_forum.pindiscussion")),k.R7$(2),k.Y8G("hidden",!n.discussion||!n.canPin||!n.discussion.pinned)("priority",250)("content",k.bMT(25,63,"addon.mod_forum.unpindiscussion"))("iconSlash",!0),k.R7$(2),k.Y8G("hidden",!n.discussion||!n.discussion.canfavourite||n.discussion.starred)("priority",200)("content",k.bMT(27,65,"addon.mod_forum.addtofavourites")),k.R7$(2),k.Y8G("hidden",!n.discussion||!n.discussion.canfavourite||!n.discussion.starred)("priority",200)("content",k.bMT(29,67,"addon.mod_forum.removefromfavourites"))("iconSlash",!0),k.R7$(2),k.Y8G("hidden",!n.externalUrl)("priority",100)("content",k.bMT(31,69,"core.openinbrowser"))("href",n.externalUrl)("showBrowserWarning",!1),k.R7$(2),k.Y8G("core-swipe-navigation",n.discussions),k.R7$(),k.Y8G("disabled",!n.discussionLoaded),k.R7$(),k.FS9("pullingText",k.bMT(35,71,"core.pulltorefresh")),k.R7$(2),k.Y8G("hideUntil",n.discussionLoaded),k.R7$(),k.Y8G("ngIf",n.postHasOffline||n.hasOfflineRatings),k.R7$(),k.Y8G("ngIf",n.availabilityMessage),k.R7$(),k.Y8G("ngIf",n.discussion&&n.discussion.locked),k.R7$(),k.Y8G("ngIf",n.showQAMessage),k.R7$(),k.Y8G("ngIf",n.startingPost),k.R7$(),k.Y8G("ngIf","nested"!==n.sort&&n.posts.length),k.R7$(),k.Y8G("ngIf","nested"===n.sort&&n.posts.length))},dependencies:[q.n,J.Sq,J.bT,J.T3,m.QW,m.b_,m.W9,m.eU,m.iq,m.uz,m.he,m.To,m.Ki,m.BC,m.ai,m.el,uo.B,mo.Q,lo.R,_o.c,po.f,oo.t,no.B,fo.n,go.i,eo.D9,ro],styles:["[_nghost-%COMP%]   .addon-forum-reply-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   addon-mod-forum-post[_ngcontent-%COMP%]{--addon-forum-border-color: 0px}"]}),AddonModForumDiscussionPage})();class AddonModForumDiscussionDiscussionsSwipeManager extends M.c{getSelectedItemPathFromRoute(o){const n=_.CoreNavigator.getRouteParams(o);return this.getSource().DISCUSSIONS_PATH_PREFIX+n.discussionId}}},25367:(o,n,t)=>{t.d(n,{v:()=>d});var e=t(15324),s=t(86654),i=t(54438),r=t(60177),a=t(2910);function CoreTagListComponent_ng_container_0_Template(o,n){if(1&o){const o=i.RV6();i.qex(0),i.j41(1,"ion-badge",1),i.bIt("click",(function CoreTagListComponent_ng_container_0_Template_ion_badge_click_1_listener(){const n=i.eBV(o).$implicit,t=i.XpG();return i.Njj(t.openTag(n))})),i.EFF(2),i.k0s(),i.bVm()}if(2&o){const o=n.$implicit;i.R7$(2),i.JRh(o.rawname)}}let d=(()=>{var o;class CoreTagListComponent{constructor(){this.tags=[]}openTag(o){e.CoreNavigator.navigateToSitePath("/tag/index",{params:{tagId:o.id,tagName:o.rawname,collectionId:o.tagcollid,fromContextId:o.taginstancecontextid}})}}return(o=CoreTagListComponent).ɵfac=function CoreTagListComponent_Factory(n){return new(n||o)},o.ɵcmp=i.VBU({type:o,selectors:[["core-tag-list"]],inputs:{tags:"tags"},standalone:!0,features:[i.aNF],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["role","link",1,"core-tag-list-tag",3,"click"]],template:function CoreTagListComponent_Template(o,n){1&o&&i.DNE(0,CoreTagListComponent_ng_container_0_Template,3,1,"ng-container",0),2&o&&i.Y8G("ngForOf",n.tags)},dependencies:[s.n,r.Sq,a.In],styles:["[_nghost-%COMP%]{line-height:1.6}[_nghost-%COMP%]   ion-badge[_ngcontent-%COMP%]{cursor:pointer;margin-left:4px;margin-right:4px}"]}),CoreTagListComponent})()}}]);