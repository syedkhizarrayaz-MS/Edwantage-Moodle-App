"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[40655],{2401:(e,t,n)=>{n.d(t,{R:()=>CoreListItemsManager});var i=n(10467),r=n(21182),s=n(15324),o=n(93417),a=n(81690),l=n(95990),c=n(82907),g=n(24742),u=n(55554);class CoreListItemsManager extends l.u{constructor(e,t){super(e);const n=a.j.debounce((()=>this.scrollToCurrentElement()),300);this.pageRouteLocator=t,this.addListener({onSelectedItemUpdated:n}),this.finishSuccessfulFetch=g.j.once((()=>u.g.ignoreErrors(this.logActivity())))}get items(){return this.getSource().getItems()||[]}get loaded(){return null!==this.itemsMap}get completed(){return this.getSource().isCompleted()}get empty(){const e=this.getSource().getItems();return null===e||0===e.length}start(e){var t=this;return(0,i.A)((function*(){e&&t.watchSplitViewOutlet(e),t.updateSelectedItem()}))()}destroy(){var e;super.destroy(),null===(e=this.splitViewOutletSubscription)||void 0===e||e.unsubscribe()}watchSplitViewOutlet(e){var t;this.splitView=e,this.splitViewOutletSubscription=e.outletRouteObservable.subscribe((e=>this.updateSelectedItem(this.getPageRouteFromSplitViewOutlet(e)))),this.updateSelectedItem(null!==(t=this.getPageRouteFromSplitViewOutlet(e.outletRoute))&&void 0!==t?t:null)}isSelected(e){return this.selectedItem===e}getItemAriaCurrent(e){return this.isSelected(e)?"page":"false"}select(e){var t=this;return(0,i.A)((function*(){if(!e)return yield t.navigateToIndex({reset:t.resetNavigation()}),void 0;yield t.navigateToItem(e,{reset:t.resetNavigation()})}))()}reset(){this.getSource().reset()}reload(){var e=this;return(0,i.A)((function*(){yield e.getSource().reload(),e.finishSuccessfulFetch()}))()}load(){var e=this;return(0,i.A)((function*(){yield e.getSource().load(),e.finishSuccessfulFetch()}))()}logActivity(){return(0,i.A)((function*(){}))()}resetNavigation(){var e;return!!o.CoreScreen.isTablet&&!(!this.splitView||null!==(e=this.splitView)&&void 0!==e&&e.isNested)}updateSelectedItem(e=null){super.updateSelectedItem(e);this.select(o.CoreScreen.isTablet&&null===this.selectedItem&&this.splitView&&!this.splitView.isNested?this.getDefaultItem():this.selectedItem)}scrollToCurrentElement(){var e=this;return(0,i.A)((function*(){var t,n,i;if(o.CoreScreen.isMobile)return;const r=(null!==(t=null===(n=e.splitView)||void 0===n?void 0:n.nativeElement)&&void 0!==t?t:document).querySelector('[aria-current="page"]');if(!r)return;c.y.isElementInViewport(r,1,null===(i=e.splitView)||void 0===i?void 0:i.nativeElement)||r.scrollIntoView({behavior:"smooth"})}))()}getDefaultItem(){return this.items[0]||null}getCurrentPageRoute(){return this.pageRouteLocator instanceof r.nX?s.CoreNavigator.isRouteActive(this.pageRouteLocator)?this.pageRouteLocator:null:s.CoreNavigator.getCurrentRoute({pageComponent:this.pageRouteLocator})}getSelectedItemPathFromRoute(e){const t=[];for(;e.firstChild;)t.push(...s.CoreNavigator.getRouteUrl(e=e.firstChild));return t.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}getPageRouteFromSplitViewOutlet(e){const t=this.buildRouteMatcher();for(;e&&!t(e);)e=e.parent;return e}buildRouteMatcher(){if(this.pageRouteLocator instanceof r.nX){const e=s.CoreNavigator.getRouteFullPath(this.pageRouteLocator);return t=>s.CoreNavigator.getRouteFullPath(t)===e}return e=>e.component===this.pageRouteLocator}}},40655:(e,t,n)=>{n.r(t),n.d(t,{default:()=>F});var i=n(10467),r=n(49882),s=n(52749),o=n(15324),a=n(29492),l=n(2401),c=n(83696),g=n(87455),u=n(94455),h=n(79555),d=n(74431),m=n(85190),p=n(99522),_=n(63196);class CoreSettingsHandlersSource extends p.F{constructor(){super(...arguments),this.handlers=[]}loadPageItems(){var e=this;return(0,i.A)((function*(){return e.handlers=_.CoreSettingsDelegate.getHandlers(),{items:e.handlers.filter((e=>"page"in e))}}))()}getItemPath(e){return e.page}getItemQueryParams(e){return e.params||{}}}var f=n(47551),S=n(25572),C=n(86654),b=n(54438),I=n(60177),P=n(89417),v=n(2910),R=n(76954),y=n(64422),w=n(86198),T=n(88246),k=n(43570),O=n(73955);function CoreSitePreferencesPage_ion_item_17_ion_icon_2_Template(e,t){if(1&e&&b.nrm(0,"ion-icon",16),2&e){const e=b.XpG().$implicit;b.Y8G("name",e.icon)}}function CoreSitePreferencesPage_ion_item_17_ion_toggle_7_Template(e,t){if(1&e){const e=b.RV6();b.j41(0,"ion-toggle",17),b.mxI("ngModelChange",(function CoreSitePreferencesPage_ion_item_17_ion_toggle_7_Template_ion_toggle_ngModelChange_0_listener(t){b.eBV(e);const n=b.XpG().$implicit;return b.DH7(n.toggleChecked,t)||(n.toggleChecked=t),b.Njj(t)})),b.bIt("ionChange",(function CoreSitePreferencesPage_ion_item_17_ion_toggle_7_Template_ion_toggle_ionChange_0_listener(t){b.eBV(e);const n=b.XpG().$implicit;return b.Njj(n.toggle(t.detail.checked))})),b.k0s()}if(2&e){const e=b.XpG().$implicit;b.R50("ngModel",e.toggleChecked)}}function CoreSitePreferencesPage_ion_item_17_Template(e,t){if(1&e){const e=b.RV6();b.j41(0,"ion-item",13),b.nI1(1,"translate"),b.bIt("click",(function CoreSitePreferencesPage_ion_item_17_Template_ion_item_click_0_listener(){const t=b.eBV(e).$implicit,n=b.XpG();return b.Njj(!t.toggle&&n.handlers.select(t))})),b.DNE(2,CoreSitePreferencesPage_ion_item_17_ion_icon_2_Template,1,1,"ion-icon",14),b.j41(3,"ion-label")(4,"p",8),b.EFF(5),b.nI1(6,"translate"),b.k0s()(),b.DNE(7,CoreSitePreferencesPage_ion_item_17_ion_toggle_7_Template,1,1,"ion-toggle",15),b.k0s()}if(2&e){const e=t.$implicit,n=b.XpG();b.Y8G("ngClass",e.class)("button",!e.toggle)("detail",!e.toggle),b.BMQ("aria-label",b.bMT(1,8,e.title))("aria-current",n.handlers.getItemAriaCurrent(e)),b.R7$(2),b.Y8G("ngIf",e.icon),b.R7$(3),b.JRh(b.bMT(6,10,e.title)),b.R7$(2),b.Y8G("ngIf",e.toggle)}}function CoreSitePreferencesPage_ion_item_31_ng_container_3_Template(e,t){1&e&&(b.qex(0),b.EFF(1),b.nI1(2,"translate"),b.bVm()),2&e&&(b.R7$(),b.SpI(" ",b.bMT(2,1,"core.settings.connectwifitosync"),""))}function CoreSitePreferencesPage_ion_item_31_ng_container_4_Template(e,t){1&e&&(b.qex(0),b.EFF(1),b.nI1(2,"translate"),b.bVm()),2&e&&(b.R7$(),b.JRh(b.bMT(2,1,"core.settings.connecttosync")))}function CoreSitePreferencesPage_ion_item_31_Template(e,t){if(1&e&&(b.j41(0,"ion-item",18),b.nrm(1,"ion-icon",19),b.j41(2,"ion-label"),b.DNE(3,CoreSitePreferencesPage_ion_item_31_ng_container_3_Template,3,3,"ng-container",20)(4,CoreSitePreferencesPage_ion_item_31_ng_container_4_Template,3,3,"ng-container",20),b.k0s()()),2&e){const e=b.XpG();b.R7$(3),b.Y8G("ngIf",e.isOnline&&e.dataSaver&&e.limitedConnection),b.R7$(),b.Y8G("ngIf",!e.isOnline)}}let F=(()=>{var e;class CoreSitePreferencesPage{get handlerItems(){return this.handlers.getSource().handlers}constructor(){this.dataSaver=!1,this.limitedConnection=!1,this.isOnline=!0,this.isDestroyed=!1,this.siteId=s.CoreSites.getCurrentSiteId();const e=c.u.getOrCreateSource(CoreSettingsHandlersSource,[]);this.handlers=new l.R(e,CoreSitePreferencesPage),this.sitesObserver=r.z.on(r.z.SITE_UPDATED,(()=>{this.refreshData()}),this.siteId),this.isOnline=u.WE.isOnline(),this.limitedConnection=this.isOnline&&u.WE.isNetworkAccessLimited(),this.networkObserver=u.WE.onChange().subscribe((()=>{h.SK.run((()=>{this.isOnline=u.WE.isOnline(),this.limitedConnection=this.isOnline&&u.WE.isNetworkAccessLimited()}))}))}ngAfterViewInit(){var e=this;return(0,i.A)((function*(){e.dataSaver=yield m.CoreConfig.get(d.CoreConstants.SETTINGS_SYNC_ONLY_ON_WIFI,!0);const t=o.CoreNavigator.getRouteParam("page");try{yield e.fetchData()}finally{const n=t?e.handlers.items.find((e=>e.page==t)):void 0;n?(e.handlers.watchSplitViewOutlet(e.splitView),yield e.handlers.select(n)):yield e.handlers.start(e.splitView)}}))()}fetchData(){var e=this;return(0,i.A)((function*(){yield e.handlers.load()}))()}synchronize(){var e=this;return(0,i.A)((function*(){try{yield g.CoreSettingsHelper.synchronizeSite(!1,e.siteId),f.CoreToasts.show({message:"core.settings.sitesynccompleted",translateMessage:!0})}catch(t){if(e.isDestroyed)return;S.CoreAlerts.showError(t,{default:h.HT.instant("core.settings.sitesyncfailed")})}}))()}isSynchronizing(){return!!g.CoreSettingsHelper.getSiteSyncPromise(this.siteId)}refreshData(e){this.handlers.getSource().setDirty(!0),this.fetchData().finally((()=>{null==e||e.complete()}))}ngOnDestroy(){this.isDestroyed=!0,this.sitesObserver.off(),this.networkObserver.unsubscribe(),this.handlers.destroy()}}return(e=CoreSitePreferencesPage).ɵfac=function CoreSitePreferencesPage_Factory(t){return new(t||e)},e.ɵcmp=b.VBU({type:e,selectors:[["page-core-site-preferences"]],viewQuery:function CoreSitePreferencesPage_Query(e,t){if(1&e&&b.GBs(a.M,5),2&e){let e;b.mGM(e=b.lsd())&&(t.splitView=e.first)}},standalone:!0,features:[b.aNF],decls:32,vars:24,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["placeholderType","column","placeholderHeight","48px",3,"hideUntil"],["class","core-settings-handler","lines","none",3,"ngClass","button","detail","click",4,"ngFor","ngForOf"],[1,"ion-text-wrap"],[1,"item-heading"],["slot","end",3,"loading"],["fill","clear",3,"click","ariaLabel","disabled"],["name","fas-rotate","slot","icon-only","aria-hidden","true"],["class","core-warning-item ion-text-wrap",4,"ngIf"],["lines","none",1,"core-settings-handler",3,"click","ngClass","button","detail"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],["slot","end",3,"ngModel","ngModelChange","ionChange",4,"ngIf"],["slot","start","aria-hidden","true",3,"name"],["slot","end",3,"ngModelChange","ionChange","ngModel"],[1,"core-warning-item","ion-text-wrap"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[4,"ngIf"]],template:function CoreSitePreferencesPage_Template(e,t){1&e&&(b.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),b.nrm(3,"ion-back-button",1),b.nI1(4,"translate"),b.k0s(),b.j41(5,"ion-title")(6,"h1"),b.EFF(7),b.nI1(8,"translate"),b.k0s()(),b.nrm(9,"ion-buttons",2),b.k0s()(),b.j41(10,"ion-content")(11,"core-split-view")(12,"ion-refresher",3),b.bIt("ionRefresh",(function CoreSitePreferencesPage_Template_ion_refresher_ionRefresh_12_listener(e){return t.refreshData(e.target)})),b.nrm(13,"ion-refresher-content",4),b.nI1(14,"translate"),b.k0s(),b.j41(15,"core-loading",5)(16,"ion-list"),b.DNE(17,CoreSitePreferencesPage_ion_item_17_Template,8,12,"ion-item",6),b.k0s(),b.j41(18,"ion-card")(19,"ion-item",7)(20,"ion-label")(21,"p",8),b.EFF(22),b.nI1(23,"translate"),b.k0s(),b.j41(24,"p"),b.EFF(25),b.nI1(26,"translate"),b.k0s()(),b.j41(27,"core-button-with-spinner",9)(28,"ion-button",10),b.nI1(29,"translate"),b.bIt("click",(function CoreSitePreferencesPage_Template_ion_button_click_28_listener(){return t.synchronize()})),b.nrm(30,"ion-icon",11),b.k0s()()(),b.DNE(31,CoreSitePreferencesPage_ion_item_31_Template,5,2,"ion-item",12),b.k0s()()()()),2&e&&(b.R7$(3),b.Y8G("text",b.bMT(4,12,"core.back")),b.R7$(4),b.JRh(b.bMT(8,14,"core.settings.preferences")),b.R7$(5),b.Y8G("disabled",!t.handlers.loaded),b.R7$(),b.FS9("pullingText",b.bMT(14,16,"core.pulltorefresh")),b.R7$(2),b.Y8G("hideUntil",t.handlers.loaded),b.R7$(2),b.Y8G("ngForOf",t.handlerItems),b.R7$(5),b.JRh(b.bMT(23,18,"core.settings.synchronizenow")),b.R7$(3),b.SpI(" ",b.bMT(26,20,"core.settings.synchronizenowhelp")," "),b.R7$(2),b.Y8G("loading",t.isSynchronizing()),b.R7$(),b.Y8G("ariaLabel",b.bMT(29,22,"core.settings.synchronizenow"))("disabled",!t.isOnline||t.dataSaver&&t.limitedConnection),b.R7$(3),b.Y8G("ngIf",!t.isOnline||t.dataSaver&&t.limitedConnection))},dependencies:[C.n,I.YU,I.Sq,I.bT,P.BC,P.vS,v.Jm,v.QW,v.b_,v.W9,v.eU,v.iq,v.uz,v.he,v.nf,v.To,v.Ki,v.BC,v.BY,v.ai,v.hB,v.el,R.q,y.R,a.M,w.t,T.i,k.T,O.D9],encapsulation:2}),CoreSitePreferencesPage})()}}]);