"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[83221],{83221:(s,e,o)=>{o.r(e),o.d(e,{default:()=>U});var n=o(10467),i=o(89417),t=o(44682),a=o(97383),d=o(98870),r=o(15324),l=o(52749),m=o(48966),u=o(75383),c=o(79555),p=o(49882),h=o(63153),_=o(45157),b=o(67193),g=o(80178),f=o(26327),k=o(22693),I=o(24742),v=o(81552),A=o(33014),w=o(25572),M=o(41450),S=o(86654),T=o(54438),W=o(60177),G=o(2910),R=o(64422),y=o(16658),C=o(86198),E=o(43570),P=o(73955);const _c0=s=>({$a:s});function AddonModWorkshopAssessmentComponent_h2_4_Template(s,e){if(1&s&&(T.j41(0,"h2"),T.EFF(1),T.k0s()),2&s){const s=T.XpG();T.R7$(),T.JRh(s.profile.fullname)}}function AddonModWorkshopAssessmentComponent_p_5_Template(s,e){if(1&s&&(T.j41(0,"p"),T.EFF(1),T.nI1(2,"translate"),T.k0s()),2&s){const s=T.XpG();T.R7$(),T.Lme(" ",T.i5U(2,2,"addon.mod_workshop.submissiongradeof",T.eq3(5,_c0,s.workshop.grade)),": ",s.assessment.grade," ")}}function AddonModWorkshopAssessmentComponent_p_6_Template(s,e){if(1&s&&(T.j41(0,"p"),T.EFF(1),T.nI1(2,"translate"),T.k0s()),2&s){const s=T.XpG();T.R7$(),T.Lme(" ",T.i5U(2,2,"addon.mod_workshop.gradinggradeof",T.eq3(5,_c0,s.workshop.gradinggrade)),": ",s.assessment.gradinggrade," ")}}function AddonModWorkshopAssessmentComponent_p_7_Template(s,e){if(1&s&&(T.j41(0,"p",8),T.EFF(1),T.nI1(2,"translate"),T.k0s()),2&s){const s=T.XpG();T.R7$(),T.Lme(" ",T.i5U(2,2,"addon.mod_workshop.gradinggradeof",T.eq3(5,_c0,s.workshop.gradinggrade)),": ",s.assessment.gradinggradeover," ")}}function AddonModWorkshopAssessmentComponent_p_8_Template(s,e){if(1&s&&(T.j41(0,"p"),T.EFF(1),T.nI1(2,"translate"),T.k0s()),2&s){const s=T.XpG();T.R7$(),T.SpI(" ",T.i5U(2,1,"addon.mod_workshop.weightinfo",T.eq3(4,_c0,s.assessment.weight))," ")}}function AddonModWorkshopAssessmentComponent_ion_badge_9_Template(s,e){1&s&&(T.j41(0,"ion-badge",9),T.EFF(1),T.nI1(2,"translate"),T.k0s()),2&s&&(T.R7$(),T.JRh(T.bMT(2,1,"addon.mod_workshop.notassessed")))}function AddonModWorkshopAssessmentComponent_ion_button_10_Template(s,e){if(1&s){const s=T.RV6();T.j41(0,"ion-button",10),T.bIt("click",(function AddonModWorkshopAssessmentComponent_ion_button_10_Template_ion_button_click_0_listener(e){T.eBV(s);const o=T.XpG();return T.Njj(o.gotoOwnAssessment(e))})),T.EFF(1),T.nI1(2,"translate"),T.k0s()}2&s&&(T.R7$(),T.SpI(" ",T.bMT(2,1,"addon.mod_workshop.assess")," "))}function AddonModWorkshopAssessmentComponent_ion_note_11_Template(s,e){1&s&&(T.j41(0,"ion-note",11),T.nrm(1,"ion-icon",12),T.EFF(2),T.nI1(3,"translate"),T.k0s()),2&s&&(T.R7$(2),T.SpI("",T.bMT(3,1,"core.notsent")," "))}let F=(()=>{var s;class AddonModWorkshopAssessmentComponent{constructor(){this.canViewAssessment=!1,this.canSelfAssess=!1,this.offline=!1,this.loaded=!1,this.currentUserId=l.CoreSites.getCurrentSiteUserId(),this.showGrade=g.AddonModWorkshopHelper.showGrade}ngOnInit(){const s=this.access&&this.access.assessingallowed,e=this.assessment.reviewerid,o=[];let n;this.assessmentId=this.assessment.id,this.canViewAssessment=!!this.assessment.grade,this.canSelfAssess=s&&e==this.currentUserId,e&&o.push(d.CoreUser.getProfile(e,this.courseId,!0).then((s=>{this.profile=s}))),n=e==this.currentUserId?f.AddonModWorkshopOffline.getAssessment(this.workshop.id,this.assessmentId).then((s=>{this.offline=!0,this.assessment.weight=s.inputdata.weight})):f.AddonModWorkshopOffline.getEvaluateAssessment(this.workshop.id,this.assessmentId).then((s=>{this.offline=!0,this.assessment.gradinggradeover=s.gradinggradeover,this.assessment.weight=s.weight})),o.push(n.catch((()=>{this.offline=!1}))),Promise.all(o).finally((()=>{this.loaded=!0}))}gotoAssessment(s){var e=this;return(0,n.A)((function*(){if(!e.canSelfAssess&&e.canViewAssessment){s.preventDefault(),s.stopPropagation();const o={assessment:e.assessment,submission:e.submission,profile:e.profile};if(e.submission)r.CoreNavigator.navigate(String(e.assessmentId),{params:o});else{const s=yield A.CoreLoadings.show();try{o.submission=yield g.AddonModWorkshopHelper.getSubmissionById(e.workshop.id,e.assessment.submissionid,{cmId:e.workshop.coursemodule,canEdit:e.assessment.reviewerid===e.currentUserId&&e.access.modifyingsubmissionallowed}),r.CoreNavigator.navigate(String(e.assessmentId),{params:o})}catch(s){w.CoreAlerts.showError(s,{default:"Cannot load submission"})}finally{s.dismiss()}}}}))()}gotoOwnAssessment(s){if(!this.canSelfAssess)return;s.preventDefault(),s.stopPropagation();const e={module:this.module,workshop:this.workshop,access:this.access,profile:this.profile,submission:this.submission,assessment:this.assessment};r.CoreNavigator.navigate(String(this.submission.id),e)}}return(s=AddonModWorkshopAssessmentComponent).ɵfac=function AddonModWorkshopAssessmentComponent_Factory(e){return new(e||s)},s.ɵcmp=T.VBU({type:s,selectors:[["addon-mod-workshop-assessment"]],inputs:{assessment:"assessment",courseId:"courseId",workshop:"workshop",access:"access",submission:"submission",module:"module"},standalone:!0,features:[T.aNF],decls:12,vars:14,consts:[[3,"hideUntil"],[1,"ion-text-wrap",3,"click","detail","button"],["slot","start",3,"user","courseId","userId"],[4,"ngIf"],["class","core-overriden-grade",4,"ngIf"],["color","danger",4,"ngIf"],["expand","block",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],[1,"core-overriden-grade"],["color","danger"],["expand","block",3,"click"],["slot","end"],["name","fas-clock","aria-hidden","true"]],template:function AddonModWorkshopAssessmentComponent_Template(s,e){1&s&&(T.j41(0,"core-loading",0)(1,"ion-item",1),T.bIt("click",(function AddonModWorkshopAssessmentComponent_Template_ion_item_click_1_listener(s){return e.gotoAssessment(s)})),T.nrm(2,"core-user-avatar",2),T.j41(3,"ion-label"),T.DNE(4,AddonModWorkshopAssessmentComponent_h2_4_Template,2,1,"h2",3)(5,AddonModWorkshopAssessmentComponent_p_5_Template,3,7,"p",3)(6,AddonModWorkshopAssessmentComponent_p_6_Template,3,7,"p",3)(7,AddonModWorkshopAssessmentComponent_p_7_Template,3,7,"p",4)(8,AddonModWorkshopAssessmentComponent_p_8_Template,3,6,"p",3)(9,AddonModWorkshopAssessmentComponent_ion_badge_9_Template,3,3,"ion-badge",5)(10,AddonModWorkshopAssessmentComponent_ion_button_10_Template,3,3,"ion-button",6),T.k0s(),T.DNE(11,AddonModWorkshopAssessmentComponent_ion_note_11_Template,4,3,"ion-note",7),T.k0s()()),2&s&&(T.Y8G("hideUntil",e.loaded),T.R7$(),T.Y8G("detail",e.canViewAssessment&&!e.canSelfAssess)("button",e.canViewAssessment&&!e.canSelfAssess),T.R7$(),T.Y8G("user",e.profile)("courseId",e.courseId)("userId",null==e.profile?null:e.profile.id),T.R7$(2),T.Y8G("ngIf",e.profile&&e.profile.fullname),T.R7$(),T.Y8G("ngIf",e.showGrade(e.assessment.grade)),T.R7$(),T.Y8G("ngIf",e.access.canviewallsubmissions&&!e.showGrade(e.assessment.gradinggradeover)&&e.showGrade(e.assessment.gradinggrade)),T.R7$(),T.Y8G("ngIf",e.access.canviewallsubmissions&&e.showGrade(e.assessment.gradinggradeover)),T.R7$(),T.Y8G("ngIf",e.assessment.weight&&1!==e.assessment.weight),T.R7$(),T.Y8G("ngIf",!e.assessment.grade),T.R7$(),T.Y8G("ngIf",e.canSelfAssess&&!e.showGrade(e.assessment.grade)),T.R7$(),T.Y8G("ngIf",e.offline))},dependencies:[S.n,W.bT,G.In,G.Jm,G.iq,G.uz,G.he,G.JI,R.R,y.T,C.t,E.T,P.D9],encapsulation:2}),AddonModWorkshopAssessmentComponent})();var $=o(61919),x=o(94455),D=o(49588),j=o(58197),Y=o(88246);s=o.hmd(s);const N=["feedbackFormEl"],_c1=s=>({$a:s}),_c2=s=>({header:s}),_c3=s=>({id:s});function AddonModWorkshopSubmissionPage_core_format_text_7_Template(s,e){if(1&s&&T.nrm(0,"core-format-text",12),2&s){const s=T.XpG();T.Y8G("text",s.title)("contextInstanceId",s.module.id)("courseId",s.courseId)}}function AddonModWorkshopSubmissionPage_ion_button_9_Template(s,e){if(1&s){const s=T.RV6();T.j41(0,"ion-button",13),T.bIt("click",(function AddonModWorkshopSubmissionPage_ion_button_9_Template_ion_button_click_0_listener(){T.eBV(s);const e=T.XpG();return T.Njj(e.saveAssessment())})),T.EFF(1),T.nI1(2,"translate"),T.k0s()}2&s&&(T.R7$(),T.SpI(" ",T.bMT(2,1,"core.save")," "))}function AddonModWorkshopSubmissionPage_Conditional_10_Template(s,e){if(1&s){const s=T.RV6();T.j41(0,"ion-button",13),T.bIt("click",(function AddonModWorkshopSubmissionPage_Conditional_10_Template_ion_button_click_0_listener(){T.eBV(s);const e=T.XpG();return T.Njj(e.saveEvaluation())})),T.EFF(1),T.nI1(2,"translate"),T.k0s()}2&s&&(T.R7$(),T.SpI(" ",T.bMT(2,1,"core.save")," "))}function AddonModWorkshopSubmissionPage_ion_refresher_12_Template(s,e){if(1&s){const s=T.RV6();T.j41(0,"ion-refresher",14),T.bIt("ionRefresh",(function AddonModWorkshopSubmissionPage_ion_refresher_12_Template_ion_refresher_ionRefresh_0_listener(e){T.eBV(s);const o=T.XpG();return T.Njj(o.refreshSubmission(e.target))})),T.nrm(1,"ion-refresher-content",15),T.nI1(2,"translate"),T.k0s()}if(2&s){const s=T.XpG();T.Y8G("disabled",!s.loaded),T.R7$(),T.FS9("pullingText",T.bMT(2,2,"core.pulltorefresh"))}}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template(s,e){if(1&s){const s=T.RV6();T.j41(0,"ion-button",22),T.bIt("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template_ion_button_click_0_listener(){T.eBV(s);const e=T.XpG(3);return T.Njj(e.editSubmission())})),T.nrm(1,"ion-icon",23),T.EFF(2),T.nI1(3,"translate"),T.k0s()}2&s&&(T.R7$(2),T.SpI(" ",T.bMT(3,1,"addon.mod_workshop.editsubmission")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template(s,e){if(1&s){const s=T.RV6();T.j41(0,"ion-button",24),T.bIt("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template_ion_button_click_0_listener(){T.eBV(s);const e=T.XpG(3);return T.Njj(e.deleteSubmission())})),T.nrm(1,"ion-icon",25),T.EFF(2),T.nI1(3,"translate"),T.k0s()}2&s&&(T.R7$(2),T.SpI(" ",T.bMT(3,1,"addon.mod_workshop.deletesubmission")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template(s,e){if(1&s){const s=T.RV6();T.j41(0,"ion-button",26),T.bIt("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template_ion_button_click_0_listener(){T.eBV(s);const e=T.XpG(3);return T.Njj(e.undoDeleteSubmission())})),T.nrm(1,"ion-icon",27),T.EFF(2),T.nI1(3,"translate"),T.k0s()}2&s&&(T.R7$(2),T.SpI(" ",T.bMT(3,1,"core.restore")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_Template(s,e){if(1&s&&(T.j41(0,"ion-item",18)(1,"ion-label"),T.DNE(2,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template,4,3,"ion-button",19)(3,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template,4,3,"ion-button",20)(4,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template,4,3,"ion-button",21),T.k0s()()),2&s){const s=T.XpG(2);T.R7$(2),T.Y8G("ngIf",s.canEdit),T.R7$(),T.Y8G("ngIf",!s.submission.deleted&&s.canDelete),T.R7$(),T.Y8G("ngIf",s.submission.deleted&&s.canDelete)}}function AddonModWorkshopSubmissionPage_ion_list_14_Template(s,e){if(1&s&&(T.j41(0,"ion-list"),T.nrm(1,"addon-mod-workshop-submission",16),T.DNE(2,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_Template,5,3,"ion-item",17),T.k0s()),2&s){const s=T.XpG();T.R7$(),T.Y8G("submission",s.submission)("courseId",s.courseId)("module",s.module)("workshop",s.workshop)("access",s.access)("viewDetails",!0),T.R7$(),T.Y8G("ngIf",s.canEdit||s.canDelete)}}function AddonModWorkshopSubmissionPage_ion_list_15_core_user_avatar_2_Template(s,e){if(1&s&&T.nrm(0,"core-user-avatar",29),2&s){const s=T.XpG(2);T.Y8G("user",s.evaluateByProfile)("courseId",s.courseId)("userId",s.evaluateByProfile.id)}}function AddonModWorkshopSubmissionPage_ion_list_15_h2_4_Template(s,e){if(1&s&&(T.j41(0,"h2"),T.EFF(1),T.nI1(2,"translate"),T.k0s()),2&s){const s=T.XpG(2);T.R7$(),T.SpI(" ",T.i5U(2,1,"addon.mod_workshop.feedbackby",T.eq3(4,_c1,s.evaluateByProfile.fullname))," ")}}function AddonModWorkshopSubmissionPage_ion_list_15_Template(s,e){if(1&s&&(T.j41(0,"ion-list")(1,"ion-item",18),T.DNE(2,AddonModWorkshopSubmissionPage_ion_list_15_core_user_avatar_2_Template,1,3,"core-user-avatar",28),T.j41(3,"ion-label"),T.DNE(4,AddonModWorkshopSubmissionPage_ion_list_15_h2_4_Template,3,6,"h2",10),T.nrm(5,"core-format-text",12),T.k0s()()()),2&s){const s=T.XpG();T.R7$(2),T.Y8G("ngIf",s.evaluateByProfile),T.R7$(2),T.Y8G("ngIf",s.evaluateByProfile&&s.evaluateByProfile.fullname),T.R7$(),T.Y8G("text",null==s.evaluate?null:s.evaluate.text)("contextInstanceId",s.module.id)("courseId",s.courseId)}}function AddonModWorkshopSubmissionPage_ion_list_16_Template(s,e){if(1&s&&(T.j41(0,"ion-list")(1,"ion-item-divider",18)(2,"ion-label")(3,"h2"),T.EFF(4),T.nI1(5,"translate"),T.k0s()()(),T.nrm(6,"addon-mod-workshop-assessment",30),T.k0s()),2&s){const s=T.XpG();T.R7$(4),T.JRh(T.bMT(5,7,"addon.mod_workshop.yourassessment")),T.R7$(2),T.Y8G("submission",s.submission)("assessment",s.ownAssessment)("courseId",s.courseId)("access",s.access)("module",s.module)("workshop",s.workshop)}}function AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_addon_mod_workshop_assessment_1_Template(s,e){if(1&s&&T.nrm(0,"addon-mod-workshop-assessment",30),2&s){const s=T.XpG().$implicit,e=T.XpG(2);T.Y8G("submission",e.submission)("assessment",s)("courseId",e.courseId)("access",e.access)("module",e.module)("workshop",e.workshop)}}function AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_Template(s,e){if(1&s&&(T.qex(0),T.DNE(1,AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_addon_mod_workshop_assessment_1_Template,1,6,"addon-mod-workshop-assessment",32),T.bVm()),2&s){const s=e.$implicit;T.R7$(),T.Y8G("ngIf",!s.ownAssessment)}}function AddonModWorkshopSubmissionPage_ion_list_17_Template(s,e){if(1&s&&(T.j41(0,"ion-list")(1,"ion-item-divider",18)(2,"ion-label")(3,"h2"),T.EFF(4),T.nI1(5,"translate"),T.k0s()()(),T.DNE(6,AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_Template,2,1,"ng-container",31),T.k0s()),2&s){const s=T.XpG();T.R7$(4),T.JRh(T.bMT(5,2,"addon.mod_workshop.receivedgrades")),T.R7$(2),T.Y8G("ngForOf",s.submissionInfo.reviewedby)}}function AddonModWorkshopSubmissionPage_ion_list_18_addon_mod_workshop_assessment_6_Template(s,e){if(1&s&&T.nrm(0,"addon-mod-workshop-assessment",34),2&s){const s=e.$implicit,o=T.XpG(2);T.Y8G("submission",o.submission)("assessment",s)("courseId",o.courseId)("module",o.module)("workshop",o.workshop)("access",o.access)}}function AddonModWorkshopSubmissionPage_ion_list_18_Template(s,e){if(1&s&&(T.j41(0,"ion-list")(1,"ion-item-divider",18)(2,"ion-label")(3,"h2"),T.EFF(4),T.nI1(5,"translate"),T.k0s()()(),T.DNE(6,AddonModWorkshopSubmissionPage_ion_list_18_addon_mod_workshop_assessment_6_Template,1,6,"addon-mod-workshop-assessment",33),T.k0s()),2&s){const s=T.XpG();T.R7$(4),T.JRh(T.bMT(5,2,"addon.mod_workshop.givengrades")),T.R7$(2),T.Y8G("ngForOf",s.submissionInfo.reviewerof)}}function AddonModWorkshopSubmissionPage_Conditional_19_Conditional_0_Template(s,e){if(1&s&&(T.j41(0,"ion-item-divider",18)(1,"ion-label")(2,"h2"),T.EFF(3),T.nI1(4,"translate"),T.k0s()()(),T.j41(5,"ion-card",35)(6,"ion-item"),T.nrm(7,"ion-icon",36),T.j41(8,"ion-label"),T.EFF(9),T.k0s()()()),2&s){const s=T.XpG(2);T.R7$(3),T.JRh(T.bMT(4,2,"addon.mod_workshop.feedbackauthor")),T.R7$(6),T.JRh(s.loadFeedbackToEditErrorMessage)}}function AddonModWorkshopSubmissionPage_Conditional_19_Conditional_1_ion_item_7_Template(s,e){1&s&&(T.j41(0,"ion-item",18)(1,"ion-toggle",42)(2,"p",43),T.EFF(3),T.nI1(4,"translate"),T.k0s(),T.j41(5,"p"),T.EFF(6),T.nI1(7,"translate"),T.k0s()()()),2&s&&(T.R7$(3),T.JRh(T.bMT(4,2,"addon.mod_workshop.publishsubmission")),T.R7$(3),T.JRh(T.bMT(7,4,"addon.mod_workshop.publishsubmission_help")))}function AddonModWorkshopSubmissionPage_Conditional_19_Conditional_1_ion_select_option_20_Template(s,e){if(1&s&&(T.j41(0,"ion-select-option",44),T.EFF(1),T.k0s()),2&s){const s=e.$implicit;T.Y8G("value",s.value),T.R7$(),T.SpI(" ",s.label," ")}}function AddonModWorkshopSubmissionPage_Conditional_19_Conditional_1_Template(s,e){if(1&s&&(T.j41(0,"form",37,0)(2,"ion-item-divider",18)(3,"ion-label")(4,"h2"),T.EFF(5),T.nI1(6,"translate"),T.k0s()()(),T.DNE(7,AddonModWorkshopSubmissionPage_Conditional_19_Conditional_1_ion_item_7_Template,8,6,"ion-item",17),T.j41(8,"ion-item-divider",18)(9,"ion-label")(10,"h3"),T.EFF(11),T.nI1(12,"translate"),T.k0s(),T.j41(13,"p"),T.EFF(14),T.k0s()()(),T.j41(15,"ion-item",18)(16,"ion-select",38),T.nI1(17,"translate"),T.nI1(18,"translate"),T.nI1(19,"translate"),T.DNE(20,AddonModWorkshopSubmissionPage_Conditional_19_Conditional_1_ion_select_option_20_Template,2,2,"ion-select-option",39),T.k0s()(),T.j41(21,"ion-item")(22,"ion-label",40),T.EFF(23),T.nI1(24,"translate"),T.k0s(),T.nrm(25,"core-rich-text-editor",41),T.k0s()()),2&s){const s=T.XpG(2);T.Y8G("formGroup",s.feedbackForm),T.R7$(5),T.JRh(T.bMT(6,14,"addon.mod_workshop.feedbackauthor")),T.R7$(2),T.Y8G("ngIf",s.access.canpublishsubmissions),T.R7$(4),T.JRh(T.bMT(12,16,"addon.mod_workshop.gradecalculated")),T.R7$(3),T.JRh(s.submission.grade),T.R7$(2),T.Y8G("cancelText",T.bMT(17,18,"core.cancel"))("interfaceOptions",T.eq3(26,_c2,T.bMT(18,20,"addon.mod_workshop.gradeover")))("label",T.bMT(19,22,"addon.mod_workshop.gradeover")),T.R7$(4),T.Y8G("ngForOf",s.evaluationGrades),T.R7$(3),T.JRh(T.bMT(24,24,"addon.mod_workshop.feedbackauthor")),T.R7$(2),T.Y8G("control",s.feedbackForm.controls.text)("autoSave",!0)("contextInstanceId",s.module.id)("draftExtraParams",T.eq3(28,_c3,s.submissionId))}}function AddonModWorkshopSubmissionPage_Conditional_19_Template(s,e){if(1&s&&T.DNE(0,AddonModWorkshopSubmissionPage_Conditional_19_Conditional_0_Template,10,4)(1,AddonModWorkshopSubmissionPage_Conditional_19_Conditional_1_Template,26,30),2&s){const s=T.XpG();T.vxM(0,s.loadFeedbackToEditErrorMessage?0:1)}}function AddonModWorkshopSubmissionPage_addon_mod_workshop_assessment_strategy_20_Template(s,e){if(1&s&&T.nrm(0,"addon-mod-workshop-assessment-strategy",45),2&s){const s=T.XpG();T.Y8G("workshop",s.workshop)("access",s.access)("assessmentId",s.assessmentId)("userId",s.assessmentUserId)("strategy",s.strategy)("edit",s.access.assessingallowed)}}function AddonModWorkshopSubmissionPage_ion_list_21_core_user_avatar_2_Template(s,e){if(1&s&&T.nrm(0,"core-user-avatar",29),2&s){const s=T.XpG(2);T.Y8G("user",s.evaluateGradingByProfile)("courseId",s.courseId)("userId",s.evaluateGradingByProfile.id)}}function AddonModWorkshopSubmissionPage_ion_list_21_h3_4_Template(s,e){if(1&s&&(T.j41(0,"h3",43),T.EFF(1),T.nI1(2,"translate"),T.k0s()),2&s){const s=T.XpG(2);T.R7$(),T.SpI(" ",T.i5U(2,1,"addon.mod_workshop.feedbackby",T.eq3(4,_c1,s.evaluateGradingByProfile.fullname))," ")}}function AddonModWorkshopSubmissionPage_ion_list_21_Template(s,e){if(1&s&&(T.j41(0,"ion-list")(1,"ion-item",18),T.DNE(2,AddonModWorkshopSubmissionPage_ion_list_21_core_user_avatar_2_Template,1,3,"core-user-avatar",28),T.j41(3,"ion-label"),T.DNE(4,AddonModWorkshopSubmissionPage_ion_list_21_h3_4_Template,3,6,"h3",46),T.nrm(5,"core-format-text",12),T.k0s()()()),2&s){const s=T.XpG();T.R7$(2),T.Y8G("ngIf",s.evaluateGradingByProfile),T.R7$(2),T.Y8G("ngIf",s.evaluateGradingByProfile&&s.evaluateGradingByProfile.fullname),T.R7$(),T.Y8G("text",s.assessment.feedbackreviewer)("contextInstanceId",s.module.id)("courseId",s.courseId)}}let U=(()=>{var e;class AddonModWorkshopSubmissionPage{constructor(s,e){this.fb=s,this.content=e,this.loaded=!1,this.canAddFeedback=!1,this.canEdit=!1,this.canDelete=!1,this.evaluationGrades=[],this.originalEvaluation={published:!1,text:"",grade:""},this.hasOffline=!1,this.component=v.Ug,this.forceLeave=!1,this.isDestroyed=!1,this.currentUserId=l.CoreSites.getCurrentSiteUserId(),this.siteId=l.CoreSites.getCurrentSiteId(),this.feedbackForm=new i.gE({}),this.feedbackForm.addControl("published",this.fb.control("")),this.feedbackForm.addControl("grade",this.fb.control("")),this.feedbackForm.addControl("text",this.fb.control("")),this.obsAssessmentSaved=p.z.on(v.Px,(s=>{this.eventReceived(s)}),this.siteId),this.syncObserver=p.z.on(v.N7,(s=>{this.eventReceived(s)}),this.siteId),this.logView=I.j.once((()=>this.performLogView()))}ngOnInit(){var s=this;return(0,n.A)((function*(){var e,o,n;try{s.submissionId=r.CoreNavigator.getRequiredRouteNumberParam("submissionId"),s.module=r.CoreNavigator.getRequiredRouteParam("module"),s.workshop=r.CoreNavigator.getRequiredRouteParam("workshop"),s.access=r.CoreNavigator.getRequiredRouteParam("access"),s.courseId=r.CoreNavigator.getRequiredRouteNumberParam("courseId"),s.profile=r.CoreNavigator.getRouteParam("profile"),s.submissionInfo=r.CoreNavigator.getRequiredRouteParam("submission"),s.assessment=r.CoreNavigator.getRouteParam("assessment")}catch(s){return w.CoreAlerts.showError(s),r.CoreNavigator.back(),void 0}s.title=s.module.name,s.workshopId=s.module.instance||s.workshop.id,s.userId=null===(e=s.submissionInfo)||void 0===e?void 0:e.authorid,s.strategy=s.assessment&&s.assessment.strategy||s.workshop&&s.workshop.strategy,s.assessmentId=null===(o=s.assessment)||void 0===o?void 0:o.id,s.assessmentUserId=null===(n=s.assessment)||void 0===n?void 0:n.reviewerid,yield s.fetchSubmissionData(),s.logView()}))()}canLeave(){var s=this;return(0,n.A)((function*(){var e;const o=null===(e=s.assessmentStrategy)||void 0===e?void 0:e.hasDataChanged();return s.forceLeave||!s.hasEvaluationChanged()&&!o||(yield w.CoreAlerts.confirmLeaveWithChanges(),h.R.triggerFormCancelledEvent(s.formElement,s.siteId)),!0}))()}editSubmission(){r.CoreNavigator.navigate(`${this.submissionId}/edit`,{module:s,access:this.access})}eventReceived(s){var e;this.workshopId===s.workshopId&&(null===(e=this.content)||void 0===e||e.scrollToTop(),this.loaded=!1,this.refreshAllData())}fetchSubmissionData(){var s=this;return(0,n.A)((function*(){try{var e,o,n;s.canAddFeedback=!s.assessmentId&&g.AddonModWorkshopHelper.canAddFeedback(s.workshop,s.access),s.submission=yield g.AddonModWorkshopHelper.getSubmissionById(s.workshopId,s.submissionId,{cmId:s.module.id,canEdit:s.userId===s.currentUserId&&s.access.modifyingsubmissionallowed});const i=[];if(s.submission.grade=null===(e=s.submissionInfo)||void 0===e?void 0:e.grade,s.submission.gradinggrade=null===(o=s.submissionInfo)||void 0===o?void 0:o.gradinggrade,s.submission.gradeover=null===(n=s.submissionInfo)||void 0===n?void 0:n.gradeover,s.userId=s.submission.authorid||s.userId,s.canEdit=s.currentUserId==s.userId&&s.access.cansubmit&&s.access.modifyingsubmissionallowed,s.canDelete=s.access.candeletesubmissions,s.ownAssessment=void 0,s.access.canviewallassessments)i.push(b.AddonModWorkshop.getSubmissionAssessments(s.workshopId,s.submissionId,{cmId:s.module.id}).then((e=>{s.canDelete&&(s.canDelete=!e.length),s.submissionInfo.reviewedby=e,s.submissionInfo.reviewedby.forEach((e=>{e=g.AddonModWorkshopHelper.realGradeValue(s.workshop,e),s.currentUserId==e.reviewerid&&(s.ownAssessment=e,e.ownAssessment=!0)}))})));else if(s.currentUserId===s.userId&&s.assessmentId)i.push(b.AddonModWorkshop.getAssessment(s.workshopId,s.assessmentId,{cmId:s.module.id,canAssess:g.AddonModWorkshopHelper.canEditAssessments(s.workshop,s.access)}).then((e=>{s.canDelete&&(s.canDelete=!e),s.submissionInfo.reviewedby=[s.parseAssessment(e)]})));else if(50===s.workshop.phase&&s.userId===s.currentUserId){const e=yield b.AddonModWorkshop.getSubmissionAssessments(s.workshopId,s.submissionId,{cmId:s.module.id});s.submissionInfo.reviewedby=e.map((e=>s.parseAssessment(e)))}(s.canAddFeedback||50===s.workshop.phase)&&(s.evaluate={published:s.submission.published,text:s.submission.feedbackauthor||""}),s.canAddFeedback?(s.isDestroyed||m.CoreSync.blockOperation(v.Ug,s.workshopId),i.push(s.fillEvaluationsGrades())):50===s.workshop.phase&&s.submission.gradeoverby&&s.evaluate&&s.evaluate.text&&i.push(d.CoreUser.getProfile(s.submission.gradeoverby,s.courseId,!0).then((e=>{s.evaluateByProfile=e}))),s.assessment&&!s.access.assessingallowed&&s.assessment.feedbackreviewer&&s.assessment.gradinggradeoverby&&i.push(d.CoreUser.getProfile(s.assessment.gradinggradeoverby,s.courseId,!0).then((e=>{s.evaluateGradingByProfile=e}))),yield Promise.all(i);const t=yield f.AddonModWorkshopOffline.getSubmissions(s.workshopId);s.submission=yield g.AddonModWorkshopHelper.applyOfflineData(s.submission,t)}catch(s){w.CoreAlerts.showError(s,{default:c.HT.instant("core.course.errorgetmodule")})}finally{s.loaded=!0}}))()}fillEvaluationsGrades(){var s=this;return(0,n.A)((function*(){const e=c.HT.instant("addon.mod_workshop.notoverridden");if(s.evaluationGrades=yield a.CoreGradesHelper.makeGradesMenu(s.workshop.grade||0,void 0,e,-1),s.evaluate){s.evaluate.grade={label:a.CoreGradesHelper.getGradeLabelFromValue(s.evaluationGrades,s.submissionInfo.gradeover)||e,value:s.submissionInfo.gradeover||-1};try{const o=yield f.AddonModWorkshopOffline.getEvaluateSubmission(s.workshopId,s.submissionId);s.hasOffline=!0,s.evaluate.published=o.published,s.evaluate.text=o.feedbacktext,s.evaluate.grade={label:a.CoreGradesHelper.getGradeLabelFromValue(s.evaluationGrades,parseInt(o.gradeover,10))||e,value:o.gradeover||-1}}catch{s.hasOffline=!1,yield s.loadFeedbackToEdit()}finally{s.originalEvaluation.published=s.evaluate.published,s.originalEvaluation.text=s.evaluate.text,s.originalEvaluation.grade=s.evaluate.grade.value,s.feedbackForm.controls.published.setValue(s.evaluate.published),s.feedbackForm.controls.grade.setValue(s.evaluate.grade.value),s.feedbackForm.controls.text.setValue(s.evaluate.text)}}}))()}loadFeedbackToEdit(){var s=this;return(0,n.A)((function*(){if(s.workshop&&s.evaluate)try{const e=yield g.AddonModWorkshopHelper.getSubmissionById(s.workshopId,s.submissionId,{cmId:s.module.id,filter:!1,readingStrategy:2});s.evaluate.text=e.feedbackauthor||"",s.loadFeedbackToEditErrorMessage=void 0}catch(e){s.loadFeedbackToEditErrorMessage=x.WE.isOnline()?D.CoreErrorHelper.getErrorMessageFromError(e)||c.HT.instant("core.networkerrormsg"):c.HT.instant("core.notavailableoffline")}}))()}parseAssessment(s){return s=g.AddonModWorkshopHelper.realGradeValue(this.workshop,s),this.currentUserId==s.reviewerid&&(this.ownAssessment=s,s.ownAssessment=!0),s}forceLeavePage(){this.forceLeave=!0,r.CoreNavigator.back()}hasEvaluationChanged(){var s,e;if(!this.loaded||!this.access.canoverridegrades)return!1;const o=this.feedbackForm.value;return this.originalEvaluation.published!==o.published||((null!==(s=this.originalEvaluation.text)&&void 0!==s?s:"")!==(null!==(e=o.text)&&void 0!==e?e:"")||this.originalEvaluation.grade!==o.grade)}refreshAllData(){var s=this;return(0,n.A)((function*(){const e=[];e.push(b.AddonModWorkshop.invalidateSubmissionData(s.workshopId,s.submissionId)),e.push(b.AddonModWorkshop.invalidateSubmissionsData(s.workshopId)),e.push(b.AddonModWorkshop.invalidateSubmissionAssesmentsData(s.workshopId,s.submissionId)),s.assessmentId&&(e.push(b.AddonModWorkshop.invalidateAssessmentFormData(s.workshopId,s.assessmentId)),e.push(b.AddonModWorkshop.invalidateAssessmentData(s.workshopId,s.assessmentId))),s.assessmentUserId&&e.push(b.AddonModWorkshop.invalidateReviewerAssesmentsData(s.workshopId,s.assessmentId));try{yield Promise.all(e)}finally{p.z.trigger(v.Dl,null,s.siteId),yield s.fetchSubmissionData(),s.logView()}}))()}refreshSubmission(s){this.loaded&&this.refreshAllData().finally((()=>{null==s||s.complete()}))}saveAssessment(){var s=this;return(0,n.A)((function*(){var e;if(null!==(e=s.assessmentStrategy)&&void 0!==e&&e.hasDataChanged())try{yield s.assessmentStrategy.saveAssessment(),s.forceLeavePage()}catch{}else s.forceLeavePage()}))()}saveEvaluation(){var s=this;return(0,n.A)((function*(){s.hasEvaluationChanged()?(yield s.sendEvaluation(),s.forceLeavePage()):s.forceLeavePage()}))()}sendEvaluation(){var s=this;return(0,n.A)((function*(){const e=yield A.CoreLoadings.show("core.sending",!0),o=s.feedbackForm.value;o.grade=Number(o.grade)>=0?o.grade:"",o.text=u.Ni.formatHtmlLines(o.text);try{const e=yield b.AddonModWorkshop.evaluateSubmission(s.workshopId,s.submissionId,s.courseId,o.text,o.published,String(o.grade));h.R.triggerFormSubmittedEvent(s.formElement,!!e,s.siteId),yield b.AddonModWorkshop.invalidateSubmissionData(s.workshopId,s.submissionId).finally((()=>{p.z.trigger(v.AZ,{workshopId:s.workshopId,submissionId:s.submissionId},s.siteId)}))}catch(s){w.CoreAlerts.showError(s,{default:"Cannot save submission evaluation"})}finally{e.dismiss()}}))()}deleteSubmission(){var s=this;return(0,n.A)((function*(){try{yield w.CoreAlerts.confirmDelete(c.HT.instant("addon.mod_workshop.submissiondeleteconfirm"))}catch{return}const e=yield A.CoreLoadings.show("core.deleting",!0);let o=!1;try{yield b.AddonModWorkshop.deleteSubmission(s.workshopId,s.submissionId,s.courseId),o=!0,yield b.AddonModWorkshop.invalidateSubmissionData(s.workshopId,s.submissionId)}catch(s){w.CoreAlerts.showError(s,{default:"Cannot delete submission"})}finally{if(e.dismiss(),o){p.z.trigger(v.AZ,{workshopId:s.workshopId,submissionId:s.submissionId},s.siteId),s.forceLeavePage()}}}))()}undoDeleteSubmission(){var s=this;return(0,n.A)((function*(){yield f.AddonModWorkshopOffline.deleteSubmissionAction(s.workshopId,"delete").finally((0,n.A)((function*(){p.z.trigger(v.AZ,{workshopId:s.workshopId,submissionId:s.submissionId},s.siteId),yield s.refreshAllData()})))}))()}performLogView(){var s=this;return(0,n.A)((function*(){try{yield b.AddonModWorkshop.logViewSubmission(s.submissionId,s.workshopId),t.CoreCourse.checkModuleCompletion(s.courseId,s.module.completiondata)}catch{}k.OF.logEvent({type:k.qr.VIEW_ITEM,ws:"mod_workshop_view_submission",name:s.workshop.name,data:{id:s.workshop.id,submissionid:s.submissionId,category:"workshop"},url:`/mod/workshop/submission.php?cmid=${s.module.id}&id=${s.submissionId}`})}))()}ngOnDestroy(){var s,e;this.isDestroyed=!0,null===(s=this.syncObserver)||void 0===s||s.off(),null===(e=this.obsAssessmentSaved)||void 0===e||e.off(),m.CoreSync.unblockOperation(v.Ug,this.workshopId)}}return(e=AddonModWorkshopSubmissionPage).ɵfac=function AddonModWorkshopSubmissionPage_Factory(s){return new(s||e)(T.rXU(i.ok),T.rXU(G.W9,8))},e.ɵcmp=T.VBU({type:e,selectors:[["page-addon-mod-workshop-submission-page"]],viewQuery:function AddonModWorkshopSubmissionPage_Query(s,e){if(1&s&&(T.GBs(_.AddonModWorkshopAssessmentStrategyComponent,5),T.GBs(N,5)),2&s){let s;T.mGM(s=T.lsd())&&(e.assessmentStrategy=s.first),T.mGM(s=T.lsd())&&(e.formElement=s.first)}},standalone:!0,features:[T.aNF],decls:22,vars:17,consts:[["feedbackFormEl",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],["slot","end",3,"hidden"],["fill","clear",3,"click",4,"ngIf"],["fill","clear"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh",4,"ngIf"],[3,"hideUntil"],[4,"ngIf"],[3,"workshop","access","assessmentId","userId","strategy","edit",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["fill","clear",3,"click"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"submission","courseId","module","workshop","access","viewDetails"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],["expand","block",3,"click",4,"ngIf"],["expand","block","color","danger",3,"click",4,"ngIf"],["expand","block","fill","outline","color","danger",3,"click",4,"ngIf"],["expand","block",3,"click"],["name","fas-pen","slot","start","aria-hidden","true"],["expand","block","color","danger",3,"click"],["name","fas-trash","slot","start","aria-hidden","true"],["expand","block","fill","outline","color","danger",3,"click"],["name","fas-rotate-left","slot","start","aria-hidden","true"],["slot","start",3,"user","courseId","userId",4,"ngIf"],["slot","start",3,"user","courseId","userId"],[3,"submission","assessment","courseId","access","module","workshop"],[4,"ngFor","ngForOf"],[3,"submission","assessment","courseId","access","module","workshop",4,"ngIf"],[3,"submission","assessment","courseId","module","workshop","access",4,"ngFor","ngForOf"],[3,"submission","assessment","courseId","module","workshop","access"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"formGroup"],["labelPlacement","stacked","formControlName","grade","interface","action-sheet",3,"cancelText","interfaceOptions","label"],[3,"value",4,"ngFor","ngForOf"],["position","stacked"],["name","text","contextLevel","module","elementId","feedbackauthor_editor",3,"control","autoSave","contextInstanceId","draftExtraParams"],["formControlName","published"],[1,"item-heading"],[3,"value"],[3,"workshop","access","assessmentId","userId","strategy","edit"],["class","item-heading",4,"ngIf"]],template:function AddonModWorkshopSubmissionPage_Template(s,e){1&s&&(T.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),T.nrm(3,"ion-back-button",2),T.nI1(4,"translate"),T.k0s(),T.j41(5,"ion-title")(6,"h1"),T.DNE(7,AddonModWorkshopSubmissionPage_core_format_text_7_Template,1,3,"core-format-text",3),T.k0s()(),T.j41(8,"ion-buttons",4),T.DNE(9,AddonModWorkshopSubmissionPage_ion_button_9_Template,3,3,"ion-button",5)(10,AddonModWorkshopSubmissionPage_Conditional_10_Template,3,3,"ion-button",6),T.k0s()()(),T.j41(11,"ion-content",7),T.DNE(12,AddonModWorkshopSubmissionPage_ion_refresher_12_Template,3,4,"ion-refresher",8),T.j41(13,"core-loading",9),T.DNE(14,AddonModWorkshopSubmissionPage_ion_list_14_Template,3,7,"ion-list",10)(15,AddonModWorkshopSubmissionPage_ion_list_15_Template,6,5,"ion-list",10)(16,AddonModWorkshopSubmissionPage_ion_list_16_Template,7,9,"ion-list",10)(17,AddonModWorkshopSubmissionPage_ion_list_17_Template,7,4,"ion-list",10)(18,AddonModWorkshopSubmissionPage_ion_list_18_Template,7,4,"ion-list",10)(19,AddonModWorkshopSubmissionPage_Conditional_19_Template,2,1)(20,AddonModWorkshopSubmissionPage_addon_mod_workshop_assessment_strategy_20_Template,1,6,"addon-mod-workshop-assessment-strategy",11)(21,AddonModWorkshopSubmissionPage_ion_list_21_Template,6,5,"ion-list",10),T.k0s()()),2&s&&(T.R7$(3),T.Y8G("text",T.bMT(4,15,"core.back")),T.R7$(4),T.Y8G("ngIf",e.title),T.R7$(),T.Y8G("hidden",!e.loaded),T.R7$(),T.Y8G("ngIf",e.assessmentId&&e.access.assessingallowed),T.R7$(),T.vxM(10,e.canAddFeedback&&!e.loadFeedbackToEditErrorMessage?10:-1),T.R7$(2),T.Y8G("ngIf",!(e.assessmentId&&e.access.assessingallowed||e.canAddFeedback)),T.R7$(),T.Y8G("hideUntil",e.loaded),T.R7$(),T.Y8G("ngIf",e.submission),T.R7$(),T.Y8G("ngIf",!e.canAddFeedback&&(null==e.evaluate?null:e.evaluate.text)),T.R7$(),T.Y8G("ngIf",e.ownAssessment&&!e.assessment),T.R7$(),T.Y8G("ngIf",e.submissionInfo&&e.submissionInfo.reviewedby&&e.submissionInfo.reviewedby.length&&!e.assessment),T.R7$(),T.Y8G("ngIf",e.submissionInfo&&e.submissionInfo.reviewerof&&e.submissionInfo.reviewerof.length&&!e.assessment),T.R7$(),T.vxM(19,e.canAddFeedback&&e.submission?19:-1),T.R7$(),T.Y8G("ngIf",e.assessmentId),T.R7$(),T.Y8G("ngIf",e.assessmentId&&!e.access.assessingallowed&&(null==e.assessment?null:e.assessment.feedbackreviewer)))},dependencies:[S.n,W.Sq,W.bT,i.qT,i.BC,i.cb,G.Jm,G.QW,G.b_,G.W9,G.eU,G.iq,G.uz,G.Dg,G.he,G.nf,G.To,G.Ki,G.Nm,G.Ip,G.BC,G.BY,G.ai,G.hB,G.Je,G.el,i.j4,i.JD,R.R,y.T,C.t,j.B,Y.i,E.T,P.D9,M.CoreEditorRichTextEditorComponent,F,_.AddonModWorkshopAssessmentStrategyComponent,$.J],encapsulation:2}),AddonModWorkshopSubmissionPage})()}}]);