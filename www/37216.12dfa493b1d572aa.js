"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[37216],{37216:(t,e,n)=>{n.r(e),n.d(e,{default:()=>R});var o=n(10467),i=n(89079),a=n(98870),r=n(15324),s=n(55554),l=n(34961),d=n(24742),_=n(22693),c=n(25572),p=n(86654),m=n(93417),g=n(96354),A=n(54438),u=n(60177),h=n(2910),P=n(16986),v=n(66198),f=n(64422),M=n(16658),y=n(86198),C=n(58197),T=n(8199),U=n(88246),F=n(73955),I=n(59528);const _forTrack0=(t,e)=>e.userid,_c0=t=>({users:t}),_c1=t=>({$a:t});function AddonModH5PActivityUsersAttemptsPage_Conditional_7_Template(t,e){if(1&t&&A.nrm(0,"core-format-text",4),2&t){const t=A.XpG();A.Y8G("text",t.h5pActivity.name)("contextInstanceId",t.h5pActivity.coursemodule)("courseId",t.courseId)}}function AddonModH5PActivityUsersAttemptsPage_Conditional_16_Conditional_0_ng_container_0_Template(t,e){1&t&&A.eu8(0)}function AddonModH5PActivityUsersAttemptsPage_Conditional_16_Conditional_0_Template(t,e){if(1&t&&A.DNE(0,AddonModH5PActivityUsersAttemptsPage_Conditional_16_Conditional_0_ng_container_0_Template,1,0,"ng-container",11),2&t){const t=A.XpG(2),e=A.sdS(22);A.Y8G("ngTemplateOutlet",e)("ngTemplateOutletContext",A.eq3(2,_c0,t.users))}}function AddonModH5PActivityUsersAttemptsPage_Conditional_16_Conditional_1_ng_container_0_Template(t,e){1&t&&A.eu8(0)}function AddonModH5PActivityUsersAttemptsPage_Conditional_16_Conditional_1_Template(t,e){if(1&t&&A.DNE(0,AddonModH5PActivityUsersAttemptsPage_Conditional_16_Conditional_1_ng_container_0_Template,1,0,"ng-container",11),2&t){const t=A.XpG(2),e=A.sdS(20);A.Y8G("ngTemplateOutlet",e)("ngTemplateOutletContext",A.eq3(2,_c0,t.users))}}function AddonModH5PActivityUsersAttemptsPage_Conditional_16_Template(t,e){if(1&t&&A.DNE(0,AddonModH5PActivityUsersAttemptsPage_Conditional_16_Conditional_0_Template,1,4,"ng-container")(1,AddonModH5PActivityUsersAttemptsPage_Conditional_16_Conditional_1_Template,1,4),2&t){const t=A.XpG();A.vxM(0,t.isTablet()?0:1)}}function AddonModH5PActivityUsersAttemptsPage_Conditional_17_Template(t,e){1&t&&(A.nrm(0,"core-empty-box",9),A.nI1(1,"translate")),2&t&&A.Y8G("message",A.bMT(1,1,"addon.mod_h5pactivity.noparticipants"))}function AddonModH5PActivityUsersAttemptsPage_ng_template_19_For_2_Conditional_7_Template(t,e){if(1&t&&(A.j41(0,"small"),A.EFF(1),A.nI1(2,"translate"),A.k0s()),2&t){const t=A.XpG().$implicit;A.R7$(),A.SpI(" ",A.i5U(2,1,"addon.mod_h5pactivity.numberofattempts",A.eq3(4,_c1,t.attempts.length))," ")}}function AddonModH5PActivityUsersAttemptsPage_ng_template_19_For_2_Conditional_9_Template(t,e){if(1&t&&(A.EFF(0),A.nI1(1,"translate")),2&t){const t=A.XpG().$implicit;A.SpI(" ",A.i5U(1,1,"core.percentagenumber",A.eq3(4,_c1,t.score))," ")}}function AddonModH5PActivityUsersAttemptsPage_ng_template_19_For_2_Conditional_10_Template(t,e){1&t&&(A.j41(0,"span",18),A.EFF(1,"–"),A.k0s(),A.j41(2,"span",19),A.EFF(3),A.nI1(4,"translate"),A.k0s()),2&t&&(A.R7$(3),A.JRh(A.bMT(4,1,"core.none")))}function AddonModH5PActivityUsersAttemptsPage_ng_template_19_For_2_Template(t,e){if(1&t){const t=A.RV6();A.j41(0,"ion-item",13),A.bIt("click",(function AddonModH5PActivityUsersAttemptsPage_ng_template_19_For_2_Template_ion_item_click_0_listener(){const e=A.eBV(t).$implicit,n=A.XpG(2);return A.Njj(n.openUser(e))})),A.nrm(1,"core-user-avatar",14),A.j41(2,"ion-label")(3,"div",15)(4,"div",16)(5,"div",17),A.EFF(6),A.k0s(),A.DNE(7,AddonModH5PActivityUsersAttemptsPage_ng_template_19_For_2_Conditional_7_Template,3,6,"small"),A.k0s(),A.j41(8,"small"),A.DNE(9,AddonModH5PActivityUsersAttemptsPage_ng_template_19_For_2_Conditional_9_Template,2,6)(10,AddonModH5PActivityUsersAttemptsPage_ng_template_19_For_2_Conditional_10_Template,5,3),A.k0s()()()()}if(2&t){const t=e.$implicit,n=A.XpG(2);A.AVh("item-dimmed",!t.attempts.length)("hide-detail",!t.attempts.length),A.Y8G("detail",!0)("button",t.attempts.length>0),A.R7$(),A.Y8G("user",t.user)("courseId",n.courseId)("linkProfile",!1),A.R7$(5),A.JRh(t.user.fullname),A.R7$(),A.vxM(7,t.attempts.length>0?7:-1),A.R7$(2),A.vxM(9,void 0!==t.score?9:10)}}function AddonModH5PActivityUsersAttemptsPage_ng_template_19_Template(t,e){if(1&t&&(A.j41(0,"ion-list"),A.Z7z(1,AddonModH5PActivityUsersAttemptsPage_ng_template_19_For_2_Template,11,12,"ion-item",12,_forTrack0),A.k0s()),2&t){const t=e.users;A.R7$(),A.Dyx(t)}}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_Conditional_14_Template(t,e){if(1&t&&A.EFF(0),2&t){const t=A.XpG(2);A.SpI(" (",t.totalAttempts,") ")}}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_6_Template(t,e){if(1&t&&(A.EFF(0),A.nI1(1,"coreFormatDate")),2&t){const t=A.XpG().$implicit;A.SpI(" ",A.i5U(1,1,t.attempts[t.attempts.length-1].timemodified,"strftimedatetimeshort")," ")}}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_7_Template(t,e){1&t&&(A.j41(0,"span",18),A.EFF(1,"–"),A.k0s(),A.j41(2,"span",19),A.EFF(3),A.nI1(4,"translate"),A.k0s()),2&t&&(A.R7$(3),A.JRh(A.bMT(4,1,"core.none")))}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_9_Template(t,e){if(1&t&&(A.EFF(0),A.nI1(1,"translate")),2&t){const t=A.XpG().$implicit;A.SpI(" ",A.i5U(1,1,"core.percentagenumber",A.eq3(4,_c1,t.score))," ")}}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_10_Template(t,e){1&t&&(A.j41(0,"span",18),A.EFF(1,"–"),A.k0s(),A.j41(2,"span",19),A.EFF(3),A.nI1(4,"translate"),A.k0s()),2&t&&(A.R7$(3),A.JRh(A.bMT(4,1,"core.none")))}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_12_Template(t,e){if(1&t&&A.EFF(0),2&t){const t=A.XpG().$implicit;A.SpI(" ",t.attempts.length," ")}}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_13_Template(t,e){1&t&&(A.j41(0,"span",18),A.EFF(1,"–"),A.k0s(),A.j41(2,"span",19),A.EFF(3),A.nI1(4,"translate"),A.k0s()),2&t&&(A.R7$(3),A.JRh(A.bMT(4,1,"core.none")))}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_15_Template(t,e){if(1&t){const t=A.RV6();A.j41(0,"span",34),A.bIt("ariaButtonClick",(function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_15_Template_span_ariaButtonClick_0_listener(){A.eBV(t);const e=A.XpG().$implicit,n=A.XpG(2);return A.Njj(n.openUser(e))})),A.nrm(1,"ion-icon",35),A.nI1(2,"translate"),A.k0s()}if(2&t){const t=A.XpG().$implicit;A.R7$(),A.BMQ("aria-label",A.i5U(2,1,"addon.mod_h5pactivity.review_user_attempts",A.eq3(4,_c1,t.attempts.length)))}}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_16_Template(t,e){1&t&&A.nrm(0,"ion-icon",26)}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Template(t,e){if(1&t){const t=A.RV6();A.j41(0,"ion-row",28),A.bIt("click",(function AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Template_ion_row_click_0_listener(){const e=A.eBV(t).$implicit,n=A.XpG(2);return A.Njj(n.openUser(e))})),A.j41(1,"ion-col",29),A.nrm(2,"core-user-avatar",30),A.j41(3,"span"),A.EFF(4),A.k0s()(),A.j41(5,"ion-col",31),A.DNE(6,AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_6_Template,2,4)(7,AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_7_Template,5,3),A.k0s(),A.j41(8,"ion-col",32),A.DNE(9,AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_9_Template,2,6)(10,AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_10_Template,5,3),A.k0s(),A.j41(11,"ion-col",32),A.DNE(12,AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_12_Template,1,1)(13,AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_13_Template,5,3),A.k0s(),A.j41(14,"ion-col",33),A.DNE(15,AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_15_Template,3,6,"span")(16,AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Conditional_16_Template,1,0),A.k0s(),A.nrm(17,"ion-ripple-effect"),A.k0s()}if(2&t){const t=e.$implicit,n=A.XpG(2);A.AVh("item-dimmed",!t.attempts.length)("ion-activatable",t.attempts.length),A.BMQ("tappable",t.attempts.length>0),A.R7$(2),A.Y8G("user",t.user)("courseId",n.courseId)("linkProfile",!1),A.R7$(2),A.JRh(t.user.fullname),A.R7$(2),A.vxM(6,t.attempts.length>0?6:7),A.R7$(3),A.vxM(9,void 0!==t.score?9:10),A.R7$(3),A.vxM(12,t.attempts.length>0?12:13),A.R7$(3),A.vxM(15,t.attempts.length?15:16)}}function AddonModH5PActivityUsersAttemptsPage_ng_template_21_Template(t,e){if(1&t&&(A.j41(0,"ion-grid",20)(1,"ion-row",21)(2,"ion-col",22),A.EFF(3),A.nI1(4,"translate"),A.k0s(),A.j41(5,"ion-col",23),A.EFF(6),A.nI1(7,"translate"),A.k0s(),A.j41(8,"ion-col",24),A.EFF(9),A.nI1(10,"translate"),A.k0s(),A.j41(11,"ion-col",24),A.EFF(12),A.nI1(13,"translate"),A.DNE(14,AddonModH5PActivityUsersAttemptsPage_ng_template_21_Conditional_14_Template,1,1),A.k0s(),A.j41(15,"ion-col",25),A.nrm(16,"ion-icon",26),A.k0s()(),A.Z7z(17,AddonModH5PActivityUsersAttemptsPage_ng_template_21_For_18_Template,18,13,"ion-row",27,_forTrack0),A.k0s()),2&t){const t=e.users,n=A.XpG();A.R7$(3),A.SpI(" ",A.bMT(4,5,"core.user")," "),A.R7$(3),A.SpI(" ",A.bMT(7,7,"addon.mod_h5pactivity.startdate")," "),A.R7$(3),A.SpI(" ",A.bMT(10,9,"addon.mod_h5pactivity.score")," "),A.R7$(3),A.SpI(" ",A.bMT(13,11,"addon.mod_h5pactivity.attempts")," "),A.R7$(2),A.vxM(14,n.totalAttempts?14:-1),A.R7$(3),A.Dyx(t)}}let R=(()=>{var t;class AddonModH5PActivityUsersAttemptsPage{constructor(){var t=this;this.loaded=!1,this.users=[],this.fetchMoreUsersFailed=!1,this.canLoadMore=!1,this.page=0,this.logView=d.j.once((0,o.A)((function*(){t.h5pActivity&&(yield s.g.ignoreErrors(l.R.logViewReport(t.h5pActivity.id)),_.OF.logEvent({type:_.qr.VIEW_ITEM_LIST,ws:"mod_h5pactivity_log_report_viewed",name:t.h5pActivity.name,data:{id:t.h5pActivity.id,category:"h5pactivity"},url:`/mod/h5pactivity/report.php?a=${t.h5pActivity.id}`}))}))),this.isTablet=(0,i.ot)(m.CoreScreen.layoutObservable.pipe((0,g.T)((()=>m.CoreScreen.isTablet))),{requireSync:!0})}ngOnInit(){var t=this;return(0,o.A)((function*(){try{t.courseId=r.CoreNavigator.getRequiredRouteNumberParam("courseId"),t.cmId=r.CoreNavigator.getRequiredRouteNumberParam("cmId")}catch(t){return c.CoreAlerts.showError(t),r.CoreNavigator.back(),void 0}t.fetchData()}))()}doRefresh(t){this.refreshData().finally((()=>{t.complete()}))}fetchData(t){var e=this;return(0,o.A)((function*(){try{e.h5pActivity=yield l.R.getH5PActivity(e.courseId,e.cmId),yield Promise.all([e.fetchUsers(t)]),e.logView()}catch(t){c.CoreAlerts.showError(t,{default:"Error loading attempts."})}finally{e.loaded=!0}}))()}fetchUsers(t){var e=this;return(0,o.A)((function*(){if(!e.h5pActivity)return;t&&(e.page=0);const n=yield l.R.getUsersAttempts(e.h5pActivity.id,{cmId:e.cmId,page:e.page}),o=yield e.formatUsers(e.h5pActivity,n.users);e.users=0===e.page?o:e.users.concat(o),e.totalAttempts=n.totalAttempts,e.canLoadMore=n.canLoadMore,e.page++}))()}formatUsers(t,e){var n=this;return(0,o.A)((function*(){return Promise.all(e.map(function(){var e=(0,o.A)((function*(e){var o;if(e.user=yield a.CoreUser.getProfile(e.userid,n.courseId,!0),0===t.grademethod);else if(2===t.grademethod){if(e.attempts.length){const t=e.attempts.reduce(((t,e)=>t+100*e.rawscore/e.maxscore),0);e.score=Math.round(t/e.attempts.length)}}else null!==(o=e.scored)&&void 0!==o&&o.attempts[0]&&(e.score=Math.round(100*e.scored.attempts[0].rawscore/e.scored.attempts[0].maxscore));return e}));return function(t){return e.apply(this,arguments)}}()))}))()}fetchMoreUsers(t){var e=this;return(0,o.A)((function*(){try{yield e.fetchUsers(!1)}catch(t){c.CoreAlerts.showError(t,{default:"Error loading more users"}),e.fetchMoreUsersFailed=!0}t()}))()}refreshData(){var t=this;return(0,o.A)((function*(){const e=[l.R.invalidateActivityData(t.courseId)];t.h5pActivity&&e.push(l.R.invalidateAllUsersAttempts(t.h5pActivity.id)),yield s.g.ignoreErrors(Promise.all(e)),yield t.fetchData(!0)}))()}openUser(t){t.attempts.length&&r.CoreNavigator.navigate(`../userattempts/${t.userid}`)}}return(t=AddonModH5PActivityUsersAttemptsPage).ɵfac=function AddonModH5PActivityUsersAttemptsPage_Factory(e){return new(e||t)},t.ɵcmp=A.VBU({type:t,selectors:[["page-addon-mod-h5pactivity-users-attempts"]],standalone:!0,features:[A.aNF],decls:23,vars:16,consts:[["usersMobileTemplate",""],["usersTabletTemplate",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[1,"ion-margin"],["icon","fas-chart-bar",3,"message"],[3,"action","enabled","error"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"detail","item-dimmed","hide-detail","button"],[3,"click","detail","button"],["slot","start",3,"user","courseId","linkProfile"],[1,"flex-row","ion-align-items-center"],[1,"flex-column"],[1,"item-heading"],["aria-hidden","true"],[1,"sr-only"],["role","grid"],["role","row",1,"ion-align-items-center"],["role","columnheader","size","4"],["role","columnheader"],["role","columnheader",1,"ion-text-center"],["role","columnheader","size","auto"],["name","fas-chevron-right","aria-hidden","true",1,"invisible"],["role","row",1,"ripple-parent",3,"item-dimmed","ion-activatable"],["role","row",1,"ripple-parent",3,"click"],["role","gridcell","size","4",1,"flex-row"],[3,"user","courseId","linkProfile"],["role","gridcell"],["role","gridcell",1,"ion-justify-content-center"],["role","gridcell","size","auto"],[3,"ariaButtonClick"],["name","fas-chevron-right"]],template:function AddonModH5PActivityUsersAttemptsPage_Template(t,e){if(1&t){const t=A.RV6();A.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),A.nrm(3,"ion-back-button",3),A.nI1(4,"translate"),A.k0s(),A.j41(5,"ion-title")(6,"h1"),A.DNE(7,AddonModH5PActivityUsersAttemptsPage_Conditional_7_Template,1,3,"core-format-text",4),A.k0s()()()(),A.j41(8,"ion-content")(9,"ion-refresher",5),A.bIt("ionRefresh",(function AddonModH5PActivityUsersAttemptsPage_Template_ion_refresher_ionRefresh_9_listener(n){return A.eBV(t),A.Njj(e.doRefresh(n.target))})),A.nrm(10,"ion-refresher-content",6),A.nI1(11,"translate"),A.k0s(),A.j41(12,"core-loading",7)(13,"h2",8),A.EFF(14),A.nI1(15,"translate"),A.k0s(),A.DNE(16,AddonModH5PActivityUsersAttemptsPage_Conditional_16_Template,2,1)(17,AddonModH5PActivityUsersAttemptsPage_Conditional_17_Template,2,3,"core-empty-box",9),A.j41(18,"core-infinite-loading",10),A.bIt("action",(function AddonModH5PActivityUsersAttemptsPage_Template_core_infinite_loading_action_18_listener(n){return A.eBV(t),A.Njj(e.fetchMoreUsers(n))})),A.k0s()()(),A.DNE(19,AddonModH5PActivityUsersAttemptsPage_ng_template_19_Template,3,0,"ng-template",null,0,A.C5r)(21,AddonModH5PActivityUsersAttemptsPage_ng_template_21_Template,19,13,"ng-template",null,1,A.C5r)}2&t&&(A.R7$(3),A.Y8G("text",A.bMT(4,10,"core.back")),A.R7$(4),A.vxM(7,e.h5pActivity?7:-1),A.R7$(2),A.Y8G("disabled",!e.loaded),A.R7$(),A.FS9("pullingText",A.bMT(11,12,"core.pulltorefresh")),A.R7$(2),A.Y8G("hideUntil",e.loaded),A.R7$(2),A.JRh(A.bMT(15,14,"addon.mod_h5pactivity.attempts_report")),A.R7$(2),A.vxM(16,e.users.length?16:-1),A.R7$(),A.vxM(17,e.users.length||e.canLoadMore?-1:17),A.R7$(),A.Y8G("enabled",e.loaded&&e.canLoadMore)("error",e.fetchMoreUsersFailed))},dependencies:[p.n,u.T3,h.QW,h.hU,h.W9,h.lO,h.eU,h.iq,h.uz,h.he,h.nf,h.To,h.Ki,h.S7,h.ln,h.BC,h.ai,h.el,P.h,v.b,f.R,M.T,y.t,C.B,T.a,U.i,F.D9,I.f],styles:["[_nghost-%COMP%]   ion-item.item-dimmed[_ngcontent-%COMP%]{--background: transparent}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]:not(:last-child){--inner-border-width: 0 0 1px 0}[_nghost-%COMP%]   core-user-avatar[_ngcontent-%COMP%]{--core-avatar-size: 32px;--margin-vertical-on-item: 0}[_nghost-%COMP%]   ion-grid[_ngcontent-%COMP%]{--ion-grid-padding: 0;--ion-grid-column-padding: 8px}[_nghost-%COMP%]   ion-row[_ngcontent-%COMP%]{padding-inline-start:8px;padding-inline-end:8px}[_nghost-%COMP%]   ion-row[_ngcontent-%COMP%]:not(:first-child){min-height:var(--a11y-sizing-minTargetSize)}[_nghost-%COMP%]   ion-row[_ngcontent-%COMP%]:nth-child(2n){background-color:var(--light)}[_nghost-%COMP%]   ion-col[role=columnheader][_ngcontent-%COMP%]{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}[_nghost-%COMP%]   ion-col[role=gridcell][_ngcontent-%COMP%]{display:flex;overflow-wrap:anywhere;align-items:center}[_nghost-%COMP%]   ion-col[role=gridcell][_ngcontent-%COMP%]   core-user-avatar[_ngcontent-%COMP%]{margin-inline-start:0;margin-inline-end:8px}[_nghost-%COMP%]   ion-col[role=gridcell][_ngcontent-%COMP%]   [role=button][_ngcontent-%COMP%]{min-height:0;min-width:0}[_nghost-%COMP%]   .ripple-parent[_ngcontent-%COMP%]{position:relative}[_nghost-%COMP%]   .ripple-parent[_ngcontent-%COMP%]   ion-ripple-effect[_ngcontent-%COMP%]{z-index:1}"]}),AddonModH5PActivityUsersAttemptsPage})()}}]);