"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[28488,46526,24145,91288],{46526:(e,t,n)=>{n.d(t,{U:()=>f});var i=n(10467),r=n(54438),s=n(21413),o=n(91768),a=n(74978),l=n(32832),d=n(15324),u=n(49882),c=n(52749),g=n(57085),h=n(86654),p=n(25572),m=n(79555),C=n(64422);const S=["compile"];let f=(()=>{var e;class CoreSitePluginsPluginContentComponent{constructor(e){this.component="",this.data={},this.onContentLoaded=new r.bkB,this.onLoadingContent=new r.bkB,this.content="",this.javascript="",this.dataLoaded=!1,this.invalidateObservable=new s.B,this.differ=e.find([]).create()}ngOnInit(){this.fetchContent()}ngDoCheck(){if(!this.data||!this.jsData)return;this.differ.diff(this.data)&&(this.jsData=Object.assign(this.jsData,this.data))}fetchContent(e){var t=this;return(0,i.A)((function*(){t.onLoadingContent.emit(e),t.forceCompile=!1;const n=Object.assign({},t.preSets);n.component=n.component||t.component;try{const i=yield l.CoreSitePlugins.getContent(t.component,t.method,t.args,n);t.content=i.templates.length?i.templates[0].html:"",t.javascript=i.javascript,t.otherData=i.otherdata,t.data=t.data||{},t.forceCompile=!0,t.jsData={...t.args,...t.data,...l.CoreSitePlugins.createDataForJS(t.initResult,i)},t.jsData.fetchContent=e=>t.fetchContent(e),t.jsData.openContent=(e,n,i,r,s,o,a)=>t.openContent(e,n,i,r,s,o,a),t.jsData.refreshContent=e=>t.refreshContent(e),t.jsData.updateContent=(e,n,i,r,s)=>t.updateContent(e,n,i,r,s),t.jsData.updateModuleCourseContent=(e,n)=>t.updateModuleCourseContent(e,n),t.jsData.updateCachedContent=()=>t.updateCachedContent(),t.onContentLoaded.emit({refresh:!!e,success:!0,content:t.content})}catch(n){t.content="<div></div>",t.onContentLoaded.emit({refresh:!!e,success:!1,content:t.content}),p.CoreAlerts.showError(n,{default:m.HT.instant("core.errorloadingcontent")})}finally{t.dataLoaded=!0}}))()}openContent(e,t={},n,i,r,s,a,l){!0===r&&(r=this.data),n=n||this.component,i=i||this.method;const u=o.VV.hashAsciiStr(JSON.stringify(t));d.CoreNavigator.navigateToSitePath(`siteplugins/content/${n}/${i}/${u}`,{params:{title:e,args:t,initResult:this.initResult,jsData:r,preSets:s,ptrEnabled:a,contextLevel:(null==l?void 0:l.contextLevel)||this.contextLevel,contextInstanceId:(null==l?void 0:l.contextInstanceId)||this.contextInstanceId,courseId:(null==l?void 0:l.courseId)||this.courseId}})}refreshContent(e=!0){var t=this;return(0,i.A)((function*(){e&&(t.dataLoaded=!1),t.invalidateObservable.next();try{yield l.CoreSitePlugins.invalidateContent(t.component,t.method,t.args)}finally{yield t.fetchContent(!0)}}))()}updateContent(e,t,n,i,r){this.component=t||this.component,this.method=n||this.method,this.args=e,this.dataLoaded=!1,this.preSets=r||this.preSets,this.data&&i&&Object.assign(this.data,i),this.fetchContent()}callComponentFunction(e,t){var n;return null===(n=this.compileComponent)||void 0===n?void 0:n.callComponentFunction(e,t)}updateModuleCourseContent(e,t){u.z.trigger(g.Vs,{cmId:e,alreadyFetched:t})}updateCachedContent(){var e=this;return(0,i.A)((function*(){yield l.CoreSitePlugins.getContent(e.component,e.method,e.args,c.CoreSites.getReadingStrategyPreSets(2))}))()}}return(e=CoreSitePluginsPluginContentComponent).ɵfac=function CoreSitePluginsPluginContentComponent_Factory(t){return new(t||e)(r.rXU(r.MKu))},e.ɵcmp=r.VBU({type:e,selectors:[["core-site-plugins-plugin-content"]],viewQuery:function CoreSitePluginsPluginContentComponent_Query(e,t){if(1&e&&r.GBs(S,5),2&e){let e;r.mGM(e=r.lsd())&&(t.compileComponent=e.first)}},hostVars:2,hostBindings:function CoreSitePluginsPluginContentComponent_HostBindings(e,t){2&e&&r.HbH(t.component)},inputs:{component:"component",method:"method",args:"args",initResult:"initResult",data:"data",preSets:"preSets",pageTitle:"pageTitle",contextLevel:"contextLevel",contextInstanceId:"contextInstanceId",courseId:"courseId"},outputs:{onContentLoaded:"onContentLoaded",onLoadingContent:"onLoadingContent"},standalone:!0,features:[r.aNF],decls:3,vars:6,consts:[["compile",""],[3,"hideUntil","fullscreen"],[3,"text","javascript","jsData","forceCompile"]],template:function CoreSitePluginsPluginContentComponent_Template(e,t){1&e&&(r.j41(0,"core-loading",1),r.nrm(1,"core-compile-html",2,0),r.k0s()),2&e&&(r.Y8G("hideUntil",t.dataLoaded)("fullscreen",!1),r.R7$(),r.Y8G("text",t.content)("javascript",t.javascript)("jsData",t.jsData)("forceCompile",t.forceCompile))},dependencies:[h.n,C.R,a.h],styles:["[_nghost-%COMP%]{display:contents}"]}),CoreSitePluginsPluginContentComponent})()},76863:(e,t,n)=>{n.r(t),n.d(t,{CoreSitePluginsInit:()=>ie,CoreSitePluginsInitService:()=>ne});var i=n(10467),r=n(2806),s=n(62007),o=n(95790),a=n(15646),l=n(75629),d=n(63114),u=n(48236),c=n(78765),g=n(14001),h=n(97086),p=n(8979),m=n(95376),C=n(13482),S=n(89857),f=n(63196),v=n(5784),y=n(999),P=n(88793),H=n(72881),A=n(52749),b=n(75383),D=n(55554),I=n(99121),R=n(49882),k=n(6787),w=n(3379),E=n(79555);class CoreSitePluginsAssignFeedbackHandler extends w.W{constructor(e,t,n){super(),this.name=e,this.type=t,this.prefix=n}getComponent(){return(0,i.A)((function*(){const{CoreSitePluginsAssignFeedbackComponent:e}=yield n.e(72076).then(n.bind(n,88646));return e}))()}getPluginName(e){const t=`${this.prefix}pluginname`,n=E.HT.instant(t);return t!=n?n:e.name}}var F=n(81672);class CoreSitePluginsAssignSubmissionHandler extends F.x{constructor(e,t,n){super(),this.name=e,this.type=t,this.prefix=n}getComponent(){return(0,i.A)((function*(){const{CoreSitePluginsAssignSubmissionComponent:e}=yield n.e(72076).then(n.bind(n,72918));return e}))()}getPluginName(e){const t=`${this.prefix}pluginname`,n=E.HT.instant(t);return t!=n?n:e.name}}class CoreSitePluginsBaseHandler{constructor(e){this.name=e}isEnabled(){return(0,i.A)((function*(){return!0}))()}}class CoreSitePluginsBlockHandler extends CoreSitePluginsBaseHandler{constructor(e,t,n,i,r){super(e),this.title=t,this.blockName=n,this.handlerSchema=i,this.initResult=r,this.logger=k.CoreLogger.getInstance("CoreSitePluginsBlockHandler")}getDisplayData(e,t,r){var s=this;return(0,i.A)((function*(){var i,o,a;const u=(null===(i=s.handlerSchema.displaydata)||void 0===i?void 0:i.class)||`block_${e.name}`;let c;if("title"===(null===(o=s.handlerSchema.displaydata)||void 0===o?void 0:o.type)){const{CoreSitePluginsOnlyTitleBlockComponent:e}=yield Promise.all([n.e(72076),n.e(74786)]).then(n.bind(n,74786));c=e}else if("prerendered"===(null===(a=s.handlerSchema.displaydata)||void 0===a?void 0:a.type)){const{CoreBlockPreRenderedComponent:e}=yield n.e(72076).then(n.bind(n,2638));c=e}else if(s.handlerSchema.fallback&&!s.handlerSchema.method){const n=e.name;e.name=s.handlerSchema.fallback;try{const i=yield d.CoreBlockDelegate.getBlockDisplayData(e,t,r);if(!i)throw new l.CoreError("Cannot get display data for fallback block.");s.logger.debug(`Using fallback "${s.handlerSchema.fallback}" for block "${n}"`),c=i.component}catch(e){throw s.logger.error(`Error using fallback "${s.handlerSchema.fallback}" for block "${n}", maybe it doesn't exist or isn't enabled.`,e),e}}else{const{CoreSitePluginsBlockComponent:e}=yield n.e(72076).then(n.bind(n,26766));c=e}return{title:s.title,class:u,component:c}}))()}}var M=n(46254);class CoreSitePluginsCourseFormatHandler extends CoreSitePluginsBaseHandler{constructor(e,t,n){super(e),this.format=t,this.handlerSchema=n}canViewAllSections(){var e;return null===(e=this.handlerSchema.canviewallsections)||void 0===e||e}displayCourseIndex(){var e;return null===(e=this.handlerSchema.displaycourseindex)||void 0===e||e}getCourseFormatComponent(){var e=this;return(0,i.A)((function*(){if(e.handlerSchema.method)return M.CoreSitePluginsCourseFormatComponent}))()}}var x=n(91768),L=n(32832),N=n(25124);class CoreSitePluginsCourseOptionHandler extends CoreSitePluginsBaseHandler{constructor(e,t,n,i,r){super(e),this.title=t,this.plugin=n,this.handlerSchema=i,this.initResult=r,this.priority=i.priority||0,this.isMenuHandler=!!i.ismenuhandler}isEnabledForCourse(e){var t=this;return(0,i.A)((function*(){var n;return t.updatingDefer&&(yield t.updatingDefer),L.CoreSitePlugins.isHandlerEnabledForCourse(e,t.handlerSchema.restricttoenrolledcourses,null===(n=t.initResult)||void 0===n?void 0:n.restrict)}))()}getDisplayData(){var e;return{title:this.title,class:null===(e=this.handlerSchema.displaydata)||void 0===e?void 0:e.class,page:`siteplugins/${this.name}`,pageParams:{}}}getMenuDisplayData(e){var t,n;const i={courseid:e.id},r=x.VV.hashAsciiStr(JSON.stringify(i));return{title:this.title,class:null===(t=this.handlerSchema.displaydata)||void 0===t?void 0:t.class,icon:(null===(n=this.handlerSchema.displaydata)||void 0===n?void 0:n.icon)||"",page:`siteplugins/content/${this.plugin.component}/${this.handlerSchema.method}/${r}`,pageParams:{title:this.title,args:i,initResult:this.initResult,ptrEnabled:this.handlerSchema.ptrenabled,contextLevel:"course",contextInstanceId:e.id}}}prefetch(e){return L.CoreSitePlugins.prefetchFunctions(this.plugin.component,{courseid:e.id},this.handlerSchema,e.id,void 0,!0)}setInitResult(e){var t;this.initResult=e,null===(t=this.updatingDefer)||void 0===t||t.resolve(),delete this.updatingDefer}updatingInit(){this.updatingDefer=new N._}}class CoreSitePluginsMainMenuHandler extends CoreSitePluginsBaseHandler{constructor(e,t,n,i,r){super(e),this.title=t,this.plugin=n,this.handlerSchema=i,this.initResult=r,this.priority=i.priority||0}getDisplayData(){var e,t;return{title:this.title,icon:(null===(e=this.handlerSchema.displaydata)||void 0===e?void 0:e.icon)||"fas-question",class:null===(t=this.handlerSchema.displaydata)||void 0===t?void 0:t.class,page:`siteplugins/content/${this.plugin.component}/${this.handlerSchema.method}/0`,pageParams:{title:this.title,initResult:this.initResult,ptrEnabled:this.handlerSchema.ptrenabled},onlyInMore:!0}}}class CoreSitePluginsMessageOutputHandler extends CoreSitePluginsBaseHandler{constructor(e,t,n,i,r,s){super(e),this.processorName=t,this.title=n,this.plugin=i,this.handlerSchema=r,this.initResult=s}getDisplayData(){var e;return{priority:this.handlerSchema.priority||0,label:this.title,icon:(null===(e=this.handlerSchema.displaydata)||void 0===e?void 0:e.icon)||"fas-question",page:`siteplugins/content/${this.plugin.component}/${this.handlerSchema.method}/0`,pageParams:{title:this.title,initResult:this.initResult,ptrEnabled:this.handlerSchema.ptrenabled}}}}var U=n(95384),j=n(94247),B=n(15324),O=n(57085);class CoreSitePluginsModuleHandler extends CoreSitePluginsBaseHandler{constructor(e,t,n,i,r){super(e),this.modName=t,this.plugin=n,this.handlerSchema=i,this.initResult=r,this.logger=k.CoreLogger.getInstance("CoreSitePluginsModuleHandler"),this.supportedFeatures=i.supportedfeatures,null!=r&&r.jsResult&&r.jsResult.supportsFeature&&(this.supportsFeature=e=>r.jsResult.supportsFeature(e))}getData(e,t,n,r){var s=this;return(0,i.A)((function*(){var n,o,a;const l=e.modicon||(null===(n=s.handlerSchema.displaydata)||void 0===n?void 0:n.icon);if(s.shouldOnlyDisplayDescription(e,r)){var d;const t=e.description;return e.description="",{icon:U.CoreCourseModuleHelper.getModuleIconSrc(e.modname,l),title:t||"",a11yTitle:"",class:null===(d=s.handlerSchema.displaydata)||void 0===d?void 0:d.class}}const u=!(!s.handlerSchema.offlinefunctions||!Object.keys(s.handlerSchema.offlinefunctions).length),c=s.handlerSchema.downloadbutton,g={title:e.name,icon:U.CoreCourseModuleHelper.getModuleIconSrc(e.modname,l),class:null===(o=s.handlerSchema.displaydata)||void 0===o?void 0:o.class,showDownloadButton:void 0!==c?c:u,hasCustomCmListItem:null!==(a=s.handlerSchema.hascustomcmlistitem)&&void 0!==a&&a};if(s.handlerSchema.method&&(g.action=function(){var e=(0,i.A)((function*(e,t,n,i){e.preventDefault(),e.stopPropagation(),yield s.openActivityPage(t,n,i)}));return function(t,n,i,r){return e.apply(this,arguments)}}()),r&&s.handlerSchema.coursepagemethod&&!j.CoreCourseHelper.isModuleStealth(e)){const n=s.handlerSchema.coursepagemethod;s.loadCoursePageTemplate(e,t,g,n),R.z.on(O.Vs,(i=>{i.cmId===e.id&&s.loadCoursePageTemplate(e,t,g,n,!i.alreadyFetched)}))}return g}))()}shouldOnlyDisplayDescription(e,t){if(t&&this.handlerSchema.coursepagemethod)return!1;const n=this.supportsNoViewLink();return void 0!==n?n:"noviewlink"in e&&!!e.noviewlink}supportsNoViewLink(){var e;return this.supportsFeature?this.supportsFeature("viewlink"):null===(e=this.supportedFeatures)||void 0===e?void 0:e.viewlink}loadCoursePageTemplate(e,t,n,r,s){var o=this;return(0,i.A)((function*(){n.loading=!0;const i={courseid:t,cmid:e.id};s&&(yield D.g.ignoreErrors(L.CoreSitePlugins.invalidateContent(o.plugin.component,r,i)));try{var a,l;const t=yield L.CoreSitePlugins.getContent(o.plugin.component,r,i);n.title=null!==(a=null===(l=t.templates[0])||void 0===l?void 0:l.html)&&void 0!==a?a:"",e.description=""}catch(e){o.logger.error("Error calling course page method:",e)}finally{n.loading=!1}}))()}getMainComponent(){return(0,i.A)((function*(){const{CoreSitePluginsModuleIndexComponent:e}=yield Promise.all([n.e(98054),n.e(89752),n.e(51024),n.e(71930)]).then(n.bind(n,71930));return e}))()}manualCompletionAlwaysShown(e){var t=this;return(0,i.A)((function*(){var n;return void 0!==t.handlerSchema.manualcompletionalwaysshown?t.handlerSchema.manualcompletionalwaysshown:!(null===(n=t.initResult)||void 0===n||!n.jsResult||!t.initResult.jsResult.manualCompletionAlwaysShown)&&t.initResult.jsResult.manualCompletionAlwaysShown(e)}))()}openActivityPage(e,t,n){return(0,i.A)((function*(){U.CoreCourseModuleHelper.moduleHasView(e)&&((n=n||{}).params=n.params||{},Object.assign(n.params,{title:e.name,module:e}),B.CoreNavigator.navigateToSitePath(`siteplugins/module/${t}/${e.id}`,n))}))()}}var _=n(38911),$=n(44682);class CoreSitePluginsModulePrefetchHandler extends _.CoreCourseActivityPrefetchHandlerBase{constructor(e,t,n,i){if(super(),this.handlerSchema=i,this.component=e,this.name=t,this.modName=n,this.isResource=!!i.isresource,i.updatesnames)try{this.updatesNames=new RegExp(i.updatesnames)}catch(e){}}download(e,t,n){const i=A.CoreSites.getCurrentSiteId();return this.prefetchPackage(e,t,(i=>this.downloadPrefetchPlugin(e,t,!1,n,i)),i)}downloadPrefetchPlugin(e,t,n,r,s){var o=this;return(0,i.A)((function*(){const i=yield A.CoreSites.getSite(s),a={courseid:t,cmid:e.id,userid:i.getUserId()};yield Promise.all([o.downloadOrPrefetchFiles(i.getId(),e,t,n,r),L.CoreSitePlugins.prefetchFunctions(o.component,a,o.handlerSchema,t,e,n,r,i)])}))()}downloadOrPrefetchFiles(e,t,n,r,s){var o=this;return(0,i.A)((function*(){yield o.loadContents(t,n,!0);const i=yield o.getIntroFiles(t,n),a=o.getContentDownloadableFiles(t);s?yield Promise.all([P.CoreFilepool.downloadOrPrefetchFiles(e,i,r,!1,o.component,t.id),P.CoreFilepool.downloadOrPrefetchFiles(e,a,r,!1,o.component,t.id,s)]):yield P.CoreFilepool.downloadOrPrefetchFiles(e,i.concat(a),r,!1,o.component,t.id)}))()}getDownloadSize(){return(0,i.A)((function*(){return{size:-1,total:!1}}))()}invalidateContent(e,t){var n=this;return(0,i.A)((function*(){const i=A.CoreSites.getCurrentSite();if(!i)return;const r=[],s=i.getId(),o={courseid:t,cmid:e,userid:i.getUserId()};r.push(P.CoreFilepool.invalidateFilesByComponent(s,n.component,e)),r.push($.CoreCourse.invalidateModule(e,s));for(const e in n.handlerSchema.offlinefunctions)i.wsAvailable(e)?r.push(i.invalidateWsCacheForKey(L.CoreSitePlugins.getCallWSCacheKey(e,o))):r.push(L.CoreSitePlugins.invalidateContent(n.component,e,o,s));return D.g.allPromises(r)}))()}isEnabled(){return(0,i.A)((function*(){return!0}))()}loadContents(e,t,n){var r=this;return(0,i.A)((function*(){if(r.isResource)return $.CoreCourse.loadModuleContents(e,t,void 0,!1,n)}))()}prefetch(e,t,n,i){return this.prefetchPackage(e,t,(n=>this.downloadPrefetchPlugin(e,t,!0,i,n)))}}var T=n(32016),Q=n(11684);class CoreSitePluginsQuestionBehaviourHandler extends T.o{constructor(e,t,n){super(),this.name=e,this.type=t,this.hasTemplate=n}handleQuestion(){if(this.hasTemplate)return[Q.CoreSitePluginsQuestionBehaviourComponent]}}var V=n(21457);class CoreSitePluginsQuestionHandler extends V.b{constructor(e,t){super(),this.name=e,this.type=t}getComponent(){return(0,i.A)((function*(){const{CoreSitePluginsQuestionComponent:e}=yield n.e(72076).then(n.bind(n,55792));return e}))()}}class CoreSitePluginsQuizAccessRuleHandler{constructor(e,t,n){this.name=e,this.ruleName=t,this.hasTemplate=n}isEnabled(){return(0,i.A)((function*(){return!0}))()}isPreflightCheckRequired(){return this.hasTemplate}getFixedPreflightData(){}getPreflightComponent(){var e=this;return(0,i.A)((function*(){if(!e.hasTemplate)return;const{CoreSitePluginsQuizAccessRuleComponent:t}=yield n.e(72076).then(n.bind(n,96350));return t}))()}notifyPreflightCheckPassed(){}notifyPreflightCheckFailed(){}shouldShowTimeLeft(){return!1}}class CoreSitePluginsSettingsHandler extends CoreSitePluginsBaseHandler{constructor(e,t,n,i,r){super(e),this.title=t,this.plugin=n,this.handlerSchema=i,this.initResult=r,this.priority=i.priority||0}getDisplayData(){var e,t;return{title:this.title,icon:null===(e=this.handlerSchema.displaydata)||void 0===e?void 0:e.icon,class:null===(t=this.handlerSchema.displaydata)||void 0===t?void 0:t.class,page:`siteplugins/content/${this.plugin.component}/${this.handlerSchema.method}/0`,params:{title:this.title,initResult:this.initResult,ptrEnabled:this.handlerSchema.ptrenabled}}}}class CoreSitePluginsUserProfileHandler extends CoreSitePluginsBaseHandler{constructor(e,t,n,i,r){super(e),this.title=t,this.plugin=n,this.handlerSchema=i,this.initResult=r,this.priority=i.priority||0,this.type=i.type&&i.type!==v.CoreUserProfileHandlerType.LIST_ACCOUNT_ITEM?i.type:v.CoreUserProfileHandlerType.LIST_ITEM}isEnabledForContext(e,t){var n=this;return(0,i.A)((function*(){var e;return L.CoreSitePlugins.isHandlerEnabledForCourse(t,n.handlerSchema.restricttoenrolledcourses,null===(e=n.initResult)||void 0===e?void 0:e.restrict)}))()}isEnabledForUser(e){var t=this;return(0,i.A)((function*(){var n;return L.CoreSitePlugins.isHandlerEnabledForUser(e.id,t.handlerSchema.restricttocurrentuser,null===(n=t.initResult)||void 0===n?void 0:n.restrict)}))()}getDisplayData(){var e,t;return{title:this.title,icon:null===(e=this.handlerSchema.displaydata)||void 0===e?void 0:e.icon,class:null===(t=this.handlerSchema.displaydata)||void 0===t?void 0:t.class,action:(e,t,n,i)=>{e.preventDefault(),e.stopPropagation();const r={courseid:i,userid:t.id},s=x.VV.hashAsciiStr(JSON.stringify(r));B.CoreNavigator.navigateToSitePath(`siteplugins/content/${this.plugin.component}/${this.handlerSchema.method}/${s}`,{params:{title:this.title,args:r,initResult:this.initResult,ptrEnabled:this.handlerSchema.ptrenabled,contextLevel:"user",contextInstanceId:t.id}})}}}setInitResult(e){var t;this.initResult=e,null===(t=this.updatingDefer)||void 0===t||t.resolve(),delete this.updatingDefer}updatingInit(){this.updatingDefer=new N._}}class CoreSitePluginsUserProfileFieldHandler extends CoreSitePluginsBaseHandler{constructor(e,t){super(e),this.type=t}getComponent(){return(0,i.A)((function*(){const{CoreSitePluginsUserProfileFieldComponent:e}=yield n.e(72076).then(n.bind(n,44940));return e}))()}getData(e,t,n,r){return(0,i.A)((function*(){const t=`profile_field_${e.shortname}`;return{type:("type"in e?e.type:e.datatype)||"",name:t,value:r[t]}}))()}}var q=n(17847);class CoreSitePluginsMainMenuHomeHandler extends CoreSitePluginsBaseHandler{constructor(e,t,n,i,r){super(e),this.title=t,this.plugin=n,this.handlerSchema=i,this.initResult=r,this.priority=i.priority||0}getDisplayData(){var e;return{title:this.title,class:null===(e=this.handlerSchema.displaydata)||void 0===e?void 0:e.class,page:`siteplugins/homecontent/${this.plugin.component}/${this.handlerSchema.method}`,pageParams:{title:this.title,initResult:this.initResult,ptrEnabled:this.handlerSchema.ptrenabled}}}}var z=n(65964);class CoreSitePluginsWorkshopAssessmentStrategyHandler extends CoreSitePluginsBaseHandler{constructor(e,t){super(e),this.name=e,this.strategyName=t}getComponent(){return(0,i.A)((function*(){const{CoreSitePluginsWorkshopAssessmentStrategyComponent:e}=yield n.e(56232).then(n.bind(n,56232));return e}))()}getOriginalValues(){return(0,i.A)((function*(){return[]}))()}hasDataChanged(){return!1}isEnabled(){return(0,i.A)((function*(){return!0}))()}prepareAssessmentData(){return(0,i.A)((function*(){return{}}))()}}var J=n(30260),W=n(33504),G=n(85720),K=n(58364),Y=n(8014),X=n(8756),Z=n(59656);class CoreSitePluginsEnrolHandler extends CoreSitePluginsBaseHandler{constructor(e,t,n,i,r){super(e),this.type=t,this.enrolmentAction=n,this.handlerSchema=i,this.initResult=r,this.logger=k.CoreLogger.getInstance("CoreSitePluginsEnrolHandler")}getInfoIcons(){var e=this;return(0,i.A)((function*(){var t;return null!==(t=e.handlerSchema.infoIcons)&&void 0!==t?t:[]}))()}invalidate(){return(0,i.A)((function*(){}))()}enrol(){return(0,i.A)((function*(){return!1}))()}canAccess(){return(0,i.A)((function*(){return{canAccess:!1}}))()}validateAccess(){return(0,i.A)((function*(){return!1}))()}}var ee=n(9538),te=n(54438);let ne=(()=>{var e;class CoreSitePluginsInitService{constructor(){this.logger=k.CoreLogger.getInstance("CoreSitePluginsInit"),this.courseRestrictHandlers={}}init(){var e=this;R.z.on(R.z.LOGIN,function(){var t=(0,i.A)((function*(t){try{const n=yield D.g.ignoreErrors(L.CoreSitePlugins.getPlugins(t.siteId));if(t.siteId!==A.CoreSites.getCurrentSiteId()||null==n||!n.length)return;try{yield e.loadSitePlugins(n)}finally{R.z.trigger(R.z.SITE_PLUGINS_LOADED,{},t.siteId)}}catch(t){e.logger.error(t)}finally{L.CoreSitePlugins.setPluginsFetched()}}));return function(e){return t.apply(this,arguments)}}()),R.z.on(ee.CORE_COURSES_MY_COURSES_CHANGED_EVENT,(e=>{e.siteId&&e.siteId===A.CoreSites.getCurrentSiteId()&&e.added.length&&this.reloadCourseRestrictHandlers()}))}downloadStyles(e,t,n,r){return(0,i.A)((function*(){var i,s,o;const a=yield A.CoreSites.getSite(r);let l=null===(i=n.styles)||void 0===i?void 0:i.url;l&&!Y.F.isAbsoluteURL(l)&&(l=X.$.concatenatePaths(a.getURL(),l)),l&&null!==(s=n.styles)&&void 0!==s&&s.version&&(l+=`${-1!=l.indexOf("?")?"&":"?"}version=${n.styles.version}`);const d=`${L.CoreSitePlugins.getHandlerUniqueName(e,t)}#main`,u=yield D.g.ignoreErrors(P.CoreFilepool.getFilesByComponent(a.getId(),O.$k,d));if(null==u||u.forEach((e=>{e.url!==l&&D.g.ignoreErrors(P.CoreFilepool.removeFileByUrl(a.getId(),e.url))})),!l)return"";n.styles&&(n.styles.url=l);const c=yield P.CoreFilepool.downloadUrl(a.getId(),l,!1,O.$k,d,0,void 0,void 0,void 0,null===(o=n.styles)||void 0===o?void 0:o.version);return I.CoreWS.getText(c)}))()}executeHandlerInit(e,t){var n=this;return(0,i.A)((function*(){return t.init?n.executeMethodAndJS(e,t.init,!0):null}))()}executeMethodAndJS(e,t,n){return(0,i.A)((function*(){const i=A.CoreSites.getCurrentSiteId(),r={getFromCache:!1,deleteCacheIfWSError:n},s=yield L.CoreSitePlugins.getContent(e.component,t,{},r);if(!s.javascript||A.CoreSites.getCurrentSiteId()!=i)return s;const o={HANDLER_DISABLED:CoreSitePluginsInitService.HANDLER_DISABLED};yield u.V.loadLibraries(),u.V.injectLibraries(o);const a=L.CoreSitePlugins.createDataForJS(s);for(const e in a)o[e]=a[e];return s.jsResult=u.V.executeJavascript(o,s.javascript),s.jsResult===CoreSitePluginsInitService.HANDLER_DISABLED&&(s.disabled=!0),s}))()}getPrefixForStrings(e){return e?`plugin.${e}.`:""}getPrefixedString(e,t="pluginname"){return this.getPrefixForStrings(e)+t}loadLangStrings(e){if(e.parsedLang)for(const t in e.parsedLang){const n=this.getPrefixForStrings(e.addon);H.CoreLang.addSitePluginsStrings(t,e.parsedLang[t],n)}}loadSitePlugin(e){var t=this;return(0,i.A)((function*(){if(t.logger.debug("Load site plugin:",e),!e.parsedHandlers&&e.handlers&&(e.parsedHandlers=b.Ni.parseJSON(e.handlers,null,(e=>t.logger.error("Error parsing site plugin handlers",e)))),!e.parsedLang&&e.lang&&(e.parsedLang=b.Ni.parseJSON(e.lang,null,(e=>t.logger.error("Error parsing site plugin lang",e)))),L.CoreSitePlugins.setPluginsLoaded(!0),t.loadLangStrings(e),e.parsedHandlers){const n=e.parsedHandlers;yield D.g.allPromises(Object.keys(n).map(function(){var r=(0,i.A)((function*(i){yield t.registerHandler(e,i,n[i])}));return function(e){return r.apply(this,arguments)}}()))}}))()}loadSitePlugins(e){var t=this;return(0,i.A)((function*(){t.courseRestrictHandlers={},yield D.g.allPromises(e.map(function(){var e=(0,i.A)((function*(e){const n=t.loadSitePlugin(e);L.CoreSitePlugins.registerSitePluginPromise(e.component,n),yield n}));return function(t){return e.apply(this,arguments)}}()))}))()}loadStyles(e,t,n,i,r,s){s=s||A.CoreSites.getCurrentSiteId();const o=document.createElement("style"),a=L.CoreSitePlugins.getHandlerUniqueName(e,t);o.setAttribute("id",`siteplugin-${a}`),o.innerHTML=i;let l=null;Array.from(document.head.querySelectorAll("style")).forEach((e=>{/^siteplugin-/.test(e.id)&&e.id>o.id&&(null===l||e.id<l.id)&&(l=e)})),l?document.head.insertBefore(o,l):document.head.appendChild(o),D.g.ignoreErrors(P.CoreFilepool.treatCSSCode(s,n,i,O.$k,a,r))}registerHandler(e,t,n){var r=this;return(0,i.A)((function*(){const i=A.CoreSites.getCurrentSiteId();try{var s;const[o,a]=yield Promise.all([r.executeHandlerInit(e,n),r.downloadStyles(e,t,n,i).catch((e=>{r.logger.error("Error getting styles for plugin",t,n,e)}))]);if(null!=o&&o.disabled)return r.logger.warn("Handler disabled by init function",e,n),void 0;let l;switch(a&&null!==(s=n.styles)&&void 0!==s&&s.url&&r.loadStyles(e,t,n.styles.url,a,n.styles.version,i),n.delegate){case"CoreMainMenuDelegate":l=r.registerMainMenuHandler(e,t,n,o);break;case"CoreCourseModuleDelegate":l=r.registerModuleHandler(e,t,n,o);break;case"CoreUserDelegate":l=r.registerUserProfileHandler(e,t,n,o);break;case"CoreCourseOptionsDelegate":l=r.registerCourseOptionHandler(e,t,n,o);break;case"CoreCourseFormatDelegate":l=r.registerCourseFormatHandler(e,t,n);break;case"CoreUserProfileFieldDelegate":l=yield r.registerUserProfileFieldHandler(e,t,n);break;case"CoreSettingsDelegate":l=r.registerSettingsHandler(e,t,n,o);break;case"CoreQuestionDelegate":l=yield r.registerQuestionHandler(e,t,n);break;case"CoreQuestionBehaviourDelegate":l=yield r.registerQuestionBehaviourHandler(e,t,n);break;case"CoreBlockDelegate":l=r.registerBlockHandler(e,t,n,o);break;case"AddonMessageOutputDelegate":l=r.registerMessageOutputHandler(e,t,n,o);break;case"AddonModQuizAccessRuleDelegate":l=yield r.registerQuizAccessRuleHandler(e,t,n);break;case"AddonModAssignFeedbackDelegate":l=yield r.registerAssignFeedbackHandler(e,t,n);break;case"AddonModAssignSubmissionDelegate":l=yield r.registerAssignSubmissionHandler(e,t,n);break;case"AddonWorkshopAssessmentStrategyDelegate":l=yield r.registerWorkshopAssessmentStrategyHandler(e,t,n);break;case"CoreMainMenuHomeDelegate":l=r.registerMainMenuHomeHandler(e,t,n,o);break;case"CoreEnrolDelegate":l=yield r.registerEnrolHandler(e,t,n,o)}l&&L.CoreSitePlugins.setSitePluginHandler(l,{plugin:e,handlerName:t,handlerSchema:n,initResult:o})}catch(e){throw new l.CoreError(`Error executing init method ${n.init}: ${e.message}`)}}))()}registerComponentInitHandler(e,t,n,r,s){var o=this;return(0,i.A)((function*(){if(!n.method)return o.logger.warn("Ignore site plugin because it doesn't provide method",e,n),void 0;o.logger.debug("Register site plugin",e,n);try{const i=yield o.executeMethodAndJS(e,n.method),a=L.CoreSitePlugins.getHandlerUniqueName(e,t),l=s(a,i);if(n.methodTemplates=i.templates,n.methodJSResult=i.jsResult,n.methodOtherdata=i.otherdata,i.jsResult){const e=i.jsResult,t=K.T.getAllPropertyNames(l);for(const n of t)"constructor"!==n&&"function"==typeof l[n]&&"function"==typeof e[n]&&(l[n]=e[n].bind(l))}return r.registerHandler(l),a}catch(t){o.logger.error("Error executing main method",e.component,n.method,t)}}))()}registerAssignFeedbackHandler(e,t,n){return this.registerComponentInitHandler(e,t,n,s.AddonModAssignFeedbackDelegate.instance,(t=>{const i=(n.moodlecomponent||e.component).replace("assignfeedback_",""),r=this.getPrefixForStrings(e.addon);return new CoreSitePluginsAssignFeedbackHandler(t,i,r)}))}registerAssignSubmissionHandler(e,t,n){return this.registerComponentInitHandler(e,t,n,o.AddonModAssignSubmissionDelegate.instance,(t=>{const i=(n.moodlecomponent||e.component).replace("assignsubmission_",""),r=this.getPrefixForStrings(e.addon);return new CoreSitePluginsAssignSubmissionHandler(t,i,r)}))}registerBlockHandler(e,t,n,i){var r;const s=L.CoreSitePlugins.getHandlerUniqueName(e,t),o=(n.moodlecomponent||e.component).replace("block_",""),a=null===(r=n.displaydata)||void 0===r?void 0:r.title,l=this.getPrefixedString(e.addon,a);return d.CoreBlockDelegate.registerHandler(new CoreSitePluginsBlockHandler(s,l,o,n,i)),s}registerCourseFormatHandler(e,t,n){this.logger.debug("Register site plugin in course format delegate:",e,n);const i=L.CoreSitePlugins.getHandlerUniqueName(e,t),r=(n.moodlecomponent||e.component).replace("format_","");return g.CoreCourseFormatDelegate.registerHandler(new CoreSitePluginsCourseFormatHandler(i,r,n)),i}registerCourseOptionHandler(e,t,n,i){var r;if(!n.displaydata)return this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n),void 0;this.logger.debug("Register site plugin in course option delegate:",e,n,i);const s=L.CoreSitePlugins.getHandlerUniqueName(e,t),o=this.getPrefixedString(e.addon,n.displaydata.title),a=new CoreSitePluginsCourseOptionHandler(s,o,e,n,i);return c.CoreCourseOptionsDelegate.registerHandler(a),null!=i&&null!==(r=i.restrict)&&void 0!==r&&r.courses&&(this.courseRestrictHandlers[s]={plugin:e,handlerName:t,handlerSchema:n,handler:a}),s}registerEnrolHandler(e,t,n,r){var s=this;return(0,i.A)((function*(){var i;const o=L.CoreSitePlugins.getHandlerUniqueName(e,t),a=(n.moodlecomponent||e.component).replace("enrol_",""),l=null!==(i=n.enrolmentAction)&&void 0!==i?i:Z.CoreEnrolAction.BROWSER,d=new CoreSitePluginsEnrolHandler(o,a,l,n,r);if(!n.method&&(l===Z.CoreEnrolAction.SELF||l===Z.CoreEnrolAction.GUEST))return s.logger.error('"self" or "guest" enrol plugins must implement a method to override the required JS functions.'),void 0;if(n.method){var u,c,g;const t=yield s.executeMethodAndJS(e,n.method);if(l===Z.CoreEnrolAction.SELF&&(null===(u=t.jsResult)||void 0===u||!u.enrol))return s.logger.error('"self" enrol plugins must implement an "enrol" function in the JS returned by the method.'),void 0;if(!(l!==Z.CoreEnrolAction.GUEST||null!==(c=t.jsResult)&&void 0!==c&&c.canAccess&&null!==(g=t.jsResult)&&void 0!==g&&g.validateAccess))return s.logger.error('"guest" enrol plugins must implement "canAccess" and "validateAccess" functions in the JS returned by the method.'),void 0;if(t.jsResult){const e=t.jsResult,n=K.T.getAllPropertyNames(d);for(const t of n)"constructor"!==t&&"function"==typeof d[t]&&"function"==typeof e[t]&&(d[t]=e[t].bind(d))}}return Z.CoreEnrolDelegate.registerHandler(d),o}))()}registerMainMenuHandler(e,t,n,i){if(!n.displaydata)return this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n),void 0;this.logger.debug("Register site plugin in main menu delegate:",e,n,i);const r=L.CoreSitePlugins.getHandlerUniqueName(e,t),s=this.getPrefixedString(e.addon,n.displaydata.title);return m.CoreMainMenuDelegate.registerHandler(new CoreSitePluginsMainMenuHandler(r,s,e,n,i)),r}registerMessageOutputHandler(e,t,n,i){if(!n.displaydata)return this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n),void 0;this.logger.debug("Register site plugin in message output delegate:",e,n,i);const s=L.CoreSitePlugins.getHandlerUniqueName(e,t),o=this.getPrefixedString(e.addon,n.displaydata.title),a=(n.moodlecomponent||e.component).replace("message_","");return r.AddonMessageOutputDelegate.registerHandler(new CoreSitePluginsMessageOutputHandler(s,a,o,e,n,i)),s}registerModuleHandler(e,t,n,i){if(!n.displaydata)return this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n),void 0;this.logger.debug("Register site plugin in module delegate:",e,n,i);const r=L.CoreSitePlugins.getHandlerUniqueName(e,t),s=(n.moodlecomponent||e.component).replace("mod_",""),o=new CoreSitePluginsModuleHandler(r,s,e,n,i);if(h.CoreCourseModuleDelegate.registerHandler(o),L.CoreSitePlugins.setModuleHandlerInstance(s,o),n.offlinefunctions&&Object.keys(n.offlinefunctions).length&&p.CoreCourseModulePrefetchDelegate.registerHandler(new CoreSitePluginsModulePrefetchHandler(e.component,r,s,n)),!o.supportsNoViewLink()&&n.method&&!n.nolinkhandlers){const e=new J.CoreContentLinksModuleIndexHandler(r,s);e.name=`${r}_indexlink`,e.priority=-1,W.CoreContentLinksDelegate.registerHandler(e);const t=new G.S(r,s);t.name=`${r}_listlink`,t.priority=-1,W.CoreContentLinksDelegate.registerHandler(t)}return r}registerQuestionHandler(e,t,n){const i=n.moodlecomponent||e.component;return this.registerComponentInitHandler(e,t,n,S.CoreQuestionDelegate.instance,(e=>new CoreSitePluginsQuestionHandler(e,i)))}registerQuestionBehaviourHandler(e,t,n){return this.registerComponentInitHandler(e,t,n,C.CoreQuestionBehaviourDelegate.instance,((t,i)=>{const r=(n.moodlecomponent||e.component).replace("qbehaviour_","");return new CoreSitePluginsQuestionBehaviourHandler(t,r,!!i.templates.length)}))}registerQuizAccessRuleHandler(e,t,n){const i=n.moodlecomponent||e.component;return this.registerComponentInitHandler(e,t,n,a.AddonModQuizAccessRuleDelegate.instance,((e,t)=>new CoreSitePluginsQuizAccessRuleHandler(e,i,!!t.templates.length)))}registerSettingsHandler(e,t,n,i){if(!n.displaydata)return this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n),void 0;this.logger.debug("Register site plugin in settings delegate:",e,n,i);const r=L.CoreSitePlugins.getHandlerUniqueName(e,t),s=this.getPrefixedString(e.addon,n.displaydata.title);return f.CoreSettingsDelegate.registerHandler(new CoreSitePluginsSettingsHandler(r,s,e,n,i)),r}registerUserProfileHandler(e,t,n,i){if(!n.displaydata)return this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n),void 0;this.logger.debug("Register site plugin in user profile delegate:",e,n,i);const r=L.CoreSitePlugins.getHandlerUniqueName(e,t),s=this.getPrefixedString(e.addon,n.displaydata.title),o=new CoreSitePluginsUserProfileHandler(r,s,e,n,i);return v.CoreUserDelegate.registerHandler(o),i&&i.restrict&&i.restrict.courses&&(this.courseRestrictHandlers[r]={plugin:e,handlerName:t,handlerSchema:n,handler:o}),r}registerUserProfileFieldHandler(e,t,n){return this.registerComponentInitHandler(e,t,n,y.CoreUserProfileFieldDelegate.instance,(t=>{const i=(n.moodlecomponent||e.component).replace("profilefield_","");return new CoreSitePluginsUserProfileFieldHandler(t,i)}))}registerWorkshopAssessmentStrategyHandler(e,t,n){return this.registerComponentInitHandler(e,t,n,z.AddonWorkshopAssessmentStrategyDelegate.instance,(t=>{const i=(n.moodlecomponent||e.component).replace("workshopform_","");return new CoreSitePluginsWorkshopAssessmentStrategyHandler(t,i)}))}reloadCourseRestrictHandlers(){var e=this;return(0,i.A)((function*(){Object.keys(e.courseRestrictHandlers).length&&(yield Promise.all(Object.keys(e.courseRestrictHandlers).map(function(){var t=(0,i.A)((function*(t){const n=e.courseRestrictHandlers[t];if(n.handler&&n.handler.setInitResult){n.handler.updatingInit&&n.handler.updatingInit();try{const t=yield e.executeHandlerInit(n.plugin,n.handlerSchema);n.handler.setInitResult(t)}catch(t){e.logger.error("Error reloading course restrict handler",t,n.plugin)}}}));return function(e){return t.apply(this,arguments)}}())),R.z.trigger(R.z.SITE_PLUGINS_COURSE_RESTRICT_UPDATED,{}))}))()}registerMainMenuHomeHandler(e,t,n,i){if(!n.displaydata)return this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n),void 0;this.logger.debug("Register site plugin in main menu home delegate:",e,n,i);const r=L.CoreSitePlugins.getHandlerUniqueName(e,t),s=this.getPrefixedString(e.addon,n.displaydata.title);return q.CoreMainMenuHomeDelegate.registerHandler(new CoreSitePluginsMainMenuHomeHandler(r,s,e,n,i)),r}}return(e=CoreSitePluginsInitService).HANDLER_DISABLED="core_site_plugins_helper_handler_disabled",e.ɵfac=function CoreSitePluginsInitService_Factory(t){return new(t||e)},e.ɵprov=te.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),CoreSitePluginsInitService})();const ie=(0,E.Qd)(ne)}}]);