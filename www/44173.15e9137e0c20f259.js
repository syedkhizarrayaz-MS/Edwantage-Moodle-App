"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[44173],{98587:(e,t,n)=>{n.r(t),n.d(t,{default:()=>B});var a=n(10467),r=n(94455),o=n(49882),i=n(52749),s=n(24742),d=n(8224),l=n(57186),c=n(68581),u=n(13462),m=n(66110),g=n(83219),h=n(94339),v=n(79555),_=n(15324),f=n(24502),p=n(74431),y=n(47514),I=n(55306),C=n(94398),S=n(83696),b=n(90137),A=n(22693),P=n(8014),E=n(93589),D=n(99234),O=n(58364),M=n(25572),T=n(86654),R=n(54438),k=n(60177),w=n(2910),x=n(69502),$=n(17388),N=n(16986),F=n(64422),G=n(32572),j=n(19858),J=n(86198),L=n(58197),Y=n(88246),U=n(43570),z=n(73955);const _c0=e=>({$a:e}),_c1=e=>[e];function AddonCalendarDayPage_core_context_menu_item_14_Template(e,t){if(1&e){const e=R.RV6();R.j41(0,"core-context-menu-item",20),R.nI1(1,"translate"),R.bIt("action",(function AddonCalendarDayPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){R.eBV(e);const t=R.XpG();return R.Njj(t.goToCurrentDay())})),R.k0s()}2&e&&R.Y8G("priority",900)("content",R.bMT(1,2,"addon.calendar.today"))}function AddonCalendarDayPage_ng_template_37_ion_card_1_Template(e,t){1&e&&(R.j41(0,"ion-card",24)(1,"ion-item"),R.nrm(2,"ion-icon",25),R.j41(3,"ion-label"),R.EFF(4),R.nI1(5,"translate"),R.nI1(6,"translate"),R.k0s()()()),2&e&&(R.R7$(4),R.JRh(R.i5U(6,3,"core.hasdatatosync",R.eq3(6,_c0,R.bMT(5,1,"core.day")))))}function AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template(e,t){1&e&&(R.nrm(0,"core-empty-box",26),R.nI1(1,"translate")),2&e&&R.Y8G("message",R.bMT(1,1,"addon.calendar.noevents"))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template(e,t){if(1&e&&R.nrm(0,"core-mod-icon",38),2&e){const e=R.XpG().$implicit;R.Y8G("modicon",e.moduleIcon)("showAlt",!1)("modname",e.modulename)("componentId",e.instance)("purpose",e.purpose)("isBranded",e.branded)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template(e,t){if(1&e&&R.nrm(0,"ion-icon",39),2&e){const e=R.XpG().$implicit;R.Y8G("name",e.eventIcon)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template(e,t){if(1&e&&(R.j41(0,"span",32),R.EFF(1),R.k0s()),2&e){const e=R.XpG().$implicit;R.R7$(),R.JRh(e.iconTitle)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template(e,t){1&e&&(R.j41(0,"ion-note",2),R.nrm(1,"ion-icon",40),R.j41(2,"span",41),R.EFF(3),R.nI1(4,"translate"),R.k0s()()),2&e&&(R.R7$(3),R.JRh(R.bMT(4,1,"core.notsent")))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_15_Template(e,t){1&e&&(R.j41(0,"ion-note",2),R.nrm(1,"ion-icon",42),R.j41(2,"span",41),R.EFF(3),R.nI1(4,"translate"),R.k0s()()),2&e&&(R.R7$(3),R.JRh(R.bMT(4,1,"core.deletedoffline")))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template(e,t){if(1&e){const e=R.RV6();R.qex(0),R.j41(1,"ion-card")(2,"ion-item",29),R.bIt("click",(function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template_ion_item_click_2_listener(){const t=R.eBV(e).$implicit,n=R.XpG(2).item,a=R.XpG();return R.Njj(a.gotoEvent(t.id,n))})),R.DNE(3,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template,1,6,"core-mod-icon",30)(4,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template,1,1,"ion-icon",31),R.j41(5,"ion-label")(6,"span",32),R.EFF(7),R.nI1(8,"translate"),R.DNE(9,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template,2,1,"span",33),R.k0s(),R.j41(10,"p",34),R.nrm(11,"core-format-text",35),R.k0s(),R.j41(12,"p"),R.nrm(13,"core-format-text",36),R.k0s()(),R.DNE(14,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template,5,3,"ion-note",37)(15,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_15_Template,5,3,"ion-note",37),R.k0s()(),R.bVm()}if(2&e){const e=t.$implicit;R.R7$(2),R.AVh("item-dimmed",e.ispast),R.Y8G("ngClass",R.eq3(19,_c1,"addon-calendar-eventtype-"+e.eventtype))("detail",!1),R.BMQ("aria-label",e.name),R.R7$(),R.Y8G("ngIf",e.moduleIcon),R.R7$(),R.Y8G("ngIf",e.eventIcon&&!e.moduleIcon),R.R7$(3),R.SpI(" ",R.bMT(8,17,"addon.calendar.type"+e.formattedType)," "),R.R7$(2),R.Y8G("ngIf",e.moduleIcon&&e.iconTitle),R.R7$(2),R.Y8G("text",e.name)("contextLevel",e.contextLevel)("contextInstanceId",e.contextInstanceId)("sanitize",e.offline),R.R7$(2),R.Y8G("text",e.formattedtime)("filter",!1),R.R7$(),R.Y8G("ngIf",e.offline&&!e.deleted),R.R7$(),R.Y8G("ngIf",e.deleted)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_Template(e,t){if(1&e&&(R.j41(0,"ion-list",27),R.DNE(1,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template,16,21,"ng-container",28),R.k0s()),2&e){const e=R.XpG().item;R.R7$(),R.Y8G("ngForOf",e.filteredEvents)}}function AddonCalendarDayPage_ng_template_37_Template(e,t){if(1&e&&(R.j41(0,"core-loading",9),R.DNE(1,AddonCalendarDayPage_ng_template_37_ion_card_1_Template,7,8,"ion-card",21)(2,AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template,2,3,"core-empty-box",22)(3,AddonCalendarDayPage_ng_template_37_ion_list_3_Template,2,1,"ion-list",23),R.k0s()),2&e){const e=t.item;R.Y8G("hideUntil",e.loaded),R.R7$(),R.Y8G("ngIf",e.hasOffline),R.R7$(),R.Y8G("ngIf",!e.filteredEvents||!e.filteredEvents.length),R.R7$(),R.Y8G("ngIf",e.filteredEvents&&e.filteredEvents.length)}}function AddonCalendarDayPage_ion_fab_38_Template(e,t){if(1&e){const e=R.RV6();R.j41(0,"ion-fab",43)(1,"ion-fab-button",44),R.nI1(2,"translate"),R.bIt("click",(function AddonCalendarDayPage_ion_fab_38_Template_ion_fab_button_click_1_listener(){R.eBV(e);const t=R.XpG();return R.Njj(t.openEdit())})),R.nrm(3,"ion-icon",45),R.j41(4,"span",32),R.EFF(5),R.nI1(6,"translate"),R.k0s()()()}2&e&&(R.R7$(),R.BMQ("aria-label",R.bMT(2,2,"addon.calendar.newevent")),R.R7$(4),R.JRh(R.bMT(6,4,"addon.calendar.newevent")))}let B=(()=>{var e;class AddonCalendarDayPage{constructor(){var e=this;this.eventObservers=[],this.loaded=!1,this.isOnline=!1,this.syncIcon=p.CoreConstants.ICON_LOADING,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=i.CoreSites.getCurrentSiteId(),this.eventObservers.push(o.z.on(D.zl,(e=>{var t;e&&e.eventId&&(null===(t=this.manager)||void 0===t||t.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId)),this.eventObservers.push(o.z.on(D.D1,(()=>{var e;null===(e=this.manager)||void 0===e||e.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0)}),this.currentSiteId)),this.eventObservers.push(o.z.on(D.bp,(e=>{var t;e&&e.eventId&&(null===(t=this.manager)||void 0===t||t.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId)),this.eventObservers.push(o.z.on(D.FK,(()=>{var e;null===(e=this.manager)||void 0===e||e.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0)}),this.currentSiteId)),this.eventObservers.push(o.z.on(D.y$,(e=>{var t;const n=null===(t=this.manager)||void 0===t?void 0:t.getSelectedItem();var a;!e||"day"==e.source&&n&&e.dayJS&&n.dayJS.isSame(e.dayJS,"day")||(null===(a=this.manager)||void 0===a||a.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId)),this.eventObservers.push(o.z.on(D.Mq,(e=>{var t,n;e&&!e.sent?null===(t=this.manager)||void 0===t||t.getSource().markAsDeleted(e.eventId,!0):(null===(n=this.manager)||void 0===n||n.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId)),this.eventObservers.push(o.z.on(D.hZ,(e=>{var t;e&&e.eventId&&(null===(t=this.manager)||void 0===t||t.getSource().markAsDeleted(e.eventId,!1))}),this.currentSiteId)),this.eventObservers.push(o.z.on(D.Jj,function(){var t=(0,a.A)((function*(t){var n,a;e.filter=t,yield null===(n=e.manager)||void 0===n?void 0:n.getSource().loadCanCreate(e.filter.courseId),null===(a=e.manager)||void 0===a||a.getSource().filterAllDayEvents(e.filter)}));return function(e){return t.apply(this,arguments)}}())),this.onlineObserver=r.WE.onChange().subscribe((()=>{v.SK.run((()=>{this.isOnline=r.WE.isOnline()}))})),this.logView=s.j.once((()=>{var e;const t=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();if(!t)return;const n={course:this.filter.courseId,time:t.dayJS.unix()};A.OF.logEvent({type:A.qr.VIEW_ITEM_LIST,ws:"core_calendar_get_calendar_day_view",name:v.HT.instant("addon.calendar.dayviewtitle",{$a:this.periodName}),data:{...n,category:"calendar"},url:P.F.addParamsToUrl("/calendar/view.php?view=day",n)})}))}ngOnInit(){const e=[];O.T.enumKeys(D.rz).forEach((t=>{var n;const a=D.rz[t];this.filter[t]=null===(n=_.CoreNavigator.getRouteBooleanParam(t))||void 0===n||n,e.push(a)})),this.filter.courseId=_.CoreNavigator.getRouteNumberParam("courseId"),this.filter.categoryId=_.CoreNavigator.getRouteNumberParam("categoryId"),this.filter.filtered=void 0!==this.filter.courseId||e.some((e=>!this.filter[e]));const t=_.CoreNavigator.getRouteNumberParam("month"),n=new AddonCalendarDaySlidesItemsManagerSource(this,(0,h.yf)({year:_.CoreNavigator.getRouteNumberParam("year"),month:t?t-1:void 0,date:_.CoreNavigator.getRouteNumberParam("day")}).startOf("day"));this.manager=new y.E(n),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onDayViewed(e)}}),this.fetchData(!0)}get canCreate(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().canCreate)||!1}get timeFormat(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().timeFormat)||"core.strftimetime"}fetchData(e){var t=this;return(0,a.A)((function*(){t.syncIcon=p.CoreConstants.ICON_LOADING,t.isOnline=r.WE.isOnline(),e&&(yield t.sync());try{var n,a,o;yield null===(n=t.manager)||void 0===n?void 0:n.getSource().fetchData(t.filter.courseId),yield null===(a=t.manager)||void 0===a?void 0:a.getSource().load(null===(o=t.manager)||void 0===o?void 0:o.getSelectedItem()),t.logView()}catch(e){M.CoreAlerts.showError(e,{default:v.HT.instant("addon.calendar.errorloadevents")})}t.loaded=!0,t.syncIcon=p.CoreConstants.ICON_SYNC}))()}onDayViewed(e){this.periodName=s.j.userDate(e.dayJS.valueOf(),"core.strftimedaydate")}doRefresh(e,t){var n=this;return(0,a.A)((function*(){n.loaded&&(yield n.refreshData(!0).finally((()=>{null==e||e.complete(),t&&t()})))}))()}refreshData(e,t){var n=this;return(0,a.A)((function*(){var a,r;n.syncIcon=p.CoreConstants.ICON_LOADING;const o=(null===(a=n.manager)||void 0===a?void 0:a.getSelectedItem())||null;yield null===(r=n.manager)||void 0===r?void 0:r.getSource().invalidateContent(o,!t),yield n.fetchData(e)}))()}sync(e){var t=this;return(0,a.A)((function*(){try{const e=yield u.AddonCalendarSync.syncEvents();if(e.warnings&&e.warnings.length&&M.CoreAlerts.show({message:e.warnings[0]}),e.updated){var n,a;const r=null===(n=t.manager)||void 0===n?void 0:n.getSelectedItem();e.source="day",e.dayJS=null==r?void 0:r.dayJS,null===(a=t.manager)||void 0===a||a.getSource().markAllItemsUnloaded(),o.z.trigger(D.y$,e,t.currentSiteId)}}catch(t){e&&M.CoreAlerts.showError(t,{default:v.HT.instant("core.errorsync")})}}))()}selectedDayIsCurrent(){var e;return!(null===(e=this.manager)||void 0===e||null===(e=e.getSelectedItem())||void 0===e||!e.isCurrentDay)}gotoEvent(e,t){_.CoreNavigator.navigateToSitePath(`/calendar/event/${e}`,{params:{date:t.dayJS.format("MMDDY")}})}openFilter(){var e=this;return(0,a.A)((function*(){var t;const{AddonCalendarFilterComponent:a}=yield n.e(45393).then(n.bind(n,45393));yield E.I.openSideModal({component:a,componentProps:{courses:null===(t=e.manager)||void 0===t?void 0:t.getSource().courses,filter:e.filter}})}))()}openEdit(e){const t={};if(!e){var n;e=0;const a=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();if(a){const e=(0,h.yf)();t.timestamp=a.dayJS.set({hour:e.hour(),minute:e.minute()}).valueOf()}}this.filter.courseId&&(t.courseId=this.filter.courseId),_.CoreNavigator.navigateToSitePath(`/calendar/edit/${e}`,{params:t})}selectedDayHasOffline(){var e;const t=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();return!(null==t||!t.hasOffline)}goToCurrentDay(){var e=this;return(0,a.A)((function*(){const t=e.manager;if(!t||!e.swipeSlidesComponent)return;const n={dayJS:(0,h.yf)()};e.loaded=!1;try{yield t.getSource().loadItem(n),e.swipeSlidesComponent.slideToItem(n)}catch(e){M.CoreAlerts.showError(e,{default:v.HT.instant("addon.calendar.errorloadevents")})}finally{e.loaded=!0}}))()}loadNext(){var e=this;return(0,a.A)((function*(){var t;null===(t=e.swipeSlidesComponent)||void 0===t||t.slideNext()}))()}loadPrevious(){var e=this;return(0,a.A)((function*(){var t;null===(t=e.swipeSlidesComponent)||void 0===t||t.slidePrev()}))()}ngOnDestroy(){var e,t,n,a;this.eventObservers.forEach((e=>e.off())),null===(e=this.onlineObserver)||void 0===e||e.unsubscribe(),null===(t=this.manager)||void 0===t||t.getSource().forgetRelatedSources(),null===(n=this.manager)||void 0===n||n.destroy(),null===(a=this.managerUnsubscribe)||void 0===a||a.call(this),delete this.manager}}return(e=AddonCalendarDayPage).ɵfac=function AddonCalendarDayPage_Factory(t){return new(t||e)},e.ɵcmp=R.VBU({type:e,selectors:[["page-addon-calendar-day"]],viewQuery:function AddonCalendarDayPage_Query(e,t){if(1&e&&R.GBs(I.N,5),2&e){let e;R.mGM(e=R.lsd())&&(t.swipeSlidesComponent=e.first)}},standalone:!0,features:[R.aNF],decls:39,vars:31,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-calendar-day",3,"priority","content","action",4,"ngIf"],[3,"action","hidden","priority","content","iconAction","closeOnClick"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[1,"core-swipe-slides-container"],[1,"ion-no-padding","safe-area-padding"],[1,"ion-align-items-center"],[1,"ion-text-start"],["name","fas-chevron-left","slot","icon-only","aria-hidden","true"],[1,"ion-text-center","addon-calendar-period"],[1,"ion-text-end"],["name","fas-chevron-right","slot","icon-only","aria-hidden","true"],[3,"manager"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["iconAction","fas-calendar-day",3,"action","priority","content"],["class","core-warning-card list-item-limited-width",4,"ngIf"],["icon","fas-calendar",3,"message",4,"ngIf"],["class","list-item-limited-width",4,"ngIf"],[1,"core-warning-card","list-item-limited-width"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["icon","fas-calendar",3,"message"],[1,"list-item-limited-width"],[4,"ngFor","ngForOf"],["button","",1,"addon-calendar-event","ion-text-wrap",3,"click","ngClass","detail"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose","isBranded",4,"ngIf"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],[1,"item-heading"],[3,"text","contextLevel","contextInstanceId","sanitize"],[3,"text","filter"],["slot","end",4,"ngIf"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose","isBranded"],["slot","start","aria-hidden","true",3,"name"],["name","fas-clock","aria-hidden","true"],[1,"ion-text-wrap"],["name","fas-trash","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"]],template:function AddonCalendarDayPage_Template(e,t){1&e&&(R.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),R.nrm(3,"ion-back-button",1),R.nI1(4,"translate"),R.k0s(),R.j41(5,"ion-title")(6,"h1"),R.EFF(7),R.nI1(8,"translate"),R.k0s()(),R.j41(9,"ion-buttons",2)(10,"ion-button",3),R.nI1(11,"translate"),R.bIt("click",(function AddonCalendarDayPage_Template_ion_button_click_10_listener(){return t.openFilter()})),R.nrm(12,"ion-icon",4),R.k0s(),R.j41(13,"core-context-menu"),R.DNE(14,AddonCalendarDayPage_core_context_menu_item_14_Template,2,4,"core-context-menu-item",5),R.j41(15,"core-context-menu-item",6),R.nI1(16,"translate"),R.bIt("action",(function AddonCalendarDayPage_Template_core_context_menu_item_action_15_listener(e){return t.doRefresh(void 0,e)})),R.k0s()()()()(),R.j41(17,"ion-content")(18,"ion-refresher",7),R.bIt("ionRefresh",(function AddonCalendarDayPage_Template_ion_refresher_ionRefresh_18_listener(e){return t.doRefresh(e.target)})),R.nrm(19,"ion-refresher-content",8),R.nI1(20,"translate"),R.k0s(),R.j41(21,"core-loading",9)(22,"div",10)(23,"ion-grid",11)(24,"ion-row",12)(25,"ion-col",13)(26,"ion-button",3),R.nI1(27,"translate"),R.bIt("click",(function AddonCalendarDayPage_Template_ion_button_click_26_listener(){return t.loadPrevious()})),R.nrm(28,"ion-icon",14),R.k0s()(),R.j41(29,"ion-col",15)(30,"h2"),R.EFF(31),R.k0s()(),R.j41(32,"ion-col",16)(33,"ion-button",3),R.nI1(34,"translate"),R.bIt("click",(function AddonCalendarDayPage_Template_ion_button_click_33_listener(){return t.loadNext()})),R.nrm(35,"ion-icon",17),R.k0s()()()(),R.j41(36,"core-swipe-slides",18),R.DNE(37,AddonCalendarDayPage_ng_template_37_Template,4,4,"ng-template"),R.k0s()()(),R.DNE(38,AddonCalendarDayPage_ion_fab_38_Template,7,6,"ion-fab",19),R.k0s()),2&e&&(R.R7$(3),R.Y8G("text",R.bMT(4,17,"core.back")),R.R7$(4),R.JRh(R.bMT(8,19,"addon.calendar.calendarevents")),R.R7$(3),R.Y8G("ariaLabel",R.bMT(11,21,"core.filter")),R.R7$(4),R.Y8G("ngIf",!t.selectedDayIsCurrent()),R.R7$(),R.Y8G("hidden",!t.loaded||!t.selectedDayHasOffline()||!t.isOnline)("priority",400)("content",R.bMT(16,23,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),R.R7$(3),R.Y8G("disabled",!t.loaded),R.R7$(),R.FS9("pullingText",R.bMT(20,25,"core.pulltorefresh")),R.R7$(2),R.Y8G("hideUntil",t.loaded),R.R7$(5),R.Y8G("ariaLabel",R.bMT(27,27,"addon.calendar.dayprev")),R.R7$(5),R.JRh(t.periodName),R.R7$(2),R.Y8G("ariaLabel",R.bMT(34,29,"addon.calendar.daynext")),R.R7$(3),R.Y8G("manager",t.manager),R.R7$(2),R.Y8G("ngIf",t.canCreate&&t.loaded))},dependencies:[T.n,k.YU,k.Sq,k.bT,w.Jm,w.QW,w.b_,w.hU,w.W9,w.Q8,w.YW,w.lO,w.eU,w.iq,w.uz,w.he,w.nf,w.JI,w.To,w.Ki,w.ln,w.BC,w.ai,w.el,x.B,$.Q,N.h,F.R,G.I,I.N,j.A,J.t,L.B,Y.i,U.T,z.D9],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color: var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical: 12px;--margin-end: 12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-inline-end:var(--margin-end)}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#10846c}","[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{flex:none;width:100%}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]{flex-grow:3}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:10px;font-size:1.2rem}"]}),AddonCalendarDayPage})();class AddonCalendarDaySlidesItemsManagerSource extends C.h{constructor(e,t){super({dayJS:t}),this.courses=[],this.eventsSources=new Set,this.offlineEvents={},this.offlineEditedEventsIds=[],this.canCreate=!1,this.sendLog=!0,this.dayPage=e}fetchData(e){var t=this;return(0,a.A)((function*(){yield Promise.all([t.loadCourses(e),t.loadCanCreate(e),t.loadCategories(),t.loadOfflineEvents(),t.loadOfflineDeletedEvents(),t.loadTimeFormat()])}))()}filterAllDayEvents(e){var t;null===(t=this.getItems())||void 0===t||t.forEach((t=>this.filterEvents(t,e)))}filterEvents(e,t){e.filteredEvents=c.AddonCalendarHelper.getFilteredEvents(e.events||[],t,this.categories||{}),this.rememberEventsList(e)}loadCourses(e){var t=this;return(0,a.A)((function*(){const n=yield g.CoreCoursesHelper.getCoursesForPopover(e);t.courses=n.courses}))()}loadCanCreate(e){var t=this;return(0,a.A)((function*(){t.canCreate=yield c.AddonCalendarHelper.canEditEvents(e)}))()}loadCategories(){var e=this;return(0,a.A)((function*(){if(!e.categories)try{const t=yield m.CoreCourses.getCategories(0,!0);e.categories=f.R.toObject(t,"id")}catch{}}))()}loadOfflineEvents(){var e=this;return(0,a.A)((function*(){const t=yield l.AddonCalendarOffline.getAllEditedEvents();e.offlineEvents=c.AddonCalendarHelper.classifyIntoMonths(t),e.offlineEditedEventsIds=t.filter((e=>e.id>0)).map((e=>e.id))}))()}loadOfflineDeletedEvents(){var e=this;return(0,a.A)((function*(){const t=yield l.AddonCalendarOffline.getAllDeletedEventsIds();e.deletedEvents=new Set(t)}))()}loadTimeFormat(){var e=this;return(0,a.A)((function*(){e.timeFormat=yield d.AddonCalendar.getCalendarTimeFormat()}))()}getItemId(e){return c.AddonCalendarHelper.getDayId(e.dayJS)}getPreviousItem(e){return{dayJS:e.dayJS.subtract(1,"day")}}getNextItem(e){return{dayJS:e.dayJS.add(1,"day")}}loadItemData(e,t=!1){var n=this;return(0,a.A)((function*(){const o={...e,hasOffline:!1,events:[],onlineEvents:[],filteredEvents:[],isCurrentDay:e.dayJS.isSame((0,h.yf)(),"day"),isPastDay:e.dayJS.isBefore((0,h.yf)(),"day")};if(t)return o;let i;try{i=yield d.AddonCalendar.getDayEvents(e.dayJS.year(),e.dayJS.month()+1,e.dayJS.date()),o.onlineEvents=yield Promise.all(i.events.map((e=>c.AddonCalendarHelper.formatEventData(e))))}catch(e){if(r.WE.isOnline())throw e}o.events=n.mergeEvents(o),n.filterEvents(o,n.dayPage.filter);const l=e.dayJS.valueOf(),u=s.j.timestamp(),m=o.events.map(function(){var e=(0,a.A)((function*(e){e.ispast=o.isPastDay||o.isCurrentDay&&n.isEventPast(e,u),e.formattedtime=yield d.AddonCalendar.formatEventTime(e,n.dayPage.timeFormat,!0,l)}));return function(t){return e.apply(this,arguments)}}());return yield Promise.all(m),o}))()}isEventPast(e,t){return e.timestart+e.timeduration<t}mergeEvents(e){var t,n;if(e.hasOffline=!1,!(Object.keys(this.offlineEvents).length||null!==(t=this.deletedEvents)&&void 0!==t&&t.size))return e.onlineEvents||[];const a=this.offlineEvents[c.AddonCalendarHelper.getMonthId(e.dayJS)],r=a&&a[e.dayJS.date()];let o=e.onlineEvents||[];var i;(null!==(n=this.deletedEvents)&&void 0!==n&&n.size&&o.forEach((t=>{var n;t.deleted=null===(n=this.deletedEvents)||void 0===n?void 0:n.has(t.id),t.deleted&&(e.hasOffline=!0)})),this.offlineEditedEventsIds.length)&&(o=o.filter((e=>-1==this.offlineEditedEventsIds.indexOf(e.id))),o.length!=(null===(i=e.onlineEvents)||void 0===i?void 0:i.length)&&(e.hasOffline=!0));return r&&r.length&&(e.hasOffline=!0,o=c.AddonCalendarHelper.sortEvents(o.concat(r))),o}invalidateContent(e,t){var n=this;return(0,a.A)((function*(){const a=[];t&&e&&a.push(d.AddonCalendar.invalidateDayEvents(e.dayJS.year(),e.dayJS.month()+1,e.dayJS.date())),a.push(d.AddonCalendar.invalidateAllowedEventTypes()),a.push(m.CoreCourses.invalidateCategories(0,!0)),a.push(d.AddonCalendar.invalidateTimeFormat()),n.categories=void 0,n.sendLog=!0,e&&(e.dirty=!0),yield Promise.all(a)}))()}markAsDeleted(e,t){var n,a,r;(null===(n=this.getItems())||void 0===n||n.some((n=>{var a;const r=null===(a=n.onlineEvents)||void 0===a?void 0:a.find((t=>t.id==e));if(!r)return!1;var o,i,s;(r.deleted=t,t)?n.hasOffline=!0:n.hasOffline=(null===(o=n.events)||void 0===o?void 0:o.length)!=(null===(i=n.onlineEvents)||void 0===i?void 0:i.length)||(null===(s=n.events)||void 0===s?void 0:s.some((e=>e.deleted||e.offline)));return!0})),t)?null===(a=this.deletedEvents)||void 0===a||a.add(e):null===(r=this.deletedEvents)||void 0===r||r.delete(e)}forgetRelatedSources(){for(const e of this.eventsSources)S.u.removeReference(e,this)}rememberEventsList(e){var t=this;return(0,a.A)((function*(){var n;const a=S.u.getOrCreateSource(b.t,[e.dayJS.format("MMDDY")]);t.eventsSources.has(a)||(t.eventsSources.add(a),S.u.addReference(a,t)),a.setEvents(null!==(n=e.filteredEvents)&&void 0!==n?n:[]),yield a.reload()}))()}}},58866:(e,t,n)=>{n.d(t,{i:()=>CoreItemsManagerSource});class CoreItemsManagerSource{constructor(){this.items=null,this.listeners=[],this.dirty=!1,this.loaded=!1,this.loadedPromise=new Promise((e=>this.resolveLoaded=e))}isDirty(){return this.dirty}isLoaded(){return this.loaded}waitForLoaded(){return this.loadedPromise}setLoaded(){this.loaded=!0,this.resolveLoaded()}setDirty(e){this.dirty=e}getItems(){return this.items}reset(){this.items=null,this.dirty=!1,this.loaded=!1,this.listeners.forEach((e=>{var t;return null===(t=e.onReset)||void 0===t?void 0:t.call(e)}))}addListener(e){return this.listeners.push(e),()=>this.removeListener(e)}removeListener(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}setItems(e){this.items=e,this.setLoaded(),this.notifyItemsUpdated()}notifyItemsUpdated(){this.listeners.forEach((e=>{var t;return null===(t=e.onItemsUpdated)||void 0===t?void 0:t.call(e,this.items)}))}}},42022:(e,t,n)=>{n.d(t,{f:()=>CoreItemsManager});var a=n(29306);class CoreItemsManager{constructor(e){this.itemsMap=null,this.selectedItem=null,this.listeners=[],this.setSource(e)}getSource(){if(!this.source)throw new a.CoreSilentError("Source is missing from items manager");return this.source.instance}setSource(e){if(this.source&&(this.source.unsubscribe(),delete this.source,this.onSourceReset()),e){this.source={instance:e,unsubscribe:e.addListener({onItemsUpdated:e=>this.onSourceItemsUpdated(e),onReset:()=>this.onSourceReset()})};const t=e.getItems();t&&this.onSourceItemsUpdated(t)}}destroy(){this.setSource(null)}getSelectedItem(){return this.selectedItem}setSelectedItem(e){e!==this.selectedItem&&(this.selectedItem=e,this.listeners.forEach((t=>{var n;return null===(n=t.onSelectedItemUpdated)||void 0===n?void 0:n.call(t,e)})))}addListener(e){return this.listeners.push(e),()=>this.removeListener(e)}removeListener(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}onSourceItemsUpdated(e){this.itemsMap=e.reduce(((e,t)=>(e[this.getItemId(t)]=t,e)),{})}onSourceReset(){this.itemsMap=null,this.selectedItem=null}getItemById(e){var t,n;return null!==(t=null===(n=this.itemsMap)||void 0===n?void 0:n[e])&&void 0!==t?t:null}}},35716:(e,t,n)=>{n.d(t,{z:()=>CorePaginatedItemsManagerSource});var a=n(10467),r=n(58866);class CorePaginatedItemsManagerSource extends r.i{constructor(){super(...arguments),this.hasMoreItems=!0}isCompleted(){return!this.hasMoreItems}isEmpty(){var e;return!this.isLoaded()||0===(null!==(e=this.getItems())&&void 0!==e?e:[]).length}getPagesLoaded(){if(null===this.items)return 0;const e=this.getPageLength();return null===e?1:Math.ceil(this.items.length/e)}reset(){this.hasMoreItems=!0,super.reset()}reload(){var e=this;return(0,a.A)((function*(){e.dirty=!0,yield e.load()}))()}load(){var e=this;return(0,a.A)((function*(){var t;if(e.dirty){const{items:t,hasMoreItems:n}=yield e.loadPageItems(0);return e.dirty=!1,e.setItems(t,null!=n&&n),void 0}if(!e.hasMoreItems)return;const{items:n,hasMoreItems:a}=yield e.loadPageItems(e.getPagesLoaded());e.setItems((null!==(t=e.items)&&void 0!==t?t:[]).concat(n),null!=a&&a)}))()}getPageLength(){return null}setItems(e,t=!1){this.hasMoreItems=t,super.setItems(e)}}},99522:(e,t,n)=>{n.d(t,{F:()=>CoreRoutedItemsManagerSource});var a=n(35716);class CoreRoutedItemsManagerSource extends a.z{static getSourceId(...e){return e.map((e=>String(e))).join("-")}getItemQueryParams(e){return{}}}},83696:(e,t,n)=>{var a;n.d(t,{u:()=>CoreRoutedItemsManagerSourcesTracker});class CoreRoutedItemsManagerSourcesTracker{static getSource(e,t){var n,a;const r="string"==typeof t?t:e.getSourceId(...t);return null!==(n=null===(a=this.getConstructorInstances(e)[r])||void 0===a?void 0:a.instance)&&void 0!==n?n:null}static getOrCreateSource(e,t){var n;const a=e.getSourceId(...t);return null!==(n=this.getSource(e,a))&&void 0!==n?n:this.createInstance(a,e,t)}static addReference(e,t){const n=this.getConstructorInstances(e.constructor),a=this.instanceIds.get(e);void 0!==a&&(a in n||(n[a]={instance:e,references:[]}),n[a].references.push(t))}static removeReference(e,t){var n,a;const r=this.instances.get(e.constructor),o=this.instanceIds.get(e),i=null!==(n=null==r||null===(a=r[null!=o?o:""])||void 0===a?void 0:a.references.indexOf(t))&&void 0!==n?n:-1;r&&void 0!==o&&-1!==i&&(r[o].references.splice(i,1),0===r[o].references.length&&delete r[o])}static getConstructorInstances(e){var t;return null!==(t=this.instances.get(e))&&void 0!==t?t:this.initialiseConstructorInstances(e)}static initialiseConstructorInstances(e){const t={};return this.instances.set(e,t),t}static createInstance(e,t,n){const a=new t(...n);return this.instanceIds.set(a,e),a}}(a=CoreRoutedItemsManagerSourcesTracker).instances=new WeakMap,a.instanceIds=new WeakMap}}]);