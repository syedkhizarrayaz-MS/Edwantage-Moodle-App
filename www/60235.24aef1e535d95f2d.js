"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[60235],{60235:(e,n,o)=>{o.r(n),o.d(n,{AddonBlockTimelineComponent:()=>H,AddonBlockTimelineSort:()=>q});var t=o(10467),i=o(52749),r=o(94339),l=o(79555),a=o(54438);let c=(()=>{var e;class AddonBlockTimelineProvider{getActionEventsByCourse(e,n,o="",r){var l=this;return(0,t.A)((function*(){const t=yield i.CoreSites.getSite(r),a=l.getDayStart(-14),c={timesortfrom:a,courseid:e,limitnum:AddonBlockTimelineProvider.EVENTS_LIMIT_PER_COURSE};n&&(c.aftereventid=n);const s={cacheKey:l.getActionEventsByCourseCacheKey(e)};""!=o&&(c.searchvalue=o,s.getFromCache=!1);const d=yield t.read("core_calendar_get_action_events_by_course",c,s);return l.treatCourseEvents(d,a)}))()}getActionEventsByCourseCacheKey(e){return`${this.getActionEventsByCoursesCacheKey()}:${e}`}getActionEventsByCourses(e,n="",o){var r=this;return(0,t.A)((function*(){if(0===e.length)return{};const t=yield i.CoreSites.getSite(o),l=r.getDayStart(-14),a={timesortfrom:l,courseids:e,limitnum:AddonBlockTimelineProvider.EVENTS_LIMIT_PER_COURSE},c={cacheKey:r.getActionEventsByCoursesCacheKey()};""!=n&&(a.searchvalue=n,c.getFromCache=!1);const s=yield t.read("core_calendar_get_action_events_by_courses",a,c),d={};return s.groupedbycourse.forEach((e=>{d[e.courseid]=r.treatCourseEvents(e,l)})),d}))()}getActionEventsByCoursesCacheKey(){return`${AddonBlockTimelineProvider.ROOT_CACHE_KEY}bycourse`}getActionEventsByTimesort(e,n="",o){var r=this;return(0,t.A)((function*(){const t=yield i.CoreSites.getSite(o),l=r.getDayStart(-14),a=AddonBlockTimelineProvider.EVENTS_LIMIT,c={timesortfrom:l,limitnum:a,limittononsuspendedevents:!0};e&&(c.aftereventid=e);const s={cacheKey:r.getActionEventsByTimesortCacheKey(e,a),getCacheUsingCacheKey:!0,uniqueCacheKey:!0};""!=n&&(c.searchvalue=n,s.getFromCache=!1,s.cacheKey+=`:${n}`);const d=yield t.read("core_calendar_get_action_events_by_timesort",c,s),_=d.events.length>=a?d.lastid:void 0;return{events:d.events.filter((e=>e.timesort>=l)),canLoadMore:_}}))()}getActionEventsByTimesortPrefixCacheKey(){return`${AddonBlockTimelineProvider.ROOT_CACHE_KEY}bytimesort:`}getActionEventsByTimesortCacheKey(e,n){return e=e||0,n=n||0,`${this.getActionEventsByTimesortPrefixCacheKey()+e}:${n}`}invalidateActionEventsByCourses(e){var n=this;return(0,t.A)((function*(){const o=yield i.CoreSites.getSite(e);yield o.invalidateWsCacheForKeyStartingWith(n.getActionEventsByCoursesCacheKey())}))()}invalidateActionEventsByTimesort(e){var n=this;return(0,t.A)((function*(){const o=yield i.CoreSites.getSite(e);yield o.invalidateWsCacheForKeyStartingWith(n.getActionEventsByTimesortPrefixCacheKey())}))()}treatCourseEvents(e,n){const o=e.events.length>=AddonBlockTimelineProvider.EVENTS_LIMIT_PER_COURSE?e.lastid:void 0;return e.events=e.events.filter((e=>e.timesort>=n)),{events:e.events,canLoadMore:o}}getDayStart(e=0){return(0,r.yf)().startOf("day").add(e,"days").unix()}}return(e=AddonBlockTimelineProvider).ROOT_CACHE_KEY="myoverview:",e.EVENTS_LIMIT=20,e.EVENTS_LIMIT_PER_COURSE=10,e.ɵfac=function AddonBlockTimelineProvider_Factory(n){return new(n||e)},e.ɵprov=a.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonBlockTimelineProvider})();const s=(0,l.Qd)(c);var d=o(55554),_=o(83219),m=o(66110),u=o(78765),p=o(84412),g=o(84572),C=o(7673),v=o(23294),f=o(96354),T=o(26365),h=o(88141),k=o(99437),b=o(97647),y=o(95384),B=o(97086),E=o(24742);class AddonBlockTimelineSection{constructor(e,n,o,t,i,r){this.search=e,this.overdue=n,this.dateRange=o,this.course=t,this.dataSubject$=new p.t({events:[],lastEventId:r,canLoadMore:void 0!==r,loadingMore:!1}),i&&this.reduceEvents(i,n,o).then((e=>this.dataSubject$.next({...this.dataSubject$.value,events:e})))}get data$(){return this.dataSubject$}loadMore(){var e=this;return(0,t.A)((function*(){var n,o;e.dataSubject$.next({...e.dataSubject$.value,loadingMore:!0});const t=e.dataSubject$.value.lastEventId,{events:i,canLoadMore:r}=e.course?yield s.getActionEventsByCourse(e.course.id,t,null!==(n=e.search)&&void 0!==n?n:""):yield s.getActionEventsByTimesort(t,null!==(o=e.search)&&void 0!==o?o:"");e.dataSubject$.next({events:e.dataSubject$.value.events.concat(yield e.reduceEvents(i,e.overdue,e.dateRange)),lastEventId:r,canLoadMore:void 0!==r,loadingMore:!1})}))()}reduceEvents(e,n,{from:o,to:i}){var r=this;return(0,t.A)((function*(){const t={now:E.j.timestamp(),midnight:s.getDayStart(),start:s.getDayStart(o),end:"number"==typeof i?s.getDayStart(i):void 0},l=(yield Promise.all(e.filter((e=>r.filterEvent(e,n,t))).map((e=>r.mapToTimelineEvent(e,t.now))))).reduce(((e,n)=>{var o;const t=E.j.getMidnightForTimestamp(n.timesort);return e[t]=null!==(o=e[t])&&void 0!==o?o:{dayTimestamp:t,events:[]},e[t].events.push(n),e}),{});return Object.values(l)}))()}filterEvent(e,n,{now:o,midnight:t,start:i,end:r}){if(i>e.timesort||r&&e.timesort>=r)return!1;if("open"===e.eventtype||"opensubmission"===e.eventtype){return E.j.getMidnightForTimestamp(e.timesort)>t}return!n||e.timesort<o}mapToTimelineEvent(e,n){return(0,t.A)((function*(){const o=e.modulename||e.icon.component;return{...e,modulename:o,overdue:e.timesort<n,iconUrl:yield B.CoreCourseModuleDelegate.getModuleIconSrc(e.icon.component,e.icon.iconurl),iconTitle:y.CoreCourseModuleHelper.translateModuleName(o)}}))()}}var A=o(89417),I=o(83749),M=o(6787),$=o(86654),x=o(33014),S=o(75383),O=o(91416),G=o(10883),P=o(60177),w=o(2910),R=o(32572),j=o(58197),F=o(43570),D=o(73955),Y=o(59528);function AddonBlockTimelineEventsComponent_ion_item_0_Template(e,n){if(1&e&&(a.j41(0,"ion-item")(1,"ion-label",4)(2,"h3")(3,"span",5),a.EFF(4),a.nI1(5,"translate"),a.k0s(),a.nrm(6,"core-format-text",6),a.k0s()()()),2&e){const e=a.XpG();a.R7$(4),a.JRh(a.bMT(5,3,"core.courses.aria:coursename")),a.R7$(2),a.Y8G("text",e.course.displayname||e.course.fullname)("contextInstanceId",e.course.id)}}function AddonBlockTimelineEventsComponent_ion_item_group_1_Conditional_3_ng_container_1_Template(e,n){1&e&&a.eu8(0)}function AddonBlockTimelineEventsComponent_ion_item_group_1_Conditional_3_Template(e,n){if(1&e&&(a.j41(0,"h4"),a.DNE(1,AddonBlockTimelineEventsComponent_ion_item_group_1_Conditional_3_ng_container_1_Template,1,0,"ng-container",7),a.k0s()),2&e){a.XpG();const e=a.sdS(6);a.R7$(),a.Y8G("ngTemplateOutlet",e)}}function AddonBlockTimelineEventsComponent_ion_item_group_1_Conditional_4_ng_container_1_Template(e,n){1&e&&a.eu8(0)}function AddonBlockTimelineEventsComponent_ion_item_group_1_Conditional_4_Template(e,n){if(1&e&&(a.j41(0,"h3"),a.DNE(1,AddonBlockTimelineEventsComponent_ion_item_group_1_Conditional_4_ng_container_1_Template,1,0,"ng-container",7),a.k0s()),2&e){a.XpG();const e=a.sdS(6);a.R7$(),a.Y8G("ngTemplateOutlet",e)}}function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_template_5_Template(e,n){if(1&e&&(a.EFF(0),a.nI1(1,"coreFormatDate")),2&e){const e=a.XpG().$implicit;a.SpI(" ",a.i5U(1,1,1e3*e.dayTimestamp,"strftimedaydate")," ")}}function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_core_mod_icon_8_Template(e,n){if(1&e&&a.nrm(0,"core-mod-icon",17),2&e){const e=a.XpG().$implicit,n=a.XpG(2);a.Y8G("modicon",e.iconUrl)("componentId",e.instance)("modname",e.modulename)("purpose",e.purpose)("colorize",n.colorizeIcons)("isBranded",e.branded)}}function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_ion_badge_13_Template(e,n){1&e&&(a.j41(0,"ion-badge",18),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&e&&(a.R7$(),a.SpI("",a.bMT(2,1,"addon.block_timeline.overdue")," "))}function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_p_14_Template(e,n){if(1&e&&(a.j41(0,"p")(1,"span"),a.nrm(2,"core-format-text",6),a.k0s()()),2&e){const e=a.XpG().$implicit;a.R7$(2),a.Y8G("text",e.course.fullnamedisplay)("contextInstanceId",e.course.id)}}function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_p_15_core_format_text_2_Template(e,n){if(1&e&&a.nrm(0,"core-format-text",20),2&e){const e=a.XpG(2).$implicit;a.Y8G("text",e.activitystr)("contextInstanceId",e.id)}}function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_p_15_Template(e,n){if(1&e&&(a.j41(0,"p")(1,"span"),a.DNE(2,AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_p_15_core_format_text_2_Template,1,2,"core-format-text",19),a.k0s()()),2&e){const e=a.XpG().$implicit;a.R7$(2),a.Y8G("ngIf",e.activitystr)}}function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_div_16_ion_badge_3_Template(e,n){if(1&e&&(a.j41(0,"ion-badge",24),a.EFF(1),a.k0s()),2&e){const e=a.XpG(2).$implicit;a.R7$(),a.SpI(" ",e.action.itemcount," ")}}function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_div_16_Template(e,n){if(1&e){const e=a.RV6();a.j41(0,"div",21)(1,"ion-button",22),a.bIt("click",(function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_div_16_Template_ion_button_click_1_listener(n){a.eBV(e);const o=a.XpG().$implicit,t=a.XpG(2);return a.Njj(t.action(n,o.action.url))})),a.EFF(2),a.DNE(3,AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_div_16_ion_badge_3_Template,2,1,"ion-badge",23),a.k0s()()}if(2&e){const e=a.XpG().$implicit;a.R7$(),a.Y8G("title",e.action.name),a.R7$(),a.SpI(" ",e.action.name," "),a.R7$(),a.Y8G("ngIf",e.action.showitemcount)}}function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_Template(e,n){if(1&e){const e=a.RV6();a.qex(0),a.j41(1,"ion-item",8),a.bIt("click",(function AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_Template_ion_item_click_1_listener(n){const o=a.eBV(e).$implicit,t=a.XpG(2);return a.Njj(t.action(n,o.url))})),a.j41(2,"ion-label")(3,"ion-row",9)(4,"ion-col",10)(5,"small"),a.EFF(6),a.nI1(7,"coreFormatDate"),a.k0s(),a.DNE(8,AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_core_mod_icon_8_Template,1,6,"core-mod-icon",11),a.k0s(),a.j41(9,"ion-col",12)(10,"p",13)(11,"span"),a.nrm(12,"core-format-text",14),a.k0s(),a.DNE(13,AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_ion_badge_13_Template,3,3,"ion-badge",15),a.k0s(),a.DNE(14,AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_p_14_Template,3,2,"p",1)(15,AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_p_15_Template,3,1,"p",1),a.k0s()(),a.DNE(16,AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_div_16_Template,4,3,"div",16),a.k0s()(),a.bVm()}if(2&e){const e=n.$implicit,o=a.XpG(2);a.R7$(),a.Y8G("detail",!1),a.BMQ("aria-label",e.name)("data-event-course-id",null==e.course?null:e.course.id),a.R7$(5),a.JRh(a.i5U(7,12,1e3*e.timesort,"strftimetime24")),a.R7$(2),a.Y8G("ngIf",e.iconUrl),a.R7$(4),a.Y8G("text",e.activityname||e.name)("contextInstanceId",e.id)("courseId",null==e.course?null:e.course.id),a.R7$(),a.Y8G("ngIf",e.overdue),a.R7$(),a.Y8G("ngIf",o.showInlineCourse&&e.course),a.R7$(),a.Y8G("ngIf",e.activitystr),a.R7$(),a.Y8G("ngIf",e.action&&e.action.actionable)}}function AddonBlockTimelineEventsComponent_ion_item_group_1_Template(e,n){if(1&e&&(a.j41(0,"ion-item-group")(1,"ion-item")(2,"ion-label"),a.DNE(3,AddonBlockTimelineEventsComponent_ion_item_group_1_Conditional_3_Template,2,1,"h4")(4,AddonBlockTimelineEventsComponent_ion_item_group_1_Conditional_4_Template,2,1)(5,AddonBlockTimelineEventsComponent_ion_item_group_1_ng_template_5_Template,2,4,"ng-template",null,0,a.C5r),a.k0s()(),a.DNE(7,AddonBlockTimelineEventsComponent_ion_item_group_1_ng_container_7_Template,17,15,"ng-container",2),a.k0s()),2&e){const e=n.$implicit,o=a.XpG();a.R7$(3),a.vxM(3,o.course?3:4),a.R7$(4),a.Y8G("ngForOf",e.events)}}function AddonBlockTimelineEventsComponent_div_2_ion_button_1_Template(e,n){if(1&e){const e=a.RV6();a.j41(0,"ion-button",27),a.bIt("click",(function AddonBlockTimelineEventsComponent_div_2_ion_button_1_Template_ion_button_click_0_listener(){a.eBV(e);const n=a.XpG(2);return a.Njj(n.loadMore.emit())})),a.EFF(1),a.nI1(2,"translate"),a.k0s()}2&e&&(a.R7$(),a.SpI(" ",a.bMT(2,1,"core.loadmore")," "))}function AddonBlockTimelineEventsComponent_div_2_ion_spinner_2_Template(e,n){1&e&&(a.nrm(0,"ion-spinner"),a.nI1(1,"translate")),2&e&&a.BMQ("aria-label",a.bMT(1,1,"core.loading"))}function AddonBlockTimelineEventsComponent_div_2_Template(e,n){if(1&e&&(a.j41(0,"div",25),a.DNE(1,AddonBlockTimelineEventsComponent_div_2_ion_button_1_Template,3,3,"ion-button",26)(2,AddonBlockTimelineEventsComponent_div_2_ion_spinner_2_Template,2,3,"ion-spinner",1),a.k0s()),2&e){const e=a.XpG();a.R7$(),a.Y8G("ngIf",!e.loadingMore),a.R7$(),a.Y8G("ngIf",e.loadingMore)}}let L=(()=>{var e;class AddonBlockTimelineEventsComponent{constructor(){this.events=[],this.showInlineCourse=!0,this.canLoadMore=!1,this.loadingMore=!1,this.loadMore=new a.bkB,this.colorizeIcons=!1}get courseId(){var e,n;return null!==(e=null===(n=this.course)||void 0===n?void 0:n.id)&&void 0!==e?e:null}ngOnInit(){var e;this.colorizeIcons=!(null!==(e=i.CoreSites.getCurrentSite())&&void 0!==e&&e.isVersionGreaterEqualThan("4.4"))}action(e,n){return(0,t.A)((function*(){e.preventDefault(),e.stopPropagation(),n=S.Ni.decodeHTMLEntities(n);const o=yield x.CoreLoadings.show();try{yield G.CoreContentLinksHelper.visitLink(n)}finally{o.dismiss()}}))()}}return(e=AddonBlockTimelineEventsComponent).ɵfac=function AddonBlockTimelineEventsComponent_Factory(n){return new(n||e)},e.ɵcmp=a.VBU({type:e,selectors:[["addon-block-timeline-events"]],hostVars:1,hostBindings:function AddonBlockTimelineEventsComponent_HostBindings(e,n){2&e&&a.BMQ("data-course-id",n.courseId)},inputs:{events:"events",course:"course",showInlineCourse:[a.Mj6.HasDecoratorInputTransform,"showInlineCourse","showInlineCourse",O.G],canLoadMore:[a.Mj6.HasDecoratorInputTransform,"canLoadMore","canLoadMore",O.G],loadingMore:[a.Mj6.HasDecoratorInputTransform,"loadingMore","loadingMore",O.G]},outputs:{loadMore:"loadMore"},standalone:!0,features:[a.GFd,a.aNF],decls:3,vars:3,consts:[["date",""],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","ion-padding ion-text-center",4,"ngIf"],[1,"ion-text-wrap"],[1,"sr-only"],["contextLevel","course",3,"text","contextInstanceId"],[4,"ngTemplateOutlet"],["button","","lines","full",1,"addon-block-timeline-activity",3,"click","detail"],[1,"ion-justify-content-between","ion-align-items-center","ion-nowrap","ion-no-padding"],[1,"addon-block-timeline-activity-time","ion-no-padding","ion-text-nowrap"],[3,"modicon","componentId","modname","purpose","colorize","isBranded",4,"ngIf"],[1,"addon-block-timeline-activity-name","ion-no-padding"],[1,"item-heading"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["color","danger",4,"ngIf"],["class","addon-block-timeline-activity-action",4,"ngIf"],[3,"modicon","componentId","modname","purpose","colorize","isBranded"],["color","danger"],["contextLevel","module",3,"text","contextInstanceId",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId"],[1,"addon-block-timeline-activity-action"],["fill","outline",1,"chip",3,"click","title"],["slot","end","class","ion-margin-start",4,"ngIf"],["slot","end",1,"ion-margin-start"],[1,"ion-padding","ion-text-center"],["expand","block","fill","outline",3,"click",4,"ngIf"],["expand","block","fill","outline",3,"click"]],template:function AddonBlockTimelineEventsComponent_Template(e,n){1&e&&a.DNE(0,AddonBlockTimelineEventsComponent_ion_item_0_Template,7,5,"ion-item",1)(1,AddonBlockTimelineEventsComponent_ion_item_group_1_Template,8,2,"ion-item-group",2)(2,AddonBlockTimelineEventsComponent_div_2_Template,3,2,"div",3),2&e&&(a.Y8G("ngIf",n.course),a.R7$(),a.Y8G("ngForOf",n.events),a.R7$(),a.Y8G("ngIf",n.canLoadMore))},dependencies:[$.n,P.Sq,P.bT,P.T3,w.In,w.Jm,w.hU,w.uz,w.jh,w.he,w.ln,w.w2,R.I,j.B,F.T,D.D9,Y.f],styles:["h3[_ngcontent-%COMP%]{font:var(--mdl-typography-heading5-font)}h4[_ngcontent-%COMP%]{font:var(--mdl-typography-heading6-font)}.addon-block-timeline-activity[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-inline-start:.25rem;margin-inline-end:.5rem}.addon-block-timeline-activity[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{margin-inline-end:.5rem}.addon-block-timeline-activity[_ngcontent-%COMP%]   core-mod-icon[_ngcontent-%COMP%]{--module-legacy-icon-padding: 8px;--margin-end: .5rem;--margin-vertical: 0}.addon-block-timeline-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{display:flex;flex-direction:column}.addon-block-timeline-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .addon-block-timeline-activity-action[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.addon-block-timeline-activity-time[_ngcontent-%COMP%]{flex-grow:0}.addon-block-timeline-activity-name[_ngcontent-%COMP%]{flex-grow:1;overflow:hidden}.addon-block-timeline-activity-name[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.addon-block-timeline-activity-name[_ngcontent-%COMP%] > p[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}),AddonBlockTimelineEventsComponent})();var N=o(25572),V=o(75357),X=o(47551),z=o(16986),K=o(64422),U=o(7570);function AddonBlockTimelineComponent_ion_row_6_Template(e,n){if(1&e){const e=a.RV6();a.j41(0,"ion-row",12)(1,"ion-col")(2,"core-search-box",13),a.nI1(3,"translate"),a.bIt("onSubmit",(function AddonBlockTimelineComponent_ion_row_6_Template_core_search_box_onSubmit_2_listener(n){a.eBV(e);const o=a.XpG();return a.Njj(o.searchChanged(n))}))("onClear",(function AddonBlockTimelineComponent_ion_row_6_Template_core_search_box_onClear_2_listener(){a.eBV(e);const n=a.XpG();return a.Njj(n.searchChanged(""))})),a.k0s()()()}2&e&&(a.R7$(2),a.Y8G("placeholder",a.bMT(3,2,"addon.block_timeline.searchevents"))("lengthCheck",2))}function AddonBlockTimelineComponent_ion_select_option_12_Template(e,n){if(1&e&&(a.j41(0,"ion-select-option",14),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&e){const e=n.$implicit,o=n.last;a.Y8G("value",e.value),a.BMQ("class",(o," core-select-option-border-bottom")),a.R7$(),a.SpI(" ",a.bMT(2,3,e.name)," ")}}function AddonBlockTimelineComponent_ion_select_option_16_Template(e,n){if(1&e&&(a.j41(0,"ion-select-option",15),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&e){const e=n.$implicit;a.Y8G("value",e.value),a.R7$(),a.SpI(" ",a.bMT(2,2,e.name)," ")}}function AddonBlockTimelineComponent_ion_col_17_Template(e,n){if(1&e){const e=a.RV6();a.j41(0,"ion-col",16)(1,"core-search-box",13),a.nI1(2,"translate"),a.bIt("onSubmit",(function AddonBlockTimelineComponent_ion_col_17_Template_core_search_box_onSubmit_1_listener(n){a.eBV(e);const o=a.XpG();return a.Njj(o.searchChanged(n))}))("onClear",(function AddonBlockTimelineComponent_ion_col_17_Template_core_search_box_onClear_1_listener(){a.eBV(e);const n=a.XpG();return a.Njj(n.searchChanged(""))})),a.k0s()()}2&e&&(a.R7$(),a.Y8G("placeholder",a.bMT(2,2,"addon.block_timeline.searchevents"))("lengthCheck",2))}function AddonBlockTimelineComponent_ion_select_option_22_Template(e,n){if(1&e&&(a.j41(0,"ion-select-option",15),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&e){const e=n.$implicit;a.Y8G("value",e.value),a.R7$(),a.SpI(" ",a.bMT(2,2,e.name)," ")}}function AddonBlockTimelineComponent_ng_container_23_ng_container_1_addon_block_timeline_events_1_Template(e,n){if(1&e){const e=a.RV6();a.j41(0,"addon-block-timeline-events",20),a.nI1(1,"async"),a.bIt("loadMore",(function AddonBlockTimelineComponent_ng_container_23_ng_container_1_addon_block_timeline_events_1_Template_addon_block_timeline_events_loadMore_0_listener(){a.eBV(e);const n=a.XpG().$implicit;return a.Njj(n.loadMore())})),a.k0s()}if(2&e){const e=n.ngIf,o=a.XpG().$implicit,t=a.XpG(2);a.Y8G("events",e.events)("showInlineCourse",a.bMT(1,5,t.sort$)===t.AddonBlockTimelineSort.ByDates)("canLoadMore",e.canLoadMore)("loadingMore",e.loadingMore)("course",o.course)}}function AddonBlockTimelineComponent_ng_container_23_ng_container_1_Template(e,n){if(1&e&&(a.qex(0),a.DNE(1,AddonBlockTimelineComponent_ng_container_23_ng_container_1_addon_block_timeline_events_1_Template,2,7,"addon-block-timeline-events",19),a.nI1(2,"async"),a.bVm()),2&e){const e=n.$implicit;a.R7$(),a.Y8G("ngIf",a.bMT(2,1,e.data$))}}function AddonBlockTimelineComponent_ng_container_23_core_empty_box_2_Template(e,n){1&e&&(a.nrm(0,"core-empty-box",21),a.nI1(1,"translate")),2&e&&a.Y8G("message",a.bMT(1,1,"addon.block_timeline.noevents"))}function AddonBlockTimelineComponent_ng_container_23_Template(e,n){if(1&e&&(a.qex(0),a.DNE(1,AddonBlockTimelineComponent_ng_container_23_ng_container_1_Template,3,3,"ng-container",17)(2,AddonBlockTimelineComponent_ng_container_23_core_empty_box_2_Template,2,3,"core-empty-box",18),a.bVm()),2&e){const e=n.ngIf;a.R7$(),a.Y8G("ngForOf",e),a.R7$(),a.Y8G("ngIf",e&&0===e.length)}}let H=(()=>{var e;class AddonBlockTimelineComponent{constructor(){this.sort=new A.MJ(q.ByDates),this.filter=new A.MJ("next30days"),this.loaded=!1,this.courseIdsToInvalidate=[],this.fetchContentDefaultError="Error getting timeline data.",this.logger=M.CoreLogger.getInstance("AddonBlockTimelineComponent"),this.search$=new p.t(null),this.initializeSort(),this.initializeFilter(),this.initializeSections()}get AddonBlockTimelineSort(){return q}ngOnInit(){var e=this;return(0,t.A)((function*(){const n=i.CoreSites.getRequiredCurrentSite(),[o,t,r]=yield Promise.all([n.getLocalSiteConfig("AddonBlockTimelineSort",q.ByDates),n.getLocalSiteConfig("AddonBlockTimelineFilter","next30days"),n.isVersionGreaterEqualThan("4.0")?"":null]);e.sort.setValue(o),e.filter.setValue(t),e.search$.next(r)}))()}sortChanged(e){i.CoreSites.getRequiredCurrentSite().setLocalSiteConfig("AddonBlockTimelineSort",e)}filterChanged(e){i.CoreSites.getRequiredCurrentSite().setLocalSiteConfig("AddonBlockTimelineFilter",e)}searchChanged(e){this.search$.next(e)}invalidateContent(){var e=this;return(0,t.A)((function*(){yield d.g.allPromises([s.invalidateActionEventsByTimesort(),s.invalidateActionEventsByCourses(),m.CoreCourses.invalidateUserCourses(),u.CoreCourseOptionsDelegate.clearAndInvalidateCoursesOptions(),m.CoreCourses.invalidateCoursesByField("ids",e.courseIdsToInvalidate.join(","))])}))()}initializeSort(){this.sort$=(0,I.$X)(this.sort),this.sortOptions=Object.values(q).map((e=>({value:e,name:`addon.block_timeline.${e}`})))}initializeFilter(){this.filter$=(0,I.$X)(this.filter),this.statusFilterOptions=[{value:"all",name:"core.all"},{value:"overdue",name:"addon.block_timeline.overdue"}],this.dateFilterOptions=["next7days","next30days","next3months","next6months"].map((e=>({value:e,name:`addon.block_timeline.${e}`})))}initializeSections(){var e=this;const n={all:{from:-14},overdue:{from:-14,to:1},next7days:{from:0,to:7},next30days:{from:0,to:30},next3months:{from:0,to:90},next6months:{from:0,to:180}},o=this.sort.valueChanges,i=o.pipe((0,v.F)(),(0,f.T)(function(){var e=(0,t.A)((function*(e){switch(e){case q.ByDates:return[];case q.ByCourses:return _.CoreCoursesHelper.getUserCoursesWithOptions()}}));return function(n){return e.apply(this,arguments)}}()),(0,I.L$)(),(0,f.T)((e=>(this.courseIdsToInvalidate=e.map((e=>e.id)),e))));this.sections$=(0,g.z)([this.filter$,o,this.search$,i]).pipe((0,f.T)(function(){var o=(0,t.A)((function*([o,t,i,r]){const l="overdue"===o,a=n[o];switch(t){case q.ByDates:return e.getSectionsByDates(i,l,a);case q.ByCourses:return e.getSectionsByCourse(i,l,a,r)}}));return function(e){return o.apply(this,arguments)}}()),(0,I.L$)(),(0,T.U)(),(0,h.M)((e=>{this.loaded&&X.CoreToasts.show({cssClass:"sr-only",message:l.HT.instant("core.resultsfound",{$a:e.length})})})),(0,k.W)((e=>(this.logger.error(e),N.CoreAlerts.showError(e,{default:this.fetchContentDefaultError}),(0,C.of)([])))),(0,b.u)(),(0,h.M)((()=>this.loaded=!0)))}getSectionsByDates(e,n,o){return(0,t.A)((function*(){const t=new AddonBlockTimelineSection(e,n,o);return yield t.loadMore(),t.data$.pipe((0,f.T)((({events:e})=>e.length>0?[t]:[])))}))()}getSectionsByCourse(e,n,o,i){var r=this;return(0,t.A)((function*(){const t=i.map((e=>e.id)),l=yield r.getCoursesGracePeriod(),a=yield s.getActionEventsByCourses(t,null!=e?e:""),c=i.filter((e=>!e.hidden&&!_.CoreCoursesHelper.isFutureCourse(e,l.after,l.before)&&a[e.id].events.length>0)).map((t=>{const i=new AddonBlockTimelineSection(e,n,o,t,a[t.id].events,a[t.id].canLoadMore);return i.data$.pipe((0,f.T)((({events:e})=>e.length>0?i:null)))}));return 0===c.length?(0,C.of)([]):(0,g.z)(c).pipe((0,f.T)((e=>e.filter((e=>!!e)))))}))()}getCoursesGracePeriod(){return(0,t.A)((function*(){try{const e=i.CoreSites.getRequiredCurrentSite();return{before:parseInt(yield e.getConfig("coursegraceperiodbefore"),10),after:parseInt(yield e.getConfig("coursegraceperiodafter"),10)}}catch{return{before:0,after:0}}}))()}}return(e=AddonBlockTimelineComponent).ɵfac=function AddonBlockTimelineComponent_Factory(n){return new(n||e)},e.ɵcmp=a.VBU({type:e,selectors:[["addon-block-timeline"]],standalone:!0,features:[a.aNF],decls:25,vars:29,consts:[[3,"sticky"],["placeholderType","column","placeholderHeight","120px",3,"hideUntil","placeholderLimit"],["class","ion-hide-md-up addon-block-timeline-filter",4,"ngIf"],[1,"ion-justify-content-between","ion-align-items-center","addon-block-timeline-filter"],["size","auto"],[3,"onChange","formControl","label"],[3,"value",4,"ngFor","ngForOf"],["disabled","","value","disabled",1,"ion-text-wrap","core-select-option-title"],["class","ion-text-wrap",3,"value",4,"ngFor","ngForOf"],["class","ion-hide-md-down",4,"ngIf"],["icon","fas-arrow-down-short-wide",1,"no-border",3,"onChange","label","formControl"],[4,"ngIf"],[1,"ion-hide-md-up","addon-block-timeline-filter"],["autocorrect","off","spellcheck","false","searchArea","AddonBlockTimeline",3,"onSubmit","onClear","placeholder","lengthCheck"],[3,"value"],[1,"ion-text-wrap",3,"value"],[1,"ion-hide-md-down"],[4,"ngFor","ngForOf"],["image","assets/img/icons/courses.svg",3,"message",4,"ngIf"],[3,"events","showInlineCourse","canLoadMore","loadingMore","course","loadMore",4,"ngIf"],[3,"loadMore","events","showInlineCourse","canLoadMore","loadingMore","course"],["image","assets/img/icons/courses.svg",3,"message"]],template:function AddonBlockTimelineComponent_Template(e,n){1&e&&(a.j41(0,"ion-item-divider",0)(1,"ion-label")(2,"h2"),a.EFF(3),a.nI1(4,"translate"),a.k0s()()(),a.j41(5,"core-loading",1),a.DNE(6,AddonBlockTimelineComponent_ion_row_6_Template,4,4,"ion-row",2),a.nI1(7,"async"),a.j41(8,"ion-row",3)(9,"ion-col",4)(10,"core-combobox",5),a.nI1(11,"translate"),a.bIt("onChange",(function AddonBlockTimelineComponent_Template_core_combobox_onChange_10_listener(e){return n.filterChanged(e)})),a.DNE(12,AddonBlockTimelineComponent_ion_select_option_12_Template,3,5,"ion-select-option",6),a.j41(13,"ion-select-option",7),a.EFF(14),a.nI1(15,"translate"),a.k0s(),a.DNE(16,AddonBlockTimelineComponent_ion_select_option_16_Template,3,4,"ion-select-option",8),a.k0s()(),a.DNE(17,AddonBlockTimelineComponent_ion_col_17_Template,3,4,"ion-col",9),a.nI1(18,"async"),a.j41(19,"ion-col",4)(20,"core-combobox",10),a.nI1(21,"translate"),a.bIt("onChange",(function AddonBlockTimelineComponent_Template_core_combobox_onChange_20_listener(e){return n.sortChanged(e)})),a.DNE(22,AddonBlockTimelineComponent_ion_select_option_22_Template,3,4,"ion-select-option",8),a.k0s()()(),a.DNE(23,AddonBlockTimelineComponent_ng_container_23_Template,3,2,"ng-container",11),a.nI1(24,"async"),a.k0s()),2&e&&(a.Y8G("sticky",!0),a.R7$(3),a.JRh(a.bMT(4,15,"addon.block_timeline.pluginname")),a.R7$(2),a.Y8G("hideUntil",n.loaded)("placeholderLimit",1),a.R7$(),a.Y8G("ngIf",null!==a.bMT(7,17,n.search$)),a.R7$(4),a.Y8G("formControl",n.filter)("label",a.bMT(11,19,"addon.block_timeline.ariadayfilter")),a.R7$(2),a.Y8G("ngForOf",n.statusFilterOptions),a.R7$(2),a.SpI(" ",a.bMT(15,21,"addon.block_timeline.duedate")," "),a.R7$(2),a.Y8G("ngForOf",n.dateFilterOptions),a.R7$(),a.Y8G("ngIf",null!==a.bMT(18,23,n.search$)),a.R7$(3),a.Y8G("label",a.bMT(21,25,"core.sortby"))("formControl",n.sort),a.R7$(2),a.Y8G("ngForOf",n.sortOptions),a.R7$(),a.Y8G("ngIf",a.bMT(24,27,n.sections$)))},dependencies:[$.n,P.Sq,P.bT,A.BC,w.hU,w.Dg,w.he,w.ln,w.Ip,A.l_,z.h,K.R,U._,P.Jj,D.D9,V.CoreSearchBoxComponent,L],styles:["[_nghost-%COMP%]   ion-row.addon-block-timeline-filter[_ngcontent-%COMP%]{margin:8px;padding:0}[_nghost-%COMP%]   ion-row.addon-block-timeline-filter[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:0;margin-right:2px;margin-left:2px}[_nghost-%COMP%]   ion-row.addon-block-timeline-filter[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-row.addon-block-timeline-filter[_ngcontent-%COMP%]   core-combobox[_ngcontent-%COMP%]     ion-button{--border-width: 0;--a11y-sizing-minTargetSize: 40px;margin:0}[_nghost-%COMP%]   ion-row.addon-block-timeline-filter[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   .select-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-row.addon-block-timeline-filter[_ngcontent-%COMP%]   core-combobox[_ngcontent-%COMP%]     ion-button .select-icon{display:none}[_nghost-%COMP%]   ion-row.addon-block-timeline-filter[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-row.addon-block-timeline-filter[_ngcontent-%COMP%]   core-combobox[_ngcontent-%COMP%]     ion-button ion-icon{font-size:var(--mdl-typography-icon-fontSize-md)}[_nghost-%COMP%]   ion-row.addon-block-timeline-filter[_ngcontent-%COMP%]   core-combobox[_ngcontent-%COMP%]     ion-select{margin:0;--a11y-sizing-minTargetSize: 40px}[_nghost-%COMP%]   ion-row.addon-block-timeline-filter[_ngcontent-%COMP%]   core-search-box[_ngcontent-%COMP%]{padding:0;margin:0;--height: 40px}"],changeDetection:0}),AddonBlockTimelineComponent})();var q=function(e){return e.ByDates="sortbydates",e.ByCourses="sortbycourses",e}(q||{})}}]);