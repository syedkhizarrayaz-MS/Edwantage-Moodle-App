"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1762],{1762:(e,t,n)=>{n.d(t,{g:()=>C});var r=n(10467),o=n(54438),s=n(88436),i=n(52749),a=n(82907),l=n(75383),c=n(8014),u=n(55351),p=n(6787),d=n(69319),m=n(91416),h=n(35161),f=n(25124);let C=(()=>{var e;class CoreQuestionBaseComponent{constructor(e,t){this.offlineEnabled=!1,this.review=!1,this.buttonClicked=new o.bkB,this.onAbort=new o.bkB,this.correctIcon="",this.incorrectIcon="",this.partialCorrectIcon="",this.onReadyPromise=new f._,this.logger=p.CoreLogger.getInstance(e),this.hostElement=t.nativeElement}ngOnInit(){if(this.correctIcon=d.CoreQuestionHelper.getCorrectIcon().fullName,this.incorrectIcon=d.CoreQuestionHelper.getIncorrectIcon().fullName,this.partialCorrectIcon=d.CoreQuestionHelper.getPartiallyCorrectIcon().fullName,!this.question)return this.logger.warn("Aborting because of no question received."),d.CoreQuestionHelper.showComponentError(this.onAbort);this.init()}init(){this.initComponent(),this.onReadyPromise.resolve()}initComponent(){if(!this.question)return;this.hostElement.classList.add("core-question-container");const e=(0,h.B)(this.question.html);return this.question.text=a.y.getContentsOfElement(e,".qtext"),void 0===this.question.text?(this.logger.warn("Aborting because of an error parsing question.",this.question.slot),d.CoreQuestionHelper.showComponentError(this.onAbort)):e}initCalculatedComponent(){const e=this.initInputTextComponent();if(e)return this.treatCalculatedSelectUnits(e)||this.treatCalculatedRadioUnits(e),e}treatCalculatedRadioUnits(e){const t=Array.from(e.querySelectorAll('input[type="radio"]'));if(!t.length||!this.question)return!1;const n=this.question;n.options=[];for(const r in t){const o=t[r],s={id:o.id,class:"",name:o.name,value:o.value,checked:o.checked,disabled:o.disabled},i=e.querySelector(`label[for="${s.id}"]`);if(n.optionsName=s.name,!i||void 0===s.name||void 0===s.value)return this.logger.warn("Aborting because of an error parsing options.",n.slot,s.name),d.CoreQuestionHelper.showComponentError(this.onAbort),!0;s.text=i.innerText,o.checked&&(n.unit=s.value),n.options.push(s)}if(n.parsedSettings&&null!==n.parsedSettings.unitsleft)n.optionsFirst="1"==n.parsedSettings.unitsleft;else{const r=e.querySelector('input[type="text"][name*=answer]');n.optionsFirst=e.innerHTML.indexOf((null==r?void 0:r.outerHTML)||"")>e.innerHTML.indexOf(t[0].outerHTML)}return!0}treatCalculatedSelectUnits(e){const t=e.querySelector("select[name*=unit]"),n=t&&Array.from(t.querySelectorAll("option"));if(!t||null==n||!n.length||!this.question)return!1;const r=this.question,o={id:t.id,name:t.name,disabled:t.disabled,options:[]};for(const e in n){const t=n[e];var s;if(void 0===t.value)return this.logger.warn("Aborting because couldn't find input.",null===(s=this.question)||void 0===s?void 0:s.slot),d.CoreQuestionHelper.showComponentError(this.onAbort),!0;const r={value:t.value,label:t.innerHTML,selected:t.selected};t.selected&&(o.selected=r.value),o.options.push(r)}o.selected||(o.selected=o.options[0].value);const i=e.querySelector(`label[for="${t.id}"]`);if(o.accessibilityLabel=null==i?void 0:i.innerHTML,r.select=o,r.parsedSettings&&null!==r.parsedSettings.unitsleft)r.selectFirst="1"==r.parsedSettings.unitsleft;else{const n=e.querySelector('input[type="text"][name*=answer]');r.selectFirst=e.innerHTML.indexOf((null==n?void 0:n.outerHTML)||"")>e.innerHTML.indexOf(t.outerHTML)}return!0}initEssayComponent(e){const t=this.initComponent();if(!t||!this.question)return;const n=this.question,r=t.querySelector('input[name*="_answer:itemid"]');var o;if(n.parsedSettings?(n.allowsAttachments="0"!=n.parsedSettings.attachments,n.allowsAnswerFiles="editorfilepicker"==n.parsedSettings.responseformat,n.isMonospaced="monospaced"==n.parsedSettings.responseformat,n.isPlainText=n.isMonospaced||"plain"==n.parsedSettings.responseformat,n.hasInlineText="noinline"!=n.parsedSettings.responseformat):(n.allowsAttachments=!!t.querySelector("div[id*=filemanager]"),n.allowsAnswerFiles=!!r,n.isMonospaced=!!t.querySelector(".qtype_essay_monospaced"),n.isPlainText=n.isMonospaced||!!t.querySelector(".qtype_essay_plain")),e)return n.answer=a.y.getContentsOfElement(t,".qtype_essay_response"),n.wordCountInfo=null===(o=t.querySelector(".answer > p"))||void 0===o?void 0:o.innerHTML,n.attachments=n.parsedSettings?Array.from(d.CoreQuestionHelper.getResponseFileAreaFiles(n,"attachments")):d.CoreQuestionHelper.getQuestionAttachmentsFromHtml(a.y.getContentsOfElement(t,".attachments")||""),this.handleEssayPlagiarism(t),t;const u=t.querySelector("textarea[name*=_answer]");if(n.hasDraftFiles=n.allowsAnswerFiles&&d.CoreQuestionHelper.hasDraftFileUrls(t.innerHTML),!u&&(n.hasInlineText||!n.allowsAttachments))return n.answer=a.y.getContentsOfElement(t,".qtype_essay_response"),n.attachments=d.CoreQuestionHelper.getQuestionAttachmentsFromHtml(a.y.getContentsOfElement(t,".attachments")||""),t;if(u){const e=t.querySelector('input[type="hidden"][name*=answerformat]');let r=l.Ni.decodeHTML(u.innerHTML||"");n.hasDraftFiles&&n.responsefileareas&&(r=s.CoreFileHelper.replaceDraftfileUrls(i.CoreSites.getRequiredCurrentSite().getURL(),r,d.CoreQuestionHelper.getResponseFileAreaFiles(n,"answer")).text),n.textarea={id:u.id,name:u.name,text:r},e&&(n.formatInput={name:e.name,value:e.value})}if(r&&(n.answerDraftIdInput={name:r.name,value:Number(r.value)}),n.allowsAttachments){const e=t.querySelector(".attachments input[name*=_attachments]"),r=t.querySelector(".attachments object"),o=r&&r.data;var p;if(e&&(n.attachmentsDraftIdInput={name:e.name,value:Number(e.value)}),n.parsedSettings)n.attachmentsMaxFiles=Number(n.parsedSettings.attachments),n.attachmentsAcceptedTypes=null===(p=n.parsedSettings.filetypeslist)||void 0===p?void 0:p.join(",");if(o){const e=c.F.extractUrlParams(o),t=Number(e.maxbytes),r=Number(e.areamaxbytes);n.attachmentsMaxBytes=-1===t||-1===r?Math.max(t,r):Math.min(t,r)}}return t}handleEssayPlagiarism(e){if(!this.question)return;const t=this.question,n=e.querySelector(".answer .core_plagiarism_links");n&&(t.answerPlagiarism=n.innerHTML);const r=t.attachments;if(null==r||!r.length)return;const o=Array.from(e.querySelectorAll(".attachments .core_plagiarism_links")),i=[];o.forEach((e=>{var t;const n=null===(t=e.parentElement)||void 0===t||null===(t=t.querySelector("a"))||void 0===t?void 0:t.href;if(!n)return;const o=r.findIndex((e=>s.CoreFileHelper.getFileUrl(e)===n));o>=0&&(i[o]=e.innerHTML)})),t.attachmentsPlagiarisms=i}initOriginalTextComponent(e){if(!this.question)return;const t=(0,h.B)(this.question.html),n=t.querySelector(e);return n?(a.y.removeElement(n,"input[name*=sequencecheck]"),a.y.removeElement(n,".validationerror"),d.CoreQuestionHelper.replaceCorrectnessClasses(t),d.CoreQuestionHelper.replaceFeedbackClasses(t),d.CoreQuestionHelper.treatCorrectnessIcons(t),this.question.text=n.innerHTML,t):(this.logger.warn("Aborting because of an error parsing question.",this.question.slot),d.CoreQuestionHelper.showComponentError(this.onAbort))}initInputTextComponent(){const e=this.initComponent();if(!e||!this.question)return;const t=this.question,n=e.querySelector('input[type="text"][name*=answer]');if(!n)return this.logger.warn("Aborting because couldn't find input.",this.question.slot),d.CoreQuestionHelper.showComponentError(this.onAbort);if(t.input={id:n.id,name:n.name,value:n.value,readOnly:n.readOnly,isInline:!!n.closest(".qtext")},n.classList.contains("incorrect")?(t.input.correctClass="core-question-incorrect",t.input.correctIcon=this.incorrectIcon,t.input.correctIconColor=u.$.DANGER,t.input.correctIconLabel="core.question.incorrect"):n.classList.contains("correct")?(t.input.correctClass="core-question-correct",t.input.correctIcon=this.correctIcon,t.input.correctIconColor=u.$.SUCCESS,t.input.correctIconLabel="core.question.correct"):n.classList.contains("partiallycorrect")?(t.input.correctClass="core-question-partiallycorrect",t.input.correctIcon=this.partialCorrectIcon,t.input.correctIconColor=u.$.WARNING,t.input.correctIconLabel="core.question.partiallycorrect"):(t.input.correctClass="",t.input.correctIcon="",t.input.correctIconColor="",t.input.correctIconLabel=""),t.input.isInline){const n=e.querySelector(".qtext");n&&(d.CoreQuestionHelper.replaceCorrectnessClasses(n),d.CoreQuestionHelper.treatCorrectnessIcons(n),t.text=n.innerHTML)}return e}initMatchComponent(){const e=this.initComponent();if(!e||!this.question)return;const t=this.question,n=Array.from(e.querySelectorAll("table.answer tr"));if(!n||!n.length)return this.logger.warn("Aborting because couldn't find any row.",t.slot),d.CoreQuestionHelper.showComponentError(this.onAbort);t.rows=[];for(const e in n){const r=Array.from(n[e].querySelectorAll("td"));if(!r||r.length<2)return this.logger.warn("Aborting because couldn't the right columns.",t.slot),d.CoreQuestionHelper.showComponentError(this.onAbort);const o=r[1].querySelector("select"),s=Array.from(r[1].querySelectorAll("option"));if(!o||!s||!s.length)return this.logger.warn("Aborting because couldn't find select or options.",t.slot),d.CoreQuestionHelper.showComponentError(this.onAbort);const i={id:o.id.replace(/:/g,"\\:"),name:o.name,disabled:o.disabled,options:[],text:r[0].innerHTML};r[1].className.indexOf("partiallycorrect")>=0?(i.correctClass="partiallycorrect",i.correctColor=u.$.WARNING):r[1].className.indexOf("incorrect")>=0?(i.correctClass="incorrect",i.correctColor=u.$.DANGER):r[1].className.indexOf("correct")>=0&&(i.correctClass="correct",i.correctColor=u.$.SUCCESS);for(const e in s){const n=s[e];if(void 0===n.value)return this.logger.warn("Aborting because couldn't find the value of an option.",t.slot),d.CoreQuestionHelper.showComponentError(this.onAbort);const r={value:n.value,label:l.Ni.decodeHTML(n.innerHTML),selected:n.selected};r.selected&&(i.selected=r.value),i.options.push(r)}const a=r[1].querySelector("label.accesshide");i.accessibilityLabel=null==a?void 0:a.innerHTML,t.rows.push(i)}return t.loaded=!0,e}initMultichoiceComponent(){const e=this.initComponent();if(!e||!this.question)return;const t=this.question;t.prompt=a.y.getContentsOfElement(e,".prompt");let n=Array.from(e.querySelectorAll('input[type="radio"]'));if(!(n&&n.length||(t.multi=!0,n=Array.from(e.querySelectorAll('input[type="checkbox"]')),n&&n.length)))return this.logger.warn("Aborting because of no radio and checkbox found.",t.slot),d.CoreQuestionHelper.showComponentError(this.onAbort);t.options=[],t.disabled=!0;for(const o in n){var r;const s=n[o],i={id:s.id,class:"",name:s.name,value:s.value,checked:s.checked,disabled:s.disabled},a=s.parentElement;if("-1"==i.value)continue;t.optionsName=i.name,t.disabled=t.disabled&&s.disabled;const l=s.getAttribute("aria-labelledby");let c=l?e.querySelector(`#${l.replace(/:/g,"\\:")}`):void 0;if(c||(c=e.querySelector(`label[for="${i.id}"]`)),i.class=(null===(r=c)||void 0===r?void 0:r.className)||i.class,!c||void 0===i.name||void 0===i.value)return this.logger.warn("Aborting because of an error parsing options.",t.slot,i.name),d.CoreQuestionHelper.showComponentError(this.onAbort);if(i.text=c.innerHTML,s.checked&&(t.multi||(t.singleChoiceModel=i.value),a)){a.className.indexOf("partiallycorrect")>=0?(i.correctClass="partiallycorrect",i.correctColor=u.$.WARNING):a.className.indexOf("incorrect")>=0?(i.correctClass="incorrect",i.correctColor=u.$.DANGER):a.className.indexOf("correct")>=0&&(i.correctClass="correct",i.correctColor=u.$.SUCCESS);const e=a.querySelector(".specificfeedback");e&&(i.feedback=e.innerHTML)}t.options.push(i)}return e}ready(){var e=this;return(0,r.A)((function*(){return e.onReadyPromise}))()}}return(e=CoreQuestionBaseComponent).ɵfac=function CoreQuestionBaseComponent_Factory(t){return new(t||e)(o.rXU("",8),o.rXU(o.aKT))},e.ɵcmp=o.VBU({type:e,selectors:[["ng-component"]],inputs:{question:"question",component:"component",componentId:"componentId",attemptId:"attemptId",offlineEnabled:[o.Mj6.HasDecoratorInputTransform,"offlineEnabled","offlineEnabled",m.G],contextLevel:"contextLevel",contextInstanceId:"contextInstanceId",courseId:"courseId",review:[o.Mj6.HasDecoratorInputTransform,"review","review",m.G],preferredBehaviour:"preferredBehaviour"},outputs:{buttonClicked:"buttonClicked",onAbort:"onAbort"},features:[o.GFd],decls:0,vars:0,template:function CoreQuestionBaseComponent_Template(e,t){},encapsulation:2}),CoreQuestionBaseComponent})()}}]);