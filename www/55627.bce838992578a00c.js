"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[55627],{55627:(e,t,n)=>{n.r(t),n.d(t,{CoreFileUploaderAudioRecorderComponent:()=>ne});var r=n(10467),o=n(23676),i=n(18022),a=n(79555),s=n(84412),c=n(84572),l=n(71985);function assertType(e,t,...n){if(!e)throw new TypeError(format(t,n))}function format(e,t){let n=0;return e.replace(/%[os]/gu,(()=>anyToString(t[n++])))}function anyToString(e){return"object"!=typeof e||null===e?String(e):Object.prototype.toString.call(e)}const d="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:void 0;class Warning{constructor(e,t){this.code=e,this.message=t}warn(...e){var t;try{undefined;const n=(null!==(t=(new Error).stack)&&void 0!==t?t:"").replace(/^(?:.+?\n){2}/gu,"\n");console.warn(this.message,...e,n)}catch(e){}}}const u=new Warning("W01","Unable to initialize event under dispatching."),p=new Warning("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),g=new Warning("W03","Assigning any truthy value to 'returnValue' property has no effect."),h=new Warning("W04","Unable to preventDefault on non-cancelable events."),v=new Warning("W05","Unable to preventDefault inside passive event listener invocation."),_=new Warning("W06","An event listener wasn't added because it has been added already: %o, %o"),m=new Warning("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),f=new Warning("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),b=new Warning("W09","Event attribute handler must be a function: %o");class Event$1{static get NONE(){return C}static get CAPTURING_PHASE(){return E}static get AT_TARGET(){return R}static get BUBBLING_PHASE(){return y}constructor(e,t){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=null!=t?t:{};A.set(this,{type:String(e),bubbles:Boolean(n.bubbles),cancelable:Boolean(n.cancelable),composed:Boolean(n.composed),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return $(this).type}get target(){return $(this).target}get srcElement(){return $(this).target}get currentTarget(){return $(this).currentTarget}composedPath(){const e=$(this).currentTarget;return e?[e]:[]}get NONE(){return C}get CAPTURING_PHASE(){return E}get AT_TARGET(){return R}get BUBBLING_PHASE(){return y}get eventPhase(){return $(this).dispatchFlag?2:0}stopPropagation(){$(this).stopPropagationFlag=!0}get cancelBubble(){return $(this).stopPropagationFlag}set cancelBubble(e){e?$(this).stopPropagationFlag=!0:p.warn()}stopImmediatePropagation(){const e=$(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return $(this).bubbles}get cancelable(){return $(this).cancelable}get returnValue(){return!$(this).canceledFlag}set returnValue(e){e?g.warn():setCancelFlag($(this))}preventDefault(){setCancelFlag($(this))}get defaultPrevented(){return $(this).canceledFlag}get composed(){return $(this).composed}get isTrusted(){return!1}get timeStamp(){return $(this).timeStamp}initEvent(e,t=!1,n=!1){const r=$(this);if(r.dispatchFlag)return u.warn(),void 0;A.set(this,Object.assign({},r,{type:String(e),bubbles:Boolean(t),cancelable:Boolean(n),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1}))}}const C=0,E=1,R=2,y=3,A=new WeakMap;function $(e,t="this"){const n=A.get(e);return assertType(null!=n,"'%s' must be an object that Event constructor created, but got another one: %o",t,e),n}function setCancelFlag(e){return e.inPassiveListenerFlag?(v.warn(),void 0):e.cancelable?(e.canceledFlag=!0,void 0):(h.warn(),void 0)}Object.defineProperty(Event$1,"NONE",{enumerable:!0}),Object.defineProperty(Event$1,"CAPTURING_PHASE",{enumerable:!0}),Object.defineProperty(Event$1,"AT_TARGET",{enumerable:!0}),Object.defineProperty(Event$1,"BUBBLING_PHASE",{enumerable:!0});const w=Object.getOwnPropertyNames(Event$1.prototype);for(let e=0;e<w.length;++e)"constructor"!==w[e]&&Object.defineProperty(Event$1.prototype,w[e],{enumerable:!0});let O;void 0!==d&&void 0!==d.Event&&Object.setPrototypeOf(Event$1.prototype,d.Event.prototype);const T={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function defineErrorCodeProperties(e){const t=Object.keys(T);for(let n=0;n<t.length;++n){const r=t[n],o=T[r];Object.defineProperty(e,r,{get:()=>o,configurable:!0,enumerable:!0})}}class EventWrapper extends Event$1{static wrap(e){return new(getWrapperClassOf(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),P.set(this,{original:e});const t=Object.keys(e);for(let n=0;n<t.length;++n){const r=t[n];r in this||Object.defineProperty(this,r,defineRedirectDescriptor(e,r))}}stopPropagation(){super.stopPropagation();const{original:e}=$$1(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;const{original:t}=$$1(this);"cancelBubble"in t&&(t.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();const{original:e}=$$1(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;const{original:t}=$$1(this);"returnValue"in t&&(t.returnValue=e)}preventDefault(){super.preventDefault();const{original:e}=$$1(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){const{original:e}=$$1(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}}const P=new WeakMap;function $$1(e){const t=P.get(e);return assertType(null!=t,"'this' is expected an Event object, but got",e),t}const M=new WeakMap;function getWrapperClassOf(e){const t=Object.getPrototypeOf(e);if(null==t)return EventWrapper;let n=M.get(t);return null==n&&(n=function defineWrapper(e,t){class CustomEventWrapper extends e{}const n=Object.keys(t);for(let e=0;e<n.length;++e)Object.defineProperty(CustomEventWrapper.prototype,n[e],defineRedirectDescriptor(t,n[e]));return CustomEventWrapper}(getWrapperClassOf(t),t),M.set(t,n)),n}function defineRedirectDescriptor(e,t){const n=Object.getOwnPropertyDescriptor(e,t);return{get(){const e=$$1(this).original,n=e[t];return"function"==typeof n?n.bind(e):n},set(e){$$1(this).original[t]=e},configurable:n.configurable,enumerable:n.enumerable}}function isCapture(e){return!(1&~e.flags)}function isPassive(e){return!(2&~e.flags)}function isOnce(e){return!(4&~e.flags)}function isRemoved(e){return!(8&~e.flags)}function invokeCallback({callback:e},t,n){try{"function"==typeof e?e.call(t,n):"function"==typeof e.handleEvent&&e.handleEvent(n)}catch(e){!function reportError(e){try{const t=e instanceof Error?e:new Error(anyToString(e));if(void 0,"function"==typeof dispatchEvent&&"function"==typeof ErrorEvent)dispatchEvent(new ErrorEvent("error",{error:t,message:t.message}));else if("undefined"!=typeof process&&"function"==typeof process.emit)return process.emit("uncaughtException",t),void 0;console.error(t)}catch(e){}}(e)}}function findIndexOfListener({listeners:e},t,n){for(let r=0;r<e.length;++r)if(e[r].callback===t&&isCapture(e[r])===n)return r;return-1}function addListener(e,t,n,r,o,i){let a;i&&(a=removeListener.bind(null,e,t,n),i.addEventListener("abort",a));const s=function createListener(e,t,n,r,o,i){return{callback:e,flags:(t?1:0)|(n?2:0)|(r?4:0),signal:o,signalListener:i}}(t,n,r,o,i,a);return e.cow?(e.cow=!1,e.listeners=[...e.listeners,s]):e.listeners.push(s),s}function removeListener(e,t,n){const r=findIndexOfListener(e,t,n);return-1!==r&&removeListenerAt(e,r)}function removeListenerAt(e,t,n=!1){const r=e.listeners[t];return!function setRemoved(e){e.flags|=8}(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),e.cow&&!n?(e.cow=!1,e.listeners=e.listeners.filter(((e,n)=>n!==t)),!1):(e.listeners.splice(t,1),!0)}function ensureListenerList(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e[t]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}M.set(Object.prototype,EventWrapper),void 0!==d&&void 0!==d.Event&&M.set(d.Event.prototype,EventWrapper);class EventTarget{constructor(){I.set(this,function createListenerListMap(){return Object.create(null)}())}addEventListener(e,t,n){const r=$$2(this),{callback:o,capture:i,once:a,passive:s,signal:c,type:l}=function normalizeAddOptions(e,t,n){var r;if(assertCallback(t),"object"==typeof n&&null!==n)return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture),passive:Boolean(n.passive),once:Boolean(n.once),signal:null!==(r=n.signal)&&void 0!==r?r:void 0};return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n),passive:!1,once:!1,signal:void 0}}(e,t,n);if(null==o||(null==c?void 0:c.aborted))return;const d=ensureListenerList(r,l),u=findIndexOfListener(d,o,i);if(-1!==u)return!function warnDuplicate(e,t,n,r){_.warn(isCapture(e)?"capture":"bubble",e.callback),isPassive(e)!==t&&m.warn("passive");isOnce(e)!==n&&m.warn("once");e.signal!==r&&m.warn("signal")}(d.listeners[u],s,a,c),void 0;addListener(d,o,i,s,a,c)}removeEventListener(e,t,n){const r=$$2(this),{callback:o,capture:i,type:a}=function normalizeOptions(e,t,n){if(assertCallback(t),"object"==typeof n&&null!==n)return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture)};return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n)}}(e,t,n),s=r[a];null!=o&&s&&removeListener(s,o,i)}dispatchEvent(e){const t=$$2(this)[String(e.type)];if(null==t)return!0;const n=e instanceof Event$1?e:EventWrapper.wrap(e),r=$(n,"event");if(r.dispatchFlag)throw function createInvalidStateError(e){return d.DOMException?new d.DOMException(e,"InvalidStateError"):(null==O&&(O=class DOMException extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,DOMException)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(O.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),defineErrorCodeProperties(O),defineErrorCodeProperties(O.prototype)),new O(e))}("This event has been in dispatching.");if(r.dispatchFlag=!0,r.target=r.currentTarget=this,!r.stopPropagationFlag){const{cow:e,listeners:o}=t;t.cow=!0;for(let i=0;i<o.length;++i){const a=o[i];if(!isRemoved(a)&&(isOnce(a)&&removeListenerAt(t,i,!e)&&(i-=1),r.inPassiveListenerFlag=isPassive(a),invokeCallback(a,this,n),r.inPassiveListenerFlag=!1,r.stopImmediatePropagationFlag))break}e||(t.cow=!1)}return r.target=null,r.currentTarget=null,r.stopImmediatePropagationFlag=!1,r.stopPropagationFlag=!1,r.dispatchFlag=!1,!r.canceledFlag}}const I=new WeakMap;function $$2(e,t="this"){const n=I.get(e);return assertType(null!=n,"'%s' must be an object that EventTarget constructor created, but got another one: %o",t,e),n}function assertCallback(e){if("function"!=typeof e&&("object"!=typeof e||null===e||"function"!=typeof e.handleEvent)){if(null==e||"object"==typeof e)return f.warn(e),void 0;throw new TypeError(format(f.message,[e]))}}const F=Object.getOwnPropertyNames(EventTarget.prototype);for(let e=0;e<F.length;++e)"constructor"!==F[e]&&Object.defineProperty(EventTarget.prototype,F[e],{enumerable:!0});function setEventAttributeValue(e,t,n){null!=n&&"function"!=typeof n&&b.warn(n),"function"==typeof n||"object"==typeof n&&null!==n?function upsertEventAttributeListener(e,t,n){const r=ensureListenerList($$2(e,"target"),String(t));r.attrCallback=n,null==r.attrListener&&(r.attrListener=addListener(r,function defineEventAttributeCallback(e){return function(t){const n=e.attrCallback;"function"==typeof n&&n.call(this,t)}}(r),!1,!1,!1,void 0))}(e,t,n):function removeEventAttributeListener(e,t){const n=$$2(e,"target"),r=n[String(t)];r&&r.attrListener&&(removeListener(r,r.attrListener.callback,!1),r.attrCallback=r.attrListener=void 0)}(e,t)}function defineEventAttribute(e,t,n){Object.defineProperty(e,`on${t}`,{get(){return function getEventAttributeValue(e,t){var n,r;return null!==(r=null===(n=$$2(e,"target")[t])||void 0===n?void 0:n.attrCallback)&&void 0!==r?r:null}(this,t)},set(e){setEventAttributeValue(this,t,e)},configurable:!0,enumerable:!0})}void 0!==d&&void 0!==d.EventTarget&&Object.setPrototypeOf(EventTarget.prototype,d.EventTarget.prototype);var L=function(e){return e.DATA_AVAILABLE="DATA_AVAILABLE",e.START_RECORDING="START_RECORDING",e.STOP_RECORDING="STOP_RECORDING",e.ERROR="ERROR",e.BLOB_READY="BLOB_READY",e.WORKER_RECORDING="WORKER_RECORDING",e}(L||{});const k="audio/mpeg",x=window.AudioContext||window.webkitAudioContext;let S=(()=>{class Mp3MediaRecorder extends EventTarget{constructor(e,{audioContext:t,worker:n}){if(super(),this.mimeType=k,this.state="inactive",this.audioBitsPerSecond=0,this.videoBitsPerSecond=0,this.isInternalAudioContext=!1,this.onWorkerMessage=e=>{const t=e.data;switch(t.type){case L.WORKER_RECORDING:{const e=new Event("start");this.dispatchEvent(e),this.state="recording";break}case L.ERROR:{const e=new Error(t.error),n=new Event("error");n.error=e,this.dispatchEvent(n),this.state="inactive";break}case L.BLOB_READY:{const e=new Event("stop"),n=new Event("dataavailable");n.data=t.blob,n.timecode=Date.now();const r=window.BlobEvent?new BlobEvent("dataavailable",{data:t.blob,timecode:Date.now()}):n;this.dispatchEvent(r),this.dispatchEvent(e),this.state="inactive";break}case L.ERROR:throw new Error(t.error)}},!n)throw new Error("No worker provided in Mp3MediaRecorder constructor.");var r;this.stream=e,this.isInternalAudioContext=!t,this.audioContext=t||new x,this.worker=n,this.sourceNode=this.audioContext.createMediaStreamSource(e),this.gainNode=((r=this.audioContext).createGain||r.createGainNode).call(r),this.gainNode.gain.value=1,this.processorNode=(e=>(e.createScriptProcessor||e.createJavaScriptNode).call(e,4096,1,1))(this.audioContext),this.sourceNode.connect(this.gainNode),this.gainNode.connect(this.processorNode),this.worker.onmessage=this.onWorkerMessage}start(){if("inactive"!==this.state)throw this.getStateError("start");this.processorNode.onaudioprocess=e=>{var t;this.worker.postMessage((t=e.inputBuffer.getChannelData(0),{type:L.DATA_AVAILABLE,data:t}))},this.processorNode.connect(this.audioContext.destination),"closed"===this.audioContext.state?this.audioContext=new AudioContext:"suspended"===this.audioContext.state&&this.audioContext.resume(),this.worker.postMessage({type:L.START_RECORDING,config:{sampleRate:this.audioContext.sampleRate}})}stop(){if("inactive"===this.state)throw this.getStateError("stop");this.processorNode.disconnect(),this.isInternalAudioContext&&this.audioContext.close(),this.worker.postMessage({type:L.STOP_RECORDING})}pause(){if("inactive"===this.state)throw this.getStateError("pause");this.audioContext.suspend().then((()=>{this.state="paused",this.dispatchEvent(new Event("pause"))}))}resume(){if("inactive"===this.state)throw this.getStateError("resume");this.audioContext.resume().then((()=>{this.state="recording",this.dispatchEvent(new Event("resume"))}))}requestData(){}getStateError(e){return new Error(`Failed to execute '${e}' on 'MediaRecorder': The MediaRecorder's state is '${this.state}'.`)}}return Mp3MediaRecorder.isTypeSupported=e=>e===k,Mp3MediaRecorder})();defineEventAttribute(S.prototype,"start"),defineEventAttribute(S.prototype,"stop"),defineEventAttribute(S.prototype,"pause"),defineEventAttribute(S.prototype,"resume"),defineEventAttribute(S.prototype,"dataavailable"),defineEventAttribute(S.prototype,"error");var U=n(76496),D=n(88141),N=n(96354);var B=n(19751),j=n(45507),G=n(8756),W=n(246),H=n(86654),V=n(91416),Y=n(54438);const z=["canvas"];let X=(()=>{var e;class CoreFileUploaderAudioHistogramComponent{constructor({nativeElement:e}){this.paused=!1,this.destroyed=!1,this.element=e}ngAfterViewInit(){var e,t;this.canvas=null===(e=this.canvasRef)||void 0===e?void 0:e.nativeElement,this.context=null===(t=this.canvas)||void 0===t?void 0:t.getContext("2d"),this.buffer=new Uint8Array(this.analyser.fftSize),this.updateCanvas(this.element.clientWidth,this.element.clientHeight),this.draw()}ngOnDestroy(){this.destroyed=!0}draw(){if(this.destroyed||!this.canvas||!this.context||!this.buffer)return;this.canvas.width===this.element.clientWidth&&this.canvas.height===this.element.clientHeight||this.updateCanvas(this.element.clientWidth,this.element.clientHeight);const e=this.canvas.width,t=this.canvas.height,n=CoreFileUploaderAudioHistogramComponent.BARS_WIDTH,r=CoreFileUploaderAudioHistogramComponent.BARS_GUTTER,o=Math.floor(this.buffer.length/((e-n-1)/(n+r))),i=Math.floor(this.buffer.length/o);this.context.fillRect(0,0,e,t);const a=Math.floor((e-(n+r)*i-n-1)/2);this.context.beginPath(),this.paused?this.drawPausedBars(a):this.drawActiveBars(a),this.context.stroke(),requestAnimationFrame((()=>this.draw()))}drawActiveBars(e){if(!this.canvas||!this.context||!this.buffer)return;let t=0;const n=this.canvas.height/2,r=CoreFileUploaderAudioHistogramComponent.BARS_MIN_HEIGHT/2,o=CoreFileUploaderAudioHistogramComponent.BARS_WIDTH,i=CoreFileUploaderAudioHistogramComponent.BARS_GUTTER,a=this.buffer.length,s=Math.floor(a/((this.canvas.width-o-1)/(o+i)));for(this.analyser.getByteTimeDomainData(this.buffer);t<a;){let c=r;do{c=Math.max(c,n*(1-this.buffer[t]/128)),t++}while(t%s!=0&&t<a);this.context.moveTo(e,n-c),this.context.lineTo(e,n+c),e+=o+i}}drawPausedBars(e){if(!this.canvas||!this.context)return;const t=this.canvas.width,n=this.canvas.height/2,r=CoreFileUploaderAudioHistogramComponent.BARS_MIN_HEIGHT/2,o=CoreFileUploaderAudioHistogramComponent.BARS_WIDTH+CoreFileUploaderAudioHistogramComponent.BARS_GUTTER;for(;e<t;)this.context.moveTo(e,n-r),this.context.lineTo(e,n+r),e+=o}updateCanvas(e,t){if(!this.canvas||!this.context)return;const n=getComputedStyle(this.element);this.canvas.width=e,this.canvas.height=t,this.context.fillStyle=n.getPropertyValue("--background-color"),this.context.lineCap="round",this.context.lineWidth=CoreFileUploaderAudioHistogramComponent.BARS_WIDTH,this.context.strokeStyle=n.getPropertyValue("--bars-color")}}return(e=CoreFileUploaderAudioHistogramComponent).BARS_WIDTH=2,e.BARS_MIN_HEIGHT=4,e.BARS_GUTTER=4,e.ɵfac=function CoreFileUploaderAudioHistogramComponent_Factory(t){return new(t||e)(Y.rXU(Y.aKT))},e.ɵcmp=Y.VBU({type:e,selectors:[["core-audio-histogram"]],viewQuery:function CoreFileUploaderAudioHistogramComponent_Query(e,t){if(1&e&&Y.GBs(z,5),2&e){let e;Y.mGM(e=Y.lsd())&&(t.canvasRef=e.first)}},inputs:{analyser:"analyser",paused:[Y.Mj6.HasDecoratorInputTransform,"paused","paused",V.G]},standalone:!0,features:[Y.GFd,Y.aNF],decls:2,vars:0,consts:[["canvas",""]],template:function CoreFileUploaderAudioHistogramComponent_Template(e,t){1&e&&Y.nrm(0,"canvas",null,0)},dependencies:[H.n],styles:["[_nghost-%COMP%]{--background-color: var(--ion-background-color, #fff);--bars-color: var(--ion-text-color, #000);position:relative}[_nghost-%COMP%]   canvas[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}"],changeDetection:0}),CoreFileUploaderAudioHistogramComponent})();var q=n(25572),K=n(60177),J=n(2910),Q=n(32458),Z=n(86198),ee=n(43570),te=n(73955);function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_1_Template(e,t){if(1&e){const e=Y.RV6();Y.j41(0,"div",4)(1,"p"),Y.EFF(2),Y.nI1(3,"translate"),Y.k0s(),Y.j41(4,"ion-button",5),Y.nI1(5,"translate"),Y.bIt("click",(function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_1_Template_ion_button_click_4_listener(){Y.eBV(e);const t=Y.XpG(2);return Y.Njj(t.startRecording())})),Y.nrm(6,"ion-icon",6),Y.k0s()()}2&e&&(Y.R7$(2),Y.JRh(Y.bMT(3,2,"core.fileuploader.startrecordinginstructions")),Y.R7$(2),Y.Y8G("ariaLabel",Y.bMT(5,4,"core.fileuploader.startrecording")))}function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_core_audio_histogram_1_Template(e,t){if(1&e&&Y.nrm(0,"core-audio-histogram",16),2&e){const e=t.ngIf,n=Y.XpG(2).ngIf;Y.Y8G("analyser",e)("paused","recording-ongoing"!==n)}}function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_div_5_Template(e,t){1&e&&Y.nrm(0,"div",17)}function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_8_Template(e,t){if(1&e){const e=Y.RV6();Y.j41(0,"ion-button",0),Y.nI1(1,"translate"),Y.bIt("click",(function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_8_Template_ion_button_click_0_listener(){Y.eBV(e);const t=Y.XpG(3);return Y.Njj(t.pauseRecording())})),Y.nrm(2,"ion-icon",18),Y.k0s()}2&e&&Y.Y8G("ariaLabel",Y.bMT(1,1,"core.fileuploader.pauserecording"))}function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_9_Template(e,t){if(1&e){const e=Y.RV6();Y.j41(0,"ion-button",19),Y.nI1(1,"translate"),Y.bIt("click",(function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_9_Template_ion_button_click_0_listener(){Y.eBV(e);const t=Y.XpG(3);return Y.Njj(t.resumeRecording())})),Y.nrm(2,"ion-icon",6),Y.k0s()}2&e&&Y.Y8G("ariaLabel",Y.bMT(1,1,"core.fileuploader.resumerecording"))}function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_Template(e,t){if(1&e){const e=Y.RV6();Y.j41(0,"div",4),Y.DNE(1,CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_core_audio_histogram_1_Template,1,2,"core-audio-histogram",7),Y.nI1(2,"async"),Y.j41(3,"div",8)(4,"div",9),Y.DNE(5,CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_div_5_Template,1,0,"div",10),Y.nrm(6,"core-chrono",11),Y.k0s(),Y.j41(7,"div",12),Y.DNE(8,CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_8_Template,3,3,"ion-button",13)(9,CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_9_Template,3,3,"ion-button",14),Y.k0s(),Y.j41(10,"div",12)(11,"ion-button",0),Y.nI1(12,"translate"),Y.bIt("click",(function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_Template_ion_button_click_11_listener(){Y.eBV(e);const t=Y.XpG(2);return Y.Njj(t.stopRecording())})),Y.nrm(13,"ion-icon",15),Y.k0s()()()()}if(2&e){const e=Y.XpG().ngIf,t=Y.XpG();Y.R7$(),Y.Y8G("ngIf",Y.bMT(2,9,t.histogramAnalyzer$)),Y.R7$(4),Y.Y8G("ngIf","recording-ongoing"===e),Y.R7$(),Y.AVh("recording","recording-ongoing"===e),Y.Y8G("running","recording-ongoing"===e)("hours",!1),Y.R7$(2),Y.Y8G("ngIf","recording-ongoing"===e),Y.R7$(),Y.Y8G("ngIf","recording-paused"===e),Y.R7$(2),Y.Y8G("ariaLabel",Y.bMT(12,11,"core.fileuploader.stoprecording"))}}function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_audio_1_Template(e,t){if(1&e&&(Y.j41(0,"audio",23),Y.nrm(1,"source",24),Y.k0s()),2&e){const e=t.ngIf;Y.R7$(),Y.Y8G("src",e,Y.B4B)}}function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template(e,t){if(1&e){const e=Y.RV6();Y.j41(0,"div",4),Y.DNE(1,CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_audio_1_Template,2,1,"audio",20),Y.nI1(2,"async"),Y.j41(3,"div",8)(4,"div",12)(5,"ion-button",19),Y.nI1(6,"translate"),Y.bIt("click",(function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template_ion_button_click_5_listener(){Y.eBV(e);const t=Y.XpG(2);return Y.Njj(t.discardRecording())})),Y.nrm(7,"ion-icon",21),Y.k0s()(),Y.j41(8,"div",12)(9,"ion-button",22),Y.bIt("click",(function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template_ion_button_click_9_listener(){Y.eBV(e);const t=Y.XpG(2);return Y.Njj(t.submit())})),Y.EFF(10),Y.nI1(11,"translate"),Y.k0s()()()()}if(2&e){const e=Y.XpG(2);Y.R7$(),Y.Y8G("ngIf",Y.bMT(2,3,e.recordingUrl$)),Y.R7$(4),Y.Y8G("ariaLabel",Y.bMT(6,5,"core.fileuploader.discardrecording")),Y.R7$(5),Y.SpI(" ",Y.bMT(11,7,"core.save")," ")}}function CoreFileUploaderAudioRecorderComponent_ng_container_8_Template(e,t){if(1&e&&(Y.qex(0),Y.DNE(1,CoreFileUploaderAudioRecorderComponent_ng_container_8_div_1_Template,7,6,"div",3)(2,CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_Template,14,13,"div",3)(3,CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template,12,9,"div",3),Y.bVm()),2&e){const e=t.ngIf;Y.R7$(),Y.Y8G("ngIf","empty"===e),Y.R7$(),Y.Y8G("ngIf",e.startsWith("recording")),Y.R7$(),Y.Y8G("ngIf","done"===e)}}let ne=(()=>{var e;class CoreFileUploaderAudioRecorderComponent extends o.O{constructor(e){super(e),this.recording=null,this.media$=new s.t(null),this.recording$=this.media$.pipe(function recorderAudioRecording(){return e=>new l.c((t=>{let n,r=[];const onDataAvailable=e=>r.push(e.data),onError=e=>q.CoreAlerts.showError(e.error),onStop=()=>{const e=new Blob(r,{type:"audio/mpeg"});t.next({url:URL.createObjectURL(e),blob:e})},o=e.subscribe((e=>{var o,i,a;null===(o=n)||void 0===o||o.removeEventListener("dataavailable",onDataAvailable),null===(i=n)||void 0===i||i.removeEventListener("error",onError),null===(a=n)||void 0===a||a.removeEventListener("stop",onStop),null==e||e.recorder.addEventListener("dataavailable",onDataAvailable),null==e||e.recorder.addEventListener("error",onError),null==e||e.recorder.addEventListener("stop",onStop),r=[],n=null==e?void 0:e.recorder,t.next(null)}));return t.next(null),()=>{var e,t,r;o.unsubscribe(),null===(e=n)||void 0===e||e.removeEventListener("dataavailable",onDataAvailable),null===(t=n)||void 0===t||t.removeEventListener("error",onError),null===(r=n)||void 0===r||r.removeEventListener("stop",onStop)}}))}(),(0,U.t)(),(0,D.M)((e=>this.recording=e))),this.recordingUrl$=this.recording$.pipe((0,N.T)((e=>e&&a.up.bypassSecurityTrustUrl(e.url)))),this.histogramAnalyzer$=this.media$.pipe((0,N.T)((e=>null==e||!e.analyser||i.CorePlatform.prefersReducedMotion()?null:e.analyser))),this.status$=(0,c.z)([this.media$.pipe((e=>new l.c((t=>{let n;const onStart=()=>t.next("recording"),onPause=()=>t.next("paused"),onResume=()=>t.next("recording"),onStop=()=>t.next("inactive"),r=e.subscribe((e=>{var r,o,i,a,s;null===(r=n)||void 0===r||r.removeEventListener("start",onStart),null===(o=n)||void 0===o||o.removeEventListener("pause",onPause),null===(i=n)||void 0===i||i.removeEventListener("resume",onResume),null===(a=n)||void 0===a||a.removeEventListener("stop",onStop),null==e||e.recorder.addEventListener("start",onStart),null==e||e.recorder.addEventListener("pause",onPause),null==e||e.recorder.addEventListener("resume",onResume),null==e||e.recorder.addEventListener("stop",onStop),n=null==e?void 0:e.recorder,t.next(null!==(s=null==e?void 0:e.recorder.state)&&void 0!==s?s:"inactive")}));return t.next("inactive"),()=>{var e,t,o,i;r.unsubscribe(),null===(e=n)||void 0===e||e.removeEventListener("start",onStart),null===(t=n)||void 0===t||t.removeEventListener("pause",onPause),null===(o=n)||void 0===o||o.removeEventListener("resume",onResume),null===(i=n)||void 0===i||i.removeEventListener("stop",onStop)}}))),(0,U.t)()),this.recording$]).pipe((0,N.T)((([e,t])=>"recording"===e?"recording-ongoing":"paused"===e?"recording-paused":t?"done":"empty")))}ngOnDestroy(){var e;const t=null===(e=this.media$.value)||void 0===e?void 0:e.recorder;t&&"inactive"!==t.state&&t.stop()}startRecording(){var e=this;return(0,r.A)((function*(){try{const t=yield e.createMedia();e.media$.next(t),t.recorder.start()}catch(e){q.CoreAlerts.showError(e)}}))()}stopRecording(){try{var e;null===(e=this.media$.value)||void 0===e||e.recorder.stop()}catch(e){q.CoreAlerts.showError(e)}}pauseRecording(){try{var e;null===(e=this.media$.value)||void 0===e||e.recorder.pause()}catch(e){q.CoreAlerts.showError(e)}}resumeRecording(){try{var e;null===(e=this.media$.value)||void 0===e||e.recorder.resume()}catch(e){q.CoreAlerts.showError(e)}}discardRecording(){this.media$.next(null)}cancel(){var e=this;return(0,r.A)((function*(){e.close(new B.CoreCaptureError(B.CAPTURE_ERROR_NO_MEDIA_FILES))}))()}submit(){var e=this;return(0,r.A)((function*(){if(e.recording)try{const t=yield j.CoreFile.getUniqueNameInFolder(j.CoreFileProvider.TMPFOLDER,"recording.mp3"),n=G.$.concatenatePaths(j.CoreFileProvider.TMPFOLDER,t),r=yield j.CoreFile.writeFile(n,e.recording.blob);e.close({name:r.name,fullPath:j.CoreFile.getFileEntryURL(r),type:"audio/mpeg"})}catch(e){q.CoreAlerts.showError(e)}}))()}createMedia(){var e=this;return(0,r.A)((function*(){yield e.prepareMicrophoneAuthorization();const t=yield navigator.mediaDevices.getUserMedia({audio:!0}),n=new window.AudioContext,r=n.createMediaStreamSource(t),o=n.createAnalyser();return o.fftSize=2048,r.connect(o),{analyser:o,recorder:new S(t,{worker:e.startWorker(),audioContext:n})}}))()}prepareMicrophoneAuthorization(){return(0,r.A)((function*(){var e;const t=yield null===(e=W.b.plugin("diagnostic"))||void 0===e?void 0:e.getInstance();if(!i.CorePlatform.isMobile()||!t)return;switch(yield t.requestMicrophoneAuthorization()){case t.permissionStatus.deniedOnce:case t.permissionStatus.deniedAlways:throw new Error(a.HT.instant("core.fileuploader.microphonepermissiondenied"));case t.permissionStatus.restricted:throw new Error(a.HT.instant("core.fileuploader.microphonepermissionrestricted"))}}))()}startWorker(){const e=new Worker(n.tu(new URL(n.p+n.u(46713),n.b)));return e.postMessage(function initAudioEncoderMessage(e){return{name:"init-audio-encoder",config:e}}({vmsgWasmUrl:`${document.head.baseURI}assets/lib/vmsg/vmsg.wasm`})),e}}return(e=CoreFileUploaderAudioRecorderComponent).ɵfac=function CoreFileUploaderAudioRecorderComponent_Factory(t){return new(t||e)(Y.rXU(Y.aKT))},e.ɵcmp=Y.VBU({type:e,selectors:[["core-fileuploader-audio-recorder"]],standalone:!0,features:[Y.Vt3,Y.aNF],decls:10,vars:9,consts:[["shape","round","fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","close"],[4,"ngIf"],["class","core-audio-recorder--wrapper",4,"ngIf"],[1,"core-audio-recorder--wrapper"],["shape","round","color","danger",3,"click","ariaLabel"],["slot","icon-only","name","fas-microphone"],[3,"analyser","paused",4,"ngIf"],[1,"core-audio-recorder--controls"],[1,"core-audio-recorder--control","chrono"],["class","core-audio-recorder--recording-marker",4,"ngIf"],[3,"running","hours"],[1,"core-audio-recorder--control"],["shape","round","fill","clear",3,"ariaLabel","click",4,"ngIf"],["shape","round","fill","clear","color","danger",3,"ariaLabel","click",4,"ngIf"],["slot","icon-only","name","fas-check","aria-hidden","true"],[3,"analyser","paused"],[1,"core-audio-recorder--recording-marker"],["slot","icon-only","name","fas-circle-pause"],["shape","round","fill","clear","color","danger",3,"click","ariaLabel"],["controls","","controlsList","nodownload",4,"ngIf"],["slot","icon-only","name","fas-trash"],[3,"click"],["controls","","controlsList","nodownload"],[3,"src"]],template:function CoreFileUploaderAudioRecorderComponent_Template(e,t){1&e&&(Y.j41(0,"header")(1,"h1"),Y.EFF(2),Y.nI1(3,"translate"),Y.k0s(),Y.j41(4,"ion-button",0),Y.nI1(5,"translate"),Y.bIt("click",(function CoreFileUploaderAudioRecorderComponent_Template_ion_button_click_4_listener(){return t.cancel()})),Y.nrm(6,"ion-icon",1),Y.k0s()(),Y.nrm(7,"hr"),Y.DNE(8,CoreFileUploaderAudioRecorderComponent_ng_container_8_Template,4,3,"ng-container",2),Y.nI1(9,"async")),2&e&&(Y.R7$(2),Y.JRh(Y.bMT(3,3,"core.fileuploader.audiotitle")),Y.R7$(2),Y.Y8G("ariaLabel",Y.bMT(5,5,"core.close")),Y.R7$(4),Y.Y8G("ngIf",Y.bMT(9,7,t.status$)))},dependencies:[H.n,K.bT,J.Jm,J.iq,Q.e,Z.t,ee.T,K.Jj,te.D9,X],styles:["[_nghost-%COMP%]{color:var(--ion-text-color, #000)}[_nghost-%COMP%]   header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}[_nghost-%COMP%]   header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font:var(--mdl-typography-body-font-lg);letter-spacing:.15px}[_nghost-%COMP%]   header[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;--icon-size: 1.8em;margin:calc((var(--icon-size) - var(--a11y-sizing-minTargetSize)) / 2)}[_nghost-%COMP%]   hr[_ngcontent-%COMP%]{background:var(--gray-300);margin:16px 0}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font:var(--mdl-typography-body-font-md);letter-spacing:.25px;text-align:center;opacity:.6;margin-top:0;margin-bottom:16px}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   ion-button[shape=round][_ngcontent-%COMP%]{--border-radius: 99px;--padding-start: 16px;--padding-end: 16px;--padding-top: 16px;--padding-bottom: 16px;height:max-content}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   core-audio-histogram[_ngcontent-%COMP%]{width:100%;height:35px;display:block}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   audio[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;align-items:center;justify-content:space-between}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]{width:33%;text-align:center}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]:first-child{text-align:start}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]:last-child{text-align:end}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control.chrono[_ngcontent-%COMP%]{padding:0 16px;display:flex;flex-direction:row;align-items:center;justify-content:flex-start}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]   .core-audio-recorder--recording-marker[_ngcontent-%COMP%]{width:8px;height:8px;margin-inline-end:4px;border-radius:4px;background:var(--danger)}[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]   core-chrono.recording[_ngcontent-%COMP%]{color:var(--danger)}"],changeDetection:0}),CoreFileUploaderAudioRecorderComponent})()}}]);