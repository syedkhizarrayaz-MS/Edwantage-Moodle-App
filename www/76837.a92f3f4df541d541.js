"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[76837],{76837:(e,o,t)=>{t.r(o),t.d(o,{default:()=>D});var r=t(10467),s=t(52749),n=t(81690),i=t(66110),a=t(79555),l=t(15324),c=t(49882),d=t(22693),g=t(24742),u=t(9538),C=t(25572),_=t(16449),h=t(86654),m=t(54438),p=t(60177),f=t(2910),y=t(69502),b=t(17388),E=t(16986),I=t(64422),w=t(86198),T=t(58197),R=t(35407),v=t(88246),x=t(73955);const _c0=e=>({$a:e});function CoreCoursesCategoriesPage_core_context_menu_item_10_Template(e,o){if(1&e){const e=m.RV6();m.j41(0,"core-context-menu-item",5),m.nI1(1,"translate"),m.bIt("action",(function CoreCoursesCategoriesPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(){m.eBV(e);const o=m.XpG();return m.Njj(o.toggleDownload())})),m.mxI("toggleChange",(function CoreCoursesCategoriesPage_core_context_menu_item_10_Template_core_context_menu_item_toggleChange_0_listener(o){m.eBV(e);const t=m.XpG();return m.DH7(t.downloadEnabled,o)||(t.downloadEnabled=o),m.Njj(o)})),m.k0s()}if(2&e){const e=m.XpG();m.Y8G("priority",1e3)("content",m.bMT(1,3,"core.settings.showdownloadoptions")),m.R50("toggle",e.downloadEnabled)}}function CoreCoursesCategoriesPage_ion_item_19_p_6_Template(e,o){if(1&e&&(m.j41(0,"p"),m.nrm(1,"core-format-text",18),m.k0s()),2&e){const e=m.XpG(2);m.R7$(),m.Y8G("text",e.currentCategory.description)("contextInstanceId",e.currentCategory.id)}}function CoreCoursesCategoriesPage_ion_item_19_Template(e,o){if(1&e&&(m.j41(0,"ion-item",14),m.nrm(1,"ion-icon",15),m.nI1(2,"translate"),m.j41(3,"ion-label")(4,"p",16),m.nrm(5,"core-format-text",2),m.k0s(),m.DNE(6,CoreCoursesCategoriesPage_ion_item_19_p_6_Template,2,2,"p",17),m.k0s()()),2&e){const e=m.XpG();m.R7$(),m.BMQ("aria-label",m.bMT(2,4,"core.category")),m.R7$(4),m.Y8G("text",e.currentCategory.name)("contextInstanceId",e.currentCategory.id),m.R7$(),m.Y8G("ngIf",e.currentCategory.description)}}function CoreCoursesCategoriesPage_div_20_ion_card_6_ion_badge_7_Template(e,o){if(1&e&&(m.j41(0,"ion-badge",24)(1,"span",25),m.EFF(2),m.k0s(),m.j41(3,"span",26),m.EFF(4),m.nI1(5,"translate"),m.k0s()()),2&e){const e=m.XpG().$implicit;m.R7$(2),m.JRh(e.coursecount),m.R7$(2),m.JRh(m.i5U(5,2,"core.courses.therearecourses",m.eq3(5,_c0,e.coursecount)))}}function CoreCoursesCategoriesPage_div_20_ion_card_6_Template(e,o){if(1&e){const e=m.RV6();m.j41(0,"ion-card")(1,"ion-item",22),m.bIt("click",(function CoreCoursesCategoriesPage_div_20_ion_card_6_Template_ion_item_click_1_listener(){const o=m.eBV(e).$implicit,t=m.XpG(2);return m.Njj(t.openCategory(o.id))})),m.nrm(2,"ion-icon",15),m.nI1(3,"translate"),m.j41(4,"ion-label")(5,"p",16),m.nrm(6,"core-format-text",2),m.k0s()(),m.DNE(7,CoreCoursesCategoriesPage_div_20_ion_card_6_ion_badge_7_Template,6,7,"ion-badge",23),m.k0s()()}if(2&e){const e=o.$implicit,t=m.XpG(2);m.BMQ("data-category-id",e.id),m.R7$(),m.Y8G("detail",!0),m.BMQ("aria-label",e.name),m.R7$(),m.BMQ("aria-label",m.bMT(3,7,"core.category")),m.R7$(4),m.Y8G("text",e.name)("contextInstanceId",e.id),m.R7$(),m.Y8G("ngIf",!t.showOnlyEnrolled&&e.coursecount>0)}}function CoreCoursesCategoriesPage_div_20_Template(e,o){if(1&e&&(m.j41(0,"div",19)(1,"ion-item-divider")(2,"ion-label")(3,"h2",20),m.EFF(4),m.nI1(5,"translate"),m.k0s()()(),m.DNE(6,CoreCoursesCategoriesPage_div_20_ion_card_6_Template,8,9,"ion-card",21),m.k0s()),2&e){const e=m.XpG();m.R7$(4),m.JRh(m.bMT(5,2,"core.courses.categories")),m.R7$(2),m.Y8G("ngForOf",e.categories)}}function CoreCoursesCategoriesPage_div_21_h2_3_Template(e,o){1&e&&(m.j41(0,"h2",20),m.EFF(1),m.nI1(2,"translate"),m.k0s()),2&e&&(m.R7$(),m.JRh(m.bMT(2,1,"core.courses.courses")))}function CoreCoursesCategoriesPage_div_21_h2_4_Template(e,o){1&e&&(m.j41(0,"h2",20),m.EFF(1),m.nI1(2,"translate"),m.k0s()),2&e&&(m.R7$(),m.JRh(m.bMT(2,1,"core.courses.mycourses")))}function CoreCoursesCategoriesPage_div_21_core_courses_course_list_item_5_Template(e,o){if(1&e&&m.nrm(0,"core-courses-course-list-item",30),2&e){const e=o.$implicit,t=m.XpG(2);m.Y8G("course",e)("showDownload",t.downloadEnabled)}}function CoreCoursesCategoriesPage_div_21_Template(e,o){if(1&e&&(m.j41(0,"div",27)(1,"ion-item-divider")(2,"ion-label"),m.DNE(3,CoreCoursesCategoriesPage_div_21_h2_3_Template,3,3,"h2",28)(4,CoreCoursesCategoriesPage_div_21_h2_4_Template,3,3,"h2",28),m.k0s()(),m.DNE(5,CoreCoursesCategoriesPage_div_21_core_courses_course_list_item_5_Template,1,2,"core-courses-course-list-item",29),m.k0s()),2&e){const e=m.XpG();m.R7$(3),m.Y8G("ngIf",!e.showOnlyEnrolled),m.R7$(),m.Y8G("ngIf",e.showOnlyEnrolled),m.R7$(),m.Y8G("ngForOf",e.courses)}}function CoreCoursesCategoriesPage_core_empty_box_22_Template(e,o){1&e&&(m.nrm(0,"core-empty-box",31),m.nI1(1,"translate")),2&e&&m.Y8G("message",m.bMT(1,1,"core.courses.nocoursesyet"))}let D=(()=>{var e;class CoreCoursesCategoriesPage{constructor(){this.categories=[],this.courses=[],this.categoriesLoaded=!1,this.showOnlyEnrolled=!1,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.downloadCoursesEnabled=!1,this.categoryCourses=[],this.categoryId=0,this.isDestroyed=!1,this.title=a.HT.instant("core.courses.categories"),this.currentSiteId=s.CoreSites.getRequiredCurrentSite().getId(),this.myCoursesObserver=c.z.on(u.CORE_COURSES_MY_COURSES_UPDATED_EVENT,(e=>{e.action===u.CoreCoursesMyCoursesUpdatedEventAction.ENROL&&this.fetchCategories()}),this.currentSiteId),this.siteUpdatedObserver=c.z.on(c.z.SITE_UPDATED,(()=>{this.downloadCourseEnabled=!i.CoreCourses.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!i.CoreCourses.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&this.downloadEnabled}),this.currentSiteId),this.downloadEnabledObserver=c.z.on(u.CORE_COURSES_DASHBOARD_DOWNLOAD_ENABLED_CHANGED_EVENT,(e=>{this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&e.enabled})),this.logView=g.j.once((()=>{d.OF.logEvent({type:d.qr.VIEW_ITEM_LIST,ws:"core_course_get_categories",name:this.title,data:{categoryid:this.categoryId,category:"course"},url:"/course/index.php"+(this.categoryId>0?`?categoryid=${this.categoryId}`:"")})}))}ngOnInit(){this.categoryId=l.CoreNavigator.getRouteNumberParam("id")||0,this.showOnlyEnrolled=l.CoreNavigator.getRouteBooleanParam("enrolled")||this.showOnlyEnrolled,this.downloadCourseEnabled=!i.CoreCourses.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!i.CoreCourses.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&i.CoreCourses.getCourseDownloadOptionsEnabled(),this.fetchCategories().finally((()=>{this.categoriesLoaded=!0}))}fetchCategories(){var e=this;return(0,r.A)((function*(){try{const o=yield i.CoreCourses.getCategories(e.categoryId,!0);e.currentCategory=void 0;const t=o.findIndex((o=>o.id==e.categoryId));if(t>=0&&(e.currentCategory=o[t],delete o[t]),o.sort(((e,o)=>e.depth==o.depth?e.sortorder>o.sortorder?1:o.sortorder>e.sortorder?-1:0:e.depth>o.depth?1:-1)),e.categories=n.j.formatTree(o,"parent","id",e.categoryId),e.currentCategory){e.title=e.currentCategory.name;try{e.categoryCourses=yield i.CoreCourses.getCoursesByField("category",e.categoryId),yield e.filterEnrolled()}catch(o){!e.isDestroyed&&C.CoreAlerts.showError(o,{default:a.HT.instant("core.courses.errorloadcourses")})}}e.logView()}catch(o){!e.isDestroyed&&C.CoreAlerts.showError(o,{default:a.HT.instant("core.courses.errorloadcategories")})}}))()}refreshCategories(e){const o=[];o.push(i.CoreCourses.invalidateUserCourses()),o.push(i.CoreCourses.invalidateCategories(this.categoryId,!0)),o.push(i.CoreCourses.invalidateCoursesByField("category",this.categoryId)),o.push(s.CoreSites.getRequiredCurrentSite().invalidateConfig()),Promise.all(o).finally((()=>{this.fetchCategories().finally((()=>{null==e||e.complete()}))}))}openCategory(e){l.CoreNavigator.navigateToSitePath(`courses/categories/${e}`,{params:{enrolled:this.showOnlyEnrolled}})}filterEnrolled(){var e=this;return(0,r.A)((function*(){e.showOnlyEnrolled?(yield Promise.all(e.categoryCourses.map(function(){var e=(0,r.A)((function*(e){if(!(void 0!==e.progress))try{const o=yield i.CoreCourses.getUserCourse(e.id);e.progress=o.progress,e.completionusertracked=o.completionusertracked}catch{}}));return function(o){return e.apply(this,arguments)}}())),e.courses=e.categoryCourses.filter((e=>"progress"in e))):e.courses=e.categoryCourses}))()}toggleDownload(){i.CoreCourses.setCourseDownloadOptionsEnabled(this.downloadEnabled)}ngOnDestroy(){this.myCoursesObserver.off(),this.siteUpdatedObserver.off(),this.downloadEnabledObserver.off(),this.isDestroyed=!0}}return(e=CoreCoursesCategoriesPage).ɵfac=function CoreCoursesCategoriesPage_Factory(o){return new(o||e)},e.ɵcmp=m.VBU({type:e,selectors:[["page-core-courses-categories"]],standalone:!0,features:[m.aNF],decls:23,vars:20,consts:[["slot","start"],[3,"text"],["contextLevel","coursecat",3,"text","contextInstanceId"],["slot","end"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange",4,"ngIf"],["iconAction","toggle",3,"action","toggleChange","priority","content","toggle"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["placeholderType","column","placeholderHeight","108px",3,"hideUntil"],[1,"list-item-limited-width"],["class","ion-text-wrap",4,"ngIf"],["class","core-category-list",4,"ngIf"],["class","core-course-list",4,"ngIf"],["icon","fas-graduation-cap",3,"message",4,"ngIf"],[1,"ion-text-wrap"],["name","fas-folder","slot","start"],[1,"item-heading"],[4,"ngIf"],["collapsible-item","","contextLevel","coursecat",3,"text","contextInstanceId"],[1,"core-category-list"],[1,"big"],[4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap",3,"click","detail"],["slot","end","color","light",4,"ngIf"],["slot","end","color","light"],["aria-hidden","true"],[1,"sr-only"],[1,"core-course-list"],["class","big",4,"ngIf"],[3,"course","showDownload",4,"ngFor","ngForOf"],[3,"course","showDownload"],["icon","fas-graduation-cap",3,"message"]],template:function CoreCoursesCategoriesPage_Template(e,o){1&e&&(m.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),m.nrm(3,"ion-back-button",1),m.nI1(4,"translate"),m.k0s(),m.j41(5,"ion-title")(6,"h1"),m.nrm(7,"core-format-text",2),m.k0s()(),m.j41(8,"ion-buttons",3)(9,"core-context-menu"),m.DNE(10,CoreCoursesCategoriesPage_core_context_menu_item_10_Template,2,5,"core-context-menu-item",4),m.j41(11,"core-context-menu-item",5),m.nI1(12,"translate"),m.bIt("action",(function CoreCoursesCategoriesPage_Template_core_context_menu_item_action_11_listener(){return o.filterEnrolled()})),m.mxI("toggleChange",(function CoreCoursesCategoriesPage_Template_core_context_menu_item_toggleChange_11_listener(e){return m.DH7(o.showOnlyEnrolled,e)||(o.showOnlyEnrolled=e),e})),m.k0s()()()()(),m.j41(13,"ion-content")(14,"ion-refresher",6),m.bIt("ionRefresh",(function CoreCoursesCategoriesPage_Template_ion_refresher_ionRefresh_14_listener(e){return o.refreshCategories(e.target)})),m.nrm(15,"ion-refresher-content",7),m.nI1(16,"translate"),m.k0s(),m.j41(17,"core-loading",8)(18,"ion-list",9),m.DNE(19,CoreCoursesCategoriesPage_ion_item_19_Template,7,6,"ion-item",10)(20,CoreCoursesCategoriesPage_div_20_Template,7,4,"div",11)(21,CoreCoursesCategoriesPage_div_21_Template,6,3,"div",12),m.k0s(),m.DNE(22,CoreCoursesCategoriesPage_core_empty_box_22_Template,2,3,"core-empty-box",13),m.k0s()()),2&e&&(m.R7$(3),m.Y8G("text",m.bMT(4,14,"core.back")),m.R7$(4),m.Y8G("text",o.title)("contextInstanceId",o.currentCategory&&o.currentCategory.id),m.R7$(3),m.Y8G("ngIf",o.downloadCourseEnabled||o.downloadCoursesEnabled),m.R7$(),m.Y8G("priority",900)("content",m.bMT(12,16,"core.courses.showonlyenrolled")),m.R50("toggle",o.showOnlyEnrolled),m.R7$(3),m.Y8G("disabled",!o.categoriesLoaded),m.R7$(),m.FS9("pullingText",m.bMT(16,18,"core.pulltorefresh")),m.R7$(2),m.Y8G("hideUntil",o.categoriesLoaded),m.R7$(2),m.Y8G("ngIf",o.currentCategory),m.R7$(),m.Y8G("ngIf",o.categories.length>0),m.R7$(),m.Y8G("ngIf",o.courses.length>0),m.R7$(),m.Y8G("ngIf",!o.categories.length&&!o.courses.length))},dependencies:[h.n,p.Sq,p.bT,f.In,f.QW,f.b_,f.W9,f.eU,f.iq,f.uz,f.Dg,f.he,f.nf,f.To,f.Ki,f.BC,f.ai,f.el,y.B,b.Q,E.h,I.R,w.t,T.B,R.K,v.i,x.D9,_.CoreCoursesCourseListItemComponent],encapsulation:2}),CoreCoursesCategoriesPage})()}}]);