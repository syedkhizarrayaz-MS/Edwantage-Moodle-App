"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[30054],{30054:(n,e,t)=>{t.r(e),t.d(e,{default:()=>L});var i=t(10467),o=t(74431),a=t(49882),r=t(52749),s=t(85190),c=t(87455),l=t(79555),_=t(82461),g=t(94455),h=t(15324),d=t(47551),u=t(25572),S=t(86654),p=t(54438),m=t(60177),f=t(89417),y=t(2910),C=t(76954),b=t(64422),T=t(13988),I=t(69418),z=t(86198),k=t(88246),v=t(43570),P=t(73955);function CoreSettingsSynchronizationPage_ion_card_26_ng_container_4_Template(n,e){1&n&&(p.qex(0),p.EFF(1),p.nI1(2,"translate"),p.bVm()),2&n&&(p.R7$(),p.SpI(" ",p.bMT(2,1,"core.settings.connectwifitosync"),""))}function CoreSettingsSynchronizationPage_ion_card_26_ng_container_5_Template(n,e){1&n&&(p.qex(0),p.EFF(1),p.nI1(2,"translate"),p.bVm()),2&n&&(p.R7$(),p.JRh(p.bMT(2,1,"core.settings.connecttosync")))}function CoreSettingsSynchronizationPage_ion_card_26_Template(n,e){if(1&n&&(p.j41(0,"ion-card",13)(1,"ion-item",9),p.nrm(2,"ion-icon",14),p.j41(3,"ion-label"),p.DNE(4,CoreSettingsSynchronizationPage_ion_card_26_ng_container_4_Template,3,3,"ng-container",12)(5,CoreSettingsSynchronizationPage_ion_card_26_ng_container_5_Template,3,3,"ng-container",12),p.k0s()()()),2&n){const n=p.XpG();p.R7$(4),p.Y8G("ngIf",n.isOnline&&n.dataSaver&&n.limitedConnection),p.R7$(),p.Y8G("ngIf",!n.isOnline)}}function CoreSettingsSynchronizationPage_ng_container_27_ng_template_7_p_0_Template(n,e){1&n&&(p.j41(0,"p",17),p.EFF(1),p.nI1(2,"translate"),p.k0s()),2&n&&(p.R7$(),p.JRh(p.bMT(2,1,"core.settings.logintosync")))}function CoreSettingsSynchronizationPage_ng_container_27_ng_template_7_Template(n,e){if(1&n&&p.DNE(0,CoreSettingsSynchronizationPage_ng_container_27_ng_template_7_p_0_Template,3,3,"p",16),2&n){p.Y8G("ngIf",e.site.loggedOut)}}function CoreSettingsSynchronizationPage_ng_container_27_ng_template_9_core_button_with_spinner_0_Template(n,e){if(1&n){const n=p.RV6();p.j41(0,"core-button-with-spinner",20)(1,"ion-button",21),p.nI1(2,"translate"),p.bIt("click",(function CoreSettingsSynchronizationPage_ng_container_27_ng_template_9_core_button_with_spinner_0_Template_ion_button_click_1_listener(){p.eBV(n);const e=p.XpG().site,t=p.XpG(2);return p.Njj(t.synchronize(e.id))})),p.nrm(3,"ion-icon",22),p.k0s()()}if(2&n){const n=p.XpG().site,e=p.XpG(2);p.Y8G("loading",e.isSynchronizing(n.id)),p.R7$(),p.Y8G("ariaLabel",p.bMT(2,2,"core.settings.synchronizenow"))}}function CoreSettingsSynchronizationPage_ng_container_27_ng_template_9_ion_button_1_Template(n,e){if(1&n){const n=p.RV6();p.j41(0,"ion-button",23),p.nI1(1,"translate"),p.bIt("click",(function CoreSettingsSynchronizationPage_ng_container_27_ng_template_9_ion_button_1_Template_ion_button_click_0_listener(){p.eBV(n);const e=p.XpG().site,t=p.XpG(2);return p.Njj(t.login(e.id))})),p.nrm(2,"ion-icon",24),p.k0s()}2&n&&p.Y8G("ariaLabel",p.bMT(1,1,"core.login.login"))}function CoreSettingsSynchronizationPage_ng_container_27_ng_template_9_Template(n,e){if(1&n&&p.DNE(0,CoreSettingsSynchronizationPage_ng_container_27_ng_template_9_core_button_with_spinner_0_Template,4,4,"core-button-with-spinner",18)(1,CoreSettingsSynchronizationPage_ng_container_27_ng_template_9_ion_button_1_Template,3,3,"ion-button",19),2&n){const n=e.site;p.Y8G("ngIf",!n.loggedOut),p.R7$(),p.Y8G("ngIf",n.loggedOut)}}function CoreSettingsSynchronizationPage_ng_container_27_Template(n,e){if(1&n&&(p.qex(0),p.j41(1,"ion-item-divider")(2,"ion-label")(3,"h2"),p.EFF(4),p.nI1(5,"translate"),p.k0s()()(),p.j41(6,"core-sites-list",15),p.DNE(7,CoreSettingsSynchronizationPage_ng_container_27_ng_template_7_Template,1,1,"ng-template",null,0,p.C5r)(9,CoreSettingsSynchronizationPage_ng_container_27_ng_template_9_Template,2,2,"ng-template",null,1,p.C5r),p.k0s(),p.bVm()),2&n){const n=p.XpG();p.R7$(4),p.JRh(p.bMT(5,2,"core.accounts")),p.R7$(2),p.Y8G("accountsList",n.accountsList)}}let L=(()=>{var n;class CoreSettingsSynchronizationPage{constructor(){var n=this;this.accountsList={sameSite:[],otherSites:[],count:0},this.sitesLoaded=!1,this.dataSaver=!1,this.limitedConnection=!1,this.isOnline=!0,this.isDestroyed=!1,this.sitesObserver=a.z.on(a.z.SITE_UPDATED,function(){var e=(0,i.A)((function*(e){var t;const i=e.siteId;let o=i===(null===(t=n.accountsList.currentSite)||void 0===t?void 0:t.id)?n.accountsList.currentSite:void 0;if(o||(o=n.accountsList.sameSite.find((n=>n.id===i))),o||n.accountsList.otherSites.some((n=>(o=n.find((n=>n.id===i)),o))),!o)return;const a=yield r.CoreSites.getSite(i),s=a.getInfo();o.siteName=yield a.getSiteName(),s&&(o.fullname=s.fullname)}));return function(n){return e.apply(this,arguments)}}()),this.isOnline=g.WE.isOnline(),this.limitedConnection=this.isOnline&&g.WE.isNetworkAccessLimited(),this.networkObserver=g.WE.onChange().subscribe((()=>{l.SK.run((()=>{this.isOnline=g.WE.isOnline(),this.limitedConnection=this.isOnline&&g.WE.isNetworkAccessLimited()}))}))}ngOnInit(){var n=this;return(0,i.A)((function*(){try{n.accountsList=yield _.CoreLoginHelper.getAccountsList()}catch{}n.sitesLoaded=!0,n.dataSaver=yield s.CoreConfig.get(o.CoreConstants.SETTINGS_SYNC_ONLY_ON_WIFI,!0)}))()}syncOnlyOnWifiChanged(){s.CoreConfig.set(o.CoreConstants.SETTINGS_SYNC_ONLY_ON_WIFI,this.dataSaver?1:0)}synchronize(n){var e=this;return(0,i.A)((function*(){try{yield c.CoreSettingsHelper.synchronizeSite(!1,n),d.CoreToasts.show({message:"core.settings.sitesynccompleted",translateMessage:!0})}catch(n){if(e.isDestroyed)return;u.CoreAlerts.showError(n,{default:l.HT.instant("core.settings.sitesyncfailed")})}}))()}login(n){return(0,i.A)((function*(){yield h.CoreNavigator.navigateToSiteHome({preferCurrentTab:!1,siteId:n})}))()}isSynchronizing(n){return!!c.CoreSettingsHelper.getSiteSyncPromise(n)}showInfo(){u.CoreAlerts.show({header:l.HT.instant("core.help"),message:l.HT.instant("core.settings.synchronizenowhelp")})}ngOnDestroy(){this.isDestroyed=!0,this.sitesObserver.off(),this.networkObserver.unsubscribe()}}return(n=CoreSettingsSynchronizationPage).ɵfac=function CoreSettingsSynchronizationPage_Factory(e){return new(e||n)},n.ɵcmp=p.VBU({type:n,selectors:[["page-core-app-settings-synchronization"]],standalone:!0,features:[p.aNF],decls:28,vars:20,consts:[["siteLabel",""],["siteItem",""],["slot","start"],[3,"text"],["slot","end"],[3,"click","ariaLabel"],["name","fas-circle-info","slot","icon-only","aria-hidden","true"],[1,"limited-width"],["placeholderType","column","placeholderHeight","128px",3,"hideUntil","placeholderLimit"],[1,"ion-text-wrap"],[3,"ngModelChange","ngModel"],["class","core-warning-card",4,"ngIf"],[4,"ngIf"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"accountsList"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["slot","end",3,"loading",4,"ngIf"],["fill","clear","slot","end",3,"ariaLabel","click",4,"ngIf"],["slot","end",3,"loading"],["fill","clear",3,"click","ariaLabel"],["name","fas-rotate","slot","icon-only","aria-hidden","true"],["fill","clear","slot","end",3,"click","ariaLabel"],["name","fas-right-to-bracket","slot","icon-only","aria-hidden","true"]],template:function CoreSettingsSynchronizationPage_Template(n,e){1&n&&(p.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),p.nrm(3,"ion-back-button",3),p.nI1(4,"translate"),p.k0s(),p.j41(5,"ion-title")(6,"h1"),p.EFF(7),p.nI1(8,"translate"),p.k0s()(),p.j41(9,"ion-buttons",4)(10,"core-navbar-buttons")(11,"ion-button",5),p.nI1(12,"translate"),p.bIt("click",(function CoreSettingsSynchronizationPage_Template_ion_button_click_11_listener(){return e.showInfo()})),p.nrm(13,"ion-icon",6),p.k0s()()()()(),p.j41(14,"ion-content",7)(15,"core-loading",8)(16,"ion-list",7)(17,"ion-item-divider")(18,"ion-label")(19,"h2"),p.EFF(20),p.nI1(21,"translate"),p.k0s()()(),p.j41(22,"ion-item",9)(23,"ion-toggle",10),p.mxI("ngModelChange",(function CoreSettingsSynchronizationPage_Template_ion_toggle_ngModelChange_23_listener(n){return p.DH7(e.dataSaver,n)||(e.dataSaver=n),n})),p.bIt("ngModelChange",(function CoreSettingsSynchronizationPage_Template_ion_toggle_ngModelChange_23_listener(){return e.syncOnlyOnWifiChanged()})),p.EFF(24),p.nI1(25,"translate"),p.k0s()(),p.DNE(26,CoreSettingsSynchronizationPage_ion_card_26_Template,6,2,"ion-card",11)(27,CoreSettingsSynchronizationPage_ng_container_27_Template,11,4,"ng-container",12),p.k0s()()()),2&n&&(p.R7$(3),p.Y8G("text",p.bMT(4,10,"core.back")),p.R7$(4),p.JRh(p.bMT(8,12,"core.settings.synchronization")),p.R7$(4),p.Y8G("ariaLabel",p.bMT(12,14,"core.info")),p.R7$(4),p.Y8G("hideUntil",e.sitesLoaded)("placeholderLimit",8),p.R7$(5),p.JRh(p.bMT(21,16,"core.settings.syncsettings")),p.R7$(3),p.R50("ngModel",e.dataSaver),p.R7$(),p.SpI(" ",p.bMT(25,18,"core.settings.syncdatasaver")," "),p.R7$(2),p.Y8G("ngIf",!e.isOnline||e.dataSaver&&e.limitedConnection),p.R7$(),p.Y8G("ngIf",e.isOnline&&(!e.dataSaver||!e.limitedConnection)))},dependencies:[S.n,m.bT,f.BC,f.vS,y.Jm,y.QW,y.b_,y.W9,y.eU,y.iq,y.uz,y.Dg,y.he,y.nf,y.BC,y.BY,y.ai,y.hB,y.el,C.q,b.R,T.c,I.L,z.t,k.i,v.T,P.D9],encapsulation:2}),CoreSettingsSynchronizationPage})()}}]);