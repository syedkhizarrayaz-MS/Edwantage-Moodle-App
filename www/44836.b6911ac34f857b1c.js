"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[44836],{44836:(e,n,i)=>{i.r(n),i.d(n,{default:()=>B});var t=i(10467),o=i(54438),l=i(89377),a=i(94455),s=i(52749),d=i(75383),r=i(79555),c=i(49882),_=i(62960),f=i(91029),p=i(55554),m=i(15324),u=i(24742),F=i(22693),g=i(93589),h=i(88793),C=i(47551),v=i(33014),P=i(74431),b=i(86654),T=i(91416),A=i(6128),I=i(60177),x=i(89417),k=i(2910),w=i(15060),R=i(86198),M=i(8199),y=i(43570),j=i(73955),G=i(59528);const _c0=e=>({"file-selected":e});function AddonPrivateFilesFileComponent_Conditional_1_Conditional_1_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"ion-checkbox",10),o.mxI("ngModelChange",(function AddonPrivateFilesFileComponent_Conditional_1_Conditional_1_Template_ion_checkbox_ngModelChange_0_listener(n){o.eBV(e);const i=o.XpG(2);return o.DH7(i.selected,n)||(i.selected=n),o.Njj(n)})),o.bIt("ngModelChange",(function AddonPrivateFilesFileComponent_Conditional_1_Conditional_1_Template_ion_checkbox_ngModelChange_0_listener(n){o.eBV(e);const i=o.XpG(2);return o.Njj(i.onSelectedFileChange.emit(n))})),o.k0s()}if(2&e){const e=o.XpG(2);o.R50("ngModel",e.selected)}}function AddonPrivateFilesFileComponent_Conditional_1_Conditional_2_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"ion-thumbnail",11),o.bIt("click",(function AddonPrivateFilesFileComponent_Conditional_1_Conditional_2_Template_ion_thumbnail_click_0_listener(n){o.eBV(e);const i=o.XpG(2);return o.Njj(i.download(n,!0))})),o.nrm(1,"img",12),o.k0s()}if(2&e){const e=o.XpG(2);o.R7$(),o.Y8G("src",e.fileIcon,o.B4B)}}function AddonPrivateFilesFileComponent_Conditional_1_Conditional_7_Template(e,n){1&e&&(o.nrm(0,"ion-icon",6),o.nI1(1,"translate")),2&e&&o.BMQ("aria-label",o.bMT(1,1,"core.downloaded"))}function AddonPrivateFilesFileComponent_Conditional_1_p_8_ng_container_1_Template(e,n){if(1&e&&(o.qex(0),o.EFF(1),o.bVm()),2&e){const e=o.XpG(3);o.R7$(),o.JRh(e.fileSizeReadable)}}function AddonPrivateFilesFileComponent_Conditional_1_p_8_ng_container_2_Template(e,n){1&e&&(o.qex(0),o.EFF(1," · "),o.bVm())}function AddonPrivateFilesFileComponent_Conditional_1_p_8_ng_container_3_Template(e,n){if(1&e&&(o.qex(0),o.EFF(1),o.nI1(2,"coreFormatDate"),o.bVm()),2&e){const e=o.XpG(3);o.R7$(),o.JRh(o.bMT(2,1,1e3*e.timemodified))}}function AddonPrivateFilesFileComponent_Conditional_1_p_8_Template(e,n){if(1&e&&(o.j41(0,"p"),o.DNE(1,AddonPrivateFilesFileComponent_Conditional_1_p_8_ng_container_1_Template,2,1,"ng-container",7)(2,AddonPrivateFilesFileComponent_Conditional_1_p_8_ng_container_2_Template,2,0,"ng-container",7)(3,AddonPrivateFilesFileComponent_Conditional_1_p_8_ng_container_3_Template,3,3,"ng-container",7),o.k0s()),2&e){const e=o.XpG(2);o.R7$(),o.Y8G("ngIf",e.fileSizeReadable),o.R7$(),o.Y8G("ngIf",e.fileSizeReadable&&e.showTime),o.R7$(),o.Y8G("ngIf",e.showTime)}}function AddonPrivateFilesFileComponent_Conditional_1_ion_button_10_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"ion-button",13),o.nI1(1,"translate"),o.bIt("click",(function AddonPrivateFilesFileComponent_Conditional_1_ion_button_10_Template_ion_button_click_0_listener(n){o.eBV(e);const i=o.XpG(2);return o.Njj(i.openFile(n,!0))})),o.nrm(2,"ion-icon",14),o.k0s()}if(2&e){const e=o.XpG(2);o.Y8G("title",o.bMT(1,2,e.openButtonLabel)),o.R7$(2),o.Y8G("name",e.openButtonIcon)}}function AddonPrivateFilesFileComponent_Conditional_1_Conditional_11_Conditional_0_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"core-download-refresh",17),o.bIt("action",(function AddonPrivateFilesFileComponent_Conditional_1_Conditional_11_Conditional_0_Template_core_download_refresh_action_0_listener(){o.eBV(e);const n=o.XpG(3);return o.Njj(n.download())})),o.k0s()}if(2&e){const e=o.XpG(3);o.Y8G("status",e.state)("enabled",e.canDownload)("loading",e.isDownloading)("canTrustDownload",!e.alwaysDownload)}}function AddonPrivateFilesFileComponent_Conditional_1_Conditional_11_Conditional_1_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"ion-button",18),o.bIt("click",(function AddonPrivateFilesFileComponent_Conditional_1_Conditional_11_Conditional_1_Template_ion_button_click_0_listener(){o.eBV(e);const n=o.XpG(3);return o.Njj(n.openMenuClick())})),o.nrm(1,"ion-icon",19),o.k0s()}}function AddonPrivateFilesFileComponent_Conditional_1_Conditional_11_Template(e,n){if(1&e&&o.DNE(0,AddonPrivateFilesFileComponent_Conditional_1_Conditional_11_Conditional_0_Template,1,4,"core-download-refresh",15)(1,AddonPrivateFilesFileComponent_Conditional_1_Conditional_11_Conditional_1_Template,2,0,"ion-button",16),2&e){const e=o.XpG(2);o.vxM(0,e.state!==e.statusDownloaded?0:-1),o.R7$(),o.vxM(1,e.canDelete?1:-1)}}function AddonPrivateFilesFileComponent_Conditional_1_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"ion-item",1),o.DNE(1,AddonPrivateFilesFileComponent_Conditional_1_Conditional_1_Template,1,1,"ion-checkbox",2)(2,AddonPrivateFilesFileComponent_Conditional_1_Conditional_2_Template,2,1),o.j41(3,"ion-label",3),o.bIt("click",(function AddonPrivateFilesFileComponent_Conditional_1_Template_ion_label_click_3_listener(n){o.eBV(e);const i=o.XpG();return o.Njj(i.download(n,!0))})),o.j41(4,"p",4)(5,"span",5),o.bIt("ariaButtonClick",(function AddonPrivateFilesFileComponent_Conditional_1_Template_span_ariaButtonClick_5_listener(n){o.eBV(e);const i=o.XpG();return o.Njj(i.download(n,!0))})),o.EFF(6),o.k0s(),o.DNE(7,AddonPrivateFilesFileComponent_Conditional_1_Conditional_7_Template,2,3,"ion-icon",6),o.k0s(),o.DNE(8,AddonPrivateFilesFileComponent_Conditional_1_p_8_Template,4,3,"p",7),o.k0s(),o.j41(9,"div",8),o.DNE(10,AddonPrivateFilesFileComponent_Conditional_1_ion_button_10_Template,3,4,"ion-button",9)(11,AddonPrivateFilesFileComponent_Conditional_1_Conditional_11_Template,2,2),o.k0s()(),o.nrm(12,"ion-ripple-effect")}if(2&e){const e=o.XpG();o.Y8G("ngClass",o.eq3(8,_c0,e.showCheckbox&&e.selected))("detail",!1),o.R7$(),o.vxM(1,e.showCheckbox?1:2),o.R7$(5),o.JRh(e.fileName),o.R7$(),o.vxM(7,e.state===e.statusDownloaded?7:-1),o.R7$(),o.Y8G("ngIf",e.fileSizeReadable||e.showTime),o.R7$(2),o.Y8G("ngIf",e.isDownloaded&&e.isIOS),o.R7$(),o.vxM(11,e.showCheckbox?-1:11)}}let S=(()=>{var e;class AddonPrivateFilesFileComponent extends A.t{constructor(){super(),this.showCheckbox=!0,this.selected=!1,this.statusDownloaded=P.DownloadStatus.DOWNLOADED,this.onSelectedFileChange=new o.bkB,this.onOpenMenuClick=new o.bkB}openMenuClick(){this.onOpenMenuClick.emit(this)}}return(e=AddonPrivateFilesFileComponent).ɵfac=function AddonPrivateFilesFileComponent_Factory(n){return new(n||e)},e.ɵcmp=o.VBU({type:e,selectors:[["addon-privatefiles-file"]],inputs:{showCheckbox:[o.Mj6.HasDecoratorInputTransform,"showCheckbox","showCheckbox",T.G],selected:[o.Mj6.HasDecoratorInputTransform,"selected","selected",T.G]},outputs:{onSelectedFileChange:"onSelectedFileChange",onOpenMenuClick:"onOpenMenuClick"},standalone:!0,features:[o.GFd,o.Vt3,o.aNF],decls:2,vars:1,consts:[[1,"card-file","ion-activatable"],[1,"ion-text-wrap","item-file",3,"ngClass","detail"],["labelPlacement","start",3,"ngModel"],[3,"click"],[1,"item-heading"],[3,"ariaButtonClick"],["color","success","name","fam-cloud-done","role","status",1,"core-icon-downloaded"],[4,"ngIf"],["slot","end",1,"flex-row"],["fill","clear",3,"title","click",4,"ngIf"],["labelPlacement","start",3,"ngModelChange","ngModel"],["slot","start",3,"click"],["alt","","role","presentation",3,"src"],["fill","clear",3,"click","title"],["slot","icon-only","aria-hidden","true",3,"name"],[3,"status","enabled","loading","canTrustDownload"],["fill","clear"],[3,"action","status","enabled","loading","canTrustDownload"],["fill","clear",3,"click"],["name","ellipsis-vertical","slot","icon-only","aria-hidden","true"]],template:function AddonPrivateFilesFileComponent_Template(e,n){1&e&&(o.j41(0,"ion-card",0),o.DNE(1,AddonPrivateFilesFileComponent_Conditional_1_Template,13,10),o.k0s()),2&e&&(o.R7$(),o.vxM(1,n.file?1:-1))},dependencies:[b.n,I.YU,I.bT,x.BC,x.vS,k.Jm,k.b_,k.eY,k.iq,k.uz,k.he,k.S7,k.Zx,k.hB,w.Y,R.t,M.a,y.T,j.D9,G.f],styles:["[_nghost-%COMP%]   ion-checkbox[_ngcontent-%COMP%]{flex:none;width:3rem}[_nghost-%COMP%]   ion-item.item.item-file[_ngcontent-%COMP%]{--inner-border-width: 0 !important}[_nghost-%COMP%]   ion-item.item.item-file.file-selected[_ngcontent-%COMP%]{--ion-item-background: var(--primary-tint)}[_nghost-%COMP%]   ion-ripple-effect[_ngcontent-%COMP%]{z-index:1}"]}),AddonPrivateFilesFileComponent})();var D=i(25572),E=i(16986),N=i(64422),V=i(7570),$=i(19858),O=i(77199),X=i(88246);const index_c0=(e,n)=>({used:e,total:n}),_c1=e=>({$a:e});function AddonPrivateFilesIndexPage_Conditional_3_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"ion-button",10),o.nI1(1,"translate"),o.bIt("click",(function AddonPrivateFilesIndexPage_Conditional_3_Template_ion_button_click_0_listener(){o.eBV(e);const n=o.XpG();return o.Njj(n.cancelFileSelection())})),o.nrm(2,"ion-icon",11),o.k0s()}2&e&&o.Y8G("ariaLabel",o.bMT(1,1,"core.close"))}function AddonPrivateFilesIndexPage_Conditional_4_Template(e,n){1&e&&(o.nrm(0,"ion-back-button",12),o.nI1(1,"translate")),2&e&&o.Y8G("text",o.bMT(1,1,"core.back"))}function AddonPrivateFilesIndexPage_Conditional_9_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"ion-button",13),o.nI1(1,"translate"),o.bIt("click",(function AddonPrivateFilesIndexPage_Conditional_9_Template_ion_button_click_0_listener(){o.eBV(e);const n=o.XpG();return o.Njj(n.deleteSelectedFiles(!0))})),o.nrm(2,"ion-icon",14),o.k0s()}2&e&&o.Y8G("ariaLabel",o.bMT(1,1,"core.delete"))}function AddonPrivateFilesIndexPage_core_loading_14_core_combobox_1_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"core-combobox",20),o.bIt("onChange",(function AddonPrivateFilesIndexPage_core_loading_14_core_combobox_1_Template_core_combobox_onChange_0_listener(n){o.eBV(e);const i=o.XpG(2);return o.Njj(i.rootChanged(n))})),o.j41(1,"ion-select-option",21),o.EFF(2),o.nI1(3,"translate"),o.k0s(),o.j41(4,"ion-select-option",22),o.EFF(5),o.nI1(6,"translate"),o.k0s()()}if(2&e){const e=o.XpG(2);o.Y8G("selection",e.root),o.R7$(2),o.SpI(" ",o.bMT(3,3,"addon.privatefiles.privatefiles")," "),o.R7$(3),o.SpI(" ",o.bMT(6,5,"addon.privatefiles.sitefiles")," ")}}function AddonPrivateFilesIndexPage_core_loading_14_ion_card_2_Template(e,n){if(1&e&&(o.j41(0,"ion-card",23)(1,"ion-item"),o.nrm(2,"ion-icon",24),o.j41(3,"ion-label"),o.EFF(4),o.nI1(5,"translate"),o.k0s()()()),2&e){const e=o.XpG(2);o.R7$(4),o.SpI(" ",o.i5U(5,1,"core.quotausage",o.eq3(7,_c1,o.l_i(4,index_c0,e.spaceUsed,e.userQuotaReadable)))," ")}}function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_1_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"ion-card")(1,"ion-item",26),o.bIt("click",(function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_1_Template_ion_item_click_1_listener(){o.eBV(e);const n=o.XpG().$implicit,i=o.XpG(3);return o.Njj(i.openFolder(n))})),o.nrm(2,"ion-icon",27),o.nI1(3,"translate"),o.j41(4,"ion-label"),o.EFF(5),o.k0s()()()}if(2&e){const e=o.XpG().$implicit;o.R7$(),o.Y8G("detail",!0),o.R7$(),o.BMQ("aria-label",o.bMT(3,3,"core.folder")),o.R7$(3),o.JRh(e.filename)}}function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_2_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"addon-privatefiles-file",28),o.bIt("onOpenMenuClick",(function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_2_Template_addon_privatefiles_file_onOpenMenuClick_0_listener(n){o.eBV(e);const i=o.XpG().$implicit,t=o.XpG(3);return o.Njj("my"===t.root&&t.openManagementFileMenu(n,i))}))("longPress",(function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_2_Template_addon_privatefiles_file_longPress_0_listener(){o.eBV(e);const n=o.XpG().$implicit,i=o.XpG(3);return o.Njj(i.canDeleteFiles&&"my"===i.root&&i.enableMultipleSelection(n))}))("onSelectedFileChange",(function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_2_Template_addon_privatefiles_file_onSelectedFileChange_0_listener(n){o.eBV(e);const i=o.XpG().$implicit,t=o.XpG(3);return o.Njj("my"===t.root&&t.selectedFileValueChanged(n,i))})),o.k0s()}if(2&e){const e=o.XpG().$implicit,n=o.XpG(3);o.Y8G("file",e)("component",n.component)("componentId",e.contextid)("showCheckbox",n.canDeleteFiles&&"my"===n.root&&n.selectFilesEnabled())("selected",e.selected)("canDelete",n.canDeleteFiles&&"my"===n.root)}}function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Template(e,n){if(1&e&&(o.qex(0),o.DNE(1,AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_1_Template,6,5,"ion-card")(2,AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_2_Template,1,6),o.bVm()),2&e){const e=n.$implicit;o.R7$(),o.vxM(1,e.isdir?1:2)}}function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_Template(e,n){if(1&e&&(o.j41(0,"ion-list"),o.DNE(1,AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Template,3,1,"ng-container",25),o.k0s()),2&e){const e=o.XpG(2);o.R7$(),o.Y8G("ngForOf",e.files)}}function AddonPrivateFilesIndexPage_core_loading_14_core_empty_box_4_Template(e,n){1&e&&(o.nrm(0,"core-empty-box",29),o.nI1(1,"translate")),2&e&&o.Y8G("message",o.bMT(1,1,"addon.privatefiles.emptyfilelist"))}function AddonPrivateFilesIndexPage_core_loading_14_Template(e,n){if(1&e&&(o.j41(0,"core-loading",15),o.DNE(1,AddonPrivateFilesIndexPage_core_loading_14_core_combobox_1_Template,7,7,"core-combobox",16)(2,AddonPrivateFilesIndexPage_core_loading_14_ion_card_2_Template,6,9,"ion-card",17)(3,AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_Template,2,1,"ion-list",18)(4,AddonPrivateFilesIndexPage_core_loading_14_core_empty_box_4_Template,2,3,"core-empty-box",19),o.k0s()),2&e){const e=o.XpG();o.Y8G("hideUntil",e.filesLoaded),o.R7$(),o.Y8G("ngIf",e.showPrivateFiles&&e.showSiteFiles&&!e.path),o.R7$(),o.Y8G("ngIf",e.userQuota&&e.filesInfo&&e.filesInfo.filecount>0),o.R7$(),o.Y8G("ngIf",e.files&&e.files.length>0),o.R7$(),o.Y8G("ngIf",!e.files||!e.files.length)}}function AddonPrivateFilesIndexPage_Conditional_15_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"ion-fab",8)(1,"ion-fab-button",30),o.nI1(2,"translate"),o.bIt("click",(function AddonPrivateFilesIndexPage_Conditional_15_Template_ion_fab_button_click_1_listener(){o.eBV(e);const n=o.XpG();return o.Njj(n.uploadFile())})),o.nrm(3,"ion-icon",31),o.j41(4,"span",32),o.EFF(5),o.nI1(6,"translate"),o.k0s()()()}2&e&&(o.R7$(),o.BMQ("aria-label",o.bMT(2,2,"core.fileuploader.uploadafile")),o.R7$(4),o.JRh(o.bMT(6,4,"core.fileuploader.uploadafile")))}function AddonPrivateFilesIndexPage_Conditional_16_Template(e,n){if(1&e){const e=o.RV6();o.j41(0,"div",9)(1,"ion-checkbox",33),o.mxI("ngModelChange",(function AddonPrivateFilesIndexPage_Conditional_16_Template_ion_checkbox_ngModelChange_1_listener(n){o.eBV(e);const i=o.XpG();return o.DH7(i.selectAll,n)||(i.selectAll=n),o.Njj(n)})),o.bIt("ngModelChange",(function AddonPrivateFilesIndexPage_Conditional_16_Template_ion_checkbox_ngModelChange_1_listener(n){o.eBV(e);const i=o.XpG();return o.Njj(i.onSelectAllChanges(n))})),o.EFF(2),o.nI1(3,"translate"),o.k0s()()}if(2&e){const e=o.XpG();o.R7$(),o.R50("ngModel",e.selectAll),o.R7$(),o.SpI(" ",o.bMT(3,2,"core.selectall")," ")}}let B=(()=>{var e;class AddonPrivateFilesIndexPage{constructor(){this.filesLoaded=!1,this.selectFilesEnabled=(0,o.vPA)(!1),this.selectedFiles=[],this.selectAll=!1,this.canDeleteFiles=!1,this.updateSiteObserver=c.z.on(c.z.SITE_UPDATED,(()=>{this.setVisibility()}),s.CoreSites.getCurrentSiteId()),this.logView=u.j.once((0,t.A)((function*(){F.OF.logEvent({type:F.qr.VIEW_ITEM_LIST,ws:"core_files_get_files",name:r.HT.instant("addon.privatefiles.files"),data:{category:"files"},url:"/user/files.php"})})))}ngOnInit(){var e=this;return(0,t.A)((function*(){var n,i;try{e.root=m.CoreNavigator.getRouteParam("root");const n=m.CoreNavigator.getRouteNumberParam("contextid");n&&(e.path={contextid:n,component:m.CoreNavigator.getRequiredRouteParam("component"),filearea:m.CoreNavigator.getRequiredRouteParam("filearea"),itemid:m.CoreNavigator.getRequiredRouteNumberParam("itemid"),filepath:m.CoreNavigator.getRequiredRouteParam("filepath"),filename:m.CoreNavigator.getRequiredRouteParam("filename")})}catch(e){return D.CoreAlerts.showError(e),m.CoreNavigator.back(),void 0}e.title=(null===(n=e.path)||void 0===n?void 0:n.filename)||r.HT.instant("addon.privatefiles.files"),e.setVisibility(),e.userQuota=null===(i=s.CoreSites.getCurrentSite())||void 0===i||null===(i=i.getInfo())||void 0===i?void 0:i.userquota,e.root||(e.showPrivateFiles?e.root="my":e.showSiteFiles&&(e.root="site")),e.root?e.rootChanged(e.root):e.filesLoaded=!0,e.canDeleteFiles=yield _.AddonPrivateFiles.canDeletePrivateFiles()}))()}setVisibility(){this.showPrivateFiles=_.AddonPrivateFiles.canViewPrivateFiles(),this.showSiteFiles=_.AddonPrivateFiles.canViewSiteFiles(),this.showUpload=_.AddonPrivateFiles.canUploadFiles()}refreshData(e){this.refreshFiles().finally((()=>{null==e||e.complete()}))}rootChanged(e){this.root=e,this.filesLoaded=!1,this.component="my"==this.root?_.AddonPrivateFilesProvider.PRIVATE_FILES_COMPONENT:_.AddonPrivateFilesProvider.SITE_FILES_COMPONENT,this.fetchFiles().finally((()=>{this.filesLoaded=!0})),this.cancelFileSelection()}uploadFile(){var e=this;return(0,t.A)((function*(){if(!a.WE.isOnline())return D.CoreAlerts.showError(r.HT.instant("core.fileuploader.errormustbeonlinetoupload")),void 0;try{yield f.AddonPrivateFilesHelper.uploadPrivateFile(e.filesInfo),e.filesLoaded=!1,yield p.g.ignoreErrors(e.refreshFiles()),e.filesLoaded=!0}catch(e){D.CoreAlerts.showError(e,{default:r.HT.instant("core.fileuploader.errorwhileuploading")})}}))()}fetchFiles(){var e=this;return(0,t.A)((function*(){try{if(e.path)return e.files=yield _.AddonPrivateFiles.getFiles(e.path),void 0;"site"==e.root?(e.title=r.HT.instant("addon.privatefiles.sitefiles"),e.files=yield _.AddonPrivateFiles.getSiteFiles()):"my"==e.root?(e.title=r.HT.instant("addon.privatefiles.files"),e.files=yield _.AddonPrivateFiles.getPrivateFiles(),e.showUpload&&e.userQuota&&e.userQuota>0?(e.filesInfo=yield _.AddonPrivateFiles.getPrivateFilesInfo(),e.spaceUsed=d.Ni.bytesToSize(e.filesInfo.filesizewithoutreferences,1),e.userQuotaReadable=d.Ni.bytesToSize(e.userQuota,1)):delete e.userQuota,e.logView()):D.CoreAlerts.showError(r.HT.instant("addon.privatefiles.couldnotloadfiles"))}catch(e){D.CoreAlerts.showError(e,{default:r.HT.instant("addon.privatefiles.couldnotloadfiles")})}}))()}refreshFiles(){var e=this;return(0,t.A)((function*(){try{yield Promise.all([_.AddonPrivateFiles.invalidateDirectory(e.root,e.path),_.AddonPrivateFiles.invalidatePrivateFilesInfoForUser()])}finally{yield e.fetchFiles()}}))()}openFolder(e){const n={contextid:e.contextid,component:e.component||"",filearea:e.filearea||"",itemid:e.itemid||0,filepath:e.filepath||"",filename:e.filename||"",root:this.root};e.component&&(n.filename="");const i=l.V.hashAsciiStr(JSON.stringify(n));m.CoreNavigator.navigate(`../${i}`,{params:n})}ngOnDestroy(){var e;null===(e=this.updateSiteObserver)||void 0===e||e.off()}deleteSelectedFiles(e=!1){var n=this;return(0,t.A)((function*(){if(0===n.selectedFiles.length)return;if(e)try{const e=1===n.selectedFiles.length?r.HT.instant("core.confirmremoveselectedfile",{filename:n.selectedFiles[0].filename}):r.HT.instant("core.confirmremoveselectedfiles");yield D.CoreAlerts.confirmDelete(e)}catch{return}const i=s.CoreSites.getCurrentSiteId(),t=yield v.CoreLoadings.show();try{yield _.AddonPrivateFiles.deleteFiles(n.selectedFiles)}catch(e){throw t.dismiss(),yield D.CoreAlerts.showError(e,{default:"An error occourred while file was being deleted."}),e}for(const e of n.selectedFiles)yield n.deleteOfflineFile(e,i);yield n.refreshFiles(),t.dismiss();const o=r.HT.instant("core.filedeletedsuccessfully",{filename:1===n.selectedFiles.length?n.selectedFiles[0].filename:`${n.selectedFiles.length} ${r.HT.instant("addon.privatefiles.files")}`});n.selectedFiles=[],n.selectFilesEnabled.set(!1),yield C.CoreToasts.show({message:o,translateMessage:!1,duration:C.ToastDuration.SHORT})}))()}selectedFileValueChanged(e,n){if(e)return this.selectedFiles.push(n),void 0;this.selectedFiles=this.selectedFiles.filter((e=>e!==n))}cancelFileSelection(){var e;this.selectFilesEnabled.set(!1),this.selectedFiles=[],this.files=null===(e=this.files)||void 0===e?void 0:e.map((e=>({...e,selected:!1})))}openManagementFileMenu(e,n){var o=this;return(0,t.A)((function*(){const t=s.CoreSites.getCurrentSiteId(),{AddonPrivateFilesFileActionsComponent:l}=yield Promise.all([i.e(72076),i.e(29589)]).then(i.bind(i,29589));try{const{status:i}=yield g.I.openSheet(l,{isDownloaded:e.isDownloaded,filename:n.filename,icon:e.fileIcon},!0);if("cancel"===i)return;if("deleteOnline"===i)return yield D.CoreAlerts.confirmDelete(r.HT.instant("core.confirmremoveselectedfile",{filename:n.filename})),o.selectedFiles=[n],yield o.deleteSelectedFiles();if("deleteOffline"===i)return yield o.deleteOfflineFile(n,t);yield e.download()}catch{return}}))()}onSelectAllChanges(e){if(this.files){for(const n of this.files)n.selected=e;this.selectedFiles=e?[...this.files]:[]}}enableMultipleSelection(e){this.selectFilesEnabled.set(!0),this.selectedFiles.push(e),e.selected=!0}deleteOfflineFile(e,n){return(0,t.A)((function*(){try{yield h.CoreFilepool.removeFileByUrl(n,e.fileurl)}catch(e){D.CoreAlerts.showError(e,{default:r.HT.instant("core.errordeletefile")})}}))()}}return(e=AddonPrivateFilesIndexPage).ɵfac=function AddonPrivateFilesIndexPage_Factory(n){return new(n||e)},e.ɵcmp=o.VBU({type:e,selectors:[["page-addon-privatefiles-index"]],standalone:!0,features:[o.aNF],decls:17,vars:10,consts:[["slot","start"],["fill","clear",3,"ariaLabel"],["slot","end"],["fill","clear","color","danger",3,"ariaLabel"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[1,"ion-padding","addons-privatefiles-index-select-all"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-xmark","aria-hidden","true"],[3,"text"],["fill","clear","color","danger",3,"click","ariaLabel"],["slot","icon-only","name","fas-trash","aria-hidden","true"],[3,"hideUntil"],[3,"selection","onChange",4,"ngIf"],["class","core-info-card",4,"ngIf"],[4,"ngIf"],["icon","far-folder-open",3,"message",4,"ngIf"],[3,"onChange","selection"],["value","my",1,"ion-text-wrap"],["value","site",1,"ion-text-wrap"],[1,"core-info-card"],["slot","start","aria-label","hidden","name","fas-cloud"],[4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap","item-file","item-directory",3,"click","detail"],["name","fas-folder","slot","start"],["showDownloadStatus","true",3,"onOpenMenuClick","longPress","onSelectedFileChange","file","component","componentId","showCheckbox","selected","canDelete"],["icon","far-folder-open",3,"message"],[3,"click"],["name","fas-arrow-up-from-bracket","aria-hidden","true"],[1,"sr-only"],["labelPlacement","end",3,"ngModelChange","ngModel"]],template:function AddonPrivateFilesIndexPage_Template(e,n){1&e&&(o.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),o.DNE(3,AddonPrivateFilesIndexPage_Conditional_3_Template,3,3,"ion-button",1)(4,AddonPrivateFilesIndexPage_Conditional_4_Template,2,3),o.k0s(),o.j41(5,"ion-title")(6,"h1"),o.EFF(7),o.k0s()(),o.j41(8,"ion-buttons",2),o.DNE(9,AddonPrivateFilesIndexPage_Conditional_9_Template,3,3,"ion-button",3),o.k0s()()(),o.j41(10,"ion-content",4)(11,"ion-refresher",5),o.bIt("ionRefresh",(function AddonPrivateFilesIndexPage_Template_ion_refresher_ionRefresh_11_listener(e){return n.refreshData(e.target)})),o.nrm(12,"ion-refresher-content",6),o.nI1(13,"translate"),o.k0s(),o.DNE(14,AddonPrivateFilesIndexPage_core_loading_14_Template,5,5,"core-loading",7)(15,AddonPrivateFilesIndexPage_Conditional_15_Template,7,6,"ion-fab",8),o.k0s(),o.DNE(16,AddonPrivateFilesIndexPage_Conditional_16_Template,4,4,"div",9)),2&e&&(o.R7$(3),o.vxM(3,n.selectFilesEnabled()?3:4),o.R7$(4),o.JRh(n.selectFilesEnabled()?n.selectedFiles.length+" "+n.title:n.title),o.R7$(2),o.vxM(9,n.selectFilesEnabled()&&n.selectedFiles.length>0?9:-1),o.R7$(2),o.Y8G("disabled",!n.filesLoaded||!n.showPrivateFiles&&!n.showSiteFiles),o.R7$(),o.FS9("pullingText",o.bMT(13,8,"core.pulltorefresh")),o.R7$(2),o.Y8G("ngIf",n.showPrivateFiles||n.showSiteFiles),o.R7$(),o.vxM(15,!n.showUpload||"site"===n.root||n.path||n.selectFilesEnabled()?-1:15),o.R7$(),o.vxM(16,n.selectFilesEnabled()?16:-1))},dependencies:[b.n,I.Sq,I.bT,x.BC,x.vS,k.Jm,k.QW,k.b_,k.eY,k.W9,k.Q8,k.YW,k.eU,k.iq,k.uz,k.he,k.nf,k.To,k.Ki,k.Ip,k.BC,k.ai,k.hB,k.el,E.h,N.R,V._,$.A,R.t,O.S,X.i,y.T,j.D9,S],styles:["[_nghost-%COMP%]{--addons-privatefiles-index-select-all-shadow: 0px 8px 10px 0px #282828}[_nghost-%COMP%]   .addons-privatefiles-index-select-all[_ngcontent-%COMP%]{box-shadow:var(--addons-privatefiles-index-select-all-shadow);z-index:3}"]}),AddonPrivateFilesIndexPage})()}}]);