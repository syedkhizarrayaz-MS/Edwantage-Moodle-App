"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[31289],{31289:(e,o,i)=>{i.r(o),i.d(o,{default:()=>$});var t=i(10467),n=i(52749),r=i(12364),c=i(15324),l=i(49882),a=i(22693),_=i(79555),s=i(65614),g=i(89417),p=i(8014),m=i(2910),P=i(93417),y=i(82907),f=i(53794),u=i(93589),d=i(33014),h=i(55554),C=i(25572),b=i(86654),T=i(54438),v=i(60177),I=i(7476),S=i(25880),R=i(64422),M=i(17778),x=i(86198),G=i(58197),O=i(23007),k=i(35407),F=i(88246),E=i(43570),w=i(73955);const _c0=e=>({$a:e}),_c1=e=>({policyname:e}),_c2=e=>({policy:e});function CorePolicySitePolicyPage_ion_title_5_Template(e,o){if(1&e&&(T.j41(0,"ion-title")(1,"h1"),T.nrm(2,"core-format-text",10),T.k0s()()),2&e){const e=T.XpG();T.R7$(2),T.Y8G("text",e.siteName)("contextInstanceId",0)}}function CorePolicySitePolicyPage_form_12_ion_item_1_Template(e,o){if(1&e&&(T.j41(0,"ion-item",17)(1,"ion-label")(2,"p"),T.EFF(3),T.nI1(4,"translate"),T.k0s()()()),2&e){const e=T.XpG(2);T.R7$(3),T.JRh(T.i5U(4,1,"core.policy.steppolicies",T.eq3(4,_c0,e.stepData)))}}function CorePolicySitePolicyPage_form_12_ion_item_2_p_4_Template(e,o){if(1&e&&(T.j41(0,"p"),T.EFF(1),T.k0s()),2&e){const e=T.XpG(3);T.R7$(),T.JRh(e.subTitle)}}function CorePolicySitePolicyPage_form_12_ion_item_2_Template(e,o){if(1&e&&(T.j41(0,"ion-item",18)(1,"ion-label")(2,"h2"),T.EFF(3),T.k0s(),T.DNE(4,CorePolicySitePolicyPage_form_12_ion_item_2_p_4_Template,2,1,"p",3),T.k0s()()),2&e){const e=T.XpG(2);T.R7$(3),T.JRh(e.title),T.R7$(),T.Y8G("ngIf",e.subTitle)}}function CorePolicySitePolicyPage_form_12_ng_container_4_core_iframe_16_Template(e,o){if(1&e&&T.nrm(0,"core-iframe",28),2&e){const e=T.XpG(3);T.Y8G("src",e.sitePoliciesURL)}}function CorePolicySitePolicyPage_form_12_ng_container_4_p_19_Template(e,o){1&e&&(T.j41(0,"p",29),T.EFF(1),T.nI1(2,"translate"),T.nI1(3,"translate"),T.k0s()),2&e&&(T.Y8G("core-mark-required",!0),T.R7$(),T.SpI(" ",T.i5U(3,4,"core.policy.havereadandagreepolicy",T.eq3(7,_c1,T.bMT(2,2,"core.policy.policyagreement")))," "))}function CorePolicySitePolicyPage_form_12_ng_container_4_p_20_Template(e,o){1&e&&(T.j41(0,"p",29),T.EFF(1),T.nI1(2,"translate"),T.k0s()),2&e&&(T.Y8G("core-mark-required",!0),T.R7$(),T.SpI(" ",T.bMT(2,2,"core.policy.policyacceptmandatory")," "))}function CorePolicySitePolicyPage_form_12_ng_container_4_Template(e,o){if(1&e&&(T.qex(0),T.j41(1,"ion-card",19)(2,"ion-item",18),T.nrm(3,"ion-icon",20),T.j41(4,"ion-label")(5,"p"),T.EFF(6),T.nI1(7,"translate"),T.k0s()()()(),T.j41(8,"ion-item",21)(9,"ion-label")(10,"p")(11,"a",22),T.EFF(12),T.nI1(13,"translate"),T.nrm(14,"ion-icon",23),T.k0s()()()(),T.j41(15,"div",24),T.DNE(16,CorePolicySitePolicyPage_form_12_ng_container_4_core_iframe_16_Template,1,1,"core-iframe",25),T.k0s(),T.j41(17,"ion-item",18)(18,"ion-checkbox",26),T.DNE(19,CorePolicySitePolicyPage_form_12_ng_container_4_p_19_Template,4,9,"p",27)(20,CorePolicySitePolicyPage_form_12_ng_container_4_p_20_Template,3,4,"p",27),T.k0s()(),T.bVm()),2&e){const e=T.XpG(2);T.R7$(6),T.JRh(T.bMT(7,9,"core.policy.policyagree")),T.R7$(5),T.Y8G("href",e.sitePoliciesURL,T.B4B)("capture",!1),T.R7$(),T.SpI(" ",T.bMT(13,11,"core.policy.policyagreementclick"),""),T.R7$(3),T.AVh("core-policy-has-iframe",e.showInline),T.R7$(),T.Y8G("ngIf",e.showInline),T.R7$(3),T.Y8G("ngIf",e.isManageAcceptancesAvailable),T.R7$(),T.Y8G("ngIf",!e.isManageAcceptancesAvailable)}}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_1_Template(e,o){if(1&e){const e=T.RV6();T.qex(0),T.j41(1,"ion-item",31)(2,"ion-label")(3,"core-format-text",32),T.bIt("afterRender",(function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_1_Template_core_format_text_afterRender_3_listener(){T.eBV(e);const o=T.XpG(3);return T.Njj(o.checkScroll())})),T.k0s()()(),T.j41(4,"ion-item",33)(5,"ion-label")(6,"core-format-text",32),T.bIt("afterRender",(function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_1_Template_core_format_text_afterRender_6_listener(){T.eBV(e);const o=T.XpG(3);return T.Njj(o.checkScroll())})),T.k0s()()(),T.bVm()}if(2&e){const e=T.XpG(3);T.R7$(3),T.Y8G("text",e.currentPolicy.summary)("contextInstanceId",0),T.R7$(3),T.Y8G("text",e.currentPolicy.content)("contextInstanceId",0)}}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_ion_item_7_Template(e,o){if(1&e){const e=T.RV6();T.j41(0,"ion-item",38),T.bIt("click",(function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_ion_item_7_Template_ion_item_click_0_listener(){T.eBV(e);const o=T.XpG().$implicit,i=T.XpG(4);return T.Njj(i.viewFullPolicy(o))})),T.j41(1,"ion-label"),T.nrm(2,"p",39),T.k0s()()}if(2&e){const e=T.XpG().$implicit;T.R7$(2),T.Y8G("innerHTML",e.referToFullPolicyText,T.npT)}}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_ng_container_8_Template(e,o){1&e&&T.eu8(0)}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_Template(e,o){if(1&e){const e=T.RV6();T.qex(0),T.j41(1,"ion-item",18)(2,"ion-label")(3,"h2"),T.EFF(4),T.k0s(),T.j41(5,"div",35)(6,"core-format-text",32),T.bIt("afterRender",(function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_Template_core_format_text_afterRender_6_listener(){T.eBV(e);const o=T.XpG(4);return T.Njj(o.checkScroll())})),T.k0s()()()(),T.DNE(7,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_ion_item_7_Template,3,1,"ion-item",36)(8,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_ng_container_8_Template,1,0,"ng-container",37),T.bVm()}if(2&e){const e=o.$implicit;T.XpG(4);const i=T.sdS(14);T.R7$(4),T.JRh(e.name),T.R7$(),T.Y8G("collapsible-item",64),T.R7$(),T.Y8G("text",e.summary)("contextInstanceId",0),T.R7$(),T.Y8G("ngIf",e.referToFullPolicyText),T.R7$(),T.Y8G("ngTemplateOutlet",i)("ngTemplateOutletContext",T.eq3(7,_c2,e))}}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_Template(e,o){if(1&e&&(T.qex(0),T.DNE(1,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_Template,9,9,"ng-container",34),T.bVm()),2&e){const e=T.XpG(3);T.R7$(),T.Y8G("ngForOf",e.pendingPolicies)}}function CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_p_2_Template(e,o){if(1&e&&(T.j41(0,"p"),T.EFF(1),T.nI1(2,"translate"),T.k0s()),2&e){const e=T.XpG(4);T.R7$(),T.JRh(T.i5U(2,1,"core.policy.steppolicies",T.eq3(4,_c0,e.stepData)))}}function CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_ion_button_3_Template(e,o){if(1&e){const e=T.RV6();T.j41(0,"ion-button",42),T.nI1(1,"translate"),T.bIt("click",(function CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_ion_button_3_Template_ion_button_click_0_listener(o){T.eBV(e);const i=T.XpG(4);return T.Njj(i.scrollTop(o))})),T.nrm(2,"ion-icon",43),T.k0s()}2&e&&T.Y8G("ariaLabel",T.bMT(1,1,"core.policy.backtotop"))}function CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_Template(e,o){if(1&e&&(T.j41(0,"ion-item",40)(1,"ion-label"),T.DNE(2,CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_p_2_Template,3,6,"p",3),T.k0s(),T.DNE(3,CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_ion_button_3_Template,3,3,"ion-button",41),T.k0s()),2&e){const e=T.XpG(3);T.R7$(2),T.Y8G("ngIf",e.stepData),T.R7$(),T.Y8G("ngIf",e.hasScroll)}}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_4_ng_container_1_Template(e,o){1&e&&T.eu8(0)}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_4_Template(e,o){if(1&e&&(T.qex(0),T.DNE(1,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_4_ng_container_1_Template,1,0,"ng-container",37),T.bVm()),2&e){const e=T.XpG(3),o=T.sdS(14);T.R7$(),T.Y8G("ngTemplateOutlet",o)("ngTemplateOutletContext",T.eq3(2,_c2,e.currentPolicy))}}function CorePolicySitePolicyPage_form_12_ng_container_5_Template(e,o){if(1&e&&(T.qex(0),T.DNE(1,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_1_Template,7,4,"ng-container",3)(2,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_Template,2,1,"ng-container",3)(3,CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_Template,4,2,"ion-item",30)(4,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_4_Template,2,4,"ng-container",3),T.bVm()),2&e){const e=T.XpG(2);T.R7$(),T.Y8G("ngIf",e.currentPolicy),T.R7$(),T.Y8G("ngIf",e.showConsentForm),T.R7$(),T.Y8G("ngIf",e.stepData||e.hasScroll),T.R7$(),T.Y8G("ngIf",e.agreeInOwnPage)}}function CorePolicySitePolicyPage_form_12_ion_button_7_Template(e,o){if(1&e&&(T.j41(0,"ion-button",44),T.EFF(1),T.nI1(2,"translate"),T.k0s()),2&e){const e=T.XpG(2);T.Y8G("expand",e.isTablet?null:"block")("disabled",(e.isPoliciesURL||e.agreeInOwnPage)&&!e.policiesForm.valid),T.R7$(),T.SpI(" ",T.bMT(2,3,"core.continue")," ")}}function CorePolicySitePolicyPage_form_12_ion_button_8_Template(e,o){if(1&e){const e=T.RV6();T.j41(0,"ion-button",45),T.bIt("click",(function CorePolicySitePolicyPage_form_12_ion_button_8_Template_ion_button_click_0_listener(o){T.eBV(e);const i=T.XpG(2);return T.Njj(i.nextPolicy(o))})),T.EFF(1),T.nI1(2,"translate"),T.k0s()}if(2&e){const e=T.XpG(2);T.Y8G("expand",e.isTablet?null:"block"),T.R7$(),T.SpI(" ",T.bMT(2,2,"core.next")," ")}}function CorePolicySitePolicyPage_form_12_Template(e,o){if(1&e){const e=T.RV6();T.j41(0,"form",11),T.bIt("ngSubmit",(function CorePolicySitePolicyPage_form_12_Template_form_ngSubmit_0_listener(o){T.eBV(e);const i=T.XpG();return T.Njj(i.submitAcceptances(o))})),T.DNE(1,CorePolicySitePolicyPage_form_12_ion_item_1_Template,5,6,"ion-item",12)(2,CorePolicySitePolicyPage_form_12_ion_item_2_Template,5,2,"ion-item",13),T.nrm(3,"hr"),T.DNE(4,CorePolicySitePolicyPage_form_12_ng_container_4_Template,21,13,"ng-container",3)(5,CorePolicySitePolicyPage_form_12_ng_container_5_Template,5,4,"ng-container",3),T.j41(6,"div",14),T.DNE(7,CorePolicySitePolicyPage_form_12_ion_button_7_Template,3,5,"ion-button",15)(8,CorePolicySitePolicyPage_form_12_ion_button_8_Template,3,4,"ion-button",16),T.k0s()()}if(2&e){const e=T.XpG();T.Y8G("formGroup",e.policiesForm),T.R7$(),T.Y8G("ngIf",e.stepData),T.R7$(),T.Y8G("ngIf",e.title),T.R7$(2),T.Y8G("ngIf",e.isPoliciesURL&&e.sitePoliciesURL),T.R7$(),T.Y8G("ngIf",!e.isPoliciesURL&&(e.currentPolicy||e.showConsentForm)),T.R7$(2),T.Y8G("ngIf",e.isPoliciesURL&&e.sitePoliciesURL||e.showConsentForm||e.agreeInOwnPage),T.R7$(),T.Y8G("ngIf",!e.isPoliciesURL&&e.currentPolicy&&!e.agreeInOwnPage)}}function CorePolicySitePolicyPage_ng_template_13_ion_item_0_Template(e,o){if(1&e&&(T.j41(0,"ion-item",18)(1,"ion-checkbox",47)(2,"p",29),T.EFF(3),T.nI1(4,"translate"),T.k0s()(),T.nrm(5,"core-input-errors",48),T.k0s()),2&e){const e=T.XpG().policy,o=T.XpG();T.R7$(),T.Y8G("formControl",o.policiesForm.controls["agreepolicy"+e.versionid]),T.R7$(),T.Y8G("core-mark-required",!0),T.R7$(),T.SpI(" ",T.i5U(4,5,"core.policy.havereadandagreepolicy",T.eq3(8,_c1,e.name))," "),T.R7$(2),T.Y8G("control",o.policiesForm.controls["agreepolicy"+e.versionid])("errorMessages",o.policiesErrors)}}function CorePolicySitePolicyPage_ng_template_13_ion_radio_group_1_Template(e,o){if(1&e&&(T.j41(0,"ion-radio-group",47)(1,"ion-item",18)(2,"ion-radio",49)(3,"p"),T.EFF(4),T.nI1(5,"translate"),T.k0s()()(),T.j41(6,"ion-item",18)(7,"ion-radio",49)(8,"p"),T.EFF(9),T.nI1(10,"translate"),T.k0s()(),T.nrm(11,"core-input-errors",48),T.k0s()()),2&e){const e=T.XpG().policy,o=T.XpG();T.Y8G("formControl",o.policiesForm.controls["agreepolicy"+e.versionid]),T.R7$(2),T.Y8G("value",1),T.R7$(2),T.JRh(T.i5U(5,7,"core.policy.havereadandagreepolicy",T.eq3(13,_c1,e.name))),T.R7$(3),T.Y8G("value",0),T.R7$(2),T.JRh(T.i5U(10,10,"core.policy.idontagree",T.eq3(15,_c0,e.name))),T.R7$(2),T.Y8G("control",o.policiesForm.controls["agreepolicy"+e.versionid])("errorMessages",o.policiesErrors)}}function CorePolicySitePolicyPage_ng_template_13_Template(e,o){if(1&e&&T.DNE(0,CorePolicySitePolicyPage_ng_template_13_ion_item_0_Template,6,10,"ion-item",13)(1,CorePolicySitePolicyPage_ng_template_13_ion_radio_group_1_Template,12,17,"ion-radio-group",46),2&e){const e=o.policy,i=T.XpG();T.Y8G("ngIf",!e.optional&&i.policiesForm),T.R7$(),T.Y8G("ngIf",e.optional&&i.policiesForm)}}let $=(()=>{var e;class CorePolicySitePolicyPage{constructor(e,o){this.elementRef=e,this.changeDetector=o,this.isManageAcceptancesAvailable=!1,this.isPoliciesURL=!1,this.title="",this.hasScroll=!1,this.isTablet=!1,this.agreeInOwnPage=!1,this.numPolicy=1,this.showConsentForm=!1,this.policiesErrors={required:_.HT.instant("core.policy.mustagreetocontinue")}}ngOnInit(){var e=this;return(0,t.A)((function*(){e.siteId=c.CoreNavigator.getRouteParam("siteId");try{e.currentSite=n.CoreSites.getRequiredCurrentSite(),e.siteName=(yield h.g.ignoreErrors(e.currentSite.getSiteName(),""))||""}catch{return e.cancel(),void 0}const o=e.currentSite.id;if(e.siteId=e.siteId||o,e.siteId!=o)return e.cancel(),void 0;e.isTablet=P.CoreScreen.isTablet,e.layoutSubscription=P.CoreScreen.layoutObservable.subscribe((()=>{e.isTablet=P.CoreScreen.isTablet})),e.isManageAcceptancesAvailable=yield s.CorePolicy.isManageAcceptancesAvailable(e.siteId),e.isPoliciesURL=!e.isManageAcceptancesAvailable||"tool_policy"!==(yield e.currentSite.getConfig("sitepolicyhandler")),e.isPoliciesURL?(yield e.fetchSitePoliciesURL(),e.initFormForPoliciesURL()):yield e.fetchNextPoliciesToAccept()}))()}fetchSitePoliciesURL(){var e=this;return(0,t.A)((function*(){e.title=_.HT.instant("core.policy.policyagreement"),e.subTitle=void 0;try{e.sitePoliciesURL=yield s.CorePolicy.getSitePoliciesURL(e.siteId)}catch(o){return C.CoreAlerts.showError(o,{default:"Error getting site policy."}),e.cancel(),void 0}try{const o=yield r.A.getMimeTypeFromUrl(e.sitePoliciesURL),i=r.A.getExtension(o,e.sitePoliciesURL);e.showInline="html"==i||"htm"==i}catch{e.showInline=!1}finally{e.policyLoaded=!0}a.OF.logEvent({type:a.qr.VIEW_ITEM,ws:"auth_email_get_signup_settings",name:_.HT.instant("core.policy.policyagreement"),data:{category:"policy"},url:"/user/policy.php"})}))()}fetchNextPoliciesToAccept(){var e=this;return(0,t.A)((function*(){try{e.scrollTop();const o=yield s.CorePolicy.getNextPendingPolicies({readingStrategy:2,siteId:e.siteId});e.pendingPolicies=o.map((e=>(e.referToFullPolicyText=_.HT.instant("core.policy.refertofullpolicytext",{$a:`<span class="core-site-policy-full-policy-link">${e.name}</span>`}),e)));const i=e.pendingPolicies[0];if(!i)return yield e.finishAcceptingPolicies(),void 0;e.initFormForPendingPolicies(),e.agreeInOwnPage=i.agreementstyle===s.CorePolicyAgreementStyle.OwnPage,e.showConsentForm=!1,e.numPolicy=1,e.setCurrentPolicy(i),e.policyLoaded=!0}catch(o){C.CoreAlerts.showError(o,{default:"Error getting site policy."}),e.cancel()}}))()}logAnalyticsPolicyView(){if(!this.currentPolicy)return;const e={versionid:this.currentPolicy.versionid};var o,i;this.agreeInOwnPage||(e.numpolicy=this.numPolicy,e.totalpolicies=null!==(o=null===(i=this.pendingPolicies)||void 0===i?void 0:i.length)&&void 0!==o?o:this.numPolicy);a.OF.logEvent({type:a.qr.VIEW_ITEM,ws:"tool_policy_get_user_acceptances",name:this.currentPolicy.name,data:e,url:p.F.addParamsToUrl("/admin/tool/policy/view.php",e)})}logAnalyticsConsentFormView(){a.OF.logEvent({type:a.qr.VIEW_ITEM,ws:"tool_policy_get_user_acceptances",name:_.HT.instant("core.policy.consentpagetitle"),data:{},url:p.F.addParamsToUrl("/admin/tool/policy/index.php")})}initFormForPoliciesURL(){this.policiesForm=new g.gE({agreepolicy:new g.MJ(!1,{validators:g.k0.requiredTrue,nonNullable:!0})})}initFormForPendingPolicies(){var e;this.policiesForm=new g.gE({}),null===(e=this.pendingPolicies)||void 0===e||e.forEach((e=>{var o,i;e.optional?null===(o=this.policiesForm)||void 0===o||o.addControl(`agreepolicy${e.versionid}`,new g.MJ(void 0,{validators:g.k0.required})):null===(i=this.policiesForm)||void 0===i||i.addControl(`agreepolicy${e.versionid}`,new g.MJ(!1,{validators:g.k0.requiredTrue,nonNullable:!0}))}))}cancel(){return(0,t.A)((function*(){yield n.CoreSites.logout()}))()}nextPolicy(e){if(e.preventDefault(),e.stopPropagation(),this.pendingPolicies){if(this.scrollTop(),this.numPolicy<this.pendingPolicies.length)return this.numPolicy++,this.setCurrentPolicy(this.pendingPolicies[this.numPolicy-1]),void 0;this.currentPolicy=void 0,this.stepData=void 0,this.showConsentForm=!0,this.title=_.HT.instant("core.policy.consentpagetitle"),this.subTitle=_.HT.instant("core.policy.agreepolicies"),this.logAnalyticsConsentFormView()}}setCurrentPolicy(e){var o,i;e&&(this.hasScroll=!1,this.currentPolicy=e,this.title=e.name||"",this.subTitle=void 0,this.stepData=this.agreeInOwnPage?void 0:{numpolicy:this.numPolicy,totalpolicies:null!==(o=null===(i=this.pendingPolicies)||void 0===i?void 0:i.length)&&void 0!==o?o:this.numPolicy},this.logAnalyticsPolicyView())}checkScroll(){var e=this;return(0,t.A)((function*(){var o;yield f.H.wait(400);const i=yield null===(o=e.content)||void 0===o?void 0:o.getScrollElement();e.hasScroll=!!i&&i.scrollHeight>i.clientHeight+2}))()}submitAcceptances(e){var o=this;return(0,t.A)((function*(){var i;if(e.preventDefault(),e.stopPropagation(),null===(i=o.policiesForm)||void 0===i||!i.valid){for(const e in null===(t=o.policiesForm)||void 0===t?void 0:t.controls){var t;o.policiesForm.controls[e].markAsDirty()}o.changeDetector.detectChanges();return(yield y.y.scrollToInputError(o.elementRef.nativeElement))||C.CoreAlerts.showError(_.HT.instant("core.policy.mustagreetocontinue")),void 0}const n=yield d.CoreLoadings.show("core.sending",!0);try{if(!o.isPoliciesURL)return yield o.acceptPendingPolicies(),void 0;yield s.CorePolicy.acceptMandatorySitePolicies(o.siteId),yield o.finishAcceptingPolicies()}catch(e){C.CoreAlerts.showError(e,{default:"Error accepting site policies."})}finally{n.dismiss()}}))()}acceptPendingPolicies(){var e=this;return(0,t.A)((function*(){var o;if(!e.pendingPolicies)return;const i={};null===(o=e.pendingPolicies)||void 0===o||o.forEach((o=>{var t;const n=null===(t=e.policiesForm)||void 0===t?void 0:t.controls[`agreepolicy${o.versionid}`];if(n)if(o.optional){if(null==n.value)return C.CoreAlerts.showError(_.HT.instant("core.policy.mustagreetocontinue")),void 0;i[o.versionid]=n.value}else{if(!n.value)return C.CoreAlerts.showError(_.HT.instant("core.policy.mustagreetocontinue")),void 0;i[o.versionid]=1}})),yield s.CorePolicy.setUserAcceptances(i,e.siteId),yield e.fetchNextPoliciesToAccept()}))()}finishAcceptingPolicies(){var e=this;return(0,t.A)((function*(){yield h.g.ignoreErrors(e.currentSite.invalidateWsCache()),l.z.trigger(l.z.SITE_POLICY_AGREED,{},e.siteId),yield c.CoreNavigator.navigateToSiteHome()}))()}scrollTop(e){var o;null==e||e.preventDefault(),null==e||e.stopPropagation(),null===(o=this.content)||void 0===o||o.scrollToTop(400)}viewFullPolicy(e){return(0,t.A)((function*(){const{CorePolicyViewPolicyModalComponent:o}=yield i.e(54619).then(i.bind(i,54619));u.I.openModal({component:o,componentProps:{policy:e}})}))()}ngOnDestroy(){var e;null===(e=this.layoutSubscription)||void 0===e||e.unsubscribe()}}return(e=CorePolicySitePolicyPage).ɵfac=function CorePolicySitePolicyPage_Factory(o){return new(o||e)(T.rXU(T.aKT),T.rXU(T.gRc))},e.ɵcmp=T.VBU({type:e,selectors:[["page-core-policy-site-policy"]],viewQuery:function CorePolicySitePolicyPage_Query(e,o){if(1&e&&T.GBs(m.W9,5),2&e){let e;T.mGM(e=T.lsd())&&(o.content=e.first)}},standalone:!0,features:[T.aNF],decls:15,vars:9,consts:[["policyForm",""],["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["name","fas-xmark","slot","icon-only","aria-hidden","true"],[1,"limited-width"],[3,"hideUntil"],[3,"formGroup","ngSubmit",4,"ngIf"],["contextLevel","system",3,"text","contextInstanceId"],[3,"ngSubmit","formGroup"],["class","core-site-policy-top-bar",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[1,"core-site-policy-buttons","ion-margin-horizontal"],["type","submit","class","ion-text-wrap",3,"expand","disabled",4,"ngIf"],["class","ion-text-wrap",3,"expand","click",4,"ngIf"],[1,"core-site-policy-top-bar"],[1,"ion-text-wrap"],[1,"core-info-card"],["name","fas-circle-info","slot","start","aria-hidden","true"],[1,"ion-text-wrap","core-site-policy-link"],["core-link","",3,"href","capture"],["name","fas-up-right-from-square","aria-hidden","true"],[1,"core-site-policy-iframe-container"],[3,"src",4,"ngIf"],["name","agreepolicy","formControlName","agreepolicy"],[3,"core-mark-required",4,"ngIf"],[3,"src"],[3,"core-mark-required"],["class","core-site-policy-bottom-bar",4,"ngIf"],[1,"ion-text-wrap","core-site-policy-summary"],["contextLevel","system",3,"afterRender","text","contextInstanceId"],[1,"ion-text-wrap","core-site-policy-content"],[4,"ngFor","ngForOf"],[3,"collapsible-item"],["class","ion-text-wrap","button","","detail","false",3,"click",4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["button","","detail","false",1,"ion-text-wrap",3,"click"],[3,"innerHTML"],[1,"core-site-policy-bottom-bar"],["class","core-site-policy-go-top-button","color","secondary","slot","end",3,"ariaLabel","click",4,"ngIf"],["color","secondary","slot","end",1,"core-site-policy-go-top-button",3,"click","ariaLabel"],["name","fas-chevron-up","slot","icon-only","aria-hidden","true"],["type","submit",1,"ion-text-wrap",3,"expand","disabled"],[1,"ion-text-wrap",3,"click","expand"],[3,"formControl",4,"ngIf"],[3,"formControl"],[3,"control","errorMessages"],[3,"value"]],template:function CorePolicySitePolicyPage_Template(e,o){if(1&e){const e=T.RV6();T.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),T.nrm(3,"ion-back-button",2),T.nI1(4,"translate"),T.k0s(),T.DNE(5,CorePolicySitePolicyPage_ion_title_5_Template,3,2,"ion-title",3),T.j41(6,"ion-buttons",4)(7,"ion-button",5),T.nI1(8,"translate"),T.bIt("click",(function CorePolicySitePolicyPage_Template_ion_button_click_7_listener(){return T.eBV(e),T.Njj(o.cancel())})),T.nrm(9,"ion-icon",6),T.k0s()()()(),T.j41(10,"ion-content",7)(11,"core-loading",8),T.DNE(12,CorePolicySitePolicyPage_form_12_Template,9,7,"form",9),T.k0s()(),T.DNE(13,CorePolicySitePolicyPage_ng_template_13_Template,2,2,"ng-template",null,0,T.C5r)}2&e&&(T.R7$(3),T.Y8G("text",T.bMT(4,5,"core.back")),T.R7$(2),T.Y8G("ngIf",o.siteName),T.R7$(2),T.Y8G("ariaLabel",T.bMT(8,7,"core.cancel")),T.R7$(4),T.Y8G("hideUntil",o.policyLoaded),T.R7$(),T.Y8G("ngIf",o.policiesForm))},dependencies:[b.n,v.Sq,v.bT,v.T3,g.qT,g.BC,g.cb,m.Jm,m.QW,m.b_,m.eY,m.W9,m.eU,m.iq,m.uz,m.he,m.KO,m.f0,m.BC,m.ai,m.hB,m.Je,m.el,g.l_,g.j4,g.JD,I.l,S.q,R.R,M.j,x.t,G.B,O.j,k.K,F.i,E.T,w.D9],styles:["[_nghost-%COMP%]   hr[_ngcontent-%COMP%]{background:var(--black);margin:0 16px}[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1;height:100%}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-info-card[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--inner-border-width: 0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-top-bar[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-bottom-bar[_ngcontent-%COMP%]{font-size:.875rem}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-top-bar[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-bottom-bar[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-link[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-decoration:underline;font-size:1rem}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-link[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:.875rem;margin-inline-start:4px;margin-inline-end:0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-iframe-container[_ngcontent-%COMP%]{margin:8px;display:flex;flex-grow:1}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-content[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-go-top-button[_ngcontent-%COMP%]{--border-radius: 50%;--box-shadow: 0 3px 5px -1px rgba(0, 0, 0, .2), 0 6px 10px 0 rgba(0, 0, 0, .14), 0 1px 18px 0 rgba(0, 0, 0, .12);margin-bottom:8px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-buttons[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:0;margin-right:0;margin-bottom:12px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]     ion-label .core-site-policy-full-policy-link{color:var(--core-link-color)}"]}),CorePolicySitePolicyPage})()}}]);