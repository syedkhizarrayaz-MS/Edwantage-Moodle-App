"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[35792],{35792:(e,n,o)=>{o.r(n),o.d(n,{default:()=>F});var t=o(10467),s=o(75629),_=o(98870),a=o(15324),i=o(52749),d=o(75383),r=o(49588),l=o(79555),c=o(21509),m=o(83174),g=o(24742),u=o(22693),p=o(55101),R=o(55554),k=o(25572),f=o(86654),I=o(54438),v=o(60177),h=o(89417),b=o(2910),M=o(64422),T=o(49234),$=o(16658),P=o(58197),G=o(37557),w=o(35407),L=o(88246),U=o(43570),A=o(73955),x=o(59528);const _c0=e=>({header:e}),_c1=e=>({$a:e}),_c2=e=>({"text-dimmed":e}),_c3=e=>({"addon-mod_lesson-highlight":e});function AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_7_Template(e,n){if(1&e&&(I.j41(0,"ion-select-option",16),I.EFF(1),I.k0s()),2&e){const e=n.$implicit;I.Y8G("value",e.try),I.R7$(),I.SpI(" ",e.label," ")}}function AddonModLessonUserRetakePage_div_14_ion_item_7_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"ion-item",12)(1,"ion-select",13),I.nI1(2,"translate"),I.nI1(3,"translate"),I.mxI("ngModelChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ngModelChange_1_listener(n){I.eBV(e);const o=I.XpG(2);return I.DH7(o.selectedRetake,n)||(o.selectedRetake=n),I.Njj(n)})),I.bIt("ionChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ionChange_1_listener(){I.eBV(e);const n=I.XpG(2);return I.Njj(n.changeRetake(n.selectedRetake))})),I.j41(4,"p",14),I.EFF(5),I.nI1(6,"translate"),I.k0s(),I.DNE(7,AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_7_Template,2,2,"ion-select-option",15),I.k0s()()}if(2&e){const e=I.XpG(2);I.R7$(),I.R50("ngModel",e.selectedRetake),I.Y8G("cancelText",I.bMT(2,5,"core.cancel"))("interfaceOptions",I.eq3(11,_c0,I.bMT(3,7,"addon.mod_lesson.attemptheader"))),I.R7$(4),I.JRh(I.bMT(6,9,"addon.mod_lesson.attemptheader")),I.R7$(2),I.Y8G("ngForOf",e.student.attempts)}}function AddonModLessonUserRetakePage_div_14_ion_list_8_Template(e,n){if(1&e&&(I.j41(0,"ion-list",17)(1,"ion-item")(2,"ion-label",12)(3,"ion-grid",18)(4,"ion-row")(5,"ion-col")(6,"p",19),I.EFF(7),I.nI1(8,"translate"),I.k0s(),I.j41(9,"p"),I.EFF(10),I.nI1(11,"translate"),I.k0s()(),I.j41(12,"ion-col")(13,"p",19),I.EFF(14),I.nI1(15,"translate"),I.k0s(),I.j41(16,"p"),I.EFF(17),I.k0s()()()()()(),I.j41(18,"ion-item",12)(19,"ion-label")(20,"p",19),I.EFF(21),I.nI1(22,"translate"),I.k0s(),I.j41(23,"p"),I.EFF(24),I.k0s()()(),I.j41(25,"ion-item",12)(26,"ion-label")(27,"p",19),I.EFF(28),I.nI1(29,"translate"),I.k0s(),I.j41(30,"p"),I.EFF(31),I.nI1(32,"coreFormatDate"),I.k0s()()()()),2&e){const e=I.XpG(2);I.R7$(7),I.JRh(I.bMT(8,9,"core.gradenoun")),I.R7$(3),I.JRh(I.i5U(11,11,"core.percentagenumber",I.eq3(22,_c1,e.retake.userstats.grade))),I.R7$(4),I.JRh(I.bMT(15,14,"addon.mod_lesson.rawgrade")),I.R7$(3),I.Lme("",e.retake.userstats.gradeinfo.earned," / ",e.retake.userstats.gradeinfo.total,""),I.R7$(4),I.JRh(I.bMT(22,16,"addon.mod_lesson.timetaken")),I.R7$(3),I.JRh(e.timeTakenReadable),I.R7$(4),I.JRh(I.bMT(29,18,"addon.mod_lesson.completed")),I.R7$(3),I.JRh(I.bMT(32,20,1e3*e.retake.userstats.completed))}}function AddonModLessonUserRetakePage_div_14_ion_item_9_Template(e,n){1&e&&(I.j41(0,"ion-item",12)(1,"ion-label"),I.EFF(2),I.nI1(3,"translate"),I.k0s()()),2&e&&(I.R7$(2),I.JRh(I.bMT(3,1,"addon.mod_lesson.notcompleted")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template(e,n){1&e&&(I.j41(0,"ion-item",12)(1,"ion-label")(2,"p"),I.EFF(3),I.nI1(4,"translate"),I.k0s()()()),2&e&&(I.R7$(3),I.JRh(I.bMT(4,1,"addon.mod_lesson.didnotanswerquestion")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template(e,n){if(1&e&&(I.j41(0,"ion-item")(1,"ion-label",12)(2,"ion-grid",18)(3,"ion-row")(4,"ion-col")(5,"ion-button",26),I.EFF(6),I.k0s()(),I.j41(7,"ion-col"),I.nrm(8,"p",27),I.k0s()()()()()),2&e){const e=I.XpG().$implicit;I.R7$(5),I.Y8G("disabled",!0),I.R7$(),I.SpI(" ",e[0].buttonText," "),I.R7$(2),I.Y8G("innerHTML",e[0].content,I.npT)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template(e,n){if(1&e&&(I.j41(0,"ion-badge",34),I.nrm(1,"core-format-text",31),I.k0s()),2&e){const e=I.XpG(3).$implicit,n=I.XpG(5);I.R7$(),I.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_5_Template(e,n){if(1&e&&(I.j41(0,"ion-badge",35),I.EFF(1),I.k0s()),2&e){const e=I.XpG(3).$implicit;I.R7$(),I.SpI(" ",e[0].successBadge," ")}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template(e,n){if(1&e&&(I.j41(0,"ion-item",29)(1,"ion-checkbox",30)(2,"p"),I.nrm(3,"core-format-text",31),I.k0s(),I.DNE(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template,2,5,"ion-badge",32)(5,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_5_Template,2,1,"ion-badge",33),I.k0s()()),2&e){const e=I.XpG(2).$implicit,n=I.XpG(5);I.Y8G("ngClass",I.eq3(11,_c3,e[0].highlight)),I.R7$(),I.Y8G("ngModel",e[0].checked)("disabled",!0),I.BMQ("name",e[0].name),I.R7$(2),I.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),I.R7$(),I.Y8G("ngIf",e[1]),I.R7$(),I.Y8G("ngIf",e[0].successBadge)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template(e,n){if(1&e&&(I.j41(0,"ion-badge",37),I.nrm(1,"core-format-text",31),I.k0s()),2&e){const e=I.XpG(3).$implicit,n=I.XpG(5);I.R7$(),I.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template(e,n){if(1&e&&(I.j41(0,"ion-item",12)(1,"ion-label")(2,"p"),I.EFF(3),I.k0s(),I.DNE(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template,2,5,"ion-badge",36),I.k0s()()),2&e){const e=I.XpG(2).$implicit;I.R7$(3),I.JRh(e[0].value),I.R7$(),I.Y8G("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template(e,n){if(1&e&&(I.j41(0,"ion-badge",37),I.nrm(1,"core-format-text",31),I.k0s()),2&e){const e=I.XpG(3).$implicit,n=I.XpG(5);I.R7$(),I.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template(e,n){if(1&e&&(I.j41(0,"ion-item")(1,"ion-label",12)(2,"ion-grid",18)(3,"ion-row")(4,"ion-col")(5,"p"),I.nrm(6,"core-format-text",31),I.k0s()(),I.j41(7,"ion-col")(8,"p"),I.EFF(9),I.k0s(),I.DNE(10,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template,2,5,"ion-badge",36),I.k0s()()()()()),2&e){const e=I.XpG(2).$implicit,n=I.XpG(5);I.R7$(6),I.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),I.R7$(3),I.JRh(e[0].value),I.R7$(),I.Y8G("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template(e,n){if(1&e&&(I.j41(0,"ion-badge",37),I.nrm(1,"core-format-text",31),I.k0s()),2&e){const e=I.XpG(3).$implicit,n=I.XpG(5);I.R7$(),I.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template(e,n){if(1&e&&(I.j41(0,"ion-item",12)(1,"ion-label")(2,"p"),I.nrm(3,"core-format-text",31),I.k0s(),I.DNE(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template,2,5,"ion-badge",36),I.k0s()()),2&e){const e=I.XpG(2).$implicit,n=I.XpG(5);I.R7$(3),I.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),I.R7$(),I.Y8G("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template,6,13,"ion-item",28)(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template,5,2,"ion-item",10)(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template,11,7,"ion-item",6)(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template,5,6,"ion-item",10),I.bVm()),2&e){const e=I.XpG().$implicit;I.R7$(),I.Y8G("ngIf",e[0].isCheckbox),I.R7$(),I.Y8G("ngIf",e[0].isText),I.R7$(),I.Y8G("ngIf",e[0].isSelect),I.R7$(),I.Y8G("ngIf",!e[0].isCheckbox&&!e[0].isText&&!e[0].isSelect)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template(e,n){if(1&e&&(I.j41(0,"ion-badge",37),I.nrm(1,"core-format-text",31),I.k0s()),2&e){const e=I.XpG(2).$implicit,n=I.XpG(5);I.R7$(),I.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template(e,n){if(1&e&&(I.j41(0,"ion-item",12)(1,"ion-label")(2,"p"),I.nrm(3,"core-format-text",31),I.k0s(),I.DNE(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template,2,5,"ion-badge",36),I.k0s()()),2&e){const e=I.XpG().$implicit,n=I.XpG(5);I.R7$(3),I.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),I.R7$(),I.Y8G("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template,9,3,"ion-item",6)(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template,5,4,"ng-container",6)(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template,5,6,"ion-item",10),I.bVm()),2&e){const e=I.XpG(2).$implicit;I.R7$(),I.Y8G("ngIf",e.isContent),I.R7$(),I.Y8G("ngIf",e.isQuestion),I.R7$(),I.Y8G("ngIf",!e.isContent&&!e.isQuestion)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template(e,n){if(1&e&&(I.j41(0,"ion-item",12)(1,"ion-label")(2,"p",19),I.EFF(3),I.nI1(4,"translate"),I.k0s(),I.j41(5,"p"),I.nrm(6,"core-format-text",31),I.k0s()()()),2&e){const e=I.XpG(2).$implicit,n=I.XpG(3);I.R7$(3),I.JRh(I.bMT(4,6,"addon.mod_lesson.response")),I.R7$(3),I.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e.answerdata.response)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template(e,n){if(1&e&&(I.j41(0,"ion-item",12)(1,"ion-label")(2,"p"),I.EFF(3),I.k0s()()()),2&e){const e=I.XpG(2).$implicit;I.R7$(3),I.JRh(e.answerdata.score)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template(e,n){if(1&e&&(I.j41(0,"div",24),I.DNE(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template,4,3,"ng-container",25)(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template,7,8,"ion-item",10)(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template,4,1,"ion-item",10),I.k0s()),2&e){const e=I.XpG().$implicit;I.R7$(),I.Y8G("ngForOf",e.answerdata.answers),I.R7$(),I.Y8G("ngIf",e.answerdata.response),I.R7$(),I.Y8G("ngIf",e.answerdata.score)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template(e,n){if(1&e&&(I.j41(0,"ion-card",21)(1,"ion-card-header",12)(2,"ion-card-title"),I.EFF(3),I.k0s()(),I.j41(4,"ion-item",12)(5,"ion-label")(6,"p",19),I.EFF(7),I.nI1(8,"translate"),I.k0s(),I.j41(9,"p"),I.nrm(10,"core-format-text",22),I.k0s()()(),I.j41(11,"ion-item",12)(12,"ion-label")(13,"p",19),I.EFF(14),I.nI1(15,"translate"),I.k0s()()(),I.DNE(16,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template,5,3,"ion-item",10)(17,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template,4,3,"div",23),I.k0s()),2&e){const e=n.$implicit,o=I.XpG(3);I.Y8G("ngClass",I.eq3(16,_c2,e.grayout)),I.R7$(3),I.Lme("",e.qtype,": ",e.title,""),I.R7$(4),I.JRh(I.bMT(8,12,"addon.mod_lesson.question")),I.R7$(3),I.Y8G("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e.contents)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),I.R7$(4),I.JRh(I.bMT(15,14,"addon.mod_lesson.answer")),I.R7$(2),I.Y8G("ngIf",!e.answerdata||!e.answerdata.answers||!e.answerdata.answers.length),I.R7$(),I.Y8G("ngIf",e.answerdata&&e.answerdata.answers&&e.answerdata.answers.length)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template,18,18,"ion-card",20),I.bVm()),2&e){const e=I.XpG(2);I.R7$(),I.Y8G("ngForOf",e.retake.answerpages)}}function AddonModLessonUserRetakePage_div_14_Template(e,n){if(1&e&&(I.j41(0,"div")(1,"ion-item",7),I.nrm(2,"core-user-avatar",8),I.j41(3,"ion-label")(4,"h2"),I.EFF(5),I.k0s(),I.nrm(6,"core-progress-bar",9),I.k0s()(),I.DNE(7,AddonModLessonUserRetakePage_div_14_ion_item_7_Template,8,13,"ion-item",10)(8,AddonModLessonUserRetakePage_div_14_ion_list_8_Template,33,24,"ion-list",11)(9,AddonModLessonUserRetakePage_div_14_ion_item_9_Template,4,3,"ion-item",10)(10,AddonModLessonUserRetakePage_div_14_ng_container_10_Template,2,1,"ng-container",6),I.k0s()),2&e){const e=I.XpG();I.R7$(),I.Y8G("userId",e.student.id)("courseId",e.courseId),I.BMQ("aria-label",e.student.fullname),I.R7$(),I.Y8G("user",e.student)("userId",e.student.id)("courseId",e.courseId)("linkProfile",!1),I.R7$(3),I.JRh(e.student.fullname),I.R7$(),I.Y8G("progress",e.student.bestgrade),I.R7$(),I.Y8G("ngIf",e.student.attempts&&e.student.attempts.length>1),I.R7$(),I.Y8G("ngIf",e.retake&&e.retake.userstats&&e.retake.userstats.gradeinfo),I.R7$(),I.Y8G("ngIf",e.retake&&(!e.retake.userstats||!e.retake.userstats.gradeinfo)),I.R7$(),I.Y8G("ngIf",e.retake)}}let F=(()=>{var e;class AddonModLessonUserRetakePage{constructor(){this.component=p.tj,this.logView=g.j.once((()=>this.performLogView()))}ngOnInit(){try{this.cmId=a.CoreNavigator.getRequiredRouteNumberParam("cmId"),this.courseId=a.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.userId=a.CoreNavigator.getRouteNumberParam("userId")||i.CoreSites.getCurrentSiteUserId(),this.retakeNumber=a.CoreNavigator.getRouteNumberParam("retake")}catch(e){return k.CoreAlerts.showError(e),a.CoreNavigator.back(),void 0}this.fetchData().finally((()=>{this.loaded=!0}))}changeRetake(e){var n=this;return(0,t.A)((function*(){n.loaded=!1;try{yield n.setRetake(e),n.performLogView()}catch(e){var o;n.selectedRetake=null!==(o=n.previousSelectedRetake)&&void 0!==o?o:n.selectedRetake,k.CoreAlerts.showError(r.CoreErrorHelper.addDataNotDownloadedError(e,"Error getting attempt."))}finally{n.loaded=!0}}))()}doRefresh(e){this.refreshData().finally((()=>{null==e||e.complete()}))}fetchData(){var e=this;return(0,t.A)((function*(){try{var n;e.lesson=yield c.N.getLesson(e.courseId,e.cmId);const o=yield c.N.getRetakesOverview(e.lesson.id,{cmId:e.cmId}),t=null==o||null===(n=o.students)||void 0===n?void 0:n.find((n=>n.id==e.userId));if(!t)throw new s.CoreError(l.HT.instant("addon.mod_lesson.cannotfinduser"));if(!t.attempts.length)throw new s.CoreError(l.HT.instant("addon.mod_lesson.cannotfindattempt"));t.bestgrade=d.Ni.roundToDecimals(t.bestgrade,2),t.attempts.forEach((n=>{e.selectedRetake||e.retakeNumber!=n.try||(e.selectedRetake=e.retakeNumber),n.label=m.r.getRetakeLabel(n)})),e.selectedRetake||(e.selectedRetake=t.attempts[t.attempts.length-1].try);const a=yield R.g.ignoreErrors(_.CoreUser.getProfile(t.id,e.courseId,!0));e.student=t,e.student.profileimageurl=null==a?void 0:a.profileimageurl,yield e.setRetake(e.selectedRetake),e.logView()}catch(e){k.CoreAlerts.showError(e,{default:l.HT.instant("Error getting data.")})}}))()}refreshData(){var e=this;return(0,t.A)((function*(){const n=[];n.push(c.N.invalidateLessonData(e.courseId)),e.lesson&&(n.push(c.N.invalidateRetakesOverview(e.lesson.id)),n.push(c.N.invalidateUserRetakesForUser(e.lesson.id,e.userId))),yield R.g.ignoreErrors(Promise.all(n)),yield e.fetchData()}))()}setRetake(e){var n=this;return(0,t.A)((function*(){n.selectedRetake=e;const o=yield c.N.getUserRetake(n.lesson.id,e,{cmId:n.cmId,userId:n.userId});n.retake=n.formatRetake(o),n.previousSelectedRetake=n.selectedRetake}))()}formatRetake(e){const n=e;return n.userstats.gradeinfo&&(n.userstats.grade=d.Ni.roundToDecimals(n.userstats.grade,2),this.timeTakenReadable=g.j.formatTime(n.userstats.timetotake)),n.answerpages.forEach((e=>{if(c.N.answerPageIsContent(e)){var n;const o=e;o.isContent=!0,null!==(n=o.answerdata)&&void 0!==n&&n.answers&&o.answerdata.answers.forEach((e=>{e[0]=m.r.getContentPageAnswerDataFromHtml(e[0])}))}else if(c.N.answerPageIsQuestion(e)){var o;const n=e;n.isQuestion=!0,null!==(o=n.answerdata)&&void 0!==o&&o.answers&&n.answerdata.answers.forEach((e=>{e[0]=m.r.getQuestionPageAnswerDataFromHtml(e[0])}))}})),n}performLogView(){this.lesson&&u.OF.logEvent({type:u.qr.VIEW_ITEM,ws:"mod_lesson_get_user_attempt",name:this.lesson.name+": "+l.HT.instant("addon.mod_lesson.detailedstats"),data:{id:this.lesson.id,userid:this.userId,try:this.selectedRetake,category:"lesson"},url:`/mod/lesson/report.php?id=${this.cmId}&action=reportdetail&userid=${this.userId}&try=${this.selectedRetake}`})}}return(e=AddonModLessonUserRetakePage).ɵfac=function AddonModLessonUserRetakePage_Factory(n){return new(n||e)},e.ɵcmp=I.VBU({type:e,selectors:[["page-addon-mod-lesson-user-retake"]],standalone:!0,features:[I.aNF],decls:15,vars:12,consts:[["slot","start"],[3,"text"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["core-user-link","",1,"ion-text-wrap",3,"userId","courseId"],["slot","start",3,"user","userId","courseId","linkProfile"],["a11yText","core.gradenoun",3,"progress"],["class","ion-text-wrap",4,"ngIf"],["class","addon-mod_lesson-userstats",4,"ngIf"],[1,"ion-text-wrap"],["interface","action-sheet",3,"ngModelChange","ionChange","ngModel","cancelText","interfaceOptions"],["slot","label",1,"item-heading"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"addon-mod_lesson-userstats"],[1,"ion-no-padding"],[1,"item-heading"],["class","addon-mod_lesson-answerpage",3,"ngClass",4,"ngFor","ngForOf"],[1,"addon-mod_lesson-answerpage",3,"ngClass"],["collapsible-item","","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["class","addon-mod_lesson-answer",4,"ngIf"],[1,"addon-mod_lesson-answer"],[4,"ngFor","ngForOf"],["expand","block","fill","outline",1,"ion-text-wrap",3,"disabled"],[3,"innerHTML"],["class","ion-text-wrap",3,"ngClass",4,"ngIf"],[1,"ion-text-wrap",3,"ngClass"],[3,"ngModel","disabled"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["color","dark","class","addon-mod_lesson-answer-stats",4,"ngIf"],["color","success","class","addon-mod_lesson-answer-success",4,"ngIf"],["color","dark",1,"addon-mod_lesson-answer-stats"],["color","success",1,"addon-mod_lesson-answer-success"],["color","dark",4,"ngIf"],["color","dark"]],template:function AddonModLessonUserRetakePage_Template(e,n){1&e&&(I.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),I.nrm(3,"ion-back-button",1),I.nI1(4,"translate"),I.k0s(),I.j41(5,"ion-title")(6,"h1"),I.EFF(7),I.nI1(8,"translate"),I.k0s()()()(),I.j41(9,"ion-content",2)(10,"ion-refresher",3),I.bIt("ionRefresh",(function AddonModLessonUserRetakePage_Template_ion_refresher_ionRefresh_10_listener(e){return n.doRefresh(e.target)})),I.nrm(11,"ion-refresher-content",4),I.nI1(12,"translate"),I.k0s(),I.j41(13,"core-loading",5),I.DNE(14,AddonModLessonUserRetakePage_div_14_Template,11,13,"div",6),I.k0s()()),2&e&&(I.R7$(3),I.Y8G("text",I.bMT(4,6,"core.back")),I.R7$(4),I.JRh(I.bMT(8,8,"addon.mod_lesson.detailedstats")),I.R7$(3),I.Y8G("disabled",!n.loaded),I.R7$(),I.FS9("pullingText",I.bMT(12,10,"core.pulltorefresh")),I.R7$(2),I.Y8G("hideUntil",n.loaded),I.R7$(),I.Y8G("ngIf",n.student))},dependencies:[f.n,v.YU,v.Sq,v.bT,h.BC,h.vS,b.In,b.Jm,b.QW,b.b_,b.ME,b.tN,b.eY,b.hU,b.W9,b.lO,b.eU,b.uz,b.he,b.nf,b.To,b.Ki,b.ln,b.Nm,b.Ip,b.BC,b.ai,b.hB,b.Je,b.el,M.R,T.z,$.T,P.B,G.O,w.K,L.i,U.T,A.D9,x.f],styles:["[_nghost-%COMP%]   .button-disabled[_ngcontent-%COMP%]{opacity:.4}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]{--background: var(--primary-tint)}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--primary-shade)}[_nghost-%COMP%]   .item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   .addon-mod_lesson-answer-stats[_ngcontent-%COMP%]{margin-inline-end:4px}"]}),AddonModLessonUserRetakePage})()}}]);