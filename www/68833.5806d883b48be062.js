"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[68833],{68833:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var o=n(10467),a=n(74431),r=n(86123),i=n(44682),s=n(94247),_=n(8979),c=n(66110),d=n(33014),l=n(15324),g=n(52749),u=n(47551),p=n(79555),m=n(82907),C=n(49882),S=n(55554),f=n(25572),h=n(49588),M=n(86654),b=n(23803),P=n(54438),T=n(60177),I=n(2910),D=n(15060),A=n(64422),w=n(32572),v=n(49234),y=n(86198),k=n(58197),R=n(8199),G=n(88246),E=n(43570),O=n(73955),z=n(78913);const _c0=e=>({name:e}),_c1=e=>({section:e}),_c2=()=>({notdownloaded:"addon.storagemanager.downloaddatafrom"});function AddonStorageManagerCourseStoragePage_ion_item_11_Template(e,t){1&e&&(P.j41(0,"ion-item",16)(1,"ion-label")(2,"p"),P.EFF(3),P.nI1(4,"translate"),P.k0s()()()),2&e&&(P.R7$(3),P.JRh(P.bMT(4,1,"addon.storagemanager.courseinfo")))}function AddonStorageManagerCourseStoragePage_ng_container_22_Template(e,t){if(1&e&&(P.qex(0),P.EFF(1),P.nI1(2,"coreBytesToSize"),P.bVm()),2&e){const e=P.XpG();P.R7$(),P.JRh(P.bMT(2,1,e.totalSize))}}function AddonStorageManagerCourseStoragePage_ng_container_23_Template(e,t){1&e&&(P.qex(0),P.EFF(1),P.nI1(2,"translate"),P.bVm()),2&e&&(P.R7$(),P.JRh(P.bMT(2,1,"core.calculating")))}function AddonStorageManagerCourseStoragePage_ion_button_24_ion_icon_1_Template(e,t){if(1&e&&P.nrm(0,"ion-icon",20),2&e){const e=P.XpG(2);P.Y8G("name",e.prefetchCourseData.icon)}}function AddonStorageManagerCourseStoragePage_ion_button_24_ion_spinner_2_Template(e,t){1&e&&P.nrm(0,"ion-spinner",1)}function AddonStorageManagerCourseStoragePage_ion_button_24_Template(e,t){if(1&e){const e=P.RV6();P.j41(0,"ion-button",17),P.bIt("click",(function AddonStorageManagerCourseStoragePage_ion_button_24_Template_ion_button_click_0_listener(t){P.eBV(e);const n=P.XpG();return P.Njj(n.prefetchCourse(t))})),P.DNE(1,AddonStorageManagerCourseStoragePage_ion_button_24_ion_icon_1_Template,1,1,"ion-icon",18)(2,AddonStorageManagerCourseStoragePage_ion_button_24_ion_spinner_2_Template,1,0,"ion-spinner",19),P.EFF(3),P.nI1(4,"translate"),P.k0s()}if(2&e){const e=P.XpG();P.Y8G("disabled",e.prefetchCourseData.loading),P.R7$(),P.Y8G("ngIf",!e.prefetchCourseData.loading),P.R7$(),P.Y8G("ngIf",e.prefetchCourseData.loading),P.R7$(),P.SpI(" ",P.bMT(4,4,e.prefetchCourseData.statusTranslatable)," ")}}function AddonStorageManagerCourseStoragePage_ng_container_30_ng_container_1_Template(e,t){1&e&&P.eu8(0)}function AddonStorageManagerCourseStoragePage_ng_container_30_Template(e,t){if(1&e&&(P.qex(0),P.DNE(1,AddonStorageManagerCourseStoragePage_ng_container_30_ng_container_1_Template,1,0,"ng-container",21),P.bVm()),2&e){const e=t.$implicit;P.XpG();const n=P.sdS(32);P.R7$(),P.Y8G("ngTemplateOutlet",n)("ngTemplateOutletContext",P.eq3(2,_c1,e))}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ion_badge_6_ion_icon_1_Template(e,t){1&e&&(P.nrm(0,"ion-icon",33),P.nI1(1,"translate")),2&e&&P.BMQ("aria-label",P.bMT(1,1,"core.downloaded"))}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ion_badge_6_Template(e,t){if(1&e&&(P.j41(0,"ion-badge",31),P.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ion_badge_6_ion_icon_1_Template,2,3,"ion-icon",32),P.EFF(2),P.nI1(3,"coreBytesToSize"),P.k0s()),2&e){const e=P.XpG(2).section,t=P.XpG();P.Y8G("color",e.downloadStatus===t.statusDownloaded?"success":"light"),P.R7$(),P.Y8G("ngIf",e.downloadStatus===t.statusDownloaded),P.R7$(),P.SpI("",P.bMT(3,3,e.totalSize)," ")}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ion_badge_7_Template(e,t){1&e&&(P.j41(0,"ion-badge",34),P.EFF(1),P.nI1(2,"translate"),P.k0s()),2&e&&(P.R7$(),P.SpI(" ",P.bMT(2,1,"core.calculating")," "))}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_p_8_Template(e,t){if(1&e&&(P.j41(0,"p"),P.nrm(1,"core-progress-bar",35),P.k0s()),2&e){const e=P.XpG(2).section;P.R7$(),P.Y8G("progress",void 0===e.total||0===e.total?-1:e.count/e.total*100)}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_div_1_core_download_refresh_1_Template(e,t){if(1&e){const e=P.RV6();P.j41(0,"core-download-refresh",42),P.bIt("action",(function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_div_1_core_download_refresh_1_Template_core_download_refresh_action_0_listener(){P.eBV(e);const t=P.XpG(4).section,n=P.XpG();return P.Njj(n.prefetchSection(t))})),P.k0s()}if(2&e){const e=P.XpG(4).section;P.Y8G("status",e.downloadStatus)("enabled",!0)("loading",e.isDownloading||e.isCalculating)("canTrustDownload",!0)("statusesTranslatable",P.lJ4(6,_c2))("statusSubject",e.name)}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_div_1_ion_badge_2_Template(e,t){if(1&e&&(P.j41(0,"ion-badge",43),P.nI1(1,"translate"),P.EFF(2),P.k0s()),2&e){const e=P.XpG(4).section;P.BMQ("aria-valuemax",e.total)("aria-valuenow",e.count)("aria-valuetext",P.i5U(1,5,"core.course.downloadsectionprogressdescription",e)),P.R7$(2),P.Lme(" ",e.count," / ",e.total," ")}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_div_1_Template(e,t){if(1&e&&(P.j41(0,"div",39),P.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_div_1_core_download_refresh_1_Template,1,7,"core-download-refresh",40)(2,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_div_1_ion_badge_2_Template,3,8,"ion-badge",41),P.k0s()),2&e){const e=P.XpG(3).section,t=P.XpG();P.R7$(),P.Y8G("ngIf",!e.isDownloading&&e.downloadStatus!==t.statusDownloaded),P.R7$(),P.Y8G("ngIf",e.isDownloading&&void 0!==e.total&&e.count<e.total)}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_ion_button_2_Template(e,t){if(1&e){const e=P.RV6();P.j41(0,"ion-button",44),P.bIt("click",(function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_ion_button_2_Template_ion_button_click_0_listener(t){P.eBV(e);const n=P.XpG(3).section,o=P.XpG();return P.Njj(o.deleteForSection(t,n))})),P.nrm(1,"ion-icon",45),P.nI1(2,"translate"),P.k0s()}if(2&e){const e=P.XpG(3).section;P.R7$(),P.BMQ("aria-label",P.i5U(2,1,"addon.storagemanager.deletedatafrom",P.eq3(4,_c0,e.name)))}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_Template(e,t){if(1&e&&(P.j41(0,"div",36),P.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_div_1_Template,3,2,"div",37)(2,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_ion_button_2_Template,3,6,"ion-button",38),P.k0s()),2&e){const e=P.XpG(2).section,t=P.XpG();P.R7$(),P.Y8G("ngIf",t.downloadEnabled),P.R7$(),P.Y8G("ngIf",!e.calculatingSize&&e.totalSize>0)}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_Conditional_10_Template(e,t){1&e&&P.nrm(0,"ion-icon",30)}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_Conditional_11_Template(e,t){1&e&&P.nrm(0,"ion-icon",46)}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_1_ng_container_0_Template(e,t){1&e&&P.eu8(0)}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_1_Template(e,t){if(1&e&&P.DNE(0,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_1_ng_container_0_Template,1,0,"ng-container",21),2&e){const e=P.XpG().$implicit;P.XpG(4);const t=P.sdS(32);P.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",P.eq3(2,_c1,e))}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_core_mod_icon_1_Template(e,t){if(1&e&&P.nrm(0,"core-mod-icon",54),2&e){const e=P.XpG(3).$implicit;P.Y8G("modicon",e.handlerData.icon)("modname",e.modname)("componentId",e.instance)("fallbackTranslation",e.modplural)("isBranded",e.branded)}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_ion_badge_5_ion_icon_1_Template(e,t){1&e&&(P.nrm(0,"ion-icon",33),P.nI1(1,"translate")),2&e&&P.BMQ("aria-label",P.bMT(1,1,"core.downloaded"))}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_ion_badge_5_Template(e,t){if(1&e&&(P.j41(0,"ion-badge",31),P.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_ion_badge_5_ion_icon_1_Template,2,3,"ion-icon",32),P.EFF(2),P.nI1(3,"coreBytesToSize"),P.k0s()),2&e){const e=P.XpG(3).$implicit,t=P.XpG(4);P.Y8G("color",e.downloadStatus===t.statusDownloaded?"success":"light"),P.R7$(),P.Y8G("ngIf",e.downloadStatus===t.statusDownloaded),P.R7$(),P.SpI("",P.bMT(3,3,e.totalSize)," ")}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_ion_badge_6_Template(e,t){1&e&&(P.j41(0,"ion-badge",34),P.EFF(1),P.nI1(2,"translate"),P.k0s()),2&e&&(P.R7$(),P.SpI(" ",P.bMT(2,1,"core.calculating")," "))}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_core_download_refresh_8_Template(e,t){if(1&e){const e=P.RV6();P.j41(0,"core-download-refresh",55),P.bIt("action",(function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_core_download_refresh_8_Template_core_download_refresh_action_0_listener(){P.eBV(e);const t=P.XpG(3).$implicit,n=P.XpG(4);return P.Njj(n.prefetchModule(t))})),P.k0s()}if(2&e){const e=P.XpG(3).$implicit;P.Y8G("status",e.downloadStatus)("enabled",!0)("canTrustDownload",!0)("loading",e.spinner||e.handlerData.spinner)("statusesTranslatable",P.lJ4(6,_c2))("statusSubject",e.name)}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_ion_button_9_Template(e,t){if(1&e){const e=P.RV6();P.j41(0,"ion-button",56),P.bIt("click",(function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_ion_button_9_Template_ion_button_click_0_listener(t){P.eBV(e);const n=P.XpG(3).$implicit,o=P.XpG(4);return P.Njj(o.deleteForModule(t,n))})),P.nrm(1,"ion-icon",45),P.nI1(2,"translate"),P.k0s()}if(2&e){const e=P.XpG(3).$implicit;P.R7$(),P.BMQ("aria-label",P.i5U(2,1,"addon.storagemanager.deletedatafrom",P.eq3(4,_c0,e.name)))}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_p_10_Template(e,t){1&e&&(P.j41(0,"p",57),P.EFF(1),P.nI1(2,"translate"),P.k0s()),2&e&&(P.R7$(),P.SpI(" ",P.bMT(2,1,"core.notdownloadable")," "))}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_Template(e,t){if(1&e&&(P.j41(0,"ion-item",48),P.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_core_mod_icon_1_Template,1,5,"core-mod-icon",49),P.j41(2,"ion-label",16)(3,"p"),P.nrm(4,"core-format-text",50),P.k0s(),P.DNE(5,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_ion_badge_5_Template,4,5,"ion-badge",27)(6,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_ion_badge_6_Template,3,3,"ion-badge",28),P.k0s(),P.j41(7,"div",36),P.DNE(8,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_core_download_refresh_8_Template,1,7,"core-download-refresh",51)(9,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_ion_button_9_Template,3,6,"ion-button",52)(10,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_p_10_Template,3,3,"p",53),P.k0s()()),2&e){const e=P.XpG(2).$implicit,t=P.XpG(3).section,n=P.XpG();P.R7$(),P.Y8G("ngIf",e.handlerData.icon),P.R7$(2),P.ZvI("item-heading ",e.handlerData.class," addon-storagemanager-module-size"),P.R7$(),P.Y8G("text",e.handlerData.title)("courseId",e.course)("contextInstanceId",e.id)("adaptImg",!1),P.R7$(),P.Y8G("ngIf",!e.calculatingSize&&e.totalSize>0),P.R7$(),P.Y8G("ngIf",e.calculatingSize||t.isDownloading&&e.downloadStatus===n.statusDownloaded),P.R7$(2),P.Y8G("ngIf",n.downloadEnabled&&(null==e.handlerData?null:e.handlerData.showDownloadButton)&&e.downloadStatus!==n.statusDownloaded),P.R7$(),P.Y8G("ngIf",!e.calculatingSize&&e.totalSize>0),P.R7$(),P.Y8G("ngIf",!n.downloadEnabled||!(null!=e.handlerData&&e.handlerData.showDownloadButton))}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_Template(e,t){if(1&e&&P.DNE(0,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_ion_item_0_Template,11,13,"ion-item",47),2&e){const e=P.XpG().$implicit,t=P.XpG(4);P.Y8G("ngIf",t.downloadEnabled||!e.calculatingSize&&e.totalSize>0)}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Template(e,t){if(1&e&&(P.qex(0),P.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_1_Template,1,4,"ng-container")(2,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Conditional_2_Template,1,1),P.bVm()),2&e){const e=t.$implicit,n=P.XpG(4);P.R7$(),P.vxM(1,n.isModule(e)?2:1)}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_Template(e,t){if(1&e&&(P.qex(0),P.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_ng_container_1_Template,3,1,"ng-container",15),P.bVm()),2&e){const e=P.XpG(2).section;P.R7$(),P.Y8G("ngForOf",e.contents)}}function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_Template(e,t){if(1&e){const e=P.RV6();P.j41(0,"ion-card",23)(1,"div",24)(2,"ion-item",25),P.bIt("click",(function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_Template_ion_item_click_2_listener(){P.eBV(e);const t=P.XpG().section,n=P.XpG();return P.Njj(n.toggleSection(t))})),P.j41(3,"ion-label")(4,"p",26),P.bIt("ariaButtonClick",(function AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_Template_p_ariaButtonClick_4_listener(){P.eBV(e);const t=P.XpG().section,n=P.XpG();return P.Njj(n.toggleSection(t))})),P.nrm(5,"core-format-text",7),P.k0s(),P.DNE(6,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ion_badge_6_Template,4,5,"ion-badge",27)(7,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ion_badge_7_Template,3,3,"ion-badge",28)(8,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_p_8_Template,2,1,"p",11),P.k0s(),P.DNE(9,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_div_9_Template,3,2,"div",29)(10,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_Conditional_10_Template,1,0,"ion-icon",30)(11,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_Conditional_11_Template,1,0),P.k0s(),P.nrm(12,"ion-ripple-effect"),P.k0s(),P.j41(13,"ion-card-content"),P.DNE(14,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_ng_container_14_Template,2,1,"ng-container",11),P.k0s()()}if(2&e){const e=P.XpG().section,t=P.XpG();P.Y8G("id","addons-course-storage-"+e.id),P.R7$(2),P.Y8G("detail",!1),P.R7$(2),P.BMQ("aria-expanded",e.expanded),P.R7$(),P.Y8G("text",e.name)("contextInstanceId",e.course)("adaptImg",!1),P.R7$(),P.Y8G("ngIf",!e.calculatingSize&&e.totalSize>0),P.R7$(),P.Y8G("ngIf",e.calculatingSize),P.R7$(),P.Y8G("ngIf",t.downloadEnabled&&e.isDownloading),P.R7$(),P.Y8G("ngIf",!e.calculatingSize&&e.totalSize>0||t.downloadEnabled),P.R7$(),P.vxM(10,e.expanded?10:11),P.R7$(4),P.Y8G("ngIf",e.expanded)}}function AddonStorageManagerCourseStoragePage_ng_template_31_Template(e,t){if(1&e&&P.DNE(0,AddonStorageManagerCourseStoragePage_ng_template_31_ion_card_0_Template,15,12,"ion-card",22),2&e){P.Y8G("ngIf",t.section.contents.length>0)}}let $=(()=>{var e;class AddonStorageManagerCourseStoragePage{constructor(e,t){this.elementRef=e,this.changeDetectorRef=t,this.title="",this.loaded=!1,this.sections=[],this.totalSize=0,this.calculatingSize=!0,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.prefetchCourseData={icon:a.CoreConstants.ICON_LOADING,statusTranslatable:"core.course.downloadcourse",status:a.DownloadStatus.DOWNLOADABLE_NOT_DOWNLOADED,loading:!0},this.statusDownloaded=a.DownloadStatus.DOWNLOADED,this.isModule=i.sectionContentIsModule,this.isDestroyed=!1,this.isGuest=!1,this.siteUpdatedObserver=C.z.on(C.z.SITE_UPDATED,(()=>{this.downloadCourseEnabled=!c.CoreCourses.isDownloadCourseDisabledInSite(),this.downloadEnabled=!g.CoreSites.getRequiredCurrentSite().isOfflineDisabled(),this.initCoursePrefetch(),this.initModulePrefetch(),this.changeDetectorRef.markForCheck()}),g.CoreSites.getCurrentSiteId())}ngOnInit(){var e=this;return(0,o.A)((function*(){var t;try{e.courseId=l.CoreNavigator.getRequiredRouteNumberParam("courseId")}catch(e){return f.CoreAlerts.showError(e),l.CoreNavigator.back(),void 0}e.title=l.CoreNavigator.getRouteParam("title")||"",e.title||e.courseId!=g.CoreSites.getCurrentSiteHomeId()||(e.title=p.HT.instant("core.sitehome.sitehome")),e.isGuest=null!==(t=l.CoreNavigator.getRouteBooleanParam("isGuest"))&&void 0!==t?t:(yield s.CoreCourseHelper.courseUsesGuestAccessInfo(e.courseId)).guestAccess;const n=l.CoreNavigator.getRouteNumberParam("sectionId");e.downloadCourseEnabled=!c.CoreCourses.isDownloadCourseDisabledInSite(),e.downloadEnabled=!g.CoreSites.getRequiredCurrentSite().isOfflineDisabled();const o=(yield i.CoreCourse.getSections(e.courseId,!1,!0)).filter((e=>!s.CoreCourseHelper.isSectionStealth(e)));let a;e.sections=(yield s.CoreCourseHelper.addHandlerDataForModules(o,e.courseId)).sections.map((t=>e.formatSection(t))),e.loaded=!0,void 0!==n&&n>0?(s.CoreCourseHelper.flattenSections(e.sections).forEach((e=>{e.id===n&&(e.expanded=!0,a=e.id)})),m.y.scrollToElement(e.elementRef.nativeElement,`#addons-course-storage-${n}`,{addYAxis:-10})):(e.sections[0].expanded=!0,a=e.sections[0].id);try{yield Promise.all([e.updateSizes(e.sections,a),e.initCoursePrefetch(),e.initModulePrefetch()])}catch(e){f.CoreAlerts.showError(e)}e.changeDetectorRef.markForCheck()}))()}formatSection(e,t=!1){return{...e,totalSize:0,calculatingSize:!0,expanded:t,contents:e.contents.map((e=>(0,i.sectionContentIsModule)(e)?{...e,totalSize:0,calculatingSize:!1}:this.formatSection(e,t)))}}initCoursePrefetch(){var e=this;return(0,o.A)((function*(){if(!e.downloadCourseEnabled||e.courseStatusObserver)return;if(e.courseStatusObserver=C.z.on(r.COURSE_STATUS_CHANGED_EVENT,(t=>{t.courseId!==e.courseId&&t.courseId!==r.CORE_COURSE_ALL_COURSES_CLEARED||e.updateCourseStatus(t.status)}),g.CoreSites.getCurrentSiteId()),yield e.determineCoursePrefetchIcon(),e.prefetchCourseData.icon!==a.CoreConstants.ICON_LOADING)return;const t=s.CoreCourseHelper.getCourseDownloadPromise(e.courseId);if(t)t.catch((t=>{e.isDestroyed||f.CoreAlerts.showError(t,{default:p.HT.instant("core.course.errordownloadingcourse")})}));else{const t=yield b.CoreCourseDownloadStatusHelper.setCoursePreviousStatus(e.courseId);e.updateCourseStatus(t)}}))()}initModulePrefetch(){var e=this;return(0,o.A)((function*(){e.downloadEnabled&&!e.sectionStatusObserver&&(e.sectionStatusObserver=C.z.on(C.z.SECTION_STATUS_CHANGED,function(){var t=(0,o.A)((function*(t){if(!e.downloadEnabled||!e.sections.length||!t.sectionId||t.courseId!=e.courseId)return;const{section:n}=s.CoreCourseHelper.findSection(e.sections,{id:t.sectionId});if(!n)return;const o=s.CoreCourseHelper.getSectionDownloadId({id:n.id});_.CoreCourseModulePrefetchDelegate.isBeingDownloaded(o)||(yield e.updateSizes([n]),n.isDownloading&&!_.CoreCourseModulePrefetchDelegate.isBeingDownloaded(o)&&e.prefetchSection(n))}));return function(e){return t.apply(this,arguments)}}(),g.CoreSites.getCurrentSiteId()),e.moduleStatusObserver=C.z.on(C.z.PACKAGE_STATUS_CHANGED,(t=>{const n=i.CoreCourse.getSectionsModules(e.sections).find((e=>{var n;return e.id===t.componentId&&e.prefetchHandler&&t.component===(null===(n=e.prefetchHandler)||void 0===n?void 0:n.component)}));if(!n)return;const o=_.CoreCourseModulePrefetchDelegate.determineModuleStatus(n,t.status);e.updateModuleStatus(n,o)}),g.CoreSites.getCurrentSiteId()))}))()}updateSizes(e,t){var n=this;return(0,o.A)((function*(){n.calculatingSize=!0,n.totalSize=0,s.CoreCourseHelper.flattenSections(e).forEach((e=>{e.totalSize=0,e.calculatingSize=!0})),n.changeDetectorRef.markForCheck();const o=t?e.findIndex((e=>e.id===t)):-1;let a;if(-1!==o)try{yield n.calculateSectionSizeAndStatus(e[o]),n.changeDetectorRef.markForCheck()}catch(e){a=e}try{yield S.g.allPromises(e.filter(((e,t)=>t!==o)).map((e=>n.calculateSectionSizeAndStatus(e))))}catch(e){a=e}if(n.sections.forEach((e=>{n.totalSize+=e.totalSize})),n.calculatingSize=!1,0!==n.totalSize||a||n.markCourseAsNotDownloaded(),n.changeDetectorRef.markForCheck(),a)throw a}))()}calculateSectionSizeAndStatus(e){var t=this;return(0,o.A)((function*(){const n=i.CoreCourse.getSectionsModules([e]);yield Promise.all(n.map(function(){var e=(0,o.A)((function*(e){yield t.calculateModuleSize(e)}));return function(t){return e.apply(this,arguments)}}())),yield t.calculateSectionsStatus([e]);const updateSectionSize=e=>{e.contents.forEach((n=>{var o;(0,i.sectionContentIsModule)(n)||updateSectionSize(n),e.totalSize+=null!==(o=n.totalSize)&&void 0!==o?o:0,t.changeDetectorRef.markForCheck()})),e.calculatingSize=!1,t.changeDetectorRef.markForCheck()};updateSectionSize(e)}))()}deleteForCourse(e){var t=this;return(0,o.A)((function*(){e.stopPropagation(),e.preventDefault();try{yield f.CoreAlerts.confirmDelete(p.HT.instant("addon.storagemanager.confirmdeletedatafrom",{name:t.title}))}catch(e){if(!h.CoreErrorHelper.isCanceledError(e))throw e;return}const n=i.CoreCourse.getSectionsModules(t.sections).filter((e=>e.totalSize&&e.totalSize>0));(yield t.deleteModules(n))&&u.CoreToasts.show({cssClass:"sr-only",message:"core.deleted",translateMessage:!0})}))()}deleteForSection(e,t){var n=this;return(0,o.A)((function*(){e.stopPropagation(),e.preventDefault();try{yield f.CoreAlerts.confirmDelete(p.HT.instant("addon.storagemanager.confirmdeletedatafrom",{name:t.name}))}catch(e){if(!h.CoreErrorHelper.isCanceledError(e))throw e;return}const o=i.CoreCourse.getSectionsModules([t]).filter((e=>e.totalSize&&e.totalSize>0));(yield n.deleteModules(o))&&u.CoreToasts.show({cssClass:"sr-only",message:"core.deleted",translateMessage:!0})}))()}deleteForModule(e,t){var n=this;return(0,o.A)((function*(){if(e.stopPropagation(),e.preventDefault(),0===t.totalSize)return;try{yield f.CoreAlerts.confirmDelete(p.HT.instant("addon.storagemanager.confirmdeletedatafrom",{name:t.name}))}catch(e){if(!h.CoreErrorHelper.isCanceledError(e))throw e;return}(yield n.deleteModules([t]))&&u.CoreToasts.show({cssClass:"sr-only",message:"core.deleted",translateMessage:!0})}))()}deleteModules(e){var t=this;return(0,o.A)((function*(){const n=yield d.CoreLoadings.show("core.deleting",!0),a=new Set,r=e.map(function(){var e=(0,o.A)((function*(e){var n;yield s.CoreCourseHelper.removeModuleStoredData(e,t.courseId),e.totalSize=0;const{section:o,parents:r}=s.CoreCourseHelper.findSection(t.sections,{id:e.section}),i=null!==(n=r[0])&&void 0!==n?n:o;i&&!a.has(i)&&a.add(i)}));return function(t){return e.apply(this,arguments)}}());try{return yield Promise.all(r),!0}catch(e){return f.CoreAlerts.showError(e,{default:p.HT.instant("core.errordeletefile")}),!1}finally{n.dismiss(),yield t.updateSizes(Array.from(a)),t.changeDetectorRef.markForCheck()}}))()}markCourseAsNotDownloaded(){b.CoreCourseDownloadStatusHelper.setCourseStatus(this.courseId,a.DownloadStatus.DOWNLOADABLE_NOT_DOWNLOADED)}prefetchSection(e){var t=this;return(0,o.A)((function*(){e.isCalculating=!0,t.changeDetectorRef.markForCheck(),u.CoreToasts.show({cssClass:"sr-only",message:"core.downloading",translateMessage:!0});try{yield s.CoreCourseHelper.confirmDownloadSizeSection(t.courseId,[e]);try{yield s.CoreCourseHelper.prefetchSections([e],t.courseId),u.CoreToasts.show({cssClass:"sr-only",message:"core.downloaded",translateMessage:!0})}catch(e){t.isDestroyed||f.CoreAlerts.showError(e,{default:p.HT.instant("core.course.errordownloadingsection")})}finally{yield t.updateSizes([e])}}catch(e){if(!t.isDestroyed&&e)return f.CoreAlerts.showError(e),t.changeDetectorRef.markForCheck(),void 0}finally{e.isCalculating=!1,t.changeDetectorRef.markForCheck()}}))()}prefetchModule(e,t=!1){var n=this;return(0,o.A)((function*(){if(e.prefetchHandler){e.spinner=!0,u.CoreToasts.show({cssClass:"sr-only",message:"core.downloading",translateMessage:!0});try{const n=yield e.prefetchHandler.getDownloadSize(e,e.course,!0);yield s.CoreCourseHelper.prefetchModule(e.prefetchHandler,e,n,e.course,t),u.CoreToasts.show({cssClass:"sr-only",message:"core.downloaded",translateMessage:!0})}catch(e){n.isDestroyed||f.CoreAlerts.showError(e,{default:p.HT.instant("core.errordownloading")})}finally{var o;e.spinner=!1;const{section:t,parents:a}=s.CoreCourseHelper.findSection(n.sections,{id:e.section}),r=null!==(o=a[0])&&void 0!==o?o:t;r&&(yield n.updateSizes([r]))}}}))()}updateModuleStatus(e,t){var n,o;t&&(e.spinner=!1,e.downloadStatus=t,null===(n=e.handlerData)||void 0===n||null===(o=n.updateStatus)||void 0===o||o.call(n,t),this.changeDetectorRef.markForCheck())}calculateModulesStatusOnSection(e){var t=this;return(0,o.A)((function*(){yield Promise.all(e.contents.map(function(){var e=(0,o.A)((function*(e){var n;if(!(0,i.sectionContentIsModule)(e))return yield t.calculateModulesStatusOnSection(e),void 0;if(null!==(n=e.handlerData)&&void 0!==n&&n.showDownloadButton){e.spinner=!0,e.prefetchHandler=_.CoreCourseModulePrefetchDelegate.getPrefetchHandlerFor(e.modname);const n=yield _.CoreCourseModulePrefetchDelegate.getModuleStatus(e,t.courseId);t.updateModuleStatus(e,n)}}));return function(t){return e.apply(this,arguments)}}()))}))()}determineCoursePrefetchIcon(){var e=this;return(0,o.A)((function*(){e.prefetchCourseData=yield s.CoreCourseHelper.getCourseStatusIconAndTitle(e.courseId)}))()}updateCourseStatus(e){const t=s.CoreCourseHelper.getCoursePrefetchStatusInfo(e);this.prefetchCourseData.status=t.status,this.prefetchCourseData.icon=t.icon,this.prefetchCourseData.statusTranslatable=t.statusTranslatable,this.prefetchCourseData.loading=t.loading,this.changeDetectorRef.markForCheck()}prefetchCourse(e){var t=this;return(0,o.A)((function*(){e.stopPropagation(),e.preventDefault(),u.CoreToasts.show({cssClass:"sr-only",message:"core.downloading",translateMessage:!0});const n=yield s.CoreCourseHelper.getCourseInfo(t.courseId);if(!n)return f.CoreAlerts.showError(p.HT.instant("core.course.errordownloadingcourse")),void 0;try{t.changeDetectorRef.markForCheck(),yield s.CoreCourseHelper.confirmAndPrefetchCourse(t.prefetchCourseData,n,{sections:t.sections,isGuest:t.isGuest}),u.CoreToasts.show({cssClass:"sr-only",message:"core.downloaded",translateMessage:!0}),yield t.updateSizes(t.sections)}catch(e){if(t.isDestroyed)return;f.CoreAlerts.showError(e,{default:p.HT.instant("core.course.errordownloadingcourse")})}finally{t.changeDetectorRef.markForCheck()}}))()}calculateModuleSize(e){var t=this;return(0,o.A)((function*(){e.calculatingSize||(e.calculatingSize=!0,t.changeDetectorRef.markForCheck(),e.totalSize=yield _.CoreCourseModulePrefetchDelegate.getModuleStoredSize(e,t.courseId),e.calculatingSize=!1,t.changeDetectorRef.markForCheck())}))()}toggleSection(e){e.expanded=!e.expanded}ngOnDestroy(){var e,t,n,o;null===(e=this.courseStatusObserver)||void 0===e||e.off(),null===(t=this.sectionStatusObserver)||void 0===t||t.off(),null===(n=this.moduleStatusObserver)||void 0===n||n.off(),null===(o=this.siteUpdatedObserver)||void 0===o||o.off(),i.CoreCourse.getSectionsModules(this.sections).forEach((e=>{var t,n;null===(t=e.handlerData)||void 0===t||null===(n=t.onDestroy)||void 0===n||n.call(t)})),this.isDestroyed=!0}calculateSectionsStatus(e){var t=this;return(0,o.A)((function*(){e&&(yield Promise.all(e.map(function(){var e=(0,o.A)((function*(e){if(e.id!==r.CORE_COURSE_ALL_SECTIONS_ID)try{e.isCalculating=!0,yield t.calculateModulesStatusOnSection(e),yield s.CoreCourseHelper.calculateSectionStatus(e,t.courseId,!1,!1)}finally{e.isCalculating=!1}}));return function(t){return e.apply(this,arguments)}}())))}))()}}return(e=AddonStorageManagerCourseStoragePage).ɵfac=function AddonStorageManagerCourseStoragePage_Factory(t){return new(t||e)(P.rXU(P.aKT),P.rXU(P.gRc))},e.ɵcmp=P.VBU({type:e,selectors:[["page-addon-storagemanager-course-storage"]],standalone:!0,features:[P.aNF],decls:33,vars:28,consts:[["sectionCard",""],["slot","start"],[3,"text"],[1,"limited-width"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[1,"wholecourse"],["contextLevel","course",3,"text","contextInstanceId","adaptImg"],[1,"size","ion-text-wrap","ion-no-padding"],[1,"item-heading","ion-text-wrap"],["color","light","slot","end"],[4,"ngIf"],["expand","block","fill","outline","class","ion-no-margin",3,"disabled","click",4,"ngIf"],["expand","block","color","danger",1,"ion-no-margin","ion-margin-top",3,"click","disabled"],["name","fas-trash","slot","start"],[4,"ngFor","ngForOf"],[1,"ion-text-wrap"],["expand","block","fill","outline",1,"ion-no-margin",3,"click","disabled"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],["slot","start",4,"ngIf"],["slot","start","aria-hidden","true",3,"name"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","section",3,"id",4,"ngIf"],[1,"section",3,"id"],[1,"ion-activatable","ripple-parent"],["tappable","",1,"card-header",3,"click","detail"],[1,"item-heading","ion-text-wrap",3,"ariaButtonClick"],[3,"color",4,"ngIf"],["color","light",4,"ngIf"],["slot","end","class","storage-buttons",4,"ngIf"],["slot","start","size","small","name","fas-chevron-down","aria-hidden","true"],[3,"color"],["name","fam-cloud-done",4,"ngIf"],["name","fam-cloud-done"],["color","light"],[3,"progress"],["slot","end",1,"storage-buttons"],["class","core-button-spinner",4,"ngIf"],["color","danger","fill","clear",3,"click",4,"ngIf"],[1,"core-button-spinner"],[3,"status","enabled","loading","canTrustDownload","statusesTranslatable","statusSubject","action",4,"ngIf"],["class","core-course-download-section-progress","role","progressbar",4,"ngIf"],[3,"action","status","enabled","loading","canTrustDownload","statusesTranslatable","statusSubject"],["role","progressbar",1,"core-course-download-section-progress"],["color","danger","fill","clear",3,"click"],["name","fas-trash","slot","icon-only"],["slot","start","size","small","name","fas-chevron-right","aria-hidden","true"],["class","core-course-storage-activity",4,"ngIf"],[1,"core-course-storage-activity"],["slot","start",3,"modicon","modname","componentId","fallbackTranslation","isBranded",4,"ngIf"],["contextLevel","module",3,"text","courseId","contextInstanceId","adaptImg"],[3,"status","enabled","canTrustDownload","loading","statusesTranslatable","statusSubject","action",4,"ngIf"],["fill","clear","color","danger",3,"click",4,"ngIf"],["class","sr-only",4,"ngIf"],["slot","start",3,"modicon","modname","componentId","fallbackTranslation","isBranded"],[3,"action","status","enabled","canTrustDownload","loading","statusesTranslatable","statusSubject"],["fill","clear","color","danger",3,"click"],[1,"sr-only"]],template:function AddonStorageManagerCourseStoragePage_Template(e,t){if(1&e){const e=P.RV6();P.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),P.nrm(3,"ion-back-button",2),P.nI1(4,"translate"),P.k0s(),P.j41(5,"ion-title")(6,"h1"),P.EFF(7),P.nI1(8,"translate"),P.k0s()()()(),P.j41(9,"ion-content",3)(10,"core-loading",4),P.DNE(11,AddonStorageManagerCourseStoragePage_ion_item_11_Template,5,3,"ion-item",5),P.j41(12,"ion-card",6)(13,"ion-card-header")(14,"ion-card-title"),P.nrm(15,"core-format-text",7),P.k0s(),P.j41(16,"ion-item",8)(17,"ion-label")(18,"p",9),P.EFF(19),P.nI1(20,"translate"),P.k0s()(),P.j41(21,"ion-badge",10),P.DNE(22,AddonStorageManagerCourseStoragePage_ng_container_22_Template,3,3,"ng-container",11)(23,AddonStorageManagerCourseStoragePage_ng_container_23_Template,3,3,"ng-container",11),P.k0s()(),P.DNE(24,AddonStorageManagerCourseStoragePage_ion_button_24_Template,5,6,"ion-button",12),P.j41(25,"ion-button",13),P.bIt("click",(function AddonStorageManagerCourseStoragePage_Template_ion_button_click_25_listener(n){return P.eBV(e),P.Njj(t.deleteForCourse(n))})),P.nrm(26,"ion-icon",14),P.nI1(27,"translate"),P.EFF(28),P.nI1(29,"translate"),P.k0s()()(),P.DNE(30,AddonStorageManagerCourseStoragePage_ng_container_30_Template,2,4,"ng-container",15),P.k0s()(),P.DNE(31,AddonStorageManagerCourseStoragePage_ng_template_31_Template,1,1,"ng-template",null,0,P.C5r)}2&e&&(P.R7$(3),P.Y8G("text",P.bMT(4,15,"core.back")),P.R7$(4),P.JRh(P.bMT(8,17,"addon.storagemanager.coursedownloads")),P.R7$(3),P.Y8G("hideUntil",t.loaded),P.R7$(),P.Y8G("ngIf",t.downloadCourseEnabled),P.R7$(4),P.Y8G("text",t.title)("contextInstanceId",t.courseId)("adaptImg",!1),P.R7$(4),P.JRh(P.bMT(20,19,"addon.storagemanager.totaldownloads")),P.R7$(3),P.Y8G("ngIf",!t.calculatingSize),P.R7$(),P.Y8G("ngIf",t.calculatingSize),P.R7$(),P.Y8G("ngIf",t.downloadCourseEnabled),P.R7$(),P.Y8G("disabled",t.calculatingSize||t.totalSize<=0),P.R7$(),P.BMQ("aria-label",P.i5U(27,21,"addon.storagemanager.deletedatafrom",P.eq3(26,_c0,t.title))),P.R7$(2),P.SpI(" ",P.bMT(29,24,"addon.storagemanager.deleteall")," "),P.R7$(2),P.Y8G("ngForOf",t.sections))},dependencies:[M.n,T.Sq,T.bT,T.T3,I.In,I.Jm,I.QW,I.b_,I.I9,I.ME,I.tN,I.W9,I.eU,I.iq,I.uz,I.he,I.S7,I.w2,I.BC,I.ai,I.el,D.Y,A.R,w.I,v.z,y.t,k.B,R.a,G.i,E.T,O.D9,z.b],styles:['[_nghost-%COMP%]{--course-storage-max-activity-height: 120px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-item.size[_ngcontent-%COMP%]{--inner-padding-end: 0px}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-item.card-header[_ngcontent-%COMP%]{padding:0;--border-width: 0px}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-item.card-header[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{font:var(--mdl-typography-heading4-font);min-height:auto}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-item.card-header[_ngcontent-%COMP%]   ion-icon[slot=start][_ngcontent-%COMP%]{margin-inline-end:var(--mdl-spacing-2);background-color:var(--gray-100);border-radius:50%;padding:var(--mdl-spacing-1)}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:0}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]{position:relative;max-height:var(--course-storage-max-activity-height);overflow:hidden}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]     *{pointer-events:none!important}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]:before{content:"";height:var(--course-storage-max-activity-height);position:absolute;left:0;right:0;top:0;background:linear-gradient(to bottom,rgba(var(--background-gradient-rgb),0) calc(100% - 30px),rgba(var(--background-gradient-rgb),1) calc(100% - 20px));z-index:6;pointer-events:none}[_nghost-%COMP%]   .ripple-parent[_ngcontent-%COMP%]{position:relative}[_nghost-%COMP%]   .ripple-parent[_ngcontent-%COMP%]   ion-ripple-effect[_ngcontent-%COMP%]{z-index:1}ion-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-end:8px}ion-item[_ngcontent-%COMP%]   core-mod-icon[_ngcontent-%COMP%]{--module-icon-size: 24px;--module-legacy-icon-size: 16px;--margin-vertical: 8px;--margin-end: 8px}.storage-buttons[_ngcontent-%COMP%]{display:flex;align-items:center}'],changeDetection:0}),AddonStorageManagerCourseStoragePage})()}}]);