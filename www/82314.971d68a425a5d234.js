"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[82314],{82314:(e,n,t)=>{t.r(n),t.d(n,{default:()=>F});var o=t(10467),s=t(2910),a=t(49882),i=t(52749),r=t(20728),d=t(47050),c=t(98870),g=t(71758),l=t(79555),_=t(81690),u=t(15324),m=t(93417),p=t(18022),v=t(29492),f=t(40152),C=t(25572),h=t(86654),M=t(20871),P=t(54438),G=t(21182),O=t(60177),b=t(69502),I=t(66198),T=t(64422),A=t(16658),y=t(10892),x=t(86198),R=t(58197),k=t(88246),$=t(43570),N=t(73955),j=t(2423);const E=["accordionGroup"],_c1=e=>({$a:e}),_c2=e=>({conversations:e});function AddonMessagesGroupConversationsPage_ion_badge_31_Template(e,n){if(1&e&&(P.j41(0,"ion-badge",4),P.nI1(1,"translate"),P.EFF(2),P.k0s()),2&e){const e=P.XpG();P.BMQ("aria-label",P.i5U(1,2,"addon.messages.pendingcontactrequests",P.eq3(5,_c1,e.contactRequestsCount))),P.R7$(2),P.SpI(" ",e.contactRequestsCount," ")}}function AddonMessagesGroupConversationsPage_ion_accordion_34_ion_badge_6_Template(e,n){if(1&e&&(P.j41(0,"ion-badge",4),P.nI1(1,"translate"),P.EFF(2),P.k0s()),2&e){const e=P.XpG().$implicit;P.BMQ("aria-label",P.i5U(1,2,"addon.messages.unreadconversations",P.eq3(5,_c1,e.unread))),P.R7$(2),P.SpI(" ",e.unread," ")}}function AddonMessagesGroupConversationsPage_ion_accordion_34_ng_container_8_ng_container_1_Template(e,n){1&e&&P.eu8(0)}function AddonMessagesGroupConversationsPage_ion_accordion_34_ng_container_8_ion_item_3_Template(e,n){if(1&e&&(P.j41(0,"ion-item",26)(1,"ion-label")(2,"p"),P.EFF(3),P.nI1(4,"translate"),P.k0s()()()),2&e){const e=P.XpG(2).$implicit;P.R7$(3),P.JRh(P.bMT(4,1,e.emptyString))}}function AddonMessagesGroupConversationsPage_ion_accordion_34_ng_container_8_Template(e,n){if(1&e){const e=P.RV6();P.qex(0),P.DNE(1,AddonMessagesGroupConversationsPage_ion_accordion_34_ng_container_8_ng_container_1_Template,1,0,"ng-container",23),P.j41(2,"core-infinite-loading",24),P.bIt("action",(function AddonMessagesGroupConversationsPage_ion_accordion_34_ng_container_8_Template_core_infinite_loading_action_2_listener(n){P.eBV(e);const t=P.XpG().$implicit,o=P.XpG();return P.Njj(o.loadMoreConversations(t,n))})),P.k0s(),P.DNE(3,AddonMessagesGroupConversationsPage_ion_accordion_34_ng_container_8_ion_item_3_Template,5,3,"ion-item",25),P.bVm()}if(2&e){const e=P.XpG().$implicit;P.XpG();const n=P.sdS(36);P.R7$(),P.Y8G("ngTemplateOutlet",n)("ngTemplateOutletContext",P.eq3(5,_c2,e.conversations)),P.R7$(),P.Y8G("enabled",e.canLoadMore)("error",e.loadMoreError),P.R7$(),P.Y8G("ngIf",e.conversations&&0===e.conversations.length)}}function AddonMessagesGroupConversationsPage_ion_accordion_34_ion_item_9_Template(e,n){1&e&&(P.j41(0,"ion-item",27)(1,"ion-label"),P.nrm(2,"ion-spinner"),P.nI1(3,"translate"),P.k0s()()),2&e&&(P.R7$(2),P.BMQ("aria-label",P.bMT(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ion_accordion_34_Template(e,n){if(1&e&&(P.j41(0,"ion-accordion",18)(1,"ion-item",19)(2,"ion-label")(3,"h2"),P.EFF(4),P.nI1(5,"translate"),P.k0s()(),P.DNE(6,AddonMessagesGroupConversationsPage_ion_accordion_34_ion_badge_6_Template,3,7,"ion-badge",15),P.k0s(),P.j41(7,"div",20),P.DNE(8,AddonMessagesGroupConversationsPage_ion_accordion_34_ng_container_8_Template,4,7,"ng-container",21)(9,AddonMessagesGroupConversationsPage_ion_accordion_34_ion_item_9_Template,4,3,"ion-item",22),P.k0s()()),2&e){const e=n.$implicit;P.Y8G("value",e.optionName),P.R7$(4),P.Lme("",P.bMT(5,6,e.titleString)," (",e.count,")"),P.R7$(2),P.Y8G("ngIf",e.unread),P.R7$(2),P.Y8G("ngIf",!e.loading),P.R7$(),P.Y8G("ngIf",e.loading)}}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_avatar_1_Template(e,n){if(1&e&&(P.j41(0,"ion-avatar",2),P.nrm(1,"img",37),P.k0s()),2&e){const e=P.XpG().$implicit;P.R7$(),P.Y8G("url",e.imageurl)("alt",e.name)}}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_core_user_avatar_2_Template(e,n){if(1&e&&P.nrm(0,"core-user-avatar",38),2&e){const e=P.XpG().$implicit;P.Y8G("user",e.otherUser)("linkProfile",!1)("checkOnline",e.showonlinestatus)}}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_icon_7_Template(e,n){1&e&&(P.nrm(0,"ion-icon",39),P.nI1(1,"translate")),2&e&&P.BMQ("aria-label",P.bMT(1,1,"addon.messages.contactblocked"))}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_icon_8_Template(e,n){1&e&&(P.nrm(0,"ion-icon",40),P.nI1(1,"translate")),2&e&&P.Y8G("title",P.bMT(1,1,"addon.messages.mutedconversation"))}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_note_9_span_1_Template(e,n){if(1&e&&(P.j41(0,"span",44),P.EFF(1),P.nI1(2,"coreDateDayOrTime"),P.k0s()),2&e){const e=P.XpG(2).$implicit;P.R7$(),P.SpI(" ",P.bMT(2,1,e.lastmessagedate)," ")}}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_note_9_ion_badge_2_Template(e,n){if(1&e&&(P.j41(0,"ion-badge",45),P.EFF(1),P.k0s()),2&e){const e=P.XpG(2).$implicit;P.R7$(),P.JRh(e.unreadcount)}}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_note_9_span_3_Template(e,n){if(1&e&&(P.j41(0,"span",46),P.EFF(1),P.nI1(2,"translate"),P.k0s()),2&e){const e=P.XpG(2).$implicit;P.R7$(),P.SpI(" ",P.i5U(2,1,"addon.messages.unreadmessages",P.eq3(4,_c1,e.unreadcount))," ")}}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_note_9_Template(e,n){if(1&e&&(P.j41(0,"ion-note"),P.DNE(1,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_note_9_span_1_Template,3,3,"span",41)(2,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_note_9_ion_badge_2_Template,2,1,"ion-badge",42)(3,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_note_9_span_3_Template,3,6,"span",43),P.k0s()),2&e){const e=P.XpG().$implicit;P.R7$(),P.Y8G("ngIf",e.lastmessagedate>0),P.R7$(),P.Y8G("ngIf",e.unreadcount>0),P.R7$(),P.Y8G("ngIf",e.unreadcount>0)}}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_p_10_Template(e,n){if(1&e&&(P.j41(0,"p"),P.nrm(1,"core-format-text",33),P.k0s()),2&e){const e=P.XpG().$implicit;P.R7$(),P.Y8G("text",e.subname)("contextInstanceId",0)}}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_p_11_span_1_Template(e,n){1&e&&(P.j41(0,"span",50),P.EFF(1),P.nI1(2,"translate"),P.k0s()),2&e&&(P.R7$(),P.SpI(" ",P.bMT(2,1,"addon.messages.you")," "))}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_p_11_span_2_Template(e,n){if(1&e&&(P.j41(0,"span",50),P.EFF(1),P.k0s()),2&e){const e=P.XpG(2).$implicit;P.R7$(),P.JRh(e.members[0].fullname+":")}}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_p_11_Template(e,n){if(1&e&&(P.j41(0,"p",47),P.DNE(1,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_p_11_span_1_Template,3,3,"span",48)(2,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_p_11_span_2_Template,2,1,"span",48),P.nrm(3,"core-format-text",49),P.k0s()),2&e){const e=P.XpG().$implicit,n=P.XpG(2);P.R7$(),P.Y8G("ngIf",e.sentfromcurrentuser),P.R7$(),P.Y8G("ngIf",!e.sentfromcurrentuser&&e.type===n.typeGroup&&e.members[0]),P.R7$(),P.Y8G("text",e.lastmessage)("contextInstanceId",0)}}function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-item",29),P.bIt("click",(function AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_Template_ion_item_click_0_listener(){const n=P.eBV(e).$implicit,t=P.XpG(2);return P.Njj(t.gotoConversation(n.id,n.userid))})),P.DNE(1,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_avatar_1_Template,2,2,"ion-avatar",30)(2,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_core_user_avatar_2_Template,1,3,"core-user-avatar",31),P.j41(3,"ion-label")(4,"div",32)(5,"p",14),P.nrm(6,"core-format-text",33),P.DNE(7,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_icon_7_Template,2,3,"ion-icon",34)(8,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_icon_8_Template,2,3,"ion-icon",35),P.k0s(),P.DNE(9,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_ion_note_9_Template,4,3,"ion-note",21),P.k0s(),P.DNE(10,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_p_10_Template,2,2,"p",21)(11,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_p_11_Template,4,4,"p",36),P.k0s()()}if(2&e){const e=n.$implicit,t=P.XpG(2);P.Mz_("id","addon-message-conversation-",e.id?e.id:"user-"+e.userid,""),P.Y8G("detail",!1),P.BMQ("aria-current",e.id&&e.id===t.selectedConversationId||e.userid&&e.userid===t.selectedUserId?"page":"false")("aria-label",e.name),P.R7$(),P.Y8G("ngIf",e.type===t.typeGroup),P.R7$(),P.Y8G("ngIf",e.type!==t.typeGroup),P.R7$(4),P.Y8G("text",e.name)("contextInstanceId",0),P.R7$(),P.Y8G("ngIf",e.isblocked),P.R7$(),P.Y8G("ngIf",e.ismuted),P.R7$(),P.Y8G("ngIf",e.lastmessagedate>0||e.unreadcount),P.R7$(),P.Y8G("ngIf",e.subname),P.R7$(),P.Y8G("ngIf",void 0!==e.lastmessage)}}function AddonMessagesGroupConversationsPage_ng_template_35_Template(e,n){if(1&e&&P.DNE(0,AddonMessagesGroupConversationsPage_ng_template_35_ion_item_0_Template,12,14,"ion-item",28),2&e){P.Y8G("ngForOf",n.conversations)}}let F=(()=>{var e;class AddonMessagesGroupConversationsPage{constructor(e){this.route=e,this.loaded=!1,this.contactRequestsCount=0,this.groupConversations=[{optionName:"favourites",titleString:"core.favourites",emptyString:"addon.messages.nofavourites",type:void 0,favourites:!0,count:0,unread:0,conversations:[]},{optionName:"group",titleString:"addon.messages.groupconversations",emptyString:"addon.messages.nogroupconversations",type:2,favourites:!1,count:0,unread:0,conversations:[]},{optionName:"individual",titleString:"addon.messages.individualconversations",emptyString:"addon.messages.noindividualconversations",type:1,favourites:!1,count:0,unread:0,conversations:[]}],this.typeGroup=2,this.firstExpand=!1,this.loadingMessage=l.HT.instant("core.loading"),this.siteId=i.CoreSites.getCurrentSiteId(),this.currentUserId=i.CoreSites.getCurrentSiteUserId(),this.newMessagesObserver=a.z.on(f.cj,(e=>{const n=this.getExpandedOption(),t=this.getConversationOptionName(e);if((null==n?void 0:n.optionName)!==t)return;const o=this.findConversation(e.conversationId,e.userId,n);if(void 0===o)return this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0})),void 0;if(void 0===e.message)return o.lastmessage=void 0,o.lastmessagedate=void 0,o.sentfromcurrentuser=void 0,void 0;if(o.lastmessage!==e.message||o.lastmessagedate!==e.timecreated/1e3){const n=e.timecreated/1e3>(o.lastmessagedate||0);o.lastmessage=e.message,o.lastmessagedate=e.timecreated/1e3,e.userFrom&&(o.sentfromcurrentuser=e.userFrom.id===this.currentUserId,2===o.type&&(o.members[0]=e.userFrom));const t=this.getConversationOptionName(o),a=this.getConversationGroupByName(t);var s;if(a.conversations=r.AddonMessages.sortConversations(a.conversations),n)null===(s=this.content)||void 0===s||s.scrollToTop()}}),this.siteId),this.readChangedObserver=a.z.on(f.j_,(e=>{if(e.conversationId){const n=this.findConversation(e.conversationId);void 0!==n&&(n.unreadcount=0,r.AddonMessages.invalidateConversations(this.siteId),r.AddonMessages.refreshUnreadConversationCounts(this.siteId))}}),this.siteId),this.openConversationObserver=a.z.on(f.mO,(e=>{(e.conversationId||e.userId)&&this.gotoConversation(e.conversationId,e.userId)}),this.siteId),this.appResumeSubscription=p.CorePlatform.resume.subscribe((()=>{this.loaded&&(this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0})))})),this.updateConversationListObserver=a.z.on(f.I2,(e=>{if("mute"!==(null==e?void 0:e.action))this.refreshData();else{const n=this.getExpandedOption();if(null!=n&&n.conversations){const t=this.findConversation(e.conversationId,void 0,n);t&&(t.ismuted=!!e.value)}}}),this.siteId),this.pushObserver=g.CorePushNotificationsDelegate.on("receive").subscribe((e=>{_.j.isFalseOrZero(e.notif)&&e.site===this.siteId&&this.refreshData(void 0,!1)})),this.cronObserver=a.z.on(f.SU,(e=>{this.setCounts(e,"unread")}),this.siteId),this.contactRequestsCountObserver=a.z.on(f.l3,(e=>{this.contactRequestsCount=e.count}),this.siteId),this.memberInfoObserver=a.z.on(f.Ie,(e=>{if(!e.userBlocked&&!e.userUnblocked)return;const n=this.getExpandedOption();if("group"===(null==n?void 0:n.optionName)||null==n||!n.conversations.length)return;const t=this.findConversation(void 0,e.userId,n);t&&(t.isblocked=e.userBlocked)}),this.siteId)}ngOnInit(){var e=this;return(0,o.A)((function*(){if(e.route.queryParams.subscribe(function(){var n=(0,o.A)((function*(n){const t=u.CoreNavigator.getRouteNumberParam("conversationId",{params:n}),o=u.CoreNavigator.getRouteNumberParam("userId",{params:n});(t||o)&&(e.selectedConversationId=t,e.selectedUserId=o)}));return function(e){return n.apply(this,arguments)}}()),yield e.fetchData(),!e.selectedConversationId&&!e.selectedUserId&&m.CoreScreen.isTablet){const n=e.getExpandedOption(),t=null==n?void 0:n.conversations[0];t&&(yield e.gotoConversation(t.id))}i.CoreSites.loginNavigationFinished()}))()}fetchData(e=!0){var n=this;return(0,o.A)((function*(){const t=[];t.push(n.fetchConversationCounts()),t.push(r.AddonMessages.getContactRequestsCount(n.siteId)),e&&t.push(r.AddonMessages.refreshUnreadConversationCounts(n.siteId));try{if(yield Promise.all(t),!n.firstExpand&&(n.selectedConversationId||n.selectedUserId)){const e=n.groupConversations.map((e=>n.fetchDataForOption(e,!1)));yield Promise.all(e);const t=n.findConversation(n.selectedConversationId,n.selectedUserId);if(t){const e=n.getConversationOptionName(t),o=n.getConversationGroupByName(e);return yield n.expandOption(o),n.loaded=!0,void 0}}yield n.fetchDataForExpandedOption()}catch(e){C.CoreAlerts.showError(e,{default:l.HT.instant("addon.messages.errorwhileretrievingdiscussions")})}n.loaded=!0}))()}fetchDataForExpandedOption(){var e=this;return(0,o.A)((function*(){if(!e.firstExpand){let n=e.groupConversations.find((e=>e.unread));n||(n=e.groupConversations.find((e=>e.count>0))),n||(n=e.getConversationGroupByName("individual")),e.accordionGroup.value=n.optionName,e.firstExpand=!0}const n=e.getExpandedOption();n&&(yield e.fetchDataForOption(n,!1))}))()}fetchDataForOption(e,n=!1,t=!1){var s=this;return(0,o.A)((function*(){e.loadMoreError=!1;const a=n?e.conversations.length:0,i=[];let c={conversations:[],canLoadMore:!1},g=[];i.push(r.AddonMessages.invalidateConversations(s.siteId).then((0,o.A)((function*(){c=yield r.AddonMessages.getConversations(e.type,e.favourites,a,s.siteId)})))),n||i.push(d.AddonMessagesOffline.getAllMessages().then((e=>{g=e}))),t&&(i.push(s.fetchConversationCounts()),i.push(r.AddonMessages.refreshUnreadConversationCounts(s.siteId))),yield Promise.all(i),n?(e.conversations=e.conversations.concat(c.conversations),e.canLoadMore=c.canLoadMore):(e.conversations=c.conversations,e.canLoadMore=c.canLoadMore,g&&g.length&&(yield s.loadOfflineMessages(e,g),e.conversations=r.AddonMessages.sortConversations(e.conversations)))}))()}fetchConversationCounts(){var e=this;return(0,o.A)((function*(){yield r.AddonMessages.invalidateConversationCounts(e.siteId);const n=yield r.AddonMessages.getConversationCounts(e.siteId);e.setCounts(n)}))()}setCounts(e,n="count"){this.getConversationGroupByName("favourites")[n]=e.favourites,this.getConversationGroupByName("individual")[n]=e.individual+e.self,this.getConversationGroupByName("group")[n]=e.group}getConversationGroupByName(e){const n=this.groupConversations.find((n=>n.optionName===e));return null!=n?n:this.groupConversations[0]}findConversation(e,n,t){if(e){const n=t?t.conversations:this.groupConversations.flatMap((e=>e.conversations));return n.find((n=>n.id===e))}let o=null==t?void 0:t.conversations;return o||(o=this.getConversationGroupByName("favourites").conversations.concat(this.getConversationGroupByName("individual").conversations)),o.find((e=>e.userid===n))}getExpandedOption(){if(this.accordionGroup.value)return this.getConversationGroupByName(this.accordionGroup.value)}gotoContacts(){u.CoreNavigator.navigateToSitePath("contacts")}gotoConversation(e,n,t){var s=this;return(0,o.A)((function*(){s.selectedConversationId=e,s.selectedUserId=n;const o={};t&&(o.message=t);const a=u.CoreNavigator.getRelativePathToParent("/messages/group-conversations")+"discussion/"+(e||`user/${n}`);yield u.CoreNavigator.navigate(a,{params:o,reset:m.CoreScreen.isTablet&&!!s.splitView&&!s.splitView.isNested})}))()}gotoSettings(){u.CoreNavigator.navigateToSitePath("message-settings")}loadMoreConversations(e,n){var t=this;return(0,o.A)((function*(){try{yield t.fetchDataForOption(e,!0)}catch(n){C.CoreAlerts.showError(n,{default:l.HT.instant("addon.messages.errorwhileretrievingdiscussions")}),e.loadMoreError=!0}null==n||n()}))()}loadOfflineMessages(e,n){var t=this;return(0,o.A)((function*(){const o=[];n.forEach((n=>{if("conversationid"in n){let o=t.findConversation(n.conversationid,void 0,e);var s,a,i,r,d,g,l,_,u,m;if(o)(null==o.lastmessage||!o.lastmessagepending||(o.lastmessagedate||0)<=n.timecreated/1e3)&&t.addLastOfflineMessage(o,n);else o={id:n.conversationid,type:(null===(s=n.conversation)||void 0===s?void 0:s.type)||1,membercount:(null===(a=n.conversation)||void 0===a?void 0:a.membercount)||0,ismuted:(null===(i=n.conversation)||void 0===i?void 0:i.ismuted)||!1,isfavourite:(null===(r=n.conversation)||void 0===r?void 0:r.isfavourite)||!1,isread:(null===(d=n.conversation)||void 0===d?void 0:d.isread)||!1,members:(null===(g=n.conversation)||void 0===g?void 0:g.members)||[],messages:(null===(l=n.conversation)||void 0===l?void 0:l.messages)||[],candeletemessagesforallusers:(null===(_=n.conversation)||void 0===_?void 0:_.candeletemessagesforallusers)||!1,userid:0,name:null===(u=n.conversation)||void 0===u?void 0:u.name,imageurl:(null===(m=n.conversation)||void 0===m?void 0:m.imageurl)||""},t.getConversationOptionName(o)===e.optionName&&(t.addLastOfflineMessage(o,n),t.addOfflineConversation(o,e))}else if(1===e.type){const s=t.findConversation(void 0,n.touserid,e);n.text=n.smallmessage,s?(s.lastmessagedate||0)<=n.timecreated/1e3&&t.addLastOfflineMessage(s,n):o.push(c.CoreUser.getProfile(n.touserid,void 0,!0).catch((()=>{})).then((o=>{const s={id:0,type:1,membercount:0,ismuted:!1,isfavourite:!1,isread:!1,members:[],messages:[],candeletemessagesforallusers:!1,userid:n.touserid,name:o?o.fullname:String(n.touserid),imageurl:o?o.profileimageurl:""};t.addLastOfflineMessage(s,n),t.addOfflineConversation(s,e)})))}})),yield Promise.all(o)}))()}addOfflineConversation(e,n){n.conversations.unshift(e)}addLastOfflineMessage(e,n){e.lastmessage=n.text,e.lastmessagedate=n.timecreated/1e3,e.lastmessagepending=!0,e.sentfromcurrentuser=!0}getConversationOptionName(e){return e.isfavourite?"favourites":2===e.type?"group":"individual"}refreshData(e,n=!0){var t=this;return(0,o.A)((function*(){try{yield r.AddonMessages.invalidateContactRequestsCountCache(t.siteId)}finally{try{yield t.fetchData(n)}finally{null==e||e.complete()}}}))()}accordionGroupChange(e){const n=e.value;if(!n)return;const t=this.getConversationGroupByName(n);this.expandOption(t,!0).catch((e=>{C.CoreAlerts.showError(e,{default:l.HT.instant("addon.messages.errorwhileretrievingdiscussions")})}))}expandOption(e,n=!1){var t=this;return(0,o.A)((function*(){e.loading=!0,t.accordionGroup.value=e.optionName;try{yield t.fetchDataForOption(e,!1,n)}catch(e){throw t.accordionGroup.value=void 0,e}finally{e.loading=!1}}))()}gotoSearch(){u.CoreNavigator.navigateToSitePath("search")}ngOnDestroy(){var e,n,t,o,s,a,i,r,d;null===(e=this.newMessagesObserver)||void 0===e||e.off(),null===(n=this.appResumeSubscription)||void 0===n||n.unsubscribe(),null===(t=this.pushObserver)||void 0===t||t.unsubscribe(),null===(o=this.readChangedObserver)||void 0===o||o.off(),null===(s=this.cronObserver)||void 0===s||s.off(),null===(a=this.openConversationObserver)||void 0===a||a.off(),null===(i=this.updateConversationListObserver)||void 0===i||i.off(),null===(r=this.contactRequestsCountObserver)||void 0===r||r.off(),null===(d=this.memberInfoObserver)||void 0===d||d.off()}}return(e=AddonMessagesGroupConversationsPage).ɵfac=function AddonMessagesGroupConversationsPage_Factory(n){return new(n||e)(P.rXU(G.nX))},e.ɵcmp=P.VBU({type:e,selectors:[["page-addon-messages-group-conversations"]],viewQuery:function AddonMessagesGroupConversationsPage_Query(e,n){if(1&e&&(P.GBs(v.M,5),P.GBs(s.W9,5),P.GBs(E,7)),2&e){let e;P.mGM(e=P.lsd())&&(n.splitView=e.first),P.mGM(e=P.lsd())&&(n.content=e.first),P.mGM(e=P.lsd())&&(n.accordionGroup=e.first)}},standalone:!0,features:[P.aNF],decls:37,vars:24,consts:[["accordionGroup",""],["conversationsTemplate",""],["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["name","fas-magnifying-glass","slot","icon-only","aria-hidden","true"],[3,"click","ariaLabel"],["name","fas-gear","slot","icon-only","aria-hidden","true"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["placeholderType","listwithavatar",3,"hideUntil","message"],["button","",1,"ion-text-wrap",3,"click","detail"],["name","fas-address-book","slot","start","aria-hidden","true"],[1,"item-heading"],["slot","end",4,"ngIf"],[3,"ionChange"],["toggleIconSlot","start",3,"value",4,"ngFor","ngForOf"],["toggleIconSlot","start",3,"value"],["slot","header",1,"ion-text-wrap","divider"],["slot","content"],[4,"ngIf"],["class","ion-text-center",4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"action","enabled","error"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],[1,"ion-text-center"],["class","ion-text-wrap addon-message-discussion","button","",3,"detail","id","click",4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap","addon-message-discussion",3,"click","detail","id"],["slot","start",4,"ngIf"],["core-user-avatar","","slot","start",3,"user","linkProfile","checkOnline",4,"ngIf"],[1,"flex-row","ion-justify-content-between"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-user-slash",4,"ngIf"],["name","fas-volume-xmark",3,"title",4,"ngIf"],["class","addon-message-last-message",4,"ngIf"],["core-external-content","","onError","this.src='assets/img/group-avatar.svg'",3,"url","alt"],["core-user-avatar","","slot","start",3,"user","linkProfile","checkOnline"],["name","fas-user-slash"],["name","fas-volume-xmark",3,"title"],["class","addon-message-last-message-date",4,"ngIf"],["aria-label","true",4,"ngIf"],["class","sr-only",4,"ngIf"],[1,"addon-message-last-message-date"],["aria-label","true"],[1,"sr-only"],[1,"addon-message-last-message"],["class","addon-message-last-message-user",4,"ngIf"],["clean","true","singleLine","true","contextLevel","system",1,"addon-message-last-message-text",3,"text","contextInstanceId"],[1,"addon-message-last-message-user"]],template:function AddonMessagesGroupConversationsPage_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),P.nrm(3,"ion-back-button",3),P.nI1(4,"translate"),P.k0s(),P.j41(5,"ion-title")(6,"h1"),P.EFF(7),P.nI1(8,"translate"),P.k0s()(),P.j41(9,"ion-buttons",4)(10,"ion-button",5),P.nI1(11,"translate"),P.bIt("click",(function AddonMessagesGroupConversationsPage_Template_ion_button_click_10_listener(){return P.eBV(e),P.Njj(n.gotoSearch())})),P.nrm(12,"ion-icon",6),P.k0s(),P.j41(13,"ion-button",7),P.nI1(14,"translate"),P.bIt("click",(function AddonMessagesGroupConversationsPage_Template_ion_button_click_13_listener(){return P.eBV(e),P.Njj(n.gotoSettings())})),P.nrm(15,"ion-icon",8),P.k0s(),P.nrm(16,"core-context-menu")(17,"core-user-menu-button"),P.k0s()()(),P.j41(18,"ion-content")(19,"core-split-view")(20,"ion-refresher",9),P.bIt("ionRefresh",(function AddonMessagesGroupConversationsPage_Template_ion_refresher_ionRefresh_20_listener(t){return P.eBV(e),P.Njj(n.refreshData(t.target))})),P.nrm(21,"ion-refresher-content",10),P.nI1(22,"translate"),P.k0s(),P.j41(23,"core-loading",11)(24,"ion-list")(25,"ion-item",12),P.bIt("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_25_listener(){return P.eBV(e),P.Njj(n.gotoContacts())})),P.nrm(26,"ion-icon",13),P.j41(27,"ion-label")(28,"p",14),P.EFF(29),P.nI1(30,"translate"),P.k0s()(),P.DNE(31,AddonMessagesGroupConversationsPage_ion_badge_31_Template,3,7,"ion-badge",15),P.k0s(),P.j41(32,"ion-accordion-group",16,0),P.bIt("ionChange",(function AddonMessagesGroupConversationsPage_Template_ion_accordion_group_ionChange_32_listener(t){return P.eBV(e),P.Njj(n.accordionGroupChange(t.detail))})),P.DNE(34,AddonMessagesGroupConversationsPage_ion_accordion_34_Template,10,8,"ion-accordion",17),P.k0s()()()()(),P.DNE(35,AddonMessagesGroupConversationsPage_ng_template_35_Template,1,1,"ng-template",null,1,P.C5r)}2&e&&(P.R7$(3),P.Y8G("text",P.bMT(4,12,"core.back")),P.R7$(4),P.JRh(P.bMT(8,14,"addon.messages.messages")),P.R7$(3),P.Y8G("ariaLabel",P.bMT(11,16,"addon.messages.searchcombined")),P.R7$(3),P.Y8G("ariaLabel",P.bMT(14,18,"addon.messages.messagepreferences")),P.R7$(7),P.Y8G("disabled",!n.loaded),P.R7$(),P.FS9("pullingText",P.bMT(22,20,"core.pulltorefresh")),P.R7$(2),P.Y8G("hideUntil",n.loaded)("message",n.loadingMessage),P.R7$(2),P.Y8G("detail",!0),P.R7$(4),P.JRh(P.bMT(30,22,"addon.messages.contacts")),P.R7$(2),P.Y8G("ngIf",n.contactRequestsCount>0),P.R7$(3),P.Y8G("ngForOf",n.groupConversations))},dependencies:[h.n,O.Sq,O.bT,O.T3,s.xk,s.YH,s.mC,s.In,s.Jm,s.QW,s.W9,s.eU,s.iq,s.uz,s.he,s.nf,s.JI,s.To,s.Ki,s.w2,s.BC,s.ai,s.el,b.B,I.b,T.R,v.M,A.T,y.l,x.t,R.B,k.i,$.T,N.D9,j.Y,M.U],styles:["[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:.6875rem}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-inline-end:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesGroupConversationsPage})()}}]);