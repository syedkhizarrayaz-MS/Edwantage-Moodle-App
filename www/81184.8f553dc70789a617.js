"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[81184],{81184:(e,t,n)=>{n.r(t),n.d(t,{default:()=>F});var o=n(10467),s=n(85122),a=n(2910),i=n(94455),r=n(15324),d=n(52749),c=n(55554),l=n(79555),g=n(49882),_=n(35853),m=n(50638),h=n(24742),u=n(22693),p=n(44426),f=n(53794),C=n(93589),I=n(33014),y=n(25572),b=n(86654),M=n(54438),v=n(60177),A=n(16986),P=n(64422),S=n(28042),T=n(86198),R=n(58197),x=n(88246),$=n(43570),w=n(73955),k=n(59528);const _c0=e=>({$a:e});function AddonModChatChatPage_ion_button_9_Template(e,t){if(1&e){const e=M.RV6();M.j41(0,"ion-button",14),M.nI1(1,"translate"),M.bIt("click",(function AddonModChatChatPage_ion_button_9_Template_ion_button_click_0_listener(){M.eBV(e);const t=M.XpG();return M.Njj(t.showChatUsers())})),M.nrm(2,"ion-icon",15),M.k0s()}2&e&&M.Y8G("ariaLabel",M.bMT(1,1,"core.users"))}function AddonModChatChatPage_ng_container_13_p_1_Template(e,t){if(1&e&&(M.j41(0,"p",19),M.EFF(1),M.nI1(2,"coreFormatDate"),M.k0s()),2&e){const e=M.XpG().$implicit;M.R7$(),M.SpI(" ",M.i5U(2,1,1e3*e.timestamp,"strftimedayshort")," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template(e,t){if(1&e&&(M.j41(0,"ion-badge",26)(1,"span"),M.nrm(2,"ion-icon",27),M.EFF(3),M.nI1(4,"coreFormatDate"),M.nI1(5,"translate"),M.k0s()()),2&e){const e=M.XpG(2).$implicit;M.R7$(3),M.Lme(" ",M.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",M.i5U(5,5,"addon.mod_chat.messageenter",M.eq3(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template(e,t){if(1&e&&(M.j41(0,"ion-badge",28)(1,"span"),M.nrm(2,"ion-icon",29),M.EFF(3),M.nI1(4,"coreFormatDate"),M.nI1(5,"translate"),M.k0s()()),2&e){const e=M.XpG(2).$implicit;M.R7$(3),M.Lme(" ",M.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",M.i5U(5,5,"addon.mod_chat.messageexit",M.eq3(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template(e,t){if(1&e&&(M.j41(0,"ion-badge",30)(1,"span"),M.nrm(2,"ion-icon",31),M.EFF(3),M.nI1(4,"coreFormatDate"),M.nI1(5,"translate"),M.k0s()()),2&e){const e=M.XpG(2).$implicit;M.R7$(3),M.Lme(" ",M.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",M.i5U(5,5,"addon.mod_chat.messagebeepseveryone",M.eq3(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template(e,t){if(1&e&&(M.j41(0,"ion-badge",30)(1,"span"),M.nrm(2,"ion-icon",31),M.EFF(3),M.nI1(4,"coreFormatDate"),M.nI1(5,"translate"),M.k0s()()),2&e){const e=M.XpG(2).$implicit;M.R7$(3),M.Lme(" ",M.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",M.i5U(5,5,"addon.mod_chat.messagebeepsyou",M.eq3(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template(e,t){if(1&e&&(M.j41(0,"ion-badge",32)(1,"span"),M.nrm(2,"ion-icon",31),M.EFF(3),M.nI1(4,"coreFormatDate"),M.nI1(5,"translate"),M.k0s()()),2&e){const e=M.XpG(2).$implicit;M.R7$(3),M.Lme(" ",M.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",M.i5U(5,5,"addon.mod_chat.messageyoubeep",M.eq3(8,_c0,e.beepWho))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template(e,t){if(1&e){const e=M.RV6();M.j41(0,"ion-badge",33)(1,"span"),M.nrm(2,"ion-icon",34),M.EFF(3),M.nI1(4,"coreFormatDate"),M.j41(5,"strong"),M.EFF(6),M.j41(7,"core-format-text",35),M.bIt("afterRender",(function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template_core_format_text_afterRender_7_listener(){M.eBV(e);const t=M.XpG(2).last,n=M.XpG();return M.Njj(t&&n.scrollToBottom())})),M.k0s()()()()}if(2&e){const e=M.XpG(2).$implicit,t=M.XpG();M.R7$(3),M.SpI(" ",M.i5U(4,5,1e3*e.timestamp,"strftimetime")," "),M.R7$(3),M.SpI(" ",e.userfullname," "),M.R7$(),M.Y8G("text",e.message)("contextInstanceId",t.cmId)("courseId",t.courseId)}}function AddonModChatChatPage_ng_container_13_div_2_Template(e,t){if(1&e&&(M.j41(0,"div",20),M.DNE(1,AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template,6,10,"ion-badge",21)(2,AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template,6,10,"ion-badge",22)(3,AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template,6,10,"ion-badge",23)(4,AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template,6,10,"ion-badge",23)(5,AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template,6,10,"ion-badge",24)(6,AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template,8,8,"ion-badge",25),M.k0s()),2&e){const e=M.XpG().$implicit,t=M.XpG();M.R7$(),M.Y8G("ngIf",e.system&&"enter"===e.message),M.R7$(),M.Y8G("ngIf",e.system&&"exit"===e.message),M.R7$(),M.Y8G("ngIf","all"===e.beep),M.R7$(),M.Y8G("ngIf",e.userid!==t.currentUserId&&e.beep===t.currentUserId),M.R7$(),M.Y8G("ngIf",e.userid===t.currentUserId&&e.beep&&"all"!==e.beep),M.R7$(),M.Y8G("ngIf",!e.system&&!e.beep)}}function AddonModChatChatPage_ng_container_13_core_message_3_Template(e,t){if(1&e){const e=M.RV6();M.j41(0,"core-message",36),M.bIt("afterRender",(function AddonModChatChatPage_ng_container_13_core_message_3_Template_core_message_afterRender_0_listener(){M.eBV(e);const t=M.XpG().last,n=M.XpG();return M.Njj(t&&n.scrollToBottom())})),M.k0s()}if(2&e){const e=M.XpG().$implicit,t=M.XpG();M.Y8G("message",e)("user",e)("text",e.message)("time",1e3*e.timestamp)("instanceId",t.cmId)("courseId",t.courseId)}}function AddonModChatChatPage_ng_container_13_Template(e,t){if(1&e&&(M.qex(0),M.DNE(1,AddonModChatChatPage_ng_container_13_p_1_Template,3,4,"p",16)(2,AddonModChatChatPage_ng_container_13_div_2_Template,7,6,"div",17)(3,AddonModChatChatPage_ng_container_13_core_message_3_Template,1,6,"core-message",18),M.bVm()),2&e){const e=t.$implicit;M.R7$(),M.Y8G("ngIf",e.showDate),M.R7$(),M.Y8G("ngIf",e.special),M.R7$(),M.Y8G("ngIf",!e.special)}}function AddonModChatChatPage_core_empty_box_14_Template(e,t){1&e&&(M.nrm(0,"core-empty-box",37),M.nI1(1,"translate")),2&e&&M.Y8G("message",M.bMT(1,1,"addon.mod_chat.nomessages"))}function AddonModChatChatPage_p_17_Template(e,t){1&e&&(M.j41(0,"p",38),M.EFF(1),M.nI1(2,"translate"),M.k0s()),2&e&&(M.R7$(),M.SpI(" ",M.bMT(2,1,"addon.mod_chat.mustbeonlinetosendmessages")," "))}function AddonModChatChatPage_core_send_message_form_18_Template(e,t){if(1&e){const e=M.RV6();M.j41(0,"core-send-message-form",39),M.nI1(1,"translate"),M.bIt("onSubmit",(function AddonModChatChatPage_core_send_message_form_18_Template_core_send_message_form_onSubmit_0_listener(t){M.eBV(e);const n=M.XpG();return M.Njj(n.sendMessage(t))})),M.k0s()}if(2&e){const e=M.XpG();M.Y8G("sendDisabled",e.sending)("message",e.newMessage)("placeholder",M.bMT(1,3,"addon.messages.newmessage"))}}function AddonModChatChatPage_ion_button_19_Template(e,t){if(1&e){const e=M.RV6();M.j41(0,"ion-button",40),M.bIt("click",(function AddonModChatChatPage_ion_button_19_Template_ion_button_click_0_listener(){M.eBV(e);const t=M.XpG();return M.Njj(t.reconnect())})),M.EFF(1),M.nI1(2,"translate"),M.k0s()}2&e&&(M.R7$(),M.SpI(" ",M.bMT(2,1,"core.login.reconnect")," "))}let F=(()=>{var e;class AddonModChatChatPage{constructor(){this.loaded=!1,this.title="",this.messages=[],this.sending=!1,this.lastTime=0,this.oldContentHeight=0,this.viewDestroyed=!1,this.pollingRunning=!1,this.users=[],this.currentUserId=d.CoreSites.getCurrentSiteUserId(),this.isOnline=i.WE.isOnline(),this.onlineSubscription=i.WE.onChange().subscribe((()=>{l.SK.run((()=>{this.isOnline=i.WE.isOnline()}))})),this.logView=h.j.once((()=>{u.OF.logEvent({type:u.qr.VIEW_ITEM_LIST,ws:"mod_chat_get_chat_latest_messages",name:this.title,data:{chatid:this.chatId,category:"chat"},url:`/mod/chat/gui_ajax/index.php?id=${this.chatId}`})}))}ngOnInit(){var e=this;return(0,o.A)((function*(){try{e.courseId=r.CoreNavigator.getRequiredRouteNumberParam("courseId"),e.cmId=r.CoreNavigator.getRequiredRouteNumberParam("cmId"),e.chatId=r.CoreNavigator.getRequiredRouteNumberParam("chatId"),e.title=r.CoreNavigator.getRouteParam("title")||"",yield e.loginUser(),yield e.fetchMessages(),e.startPolling(),e.logView()}catch(e){y.CoreAlerts.showError(e,{default:l.HT.instant("addon.mod_chat.errorwhileconnecting")}),r.CoreNavigator.back()}finally{e.loaded=!0}}))()}ionViewDidEnter(){this.startPolling()}ionViewWillLeave(){g.z.trigger(g.z.ACTIVITY_DATA_SENT,{module:"chat"}),this.stopPolling()}loginUser(){var e=this;return(0,o.A)((function*(){e.sessionId=yield _.V.loginUser(e.chatId)}))()}fetchMessages(){var e=this;return(0,o.A)((function*(){const t=yield _.V.getLatestMessages(e.sessionId,e.lastTime);e.lastTime=t.chatnewlasttime||0;const n=yield _.V.getMessagesUserData(t.messages,e.courseId);if(!n.length)return;const o=e.messages.length;e.messages=e.messages.concat(n);for(let t=o;t<e.messages.length;t++){e.messages[t]=m.H.formatMessage(e.currentUserId,e.messages[t],t>0?e.messages[t-1]:void 0);const n=e.messages[t];n.beep&&n.beep!==e.currentUserId&&e.loadMessageBeepWho(n)}e.messages[e.messages.length-1].showTail=!0,e.scrollToBottom()}))()}loadMessageBeepWho(e){var t=this;return(0,o.A)((function*(){e.beepWho=yield t.getUserFullname(e.beep)}))()}showChatUsers(){var e=this;return(0,o.A)((function*(){const{AddonModChatUsersModalComponent:t}=yield n.e(35712).then(n.bind(n,35712)),o=yield C.I.openSideModal({component:t,componentProps:{sessionId:e.sessionId,cmId:e.cmId}});if(o){var s;if(o.talkTo)e.newMessage=`To ${o.talkTo}: ${(null===(s=e.sendMessageForm)||void 0===s?void 0:s.message)||""}`;o.beepTo&&e.sendMessage("",o.beepTo),e.users=o.users}}))()}getUserFullname(e){var t=this;return(0,o.A)((function*(){const n=Number(e);if(isNaN(n))return String(e);const o=t.users.find((e=>e.id==n));if(o)return o.fullname;try{const o=yield _.V.getChatUsers(t.sessionId,{cmId:t.cmId});t.users=o.users;const s=t.users.find((e=>e.id==n));return s?s.fullname:String(e)}catch{return String(e)}}))()}startPolling(){this.polling||(this.polling=window.setInterval((()=>{c.g.ignoreErrors(this.fetchMessagesInterval())}),AddonModChatChatPage.POLL_INTERVAL))}stopPolling(){clearInterval(this.polling),this.polling=void 0}fetchMessagesInterval(){var e=this;return(0,o.A)((function*(){if(e.isOnline&&!e.pollingRunning){e.pollingRunning=!0;try{yield e.fetchMessages()}catch{try{yield e.loginUser(),yield e.fetchMessages()}catch(t){throw e.stopPolling(),y.CoreAlerts.showError(t,{default:l.HT.instant("addon.mod_chat.errorwhileretrievingmessages")}),t}}finally{e.pollingRunning=!1}}}))()}sendMessage(e,t=0){var n=this;return(0,o.A)((function*(){if(n.isOnline&&(0!==t||e.trim())){n.sending=!0;try{yield _.V.sendMessage(n.sessionId,e,t),c.g.ignoreErrors(n.fetchMessagesInterval())}catch(t){p.p.close(),n.newMessage=e,y.CoreAlerts.showError(t,{default:l.HT.instant("addon.mod_chat.errorwhilesendingmessage")})}finally{n.sending=!1}}}))()}reconnect(){var e=this;return(0,o.A)((function*(){const t=yield I.CoreLoadings.show();try{yield e.fetchMessagesInterval(),e.startPolling()}catch{}finally{t.dismiss()}}))()}scrollToBottom(){var e=this;return(0,o.A)((function*(){var t;(yield f.H.nextTick(),e.viewDestroyed)||(null===(t=e.content)||void 0===t||t.scrollToBottom())}))()}canLeave(){var e=this;return(0,o.A)((function*(){return!e.messages.some((e=>!e.special))||(yield y.CoreAlerts.confirm(l.HT.instant("addon.mod_chat.confirmloss")),!0)}))()}ngOnDestroy(){this.onlineSubscription&&this.onlineSubscription.unsubscribe(),this.stopPolling(),this.viewDestroyed=!0}}return(e=AddonModChatChatPage).POLL_INTERVAL=4e3,e.ɵfac=function AddonModChatChatPage_Factory(t){return new(t||e)},e.ɵcmp=M.VBU({type:e,selectors:[["page-addon-mod-chat-chat"]],viewQuery:function AddonModChatChatPage_Query(e,t){if(1&e&&(M.GBs(a.W9,5),M.GBs(s.u,5)),2&e){let e;M.mGM(e=M.lsd())&&(t.content=e.first),M.mGM(e=M.lsd())&&(t.sendMessageForm=e.first)}},standalone:!0,features:[M.aNF],decls:20,vars:14,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"ariaLabel","click",4,"ngIf"],[3,"hideUntil"],["aria-live","polite",1,"addon-messages-discussion-container"],[4,"ngFor","ngForOf"],["icon","far-comments",3,"message",4,"ngIf"],[1,"footer-adjustable"],[3,"color"],["class","ion-text-center",4,"ngIf"],[3,"sendDisabled","message","placeholder","onSubmit",4,"ngIf"],["expand","block","fill","outline",3,"click",4,"ngIf"],["fill","clear",3,"click","ariaLabel"],["name","fas-users","slot","icon-only","aria-hidden","true"],["class","ion-text-center addon-messages-date",4,"ngIf"],["class","ion-text-center addon-mod_chat-notice",4,"ngIf"],["contextLevel","module",3,"message","user","text","time","instanceId","courseId","afterRender",4,"ngIf"],[1,"ion-text-center","addon-messages-date"],[1,"ion-text-center","addon-mod_chat-notice"],["class","ion-text-wrap","color","success",4,"ngIf"],["class","ion-text-wrap","color","danger",4,"ngIf"],["class","ion-text-wrap","color","primary",4,"ngIf"],["class","ion-text-wrap","color","light",4,"ngIf"],["class","ion-text-wrap","color","info",4,"ngIf"],["color","success",1,"ion-text-wrap"],["name","fas-right-to-bracket","aria-hidden","true"],["color","danger",1,"ion-text-wrap"],["name","fas-right-from-bracket","aria-hidden","true"],["color","primary",1,"ion-text-wrap"],["name","fas-bell","aria-hidden","true"],["color","light",1,"ion-text-wrap"],["color","info",1,"ion-text-wrap"],["name","fas-asterisk","aria-hidden","true"],["contextLevel","module",3,"afterRender","text","contextInstanceId","courseId"],["contextLevel","module",3,"afterRender","message","user","text","time","instanceId","courseId"],["icon","far-comments",3,"message"],[1,"ion-text-center"],[3,"onSubmit","sendDisabled","message","placeholder"],["expand","block","fill","outline",3,"click"]],template:function AddonModChatChatPage_Template(e,t){1&e&&(M.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),M.nrm(3,"ion-back-button",1),M.nI1(4,"translate"),M.k0s(),M.j41(5,"ion-title")(6,"h1"),M.nrm(7,"core-format-text",2),M.k0s()(),M.j41(8,"ion-buttons",3),M.DNE(9,AddonModChatChatPage_ion_button_9_Template,3,3,"ion-button",4),M.k0s()()(),M.j41(10,"ion-content")(11,"core-loading",5)(12,"ion-list",6),M.DNE(13,AddonModChatChatPage_ng_container_13_Template,4,3,"ng-container",7),M.k0s(),M.DNE(14,AddonModChatChatPage_core_empty_box_14_Template,2,3,"core-empty-box",8),M.k0s()(),M.j41(15,"ion-footer",9)(16,"ion-toolbar",10),M.DNE(17,AddonModChatChatPage_p_17_Template,3,3,"p",11)(18,AddonModChatChatPage_core_send_message_form_18_Template,2,5,"core-send-message-form",12)(19,AddonModChatChatPage_ion_button_19_Template,3,3,"ion-button",13),M.k0s()()),2&e&&(M.R7$(3),M.Y8G("text",M.bMT(4,12,"core.back")),M.R7$(4),M.Y8G("text",t.title)("contextInstanceId",t.cmId)("courseId",t.courseId),M.R7$(2),M.Y8G("ngIf",t.loaded),M.R7$(2),M.Y8G("hideUntil",t.loaded),M.R7$(2),M.Y8G("ngForOf",t.messages),M.R7$(),M.Y8G("ngIf",!t.messages||t.messages.length<=0),M.R7$(2),M.Y8G("color",t.isOnline&&t.polling&&t.loaded?null:"light"),M.R7$(),M.Y8G("ngIf",!t.isOnline),M.R7$(),M.Y8G("ngIf",t.isOnline&&t.polling&&t.loaded),M.R7$(),M.Y8G("ngIf",t.isOnline&&!t.polling&&t.loaded))},dependencies:[b.n,v.Sq,v.bT,a.In,a.Jm,a.QW,a.W9,a.M0,a.eU,a.iq,a.nf,a.BC,a.ai,a.el,A.h,P.R,S.A,s.u,T.t,R.B,x.i,$.T,w.D9,k.f],styles:[".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0px}ion-content[_ngcontent-%COMP%]{--content-background: var(--background-alternative);--background: var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}ion-content[_ngcontent-%COMP%]   core-empty-box[_ngcontent-%COMP%]{--core-empty-box-icon-color: var(--dark)}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}","[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"]}),AddonModChatChatPage})()},35853:(e,t,n)=>{n.d(t,{V:()=>m});var o=n(10467),s=n(97254),a=n(98870),i=n(52749),r=n(79555),d=n(22535),c=n(74431),l=n(95384),g=n(54438);let _=(()=>{var e;class AddonModChatProvider{getChat(e,t,n={}){var s=this;return(0,o.A)((function*(){const o=yield i.CoreSites.getSite(n.siteId),a={courseids:[e]},r={cacheKey:s.getChatsCacheKey(e),updateFrequency:c.CoreCacheUpdateFrequency.RARELY,component:d.vz,...i.CoreSites.getReadingStrategyPreSets(n.readingStrategy)},g=yield o.read("mod_chat_get_chats_by_courses",a,r);return l.CoreCourseModuleHelper.getActivityByCmId(g.chats,t)}))()}loginUser(e,t){return(0,o.A)((function*(){const n=yield i.CoreSites.getSite(t),o={chatid:e};return(yield n.write("mod_chat_login_user",o)).chatsid}))()}logView(e,t){return(0,o.A)((function*(){const n={chatid:e};yield s.CoreCourseLogHelper.log("mod_chat_view_chat",n,d.vz,e,t)}))()}logViewSessions(e,t){return(0,o.A)((function*(){const n={cmid:e};t&&(n.start=t.start,n.end=t.end),yield s.CoreCourseLogHelper.log("mod_chat_view_sessions",n,d.vz,e)}))()}sendMessage(e,t,n,s){return(0,o.A)((function*(){const o=yield i.CoreSites.getSite(s),a={chatsid:e,messagetext:t,beepid:String(n)};return(yield o.write("mod_chat_send_chat_message",a)).messageid}))()}getLatestMessages(e,t,n){return(0,o.A)((function*(){return(yield i.CoreSites.getSite(n)).write("mod_chat_get_chat_latest_messages",{chatsid:e,chatlasttime:t})}))()}getMessagesUserData(e,t,n){return(0,o.A)((function*(){const s=e;return yield Promise.all(s.map(function(){var e=(0,o.A)((function*(e){try{const o=yield a.CoreUser.getProfile(e.userid,t,!0,n);e.userfullname=o.fullname,e.userprofileimageurl=o.profileimageurl}catch{e.userfullname=`${r.HT.instant("core.deleteduser")} ${e.userid}`}}));return function(t){return e.apply(this,arguments)}}())),s}))()}getChatUsers(e,t={}){return(0,o.A)((function*(){t.readingStrategy=t.readingStrategy||3;const n=yield i.CoreSites.getSite(t.siteId),o={chatsid:e},s={component:d.vz,componentId:t.cmId,...i.CoreSites.getReadingStrategyPreSets(t.readingStrategy)};return n.read("mod_chat_get_chat_users",o,s)}))()}getSessions(e,t=0,n=!1,s={}){var a=this;return(0,o.A)((function*(){const o=yield i.CoreSites.getSite(s.siteId),r={chatid:e,groupid:t,showall:n},l={cacheKey:a.getSessionsCacheKey(e,t,n),updateFrequency:c.CoreCacheUpdateFrequency.SOMETIMES,component:d.vz,componentId:s.cmId,...i.CoreSites.getReadingStrategyPreSets(s.readingStrategy)};return(yield o.read("mod_chat_get_sessions",r,l)).sessions}))()}getSessionMessages(e,t,n,s=0,a={}){var r=this;return(0,o.A)((function*(){const o=yield i.CoreSites.getSite(a.siteId),l={chatid:e,sessionstart:t,sessionend:n,groupid:s},g={cacheKey:r.getSessionMessagesCacheKey(e,t,s),updateFrequency:c.CoreCacheUpdateFrequency.RARELY,component:d.vz,componentId:a.cmId,...i.CoreSites.getReadingStrategyPreSets(a.readingStrategy)};return(yield o.read("mod_chat_get_session_messages",l,g)).messages}))()}invalidateChats(e,t){var n=this;return(0,o.A)((function*(){const o=yield i.CoreSites.getSite(t);yield o.invalidateWsCacheForKey(n.getChatsCacheKey(e))}))()}invalidateSessions(e,t=0,n=!1,s){var a=this;return(0,o.A)((function*(){const o=yield i.CoreSites.getSite(s);yield o.invalidateWsCacheForKey(a.getSessionsCacheKey(e,t,n))}))()}invalidateAllSessions(e,t){var n=this;return(0,o.A)((function*(){const o=yield i.CoreSites.getSite(t);yield o.invalidateWsCacheForKeyStartingWith(n.getSessionsCacheKeyPrefix(e))}))()}invalidateSessionMessages(e,t,n=0,s){var a=this;return(0,o.A)((function*(){const o=yield i.CoreSites.getSite(s);yield o.invalidateWsCacheForKey(a.getSessionMessagesCacheKey(e,t,n))}))()}invalidateAllSessionMessages(e,t){var n=this;return(0,o.A)((function*(){const o=yield i.CoreSites.getSite(t);yield o.invalidateWsCacheForKeyStartingWith(n.getSessionMessagesCacheKeyPrefix(e))}))()}getChatsCacheKey(e){return`${AddonModChatProvider.ROOT_CACHE_KEY}chats:${e}`}getSessionsCacheKey(e,t,n){return this.getSessionsCacheKeyPrefix(e)+t+":"+(n?1:0)}getSessionsCacheKeyPrefix(e){return`${AddonModChatProvider.ROOT_CACHE_KEY}sessions:${e}:`}getSessionMessagesCacheKey(e,t,n){return this.getSessionMessagesCacheKeyPrefix(e)+t+":"+n}getSessionMessagesCacheKeyPrefix(e){return`${AddonModChatProvider.ROOT_CACHE_KEY}sessionsMessages:${e}:`}}return(e=AddonModChatProvider).ROOT_CACHE_KEY="AddonModChat:",e.ɵfac=function AddonModChatProvider_Factory(t){return new(t||e)},e.ɵprov=g.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModChatProvider})();const m=(0,r.Qd)(_)}}]);