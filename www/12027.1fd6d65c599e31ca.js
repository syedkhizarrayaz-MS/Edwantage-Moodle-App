"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[12027],{12027:(n,e,t)=>{t.r(e),t.d(e,{AddonModAssignSubmissionOnlineTextComponent:()=>I});var i=t(10467),o=t(57102),s=t(5505),d=t(4175),l=t(52749),a=t(75383),r=t(55554),m=t(66016),c=t(69534),p=t(41450),u=t(86654),_=t(88436),g=t(54438),x=t(89417),f=t(60177),b=t(2910),h=t(58197),A=t(73955);const _c0=n=>({$a:n}),_c1=n=>({userid:n,action:"editsubmission"});function AddonModAssignSubmissionOnlineTextComponent_ion_item_0_p_4_Template(n,e){if(1&n&&(g.j41(0,"p"),g.EFF(1),g.nI1(2,"translate"),g.k0s()),2&n){const n=g.XpG(2);g.R7$(),g.JRh(g.i5U(2,1,"addon.mod_assign.numwords",g.eq3(4,_c0,n.words)))}}function AddonModAssignSubmissionOnlineTextComponent_ion_item_0_Template(n,e){if(1&n){const n=g.RV6();g.j41(0,"ion-item",2),g.bIt("click",(function AddonModAssignSubmissionOnlineTextComponent_ion_item_0_Template_ion_item_click_0_listener(e){g.eBV(n);const t=g.XpG();return g.Njj(t.open(e))})),g.j41(1,"ion-label")(2,"p",3),g.EFF(3),g.k0s(),g.DNE(4,AddonModAssignSubmissionOnlineTextComponent_ion_item_0_p_4_Template,3,6,"p",1),g.j41(5,"p",4),g.nrm(6,"core-format-text",5),g.k0s()()()}if(2&n){const n=g.XpG();g.Y8G("detail",!0),g.R7$(3),g.JRh(n.plugin.name),g.R7$(),g.Y8G("ngIf",n.words),g.R7$(2),g.Y8G("component",n.component)("componentId",n.assign.cmid)("text",n.text)("contextInstanceId",n.assign.cmid)("courseId",n.assign.course)("sanitize",!n.isSent)}}function AddonModAssignSubmissionOnlineTextComponent_div_1_ion_item_5_Template(n,e){if(1&n&&(g.j41(0,"ion-item",8)(1,"ion-label")(2,"p",3),g.EFF(3),g.nI1(4,"translate"),g.k0s(),g.j41(5,"p"),g.EFF(6),g.nI1(7,"translate"),g.k0s()()()),2&n){const n=g.XpG(2);g.R7$(3),g.JRh(g.bMT(4,2,"addon.mod_assign.wordlimit")),g.R7$(3),g.JRh(g.i5U(7,4,"core.numwords",g.eq3(7,_c0,n.words+" / "+n.wordLimit)))}}function AddonModAssignSubmissionOnlineTextComponent_div_1_Template(n,e){if(1&n){const n=g.RV6();g.j41(0,"div")(1,"ion-item-divider",6)(2,"ion-label")(3,"p",3),g.EFF(4),g.k0s()()(),g.DNE(5,AddonModAssignSubmissionOnlineTextComponent_div_1_ion_item_5_Template,8,9,"ion-item",7),g.j41(6,"ion-item",8)(7,"ion-label",9),g.EFF(8),g.k0s(),g.j41(9,"core-rich-text-editor",10),g.bIt("contentChanged",(function AddonModAssignSubmissionOnlineTextComponent_div_1_Template_core_rich_text_editor_contentChanged_9_listener(e){g.eBV(n);const t=g.XpG();return g.Njj(t.onChange(e))})),g.k0s()()()}if(2&n){const n=g.XpG();g.R7$(),g.Y8G("sticky",!0),g.R7$(3),g.JRh(n.plugin.name),g.R7$(),g.Y8G("ngIf",n.wordLimitEnabled&&n.words>=0),g.R7$(3),g.JRh(n.plugin.name),g.R7$(),g.Y8G("control",n.control)("placeholder",n.plugin.name)("component",n.component)("componentId",n.assign.cmid)("autoSave",!0)("contextInstanceId",n.assign.cmid)("draftExtraParams",g.eq3(11,_c1,n.currentUserId))}}let I=(()=>{var n;class AddonModAssignSubmissionOnlineTextComponent extends o.L{constructor(n){super(),this.fb=n,this.words=0,this.component=m.It,this.text="",this.loaded=!1,this.wordLimitEnabled=!1,this.wordLimit=0,this.isSent=!1,this.currentUserId=l.CoreSites.getCurrentSiteUserId()}ngOnInit(){var n=this;return(0,i.A)((function*(){var e,t;const i=yield r.g.ignoreErrors(d.AddonModAssignOffline.getSubmission(n.assign.id),void 0);n.wordLimitEnabled=!!parseInt((null===(e=n.configs)||void 0===e?void 0:e.wordlimitenabled)||"0",10),n.wordLimit=parseInt((null===(t=n.configs)||void 0===t?void 0:t.wordlimit)||"0");try{var o,l;if(i&&i.plugindata){if(i.plugindata.onlinetext_editor)n.text=_.CoreFileHelper.replacePluginfileUrls(i.plugindata.onlinetext_editor.text,null!==(o=null===(l=n.plugin.fileareas)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.files)&&void 0!==o?o:[]),n.isSent=!1}else n.text=s.AddonModAssign.getSubmissionPluginText(n.plugin),n.isSent=!0;n.edit&&(n.control=n.fb.control(n.text,{nonNullable:!0})),n.wordLimitEnabled&&(n.words=a.Ni.countWords(n.text))}finally{n.loaded=!0}}))()}open(n){n.preventDefault(),n.stopPropagation(),c.m.viewText(this.plugin.name,this.text,{component:this.component,componentId:this.assign.cmid,filter:!0,contextLevel:"module",instanceId:this.assign.cmid,courseId:this.assign.course})}onChange(n){this.wordLimitEnabled&&(clearTimeout(this.wordCountTimeout),this.wordCountTimeout=window.setTimeout((()=>{this.words=a.Ni.countWords(n)}),1500))}}return(n=AddonModAssignSubmissionOnlineTextComponent).ɵfac=function AddonModAssignSubmissionOnlineTextComponent_Factory(e){return new(e||n)(g.rXU(x.ok))},n.ɵcmp=g.VBU({type:n,selectors:[["addon-mod-assign-submission-online-text"]],standalone:!0,features:[g.Vt3,g.aNF],decls:2,vars:2,consts:[["class","ion-text-wrap","button","",3,"detail","click",4,"ngIf"],[4,"ngIf"],["button","",1,"ion-text-wrap",3,"click","detail"],[1,"item-heading"],[1,"collapse-content"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId","sanitize"],[1,"ion-text-wrap",3,"sticky"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],[1,"sr-only"],["name","onlinetext_editor_text","contextLevel","module","elementId","onlinetext_editor",3,"contentChanged","control","placeholder","component","componentId","autoSave","contextInstanceId","draftExtraParams"]],template:function AddonModAssignSubmissionOnlineTextComponent_Template(n,e){1&n&&g.DNE(0,AddonModAssignSubmissionOnlineTextComponent_ion_item_0_Template,7,9,"ion-item",0)(1,AddonModAssignSubmissionOnlineTextComponent_div_1_Template,10,13,"div",1),2&n&&(g.Y8G("ngIf",!e.edit&&e.text),g.R7$(),g.Y8G("ngIf",e.edit&&e.loaded))},dependencies:[u.n,f.bT,b.uz,b.Dg,b.he,h.B,A.D9,p.CoreEditorRichTextEditorComponent],encapsulation:2}),AddonModAssignSubmissionOnlineTextComponent})()}}]);