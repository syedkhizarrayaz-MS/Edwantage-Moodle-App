"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[25773],{25773:(e,o,s)=>{s.r(o),s.d(o,{default:()=>P});var r=s(10467),t=s(83219),a=s(15324),n=s(52749),l=s(49882),i=s(66110),c=s(24742),u=s(22693),d=s(79555),h=s(9538),C=s(25572),_=s(16449),g=s(75357),m=s(20871),b=s(86654),f=s(54438),p=s(60177),E=s(2910),T=s(69502),y=s(17388),w=s(16986),I=s(66198),L=s(64422),x=s(88246),M=s(73955);const _c0=e=>({$a:e});function CoreCoursesListPage_h1_6_Template(e,o){1&e&&(f.j41(0,"h1"),f.EFF(1),f.nI1(2,"translate"),f.k0s()),2&e&&(f.R7$(),f.JRh(f.bMT(2,1,"core.courses.availablecourses")))}function CoreCoursesListPage_h1_7_Template(e,o){1&e&&(f.j41(0,"h1"),f.EFF(1),f.nI1(2,"translate"),f.k0s()),2&e&&(f.R7$(),f.JRh(f.bMT(2,1,"core.courses.mycourses")))}function CoreCoursesListPage_core_context_menu_item_10_Template(e,o){if(1&e){const e=f.RV6();f.j41(0,"core-context-menu-item",5),f.nI1(1,"translate"),f.bIt("action",(function CoreCoursesListPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(){f.eBV(e);const o=f.XpG();return f.Njj(o.toggleDownload())})),f.mxI("toggleChange",(function CoreCoursesListPage_core_context_menu_item_10_Template_core_context_menu_item_toggleChange_0_listener(o){f.eBV(e);const s=f.XpG();return f.DH7(s.downloadEnabled,o)||(s.downloadEnabled=o),f.Njj(o)})),f.k0s()}if(2&e){const e=f.XpG();f.Y8G("priority",1e3)("content",f.bMT(1,3,"core.settings.showdownloadoptions")),f.R50("toggle",e.downloadEnabled)}}function CoreCoursesListPage_core_search_box_18_Template(e,o){if(1&e){const e=f.RV6();f.j41(0,"core-search-box",15),f.nI1(1,"translate"),f.nI1(2,"translate"),f.bIt("onSubmit",(function CoreCoursesListPage_core_search_box_18_Template_core_search_box_onSubmit_0_listener(o){f.eBV(e);const s=f.XpG();return f.Njj(s.search(o))}))("onClear",(function CoreCoursesListPage_core_search_box_18_Template_core_search_box_onClear_0_listener(){f.eBV(e);const o=f.XpG();return f.Njj(o.clearSearch())})),f.k0s()}if(2&e){const e=f.XpG();f.Y8G("placeholder",f.bMT(1,4,"core.courses.search"))("searchLabel",f.bMT(2,6,"core.courses.search"))("autoFocus",e.searchMode)("lengthCheck",1)}}function CoreCoursesListPage_ng_container_20_Template(e,o){if(1&e&&(f.qex(0),f.j41(1,"ion-item-divider")(2,"ion-label")(3,"h2",16),f.EFF(4),f.nI1(5,"translate"),f.k0s()()(),f.bVm()),2&e){const e=f.XpG();f.R7$(4),f.JRh(f.i5U(5,1,"core.courses.totalcoursesearchresults",f.eq3(4,_c0,e.searchTotal)))}}function CoreCoursesListPage_core_courses_course_list_item_22_Template(e,o){if(1&e&&f.nrm(0,"core-courses-course-list-item",17),2&e){const e=o.$implicit,s=f.XpG();f.Y8G("course",e)("showDownload",s.downloadEnabled)}}function CoreCoursesListPage_core_empty_box_24_Template(e,o){1&e&&(f.nrm(0,"core-empty-box",18),f.nI1(1,"translate")),2&e&&f.Y8G("message",f.bMT(1,1,"core.courses.nosearchresults"))}function CoreCoursesListPage_core_empty_box_25_Template(e,o){1&e&&(f.nrm(0,"core-empty-box",19),f.nI1(1,"translate")),2&e&&f.Y8G("message",f.bMT(1,1,"core.courses.nocourses"))}let P=(()=>{var e;class CoreCoursesListPage{constructor(){var e=this;this.downloadAllCoursesEnabled=!1,this.searchEnabled=!1,this.searchMode=!1,this.searchTotal=0,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.downloadCoursesEnabled=!1,this.courses=[],this.loaded=!1,this.coursesLoaded=0,this.canLoadMore=!1,this.loadMoreError=!1,this.loadingMessage=d.HT.instant("core.loading"),this.showOnlyEnrolled=!1,this.loadedCourses=[],this.loadCoursesPerPage=20,this.searchPage=0,this.searchText="",this.courseIds="",this.isDestroyed=!1,this.currentSiteId=n.CoreSites.getRequiredCurrentSite().getId(),this.frontpageCourseId=n.CoreSites.getRequiredCurrentSite().getSiteHomeId(),this.myCoursesObserver=l.z.on(h.CORE_COURSES_MY_COURSES_UPDATED_EVENT,(e=>{e.action==h.CoreCoursesMyCoursesUpdatedEventAction.ENROL&&this.fetchCourses()}),this.currentSiteId),this.siteUpdatedObserver=l.z.on(l.z.SITE_UPDATED,(()=>{this.searchEnabled=!i.CoreCourses.isSearchCoursesDisabledInSite(),this.downloadCourseEnabled=!i.CoreCourses.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!i.CoreCourses.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&this.downloadEnabled,!this.searchEnabled&&this.searchMode&&(this.searchMode=!1,this.fetchCourses())}),this.currentSiteId),this.downloadEnabledObserver=l.z.on(h.CORE_COURSES_DASHBOARD_DOWNLOAD_ENABLED_CHANGED_EVENT,(e=>{this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&e.enabled})),this.logView=c.j.once((0,r.A)((function*(){u.OF.logEvent(e.showOnlyEnrolled?{type:u.qr.VIEW_ITEM_LIST,ws:"core_enrol_get_users_courses",name:d.HT.instant("core.courses.mycourses"),data:{category:"course"},url:"/my/courses.php"}:{type:u.qr.VIEW_ITEM_LIST,ws:"core_course_get_courses_by_field",name:d.HT.instant("core.courses.availablecourses"),data:{category:"course"},url:"/course/index.php"})})))}ngOnInit(){this.downloadCourseEnabled=!i.CoreCourses.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!i.CoreCourses.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&i.CoreCourses.getCourseDownloadOptionsEnabled();const e=a.CoreNavigator.getRouteParam("mode")||"my";"search"==e&&(this.searchMode=!0),"my"==e&&(this.showOnlyEnrolled=!0),this.searchEnabled=!i.CoreCourses.isSearchCoursesDisabledInSite(),this.searchEnabled||(this.searchMode=!1),this.fetchCourses()}fetchCourses(){var e=this;return(0,r.A)((function*(){try{e.searchMode?e.searchText&&(yield e.searchCourses()):yield e.loadCourses(!0)}finally{e.loaded=!0}}))()}loadCourses(e=!1){var o=this;return(0,r.A)((function*(){o.loadingMessage=d.HT.instant("core.loading"),o.loadMoreError=!1;try{if(e){if(o.showOnlyEnrolled)o.loadedCourses=yield i.CoreCourses.getUserCourses();else{const e=yield i.CoreCourses.getCoursesByField();o.loadedCourses=e.filter((e=>e.id!=o.frontpageCourseId))}o.coursesLoaded=0,o.courses=[]}const s=o.loadedCourses.slice(o.coursesLoaded,o.coursesLoaded+o.loadCoursesPerPage);yield t.CoreCoursesHelper.loadCoursesExtraInfo(s,!0),o.courses=o.courses.concat(s),o.courseIds=o.courses.map((e=>e.id)).join(","),o.coursesLoaded=o.courses.length,o.canLoadMore=o.loadedCourses.length>o.courses.length,o.logView()}catch(e){o.loadMoreError=!0,!o.isDestroyed&&C.CoreAlerts.showError(e,{default:d.HT.instant("core.courses.errorloadcourses")})}}))()}refreshCourses(e){const o=[];this.searchMode||(o.push(this.showOnlyEnrolled?i.CoreCourses.invalidateUserCourses():i.CoreCourses.invalidateCoursesByField()),this.courseIds&&o.push(i.CoreCourses.invalidateCoursesByField("ids",this.courseIds))),Promise.all(o).finally((()=>{this.fetchCourses().finally((()=>{null==e||e.complete()}))}))}search(e){var o=this;return(0,r.A)((function*(){o.searchMode=!0,o.searchText=e,o.courses=[],o.searchPage=0,o.searchTotal=0,o.logSearch=c.j.once((()=>o.performLogSearch())),o.loaded=!1,yield o.searchCourses().finally((()=>{o.loaded=!0}))}))()}clearSearch(){this.searchText="",this.courses=[],this.searchPage=0,this.searchTotal=0,this.searchMode=!1,this.loaded=!1,this.fetchCourses()}performLogSearch(){var e=this;return(0,r.A)((function*(){e.searchMode&&u.OF.logEvent({type:u.qr.VIEW_ITEM_LIST,ws:"core_course_search_courses",name:d.HT.instant("core.courses.availablecourses"),data:{search:e.searchText,category:"course"},url:`/course/search.php?search=${e.searchText}`})}))()}loadMoreCourses(e){var o=this;return(0,r.A)((function*(){try{o.searchMode?yield o.searchCourses():yield o.loadCourses()}finally{e&&e()}}))()}searchCourses(){var e=this;return(0,r.A)((function*(){e.loadMoreError=!1,e.loadingMessage=d.HT.instant("core.searching");try{var o;const s=yield i.CoreCourses.search(e.searchText,e.searchPage,void 0,e.showOnlyEnrolled);e.courses=0===e.searchPage?s.courses:e.courses.concat(s.courses),e.searchTotal=s.total,e.searchPage++,e.canLoadMore=e.courses.length<e.searchTotal,null===(o=e.logSearch)||void 0===o||o.call(e)}catch(o){e.loadMoreError=!0,!e.isDestroyed&&C.CoreAlerts.showError(o,{default:d.HT.instant("core.courses.errorsearching")})}}))()}toggleEnrolled(){this.loaded=!1,this.fetchCourses()}toggleDownload(){i.CoreCourses.setCourseDownloadOptionsEnabled(this.downloadEnabled)}ngOnDestroy(){this.myCoursesObserver.off(),this.siteUpdatedObserver.off(),this.downloadEnabledObserver.off(),this.isDestroyed=!0}}return(e=CoreCoursesListPage).ɵfac=function CoreCoursesListPage_Factory(o){return new(o||e)},e.ɵcmp=f.VBU({type:e,selectors:[["page-core-courses-list"]],standalone:!0,features:[f.aNF],decls:26,vars:24,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange",4,"ngIf"],["iconAction","toggle",3,"action","toggleChange","priority","content","toggle"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["searchArea","CoreCoursesSearch",3,"placeholder","searchLabel","autoFocus","lengthCheck","onSubmit","onClear",4,"ngIf"],["placeholderType","column","placeholderHeight","108px",3,"hideUntil","message"],[1,"list-item-limited-width","core-course-list"],[3,"course","showDownload",4,"ngFor","ngForOf"],[3,"action","enabled","error"],["icon","fas-magnifying-glass","role","alert",3,"message",4,"ngIf"],["icon","fas-graduation-cap",3,"message",4,"ngIf"],["searchArea","CoreCoursesSearch",3,"onSubmit","onClear","placeholder","searchLabel","autoFocus","lengthCheck"],["role","status"],[3,"course","showDownload"],["icon","fas-magnifying-glass","role","alert",3,"message"],["icon","fas-graduation-cap",3,"message"]],template:function CoreCoursesListPage_Template(e,o){1&e&&(f.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),f.nrm(3,"ion-back-button",1),f.nI1(4,"translate"),f.k0s(),f.j41(5,"ion-title"),f.DNE(6,CoreCoursesListPage_h1_6_Template,3,3,"h1",2)(7,CoreCoursesListPage_h1_7_Template,3,3,"h1",2),f.k0s(),f.j41(8,"ion-buttons",3)(9,"core-context-menu"),f.DNE(10,CoreCoursesListPage_core_context_menu_item_10_Template,2,5,"core-context-menu-item",4),f.j41(11,"core-context-menu-item",5),f.nI1(12,"translate"),f.bIt("action",(function CoreCoursesListPage_Template_core_context_menu_item_action_11_listener(){return o.toggleEnrolled()})),f.mxI("toggleChange",(function CoreCoursesListPage_Template_core_context_menu_item_toggleChange_11_listener(e){return f.DH7(o.showOnlyEnrolled,e)||(o.showOnlyEnrolled=e),e})),f.k0s()(),f.nrm(13,"core-user-menu-button"),f.k0s()()(),f.j41(14,"ion-content")(15,"ion-refresher",6),f.bIt("ionRefresh",(function CoreCoursesListPage_Template_ion_refresher_ionRefresh_15_listener(e){return o.refreshCourses(e.target)})),f.nrm(16,"ion-refresher-content",7),f.nI1(17,"translate"),f.k0s(),f.DNE(18,CoreCoursesListPage_core_search_box_18_Template,3,8,"core-search-box",8),f.j41(19,"core-loading",9),f.DNE(20,CoreCoursesListPage_ng_container_20_Template,6,6,"ng-container",2),f.j41(21,"ion-list",10),f.DNE(22,CoreCoursesListPage_core_courses_course_list_item_22_Template,1,2,"core-courses-course-list-item",11),f.k0s(),f.j41(23,"core-infinite-loading",12),f.bIt("action",(function CoreCoursesListPage_Template_core_infinite_loading_action_23_listener(e){return o.loadMoreCourses(e)})),f.k0s(),f.DNE(24,CoreCoursesListPage_core_empty_box_24_Template,2,3,"core-empty-box",13)(25,CoreCoursesListPage_core_empty_box_25_Template,2,3,"core-empty-box",14),f.k0s()()),2&e&&(f.R7$(3),f.Y8G("text",f.bMT(4,18,"core.back")),f.R7$(3),f.Y8G("ngIf",!o.showOnlyEnrolled),f.R7$(),f.Y8G("ngIf",o.showOnlyEnrolled),f.R7$(3),f.Y8G("ngIf",o.downloadCourseEnabled||o.downloadCoursesEnabled),f.R7$(),f.Y8G("priority",900)("content",f.bMT(12,20,"core.courses.showonlyenrolled")),f.R50("toggle",o.showOnlyEnrolled),f.R7$(4),f.Y8G("disabled",!o.loaded),f.R7$(),f.FS9("pullingText",f.bMT(17,22,"core.pulltorefresh")),f.R7$(2),f.Y8G("ngIf",o.searchEnabled),f.R7$(),f.Y8G("hideUntil",o.loaded)("message",o.loadingMessage),f.R7$(),f.Y8G("ngIf",o.searchMode&&o.searchTotal>0),f.R7$(2),f.Y8G("ngForOf",o.courses),f.R7$(),f.Y8G("enabled",o.canLoadMore)("error",o.loadMoreError),f.R7$(),f.Y8G("ngIf",o.searchMode&&!o.courses.length),f.R7$(),f.Y8G("ngIf",!o.searchMode&&!o.courses.length))},dependencies:[b.n,p.Sq,p.bT,E.QW,E.W9,E.eU,E.Dg,E.he,E.nf,E.To,E.Ki,E.BC,E.ai,E.el,T.B,y.Q,w.h,I.b,L.R,x.i,M.D9,m.U,g.CoreSearchBoxComponent,_.CoreCoursesCourseListItemComponent],encapsulation:2}),CoreCoursesListPage})()}}]);