"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[91005],{91005:(e,t,s)=>{s.r(t),s.d(t,{default:()=>L});var i=s(10467),n=s(2401),o=s(83696),r=s(29492),a=s(15324),u=s(52749),d=s(79555),g=s(49882),l=s(65045),c=s(22693),m=s(66016),p=s(25572),_=s(86654),b=s(54438),h=s(60177),f=s(2910),I=s(16986),S=s(97818),A=s(64422),v=s(16658),R=s(58197),T=s(88246),M=s(73955);function AddonModAssignSubmissionListPage_ng_container_17_p_4_Template(e,t){if(1&e&&(b.j41(0,"p",14),b.EFF(1),b.k0s()),2&e){const e=b.XpG().$implicit;b.R7$(),b.JRh(e.userfullname)}}function AddonModAssignSubmissionListPage_ng_container_17_p_5_Template(e,t){if(1&e&&(b.j41(0,"p",14),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&e){const e=b.XpG().$implicit;b.R7$(),b.Lme(" ",b.bMT(2,2,"addon.mod_assign.hiddenuser"),"",e.blindid," ")}}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_1_Template(e,t){if(1&e&&(b.j41(0,"span",17),b.nrm(1,"core-format-text",18),b.k0s()),2&e){const e=b.XpG(2).$implicit,t=b.XpG();b.R7$(),b.Y8G("text",e.groupname)("contextInstanceId",t.courseId)}}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_2_Template(e,t){1&e&&(b.j41(0,"span",19),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&e&&(b.R7$(),b.SpI(" ",b.bMT(2,1,"addon.mod_assign.noteam")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_3_Template(e,t){1&e&&(b.j41(0,"span",19),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&e&&(b.R7$(),b.SpI(" ",b.bMT(2,1,"addon.mod_assign.multipleteams")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_4_Template(e,t){1&e&&(b.j41(0,"span"),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&e&&(b.R7$(),b.SpI(" ",b.bMT(2,1,"addon.mod_assign.defaultteam")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_Template(e,t){if(1&e&&(b.j41(0,"p"),b.DNE(1,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_1_Template,2,2,"span",15)(2,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_2_Template,3,3,"span",16)(3,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_3_Template,3,3,"span",16)(4,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_4_Template,3,3,"span",13),b.k0s()),2&e){const e=b.XpG().$implicit,t=b.XpG();b.R7$(),b.Y8G("ngIf",e.groupname),b.R7$(),b.Y8G("ngIf",t.assign.preventsubmissionnotingroup&&!e.groupname&&e.noGroups&&!e.blindid),b.R7$(),b.Y8G("ngIf",t.assign.preventsubmissionnotingroup&&!e.groupname&&e.manyGroups&&!e.blindid),b.R7$(),b.Y8G("ngIf",!t.assign.preventsubmissionnotingroup&&!e.groupname)}}function AddonModAssignSubmissionListPage_ng_container_17_p_7_Template(e,t){if(1&e&&(b.j41(0,"p")(1,"ion-badge",20),b.EFF(2),b.k0s()()),2&e){const e=b.XpG().$implicit;b.R7$(),b.Y8G("color",e.statusColor),b.R7$(),b.SpI(" ",e.statusTranslated," ")}}function AddonModAssignSubmissionListPage_ng_container_17_p_8_Template(e,t){if(1&e&&(b.j41(0,"p")(1,"ion-badge",20),b.EFF(2),b.nI1(3,"translate"),b.k0s()()),2&e){const e=b.XpG().$implicit;b.R7$(),b.Y8G("color",e.gradingColor),b.R7$(),b.SpI(" ",b.bMT(3,2,e.gradingStatusTranslationId)," ")}}function AddonModAssignSubmissionListPage_ng_container_17_Template(e,t){if(1&e){const e=b.RV6();b.qex(0),b.j41(1,"ion-item",10),b.bIt("click",(function AddonModAssignSubmissionListPage_ng_container_17_Template_ion_item_click_1_listener(){const t=b.eBV(e).$implicit,s=b.XpG();return b.Njj(s.submissions.select(t))})),b.nrm(2,"core-user-avatar",11),b.j41(3,"ion-label"),b.DNE(4,AddonModAssignSubmissionListPage_ng_container_17_p_4_Template,2,1,"p",12)(5,AddonModAssignSubmissionListPage_ng_container_17_p_5_Template,3,4,"p",12)(6,AddonModAssignSubmissionListPage_ng_container_17_p_6_Template,5,4,"p",13)(7,AddonModAssignSubmissionListPage_ng_container_17_p_7_Template,3,2,"p",13)(8,AddonModAssignSubmissionListPage_ng_container_17_p_8_Template,4,4,"p",13),b.k0s()(),b.bVm()}if(2&e){const e=t.$implicit,s=b.XpG();b.R7$(),b.Y8G("detail",!0),b.BMQ("aria-current",s.submissions.getItemAriaCurrent(e)),b.R7$(),b.Y8G("user",e)("linkProfile",!1),b.R7$(2),b.Y8G("ngIf",e.userfullname),b.R7$(),b.Y8G("ngIf",!e.userfullname),b.R7$(),b.Y8G("ngIf",s.assign&&s.assign.teamsubmission),b.R7$(),b.Y8G("ngIf",e.statusTranslated),b.R7$(),b.Y8G("ngIf",e.gradingStatusTranslationId)}}function AddonModAssignSubmissionListPage_core_empty_box_18_Template(e,t){1&e&&(b.nrm(0,"core-empty-box",21),b.nI1(1,"translate")),2&e&&b.Y8G("message",b.bMT(1,1,"addon.mod_assign.submissionstatus_"))}let L=(()=>{var e;class AddonModAssignSubmissionListPage{constructor(){this.title="",this.gradedObserver=g.z.on(m.$P,(e=>{var t;this.submissions.loaded&&this.submissions.getSource().assign&&e.assignmentId==(null===(t=this.submissions.getSource().assign)||void 0===t?void 0:t.id)&&e.userId==u.CoreSites.getCurrentSiteUserId()&&this.refreshAllData(!0)}),u.CoreSites.getCurrentSiteId());this.syncObserver=g.z.onMultiple([m.zi,m.Cu],(e=>{!this.submissions.loaded||"context"in e&&"submission-list"==e.context||this.refreshAllData(!1)}),u.CoreSites.getCurrentSiteId());try{const e=a.CoreNavigator.getRequiredRouteNumberParam("cmId"),t=a.CoreNavigator.getRequiredRouteNumberParam("courseId"),s=a.CoreNavigator.getRouteNumberParam("groupId")||0,i=a.CoreNavigator.getRouteParam("status"),r=o.u.getOrCreateSource(l.W,[t,e,i]);r.groupId=s,this.sourceUnsubscribe=r.addListener({onItemsUpdated:()=>{var e;this.title=(null===(e=this.submissions.getSource().assign)||void 0===e?void 0:e.name)||this.title}}),this.submissions=new n.R(r,AddonModAssignSubmissionListPage)}catch(e){return p.CoreAlerts.showError(e),a.CoreNavigator.back(),void 0}}get assign(){return this.submissions.getSource().assign}get groupInfo(){return this.submissions.getSource().groupInfo}get moduleId(){return this.submissions.getSource().MODULE_ID}get courseId(){return this.submissions.getSource().COURSE_ID}get groupId(){return this.submissions.getSource().groupId}set groupId(e){this.submissions.getSource().groupId=e}ngAfterViewInit(){const e=this.submissions.getSource().SELECTED_STATUS;this.title=d.HT.instant(e?"needgrading"===e?"addon.mod_assign.numberofsubmissionsneedgrading":`addon.mod_assign.submissionstatus_${e}`:"addon.mod_assign.numberofparticipants"),this.fetchAssignment(!0).finally((()=>{this.submissions.start(this.splitView)}))}fetchAssignment(e=!1){var t=this;return(0,i.A)((function*(){try{if(yield t.submissions.getSource().loadAssignment(e),!t.assign)return;c.OF.logEvent({type:c.qr.VIEW_ITEM_LIST,ws:"mod_assign_get_submissions",name:d.HT.instant("addon.mod_assign.subpagetitle",{contextname:t.assign.name,subpage:d.HT.instant("addon.mod_assign.grading")}),data:{assignid:t.assign.id,category:m.KZ},url:`/mod/assign/view.php?id=${t.assign.cmid}&action=grading`})}catch(e){p.CoreAlerts.showError(e,{default:"Error getting assigment data."})}}))()}refreshAllData(e){var t=this;return(0,i.A)((function*(){try{yield t.submissions.getSource().invalidateCache()}finally{t.fetchAssignment(e)}}))()}refreshList(e){this.refreshAllData(!0).finally((()=>{null==e||e.complete()}))}reloadSubmissions(){var e=this;return(0,i.A)((function*(){yield e.submissions.reload()}))()}ngOnDestroy(){var e,t;null===(e=this.gradedObserver)||void 0===e||e.off(),null===(t=this.syncObserver)||void 0===t||t.off(),this.submissions.destroy(),this.sourceUnsubscribe&&this.sourceUnsubscribe()}}return(e=AddonModAssignSubmissionListPage).ɵfac=function AddonModAssignSubmissionListPage_Factory(t){return new(t||e)},e.ɵcmp=b.VBU({type:e,selectors:[["page-addon-mod-assign-submission-list"]],viewQuery:function AddonModAssignSubmissionListPage_Query(e,t){if(1&e&&b.GBs(r.M,5),2&e){let e;b.mGM(e=b.lsd())&&(t.splitView=e.first)}},standalone:!0,features:[b.aNF],decls:19,vars:16,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[3,"selectedChange","groupInfo","selected","courseId"],[4,"ngFor","ngForOf"],["icon","fas-file-signature",3,"message",4,"ngIf"],["button","",1,"ion-text-wrap",3,"click","detail"],["slot","start",3,"user","linkProfile"],["class","item-heading",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["class","core-groupname",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"core-groupname"],["contextLevel","course",3,"text","contextInstanceId"],[1,"text-danger"],[1,"ion-text-start","ion-text-wrap",3,"color"],["icon","fas-file-signature",3,"message"]],template:function AddonModAssignSubmissionListPage_Template(e,t){1&e&&(b.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),b.nrm(3,"ion-back-button",1),b.nI1(4,"translate"),b.k0s(),b.j41(5,"ion-title")(6,"h1"),b.nrm(7,"core-format-text",2),b.k0s()(),b.nrm(8,"ion-buttons",3),b.k0s()(),b.j41(9,"ion-content")(10,"core-split-view")(11,"ion-refresher",4),b.bIt("ionRefresh",(function AddonModAssignSubmissionListPage_Template_ion_refresher_ionRefresh_11_listener(e){return t.refreshList(e.target)})),b.nrm(12,"ion-refresher-content",5),b.nI1(13,"translate"),b.k0s(),b.j41(14,"core-loading",6)(15,"ion-list")(16,"core-group-selector",7),b.mxI("selectedChange",(function AddonModAssignSubmissionListPage_Template_core_group_selector_selectedChange_16_listener(e){return b.DH7(t.groupId,e)||(t.groupId=e),e})),b.bIt("selectedChange",(function AddonModAssignSubmissionListPage_Template_core_group_selector_selectedChange_16_listener(){return t.reloadSubmissions()})),b.k0s(),b.DNE(17,AddonModAssignSubmissionListPage_ng_container_17_Template,9,9,"ng-container",8),b.k0s(),b.DNE(18,AddonModAssignSubmissionListPage_core_empty_box_18_Template,2,3,"core-empty-box",9),b.k0s()()()),2&e&&(b.R7$(3),b.Y8G("text",b.bMT(4,12,"core.back")),b.R7$(4),b.Y8G("text",t.title)("contextInstanceId",t.moduleId)("courseId",t.courseId),b.R7$(4),b.Y8G("disabled",!t.submissions.loaded),b.R7$(),b.FS9("pullingText",b.bMT(13,14,"core.pulltorefresh")),b.R7$(2),b.Y8G("hideUntil",t.submissions.loaded),b.R7$(2),b.Y8G("groupInfo",t.groupInfo),b.R50("selected",t.groupId),b.Y8G("courseId",t.courseId),b.R7$(),b.Y8G("ngForOf",t.submissions.items),b.R7$(),b.Y8G("ngIf",!t.submissions||t.submissions.empty))},dependencies:[_.n,h.Sq,h.bT,f.In,f.QW,f.W9,f.eU,f.uz,f.he,f.nf,f.To,f.Ki,f.BC,f.ai,f.el,I.h,S.F,A.R,r.M,v.T,R.B,T.i,M.D9],encapsulation:2}),AddonModAssignSubmissionListPage})()},2401:(e,t,s)=>{s.d(t,{R:()=>CoreListItemsManager});var i=s(10467),n=s(21182),o=s(15324),r=s(93417),a=s(81690),u=s(95990),d=s(82907),g=s(24742),l=s(55554);class CoreListItemsManager extends u.u{constructor(e,t){super(e);const s=a.j.debounce((()=>this.scrollToCurrentElement()),300);this.pageRouteLocator=t,this.addListener({onSelectedItemUpdated:s}),this.finishSuccessfulFetch=g.j.once((()=>l.g.ignoreErrors(this.logActivity())))}get items(){return this.getSource().getItems()||[]}get loaded(){return null!==this.itemsMap}get completed(){return this.getSource().isCompleted()}get empty(){const e=this.getSource().getItems();return null===e||0===e.length}start(e){var t=this;return(0,i.A)((function*(){e&&t.watchSplitViewOutlet(e),t.updateSelectedItem()}))()}destroy(){var e;super.destroy(),null===(e=this.splitViewOutletSubscription)||void 0===e||e.unsubscribe()}watchSplitViewOutlet(e){var t;this.splitView=e,this.splitViewOutletSubscription=e.outletRouteObservable.subscribe((e=>this.updateSelectedItem(this.getPageRouteFromSplitViewOutlet(e)))),this.updateSelectedItem(null!==(t=this.getPageRouteFromSplitViewOutlet(e.outletRoute))&&void 0!==t?t:null)}isSelected(e){return this.selectedItem===e}getItemAriaCurrent(e){return this.isSelected(e)?"page":"false"}select(e){var t=this;return(0,i.A)((function*(){if(!e)return yield t.navigateToIndex({reset:t.resetNavigation()}),void 0;yield t.navigateToItem(e,{reset:t.resetNavigation()})}))()}reset(){this.getSource().reset()}reload(){var e=this;return(0,i.A)((function*(){yield e.getSource().reload(),e.finishSuccessfulFetch()}))()}load(){var e=this;return(0,i.A)((function*(){yield e.getSource().load(),e.finishSuccessfulFetch()}))()}logActivity(){return(0,i.A)((function*(){}))()}resetNavigation(){var e;return!!r.CoreScreen.isTablet&&!(!this.splitView||null!==(e=this.splitView)&&void 0!==e&&e.isNested)}updateSelectedItem(e=null){super.updateSelectedItem(e);this.select(r.CoreScreen.isTablet&&null===this.selectedItem&&this.splitView&&!this.splitView.isNested?this.getDefaultItem():this.selectedItem)}scrollToCurrentElement(){var e=this;return(0,i.A)((function*(){var t,s,i;if(r.CoreScreen.isMobile)return;const n=(null!==(t=null===(s=e.splitView)||void 0===s?void 0:s.nativeElement)&&void 0!==t?t:document).querySelector('[aria-current="page"]');if(!n)return;d.y.isElementInViewport(n,1,null===(i=e.splitView)||void 0===i?void 0:i.nativeElement)||n.scrollIntoView({behavior:"smooth"})}))()}getDefaultItem(){return this.items[0]||null}getCurrentPageRoute(){return this.pageRouteLocator instanceof n.nX?o.CoreNavigator.isRouteActive(this.pageRouteLocator)?this.pageRouteLocator:null:o.CoreNavigator.getCurrentRoute({pageComponent:this.pageRouteLocator})}getSelectedItemPathFromRoute(e){const t=[];for(;e.firstChild;)t.push(...o.CoreNavigator.getRouteUrl(e=e.firstChild));return t.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}getPageRouteFromSplitViewOutlet(e){const t=this.buildRouteMatcher();for(;e&&!t(e);)e=e.parent;return e}buildRouteMatcher(){if(this.pageRouteLocator instanceof n.nX){const e=o.CoreNavigator.getRouteFullPath(this.pageRouteLocator);return t=>o.CoreNavigator.getRouteFullPath(t)===e}return e=>e.component===this.pageRouteLocator}}}}]);