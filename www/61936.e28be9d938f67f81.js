"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[61936],{61936:(e,o,n)=>{n.r(o),n.d(o,{AddonBlockMyOverviewComponent:()=>E});var t=n(10467),i=n(49882),r=n(24742),s=n(52749),l=n(66110),a=n(83219),d=n(94247),c=n(78765),_=n(3484),u=n(55554),p=n(75383),v=n(12808),f=n(15324),m=n(58530),C=n(74431),g=n(86654),h=n(16449),w=n(9538),b=n(25572),y=n(79555),k=n(54438),M=n(60177),O=n(89417),A=n(2910),I=n(16986),T=n(64422),B=n(7570),S=n(86198),R=n(43570),F=n(73955);function AddonBlockMyOverviewComponent_div_6_ion_button_1_Template(e,o){if(1&e){const e=k.RV6();k.j41(0,"ion-button",12),k.nI1(1,"translate"),k.bIt("click",(function AddonBlockMyOverviewComponent_div_6_ion_button_1_Template_ion_button_click_0_listener(){k.eBV(e);const o=k.XpG(2);return k.Njj(o.prefetchCourses())})),k.nrm(2,"ion-icon",13),k.k0s()}if(2&e){const e=k.XpG(2);k.Y8G("ariaLabel",k.bMT(1,2,e.prefetchCoursesData.statusTranslatable)),k.R7$(2),k.Y8G("name",e.prefetchCoursesData.icon)}}function AddonBlockMyOverviewComponent_div_6_ion_badge_2_Template(e,o){if(1&e&&(k.j41(0,"ion-badge",14),k.EFF(1),k.k0s()),2&e){const e=k.XpG(2);k.BMQ("aria-valuemax",e.prefetchCoursesData.total)("aria-valuenow",e.prefetchCoursesData.count)("aria-valuetext",e.prefetchCoursesData.badgeA11yText),k.R7$(),k.SpI(" ",e.prefetchCoursesData.badge," ")}}function AddonBlockMyOverviewComponent_div_6_ion_spinner_3_Template(e,o){1&e&&(k.nrm(0,"ion-spinner"),k.nI1(1,"translate")),2&e&&k.BMQ("aria-label",k.bMT(1,1,"core.loading"))}function AddonBlockMyOverviewComponent_div_6_Template(e,o){if(1&e&&(k.j41(0,"div",8),k.DNE(1,AddonBlockMyOverviewComponent_div_6_ion_button_1_Template,3,4,"ion-button",9)(2,AddonBlockMyOverviewComponent_div_6_ion_badge_2_Template,2,4,"ion-badge",10)(3,AddonBlockMyOverviewComponent_div_6_ion_spinner_3_Template,2,3,"ion-spinner",11),k.k0s()),2&e){const e=k.XpG();k.R7$(),k.Y8G("ngIf",!e.prefetchCoursesData.loading),k.R7$(),k.Y8G("ngIf",e.prefetchCoursesData.badge),k.R7$(),k.Y8G("ngIf",e.prefetchCoursesData.loading)}}function AddonBlockMyOverviewComponent_ion_row_8_Template(e,o){if(1&e){const e=k.RV6();k.j41(0,"ion-row",15)(1,"ion-col")(2,"ion-searchbar",16),k.nI1(3,"translate"),k.mxI("ngModelChange",(function AddonBlockMyOverviewComponent_ion_row_8_Template_ion_searchbar_ngModelChange_2_listener(o){k.eBV(e);const n=k.XpG();return k.DH7(n.textFilter,o)||(n.textFilter=o),k.Njj(o)})),k.bIt("ionInput",(function AddonBlockMyOverviewComponent_ion_row_8_Template_ion_searchbar_ionInput_2_listener(o){k.eBV(e);const n=k.XpG();return k.Njj(n.filterTextChanged(o.target))}))("ionCancel",(function AddonBlockMyOverviewComponent_ion_row_8_Template_ion_searchbar_ionCancel_2_listener(o){k.eBV(e);const n=k.XpG();return k.Njj(n.filterTextChanged(o.target))})),k.k0s()()()}if(2&e){const e=k.XpG();k.R7$(2),k.R50("ngModel",e.textFilter),k.Y8G("placeholder",k.bMT(3,2,"core.courses.filtermycourses"))}}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_3_Template(e,o){1&e&&(k.j41(0,"ion-select-option",29),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e&&(k.R7$(),k.SpI(" ",k.bMT(2,1,"addon.block_myoverview.allincludinghidden")," "))}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_4_Template(e,o){1&e&&(k.j41(0,"ion-select-option",30),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e&&(k.R7$(),k.SpI(" ",k.bMT(2,1,"addon.block_myoverview.all")," "))}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_5_Template(e,o){if(1&e&&(k.j41(0,"ion-select-option",31),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e){const e=k.XpG(3);k.AVh("core-select-option-border-bottom",!e.filters.show.past&&!e.filters.show.future),k.R7$(),k.SpI(" ",k.bMT(2,3,"addon.block_myoverview.inprogress")," ")}}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_6_Template(e,o){if(1&e&&(k.j41(0,"ion-select-option",32),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e){const e=k.XpG(3);k.AVh("core-select-option-border-bottom",!e.filters.show.past),k.R7$(),k.SpI(" ",k.bMT(2,3,"addon.block_myoverview.future")," ")}}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_7_Template(e,o){1&e&&(k.j41(0,"ion-select-option",33),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e&&(k.R7$(),k.SpI(" ",k.bMT(2,1,"addon.block_myoverview.past")," "))}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ng_container_8_ng_container_1_Template(e,o){if(1&e&&(k.qex(0),k.j41(1,"ion-select-option",35),k.EFF(2),k.k0s(),k.bVm()),2&e){const e=o.$implicit,n=o.index,t=o.last;k.R7$(),k.AVh("core-select-option-border-bottom",t),k.Mz_("value","custom-",n,""),k.R7$(),k.SpI(" ",e.name,"")}}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ng_container_8_Template(e,o){if(1&e&&(k.qex(0),k.DNE(1,AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ng_container_8_ng_container_1_Template,3,5,"ng-container",34),k.bVm()),2&e){const e=k.XpG(3);k.R7$(),k.Y8G("ngForOf",e.filters.customFilters)}}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_9_Template(e,o){1&e&&(k.j41(0,"ion-select-option",36),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e&&(k.R7$(),k.SpI(" ",k.bMT(2,1,"addon.block_myoverview.favourites")," "))}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_10_Template(e,o){1&e&&(k.j41(0,"ion-select-option",37),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e&&(k.R7$(),k.SpI(" ",k.bMT(2,1,"addon.block_myoverview.hiddencourses")," "))}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_Template(e,o){if(1&e){const e=k.RV6();k.j41(0,"ion-col",20)(1,"core-combobox",21),k.nI1(2,"translate"),k.bIt("onChange",(function AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_Template_core_combobox_onChange_1_listener(o){k.eBV(e);const n=k.XpG(2);return k.Njj(n.filterOptionsChanged(o))})),k.DNE(3,AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_3_Template,3,3,"ion-select-option",22)(4,AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_4_Template,3,3,"ion-select-option",23)(5,AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_5_Template,3,5,"ion-select-option",24)(6,AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_6_Template,3,5,"ion-select-option",25)(7,AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_7_Template,3,3,"ion-select-option",26)(8,AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ng_container_8_Template,2,1,"ng-container",11)(9,AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_9_Template,3,3,"ion-select-option",27)(10,AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_ion_select_option_10_Template,3,3,"ion-select-option",28),k.k0s()()}if(2&e){const e=k.XpG(2);k.R7$(),k.Y8G("label",k.bMT(2,10,"core.courses.filtermycourses"))("selection",e.filters.timeFilterSelected),k.R7$(2),k.Y8G("ngIf",e.filters.show.allincludinghidden),k.R7$(),k.Y8G("ngIf",e.filters.show.all),k.R7$(),k.Y8G("ngIf",e.filters.show.inprogress),k.R7$(),k.Y8G("ngIf",e.filters.show.future),k.R7$(),k.Y8G("ngIf",e.filters.show.past),k.R7$(),k.Y8G("ngIf",e.filters.show.custom),k.R7$(),k.Y8G("ngIf",e.filters.show.favourite),k.R7$(),k.Y8G("ngIf",e.filters.show.hidden)}}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_5_ion_select_option_6_Template(e,o){1&e&&(k.j41(0,"ion-select-option",42),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e&&(k.R7$(),k.SpI(" ",k.bMT(2,1,"addon.block_myoverview.shortname")," "))}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_5_Template(e,o){if(1&e){const e=k.RV6();k.j41(0,"ion-col",20)(1,"core-combobox",38),k.nI1(2,"translate"),k.bIt("onChange",(function AddonBlockMyOverviewComponent_ion_row_9_ion_col_5_Template_core_combobox_onChange_1_listener(o){k.eBV(e);const n=k.XpG(2);return k.Njj(n.sortCourses(o))})),k.j41(3,"ion-select-option",39),k.EFF(4),k.nI1(5,"translate"),k.k0s(),k.DNE(6,AddonBlockMyOverviewComponent_ion_row_9_ion_col_5_ion_select_option_6_Template,3,3,"ion-select-option",40),k.j41(7,"ion-select-option",41),k.EFF(8),k.nI1(9,"translate"),k.k0s()()()}if(2&e){const e=k.XpG(2);k.R7$(),k.Y8G("label",k.bMT(2,5,"core.sortby"))("selection",e.sort.selected),k.R7$(3),k.SpI(" ",k.bMT(5,7,"addon.block_myoverview.title")," "),k.R7$(2),k.Y8G("ngIf",e.sort.shortnameEnabled),k.R7$(2),k.SpI(" ",k.bMT(9,9,"addon.block_myoverview.lastaccessed")," ")}}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_6_ion_button_1_Template(e,o){if(1&e){const e=k.RV6();k.j41(0,"ion-button",44),k.nI1(1,"translate"),k.bIt("click",(function AddonBlockMyOverviewComponent_ion_row_9_ion_col_6_ion_button_1_Template_ion_button_click_0_listener(){k.eBV(e);const o=k.XpG(3);return k.Njj(o.toggleLayout("list"))})),k.nrm(2,"ion-icon",45),k.k0s()}2&e&&k.Y8G("ariaLabel",k.bMT(1,1,"addon.block_myoverview.aria:list"))}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_6_ion_button_2_Template(e,o){if(1&e){const e=k.RV6();k.j41(0,"ion-button",44),k.nI1(1,"translate"),k.bIt("click",(function AddonBlockMyOverviewComponent_ion_row_9_ion_col_6_ion_button_2_Template_ion_button_click_0_listener(){k.eBV(e);const o=k.XpG(3);return k.Njj(o.toggleLayout("card"))})),k.nrm(2,"ion-icon",46),k.k0s()}2&e&&k.Y8G("ariaLabel",k.bMT(1,1,"addon.block_myoverview.aria:card"))}function AddonBlockMyOverviewComponent_ion_row_9_ion_col_6_Template(e,o){if(1&e&&(k.j41(0,"ion-col",20),k.DNE(1,AddonBlockMyOverviewComponent_ion_row_9_ion_col_6_ion_button_1_Template,3,3,"ion-button",43)(2,AddonBlockMyOverviewComponent_ion_row_9_ion_col_6_ion_button_2_Template,3,3,"ion-button",43),k.k0s()),2&e){const e=k.XpG(2);k.R7$(),k.Y8G("ngIf","card"===e.layout),k.R7$(),k.Y8G("ngIf","list"===e.layout)}}function AddonBlockMyOverviewComponent_ion_row_9_Template(e,o){if(1&e){const e=k.RV6();k.j41(0,"ion-row",17),k.DNE(1,AddonBlockMyOverviewComponent_ion_row_9_ion_col_1_Template,11,12,"ion-col",18),k.j41(2,"ion-col")(3,"ion-searchbar",19),k.nI1(4,"translate"),k.mxI("ngModelChange",(function AddonBlockMyOverviewComponent_ion_row_9_Template_ion_searchbar_ngModelChange_3_listener(o){k.eBV(e);const n=k.XpG();return k.DH7(n.textFilter,o)||(n.textFilter=o),k.Njj(o)})),k.bIt("ionInput",(function AddonBlockMyOverviewComponent_ion_row_9_Template_ion_searchbar_ionInput_3_listener(o){k.eBV(e);const n=k.XpG();return k.Njj(n.filterTextChanged(o.target))}))("ionCancel",(function AddonBlockMyOverviewComponent_ion_row_9_Template_ion_searchbar_ionCancel_3_listener(o){k.eBV(e);const n=k.XpG();return k.Njj(n.filterTextChanged(o.target))})),k.k0s()(),k.DNE(5,AddonBlockMyOverviewComponent_ion_row_9_ion_col_5_Template,10,11,"ion-col",18)(6,AddonBlockMyOverviewComponent_ion_row_9_ion_col_6_Template,3,2,"ion-col",18),k.k0s()}if(2&e){const e=k.XpG();k.R7$(),k.Y8G("ngIf",e.filters.enabled),k.R7$(2),k.R50("ngModel",e.textFilter),k.Y8G("placeholder",k.bMT(4,5,"core.courses.filtermycourses")),k.R7$(2),k.Y8G("ngIf",e.sort.enabled),k.R7$(),k.Y8G("ngIf",e.isLayoutSwitcherAvailable)}}function AddonBlockMyOverviewComponent_core_empty_box_10_h3_1_Template(e,o){1&e&&(k.j41(0,"h3",49),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e&&(k.R7$(),k.SpI(" ",k.bMT(2,1,"addon.block_myoverview.noresult")," "))}function AddonBlockMyOverviewComponent_core_empty_box_10_h3_2_Template(e,o){1&e&&(k.j41(0,"h3",49),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e&&(k.R7$(),k.SpI(" ",k.bMT(2,1,"addon.block_myoverview.nocoursesenrolled")," "))}function AddonBlockMyOverviewComponent_core_empty_box_10_ng_container_3_p_1_Template(e,o){1&e&&(k.j41(0,"p",53),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e&&(k.R7$(),k.SpI(" ",k.bMT(2,1,"addon.block_myoverview.noresultdescription")," "))}function AddonBlockMyOverviewComponent_core_empty_box_10_ng_container_3_p_2_Template(e,o){1&e&&(k.j41(0,"p",53),k.EFF(1),k.nI1(2,"translate"),k.k0s()),2&e&&(k.R7$(),k.SpI(" ",k.bMT(2,1,"addon.block_myoverview.nocoursesenrolleddescription")," "))}function AddonBlockMyOverviewComponent_core_empty_box_10_ng_container_3_Template(e,o){if(1&e){const e=k.RV6();k.qex(0),k.DNE(1,AddonBlockMyOverviewComponent_core_empty_box_10_ng_container_3_p_1_Template,3,3,"p",50)(2,AddonBlockMyOverviewComponent_core_empty_box_10_ng_container_3_p_2_Template,3,3,"p",50),k.j41(3,"ion-button",51),k.bIt("click",(function AddonBlockMyOverviewComponent_core_empty_box_10_ng_container_3_Template_ion_button_click_3_listener(){k.eBV(e);const o=k.XpG(2);return k.Njj(o.openSearch())})),k.nrm(4,"ion-icon",52),k.EFF(5),k.nI1(6,"translate"),k.k0s(),k.bVm()}if(2&e){const e=k.XpG(2);k.R7$(),k.Y8G("ngIf",e.hasCourses),k.R7$(),k.Y8G("ngIf",!e.hasCourses),k.R7$(3),k.SpI(" ",k.bMT(6,3,"addon.block_myoverview.browseallcourses")," ")}}function AddonBlockMyOverviewComponent_core_empty_box_10_Template(e,o){if(1&e&&(k.j41(0,"core-empty-box",47),k.DNE(1,AddonBlockMyOverviewComponent_core_empty_box_10_h3_1_Template,3,3,"h3",48)(2,AddonBlockMyOverviewComponent_core_empty_box_10_h3_2_Template,3,3,"h3",48)(3,AddonBlockMyOverviewComponent_core_empty_box_10_ng_container_3_Template,7,5,"ng-container",11),k.k0s()),2&e){const e=k.XpG();k.R7$(),k.Y8G("ngIf",e.hasCourses),k.R7$(),k.Y8G("ngIf",!e.hasCourses),k.R7$(),k.Y8G("ngIf",e.searchEnabled)}}function AddonBlockMyOverviewComponent_div_11_ion_col_3_Template(e,o){if(1&e&&(k.j41(0,"ion-col",57),k.nrm(1,"core-courses-course-list-item",58),k.k0s()),2&e){const e=o.$implicit,n=k.XpG(2);k.BMQ("data-course-id",e.id),k.R7$(),k.Y8G("course",e)("showDownload",n.downloadCourseEnabled)("layout",n.layout)}}function AddonBlockMyOverviewComponent_div_11_Template(e,o){if(1&e&&(k.j41(0,"div",54)(1,"ion-grid",55)(2,"ion-row",55),k.DNE(3,AddonBlockMyOverviewComponent_div_11_ion_col_3_Template,2,4,"ion-col",56),k.k0s()()()),2&e){const e=k.XpG();k.R7$(),k.AVh("core-no-grid","card"!==e.layout)("list-item-limited-width","card"!==e.layout),k.R7$(2),k.Y8G("ngForOf",e.filteredCourses)}}const x=["all","inprogress","future","past","favourite","allincludinghidden","hidden","custom"];let E=(()=>{var e;class AddonBlockMyOverviewComponent extends _.d{constructor(e){super("AddonBlockMyOverviewComponent"),this.filteredCourses=[],this.prefetchCoursesData={icon:"",statusTranslatable:"core.loading",status:C.DownloadStatus.DOWNLOADABLE_NOT_DOWNLOADED,loading:!0},this.downloadCourseEnabled=!1,this.downloadCoursesEnabled=!1,this.filters={enabled:!1,show:{allincludinghidden:!0,all:!0,past:!0,inprogress:!0,future:!0,favourite:!0,hidden:!0,custom:!1},timeFilterSelected:"inprogress",customFilters:[]},this.isLayoutSwitcherAvailable=!1,this.layout="list",this.sort={shortnameEnabled:!1,selected:"fullname",enabled:!1},this.textFilter="",this.hasCourses=!1,this.searchEnabled=!1,this.allCourses=[],this.prefetchIconsInitialized=!1,this.isDirty=!1,this.isDestroyed=!1,this.fetchContentDefaultError="Error getting my overview data.",this.gradePeriodAfter=0,this.gradePeriodBefore=0,this.loadsManager=null!=e?e:new m.o}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,e=this;return(0,t.A)((function*(){e.firstLoadWatcher=e.loadsManager.startComponentLoad(e),e.downloadCourseEnabled=!l.CoreCourses.isDownloadCourseDisabledInSite(),e.downloadCoursesEnabled=!l.CoreCourses.isDownloadCoursesDisabledInSite(),e.searchEnabled=!l.CoreCourses.isSearchCoursesDisabledInSite(),e.updateSiteObserver=i.z.on(i.z.SITE_UPDATED,(()=>{e.downloadCourseEnabled=!l.CoreCourses.isDownloadCourseDisabledInSite(),e.downloadCoursesEnabled=!l.CoreCourses.isDownloadCoursesDisabledInSite(),e.searchEnabled=!l.CoreCourses.isSearchCoursesDisabledInSite()}),s.CoreSites.getCurrentSiteId()),e.coursesObserver=i.z.on(w.CORE_COURSES_MY_COURSES_UPDATED_EVENT,(o=>{e.refreshCourseList(o)}),s.CoreSites.getCurrentSiteId()),e.currentSite=s.CoreSites.getRequiredCurrentSite();const o=[];o.push(e.currentSite.getLocalSiteConfig("AddonBlockMyOverviewSort",e.sort.selected).then((o=>{e.sort.selected=o}))),o.push(e.currentSite.getLocalSiteConfig("AddonBlockMyOverviewLayout",e.layout).then((o=>{e.layout=o}))),o.push(e.currentSite.getLocalSiteConfig("AddonBlockMyOverviewFilter",e.filters.timeFilterSelected).then((o=>{e.filters.timeFilterSelected=o}))),Promise.all(o).finally((()=>{_superprop_getNgOnInit().call(e)}))}))()}ngOnChanges(e){super.ngOnChanges(e),this.loaded&&e.block&&this.reloadContent()}doRefresh(e,o){var n=this;return(0,t.A)((function*(){if(n.loaded)return n.refreshContent().finally((()=>{null==e||e.complete(),o&&o()}))}))()}invalidateContent(){var e=this;return(0,t.A)((function*(){e.isDirty=!0;const o=e.allCourses.map((e=>e.id));yield e.invalidateCourses(o)}))()}invalidateCourseList(){return l.CoreCourses.invalidateUserCourses()}invalidateCourses(e){var o=this;return(0,t.A)((function*(){const n=[];n.push(o.invalidateCourseList().finally((()=>u.g.allPromises(e.map((e=>v.AddonCourseCompletion.invalidateCourseCompletion(e))))))),n.push(1==e.length?c.CoreCourseOptionsDelegate.clearAndInvalidateCoursesOptions(e[0]):c.CoreCourseOptionsDelegate.clearAndInvalidateCoursesOptions()),e.length>0&&n.push(l.CoreCourses.invalidateCoursesByField("ids",e.join(","))),yield u.g.allPromises(n).finally((()=>{o.prefetchIconsInitialized=!1}))}))()}fetchContent(){var e=this;return(0,t.A)((function*(){var o,n;const t=null!==(o=e.firstLoadWatcher)&&void 0!==o?o:e.loadsManager.startComponentLoad(e);e.firstLoadWatcher=void 0,yield Promise.all([e.loadAllCourses(t),e.loadGracePeriod(t)]),e.loadSort(),e.loadLayouts(null===(n=e.block.configsRecord)||void 0===n||null===(n=n.layouts)||void 0===n?void 0:n.value.split(",")),yield e.loadFilters(e.block.configsRecord,t),e.isDirty=!1}))()}loadAllCourses(e){var o=this;return(0,t.A)((function*(){var n;const t="1"===(null===(n=o.block.configsRecord)||void 0===n||null===(n=n.displaycategories)||void 0===n?void 0:n.value);o.allCourses=yield e.watchRequest(a.CoreCoursesHelper.getUserCoursesWithOptionsObservable({sort:o.sort.selected,loadCategoryNames:t,readingStrategy:o.isDirty?3:e.getReadingStrategy()}),((e,n)=>o.coursesHaveMeaningfulChanges(e,n))),o.hasCourses=o.allCourses.length>0}))()}loadGracePeriod(e){var o=this;return(0,t.A)((function*(){o.hasCourses=o.allCourses.length>0;try{const n=yield e.watchRequest(o.currentSite.getConfigObservable(void 0,o.isDirty?3:e.getReadingStrategy()));o.gradePeriodAfter=parseInt(n.coursegraceperiodafter,10),o.gradePeriodBefore=parseInt(n.coursegraceperiodbefore,10)}catch{o.gradePeriodAfter=0,o.gradePeriodBefore=0}}))()}loadSort(){const e=this.allCourses[0];this.sort.shortnameEnabled=!(null==e||!e.displayname||null==e||!e.shortname||(null==e?void 0:e.fullname)==(null==e?void 0:e.displayname)),this.sort.shortnameEnabled||"shortname"!==this.sort.selected||this.saveSort("fullname"),this.sort.enabled=void 0!==(null==e?void 0:e.lastaccess)}loadFilters(e,o){var n=this;return(0,t.A)((function*(){var t,i,r,s,l,a,d,c,_,u,v,f;if(!n.hasCourses)return;n.textFilter="";const m=n.allCourses[0];n.filters.show.hidden="1"==(null==e||null===(t=e.displaygroupingallincludinghidden)||void 0===t?void 0:t.value)||void 0!==m.hidden&&(!e||"1"==(null===(i=e.displaygroupinghidden)||void 0===i?void 0:i.value)),n.filters.show.allincludinghidden=!e||"1"==(null===(r=e.displaygroupingallincludinghidden)||void 0===r?void 0:r.value),n.filters.show.all=!e||"1"==(null===(s=e.displaygroupingall)||void 0===s?void 0:s.value),n.filters.show.inprogress=!e||"1"==(null===(l=e.displaygroupinginprogress)||void 0===l?void 0:l.value),n.filters.show.past=!e||"1"==(null===(a=e.displaygroupingpast)||void 0===a?void 0:a.value),n.filters.show.future=!e||"1"==(null===(d=e.displaygroupingfuture)||void 0===d?void 0:d.value),n.filters.show.favourite=void 0!==m.isfavourite&&(!e||"1"==(null===(c=e.displaygroupingstarred)||void 0===c?void 0:c.value)||"1"==(null===(_=e.displaygroupingfavourites)||void 0===_?void 0:_.value)),n.filters.show.custom="1"==(null==e||null===(u=e.displaygroupingcustomfield)||void 0===u?void 0:u.value)&&!(null==e||null===(v=e.customfieldsexport)||void 0===v||!v.value),n.filters.customFilters=n.filters.show.custom?p.Ni.parseJSON((null==e||null===(f=e.customfieldsexport)||void 0===f?void 0:f.value)||"[]",[]):[],n.filters.enabled=Object.keys(n.filters.show).some((e=>n.filters.show[e])),n.filters.enabled||(n.filters.show.all=!0,n.saveFilters("all")),yield n.filterCourses(o)}))()}loadLayouts(e){const o=[];if(void 0===e)return this.isLayoutSwitcherAvailable=!0,void 0;e.forEach((e=>{if(""==e)return;const n="summary"==e?"list":e;o.includes(n)||o.push(n)})),0==o.length&&o.push("list"),o.includes(this.layout)||(this.layout=o[0]),this.isLayoutSwitcherAvailable=o.length>1}refreshCourseList(e){var o=this;return(0,t.A)((function*(){if(e.action===w.CoreCoursesMyCoursesUpdatedEventAction.ENROL)return o.refreshContent(!0);const n=o.allCourses.find((o=>o.id==e.courseId));if(e.action===w.CoreCoursesMyCoursesUpdatedEventAction.STATE_CHANGED){if(!n)return o.refreshContent(!0);e.state===w.CORE_COURSES_STATE_FAVOURITE&&(n.isfavourite=!!e.value),e.state===w.CORE_COURSES_STATE_HIDDEN&&(n.hidden=!!e.value),yield o.invalidateCourseList(),yield o.filterCourses()}if(e.action===w.CoreCoursesMyCoursesUpdatedEventAction.VIEW&&e.courseId!=s.CoreSites.getCurrentSiteHomeId()){if(!n)return o.refreshContent(!0);n.lastaccess=r.j.timestamp(),yield o.invalidateCourseList(),yield o.filterCourses()}}))()}initPrefetchCoursesIcons(){var e=this;return(0,t.A)((function*(){e.prefetchIconsInitialized||(e.prefetchIconsInitialized=!0,e.prefetchCoursesData=yield d.CoreCourseHelper.initPrefetchCoursesIcons(e.filteredCourses,e.prefetchCoursesData))}))()}prefetchCourses(){var e=this;return(0,t.A)((function*(){const o=e.prefetchCoursesData.icon;try{yield d.CoreCourseHelper.prefetchCourses(e.filteredCourses,e.prefetchCoursesData)}catch(n){e.isDestroyed||(b.CoreAlerts.showError(n,{default:y.HT.instant("core.course.errordownloadingcourse")}),e.prefetchCoursesData.icon=o)}}))()}filterTextChanged(e){this.textFilter=e.value||"",this.filterCourses()}filterCourses(e){var o=this;return(0,t.A)((function*(){let n=o.filters.timeFilterSelected;if((n.startsWith("custom-")?o.filters.show.custom:o.filters.show[n])||(n=o.getFirstActiveFilter()),o.filteredCourses=o.allCourses,o.filters.show.custom&&n.startsWith("custom-")){var t,i;const r=null===(t=o.block.configsRecord)||void 0===t?void 0:t.customfiltergrouping.value,s=null===(i=o.filters.customFilters[n.substring(7)])||void 0===i?void 0:i.value;if(void 0!==r&&void 0!==s){const t=!1===o.loaded;o.loaded=!1;try{const t=(e?yield e.watchRequest(l.CoreCourses.getEnrolledCoursesByCustomFieldObservable(r,s,{readingStrategy:e.getReadingStrategy()}),((e,n)=>o.customFilterCoursesHaveMeaningfulChanges(e,n))):yield l.CoreCourses.getEnrolledCoursesByCustomField(r,s)).map((e=>e.id));o.filteredCourses=o.filteredCourses.filter((e=>t.includes(e.id))),o.saveFilters(n)}catch(e){if(t)throw e;b.CoreAlerts.showError(e,{default:o.fetchContentDefaultError})}finally{t||(o.loaded=!0)}}}else switch(o.saveFilters(n),n){case"allincludinghidden":break;case"all":o.filteredCourses=o.filteredCourses.filter((e=>!e.hidden));break;case"inprogress":o.filteredCourses=o.filteredCourses.filter((e=>!e.hidden&&!a.CoreCoursesHelper.isPastCourse(e,o.gradePeriodAfter)&&!a.CoreCoursesHelper.isFutureCourse(e,o.gradePeriodAfter,o.gradePeriodBefore)));break;case"future":o.filteredCourses=o.filteredCourses.filter((e=>!e.hidden&&a.CoreCoursesHelper.isFutureCourse(e,o.gradePeriodAfter,o.gradePeriodBefore)));break;case"past":o.filteredCourses=o.filteredCourses.filter((e=>!e.hidden&&a.CoreCoursesHelper.isPastCourse(e,o.gradePeriodAfter)));break;case"favourite":o.filteredCourses=o.filteredCourses.filter((e=>!e.hidden&&e.isfavourite));break;case"hidden":o.filteredCourses=o.filteredCourses.filter((e=>e.hidden))}const r=o.textFilter.trim().toLowerCase();""!=r&&o.filteredCourses.length>0&&(o.filteredCourses=o.filteredCourses.filter(void 0!==o.filteredCourses[0].displayname?e=>e.displayname&&e.displayname.toLowerCase().indexOf(r)>-1:e=>e.fullname.toLowerCase().indexOf(r)>-1)),o.sortCourses(o.sort.selected),o.prefetchIconsInitialized=!1,o.initPrefetchCoursesIcons()}))()}getFirstActiveFilter(){const e=x.find((e=>this.filters.show[e]))||"all";return"custom"!==e?e:this.filters.customFilters.length?"custom-0":"all"}sortCourses(e){this.sort.enabled&&(this.sort.selected!=e&&this.saveSort(e),"lastaccess"==this.sort.selected?this.filteredCourses.sort(((e,o)=>(o.lastaccess||0)-(e.lastaccess||0))):"fullname"==this.sort.selected?this.filteredCourses.sort(((e,o)=>{const n=e.fullname.toLowerCase(),t=o.fullname.toLowerCase();return n.localeCompare(t)})):"shortname"==this.sort.selected&&this.filteredCourses.sort(((e,o)=>{const n=e.shortname.toLowerCase(),t=o.shortname.toLowerCase();return n.localeCompare(t)})))}saveFilters(e){var o=this;return(0,t.A)((function*(){o.filters.timeFilterSelected=e,yield o.currentSite.setLocalSiteConfig("AddonBlockMyOverviewFilter",e)}))()}toggleLayout(e){var o=this;return(0,t.A)((function*(){o.layout=e,yield o.currentSite.setLocalSiteConfig("AddonBlockMyOverviewLayout",o.layout)}))()}saveSort(e){var o=this;return(0,t.A)((function*(){o.sort.selected=e,yield o.currentSite.setLocalSiteConfig("AddonBlockMyOverviewSort",o.sort.selected)}))()}filterOptionsChanged(e){var o=this;return(0,t.A)((function*(){o.filters.timeFilterSelected=e,o.filterCourses()}))()}openSearch(){return(0,t.A)((function*(){f.CoreNavigator.navigateToSitePath("courses/list",{params:{mode:"search"}})}))()}coursesHaveMeaningfulChanges(e,o){return(0,t.A)((function*(){if(e.length!==o.length)return!0;e=Array.from(e).sort(((e,o)=>e.fullname.toLowerCase().localeCompare(o.fullname.toLowerCase()))),o=Array.from(o).sort(((e,o)=>e.fullname.toLowerCase().localeCompare(o.fullname.toLowerCase())));for(let i=0;i<e.length;i++){var n,t;const r=e[i],s=o[i];if(r.progress!==s.progress||r.categoryname!==s.categoryname||(null!==(n=r.displayname)&&void 0!==n?n:r.fullname)!==(null!==(t=s.displayname)&&void 0!==t?t:s.fullname))return!0}return!1}))()}customFilterCoursesHaveMeaningfulChanges(e,o){return(0,t.A)((function*(){if(e.length!==o.length)return!0;const n=e.map((e=>e.id)).sort(),t=o.map((e=>e.id)).sort();return n.some(((e,o)=>e!==t[o]))}))()}ngOnDestroy(){var e,o;this.isDestroyed=!0,null===(e=this.coursesObserver)||void 0===e||e.off(),null===(o=this.updateSiteObserver)||void 0===o||o.off()}}return(e=AddonBlockMyOverviewComponent).ɵfac=function AddonBlockMyOverviewComponent_Factory(o){return new(o||e)(k.rXU(m.o,8))},e.ɵcmp=k.VBU({type:e,selectors:[["addon-block-myoverview"]],standalone:!0,features:[k.Vt3,k.OA$,k.aNF],decls:12,vars:11,consts:[[3,"sticky"],["slot","end",1,"flex-row"],["class","core-button-spinner",4,"ngIf"],["placeholderType","column",3,"hideUntil","placeholderLimit"],["class","ion-hide-md-up addon-block-myoverview-filter",4,"ngIf"],["class","ion-justify-content-between ion-align-items-center addon-block-myoverview-filter",4,"ngIf"],["image","assets/img/icons/courses.svg",4,"ngIf"],["class","safe-area-padding core-course-list",4,"ngIf"],[1,"core-button-spinner"],["fill","clear",3,"ariaLabel","click",4,"ngIf"],["class","core-course-download-courses-progress","role","progressbar",4,"ngIf"],[4,"ngIf"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","aria-hidden","true",3,"name"],["role","progressbar",1,"core-course-download-courses-progress"],[1,"ion-hide-md-up","addon-block-myoverview-filter"],[3,"ngModelChange","ionInput","ionCancel","ngModel","placeholder"],[1,"ion-justify-content-between","ion-align-items-center","addon-block-myoverview-filter"],["size","auto",4,"ngIf"],[1,"ion-hide-md-down",3,"ngModelChange","ionInput","ionCancel","ngModel","placeholder"],["size","auto"],[3,"onChange","label","selection"],["class","ion-text-wrap core-select-option-border-bottom","value","allincludinghidden",4,"ngIf"],["class","ion-text-wrap core-select-option-border-bottom","value","all",4,"ngIf"],["class","ion-text-wrap","value","inprogress",3,"core-select-option-border-bottom",4,"ngIf"],["class","ion-text-wrap","value","future",3,"core-select-option-border-bottom",4,"ngIf"],["class","ion-text-wrap core-select-option-border-bottom","value","past",4,"ngIf"],["class","ion-text-wrap core-select-option-border-bottom","value","favourite",4,"ngIf"],["class","ion-text-wrap","value","hidden",4,"ngIf"],["value","allincludinghidden",1,"ion-text-wrap","core-select-option-border-bottom"],["value","all",1,"ion-text-wrap","core-select-option-border-bottom"],["value","inprogress",1,"ion-text-wrap"],["value","future",1,"ion-text-wrap"],["value","past",1,"ion-text-wrap","core-select-option-border-bottom"],[4,"ngFor","ngForOf"],[1,"ion-text-wrap",3,"value"],["value","favourite",1,"ion-text-wrap","core-select-option-border-bottom"],["value","hidden",1,"ion-text-wrap"],["icon","fas-arrow-down-short-wide",1,"no-border",3,"onChange","label","selection"],["value","fullname",1,"ion-text-wrap"],["class","ion-text-wrap","value","shortname",4,"ngIf"],["value","lastaccess",1,"ion-text-wrap"],["value","shortname",1,"ion-text-wrap"],["fill","outline",3,"ariaLabel","click",4,"ngIf"],["fill","outline",3,"click","ariaLabel"],["slot","icon-only","name","fas-list","aria-hidden","true"],["slot","icon-only","name","fas-table-cells-large","aria-hidden","true"],["image","assets/img/icons/courses.svg"],["class","item-heading",4,"ngIf"],[1,"item-heading"],["class","subdued",4,"ngIf"],["fill","outline",3,"click"],["name","fas-magnifying-glass","slot","start","aria-hidden","true"],[1,"subdued"],[1,"safe-area-padding","core-course-list"],[1,"ion-no-padding"],["class","ion-no-padding","size","12","size-sm","6","size-md","6","size-lg","4","size-xl","3",4,"ngFor","ngForOf"],["size","12","size-sm","6","size-md","6","size-lg","4","size-xl","3",1,"ion-no-padding"],[1,"core-courseoverview",3,"course","showDownload","layout"]],template:function AddonBlockMyOverviewComponent_Template(e,o){1&e&&(k.j41(0,"ion-item-divider",0)(1,"ion-label")(2,"h2"),k.EFF(3),k.nI1(4,"translate"),k.k0s()(),k.j41(5,"div",1),k.DNE(6,AddonBlockMyOverviewComponent_div_6_Template,4,3,"div",2),k.k0s()(),k.j41(7,"core-loading",3),k.DNE(8,AddonBlockMyOverviewComponent_ion_row_8_Template,4,4,"ion-row",4)(9,AddonBlockMyOverviewComponent_ion_row_9_Template,7,7,"ion-row",5)(10,AddonBlockMyOverviewComponent_core_empty_box_10_Template,4,3,"core-empty-box",6)(11,AddonBlockMyOverviewComponent_div_11_Template,4,5,"div",7),k.k0s()),2&e&&(k.Y8G("sticky",!0),k.R7$(3),k.JRh(k.bMT(4,9,"addon.block_myoverview.pluginname")),k.R7$(3),k.Y8G("ngIf",o.downloadCoursesEnabled&&o.filteredCourses.length>0),k.R7$(),k.Y8G("hideUntil",o.loaded)("placeholderLimit",8),k.R7$(),k.Y8G("ngIf",o.hasCourses),k.R7$(),k.Y8G("ngIf",o.hasCourses),k.R7$(),k.Y8G("ngIf",0===o.filteredCourses.length),k.R7$(),k.Y8G("ngIf",o.hasCourses))},dependencies:[g.n,M.Sq,M.bT,O.BC,O.vS,A.In,A.Jm,A.hU,A.lO,A.iq,A.Dg,A.he,A.ln,A.S1,A.Ip,A.w2,A.Gw,I.h,T.R,B._,S.t,R.T,F.D9,h.CoreCoursesCourseListItemComponent],styles:["[_nghost-%COMP%]   ion-row.addon-block-myoverview-filter[_ngcontent-%COMP%]{margin:8px;padding:0}[_nghost-%COMP%]   ion-row.addon-block-myoverview-filter[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:0;margin-right:2px;margin-left:2px}[_nghost-%COMP%]   ion-row.addon-block-myoverview-filter[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-row.addon-block-myoverview-filter[_ngcontent-%COMP%]   core-combobox[_ngcontent-%COMP%]     ion-select{--a11y-sizing-minTargetSize: 40px;margin:0}[_nghost-%COMP%]   ion-row.addon-block-myoverview-filter[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-width: 0}[_nghost-%COMP%]   ion-row.addon-block-myoverview-filter[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:var(--mdl-typography-icon-fontSize-md)}[_nghost-%COMP%]   ion-row.addon-block-myoverview-filter[_ngcontent-%COMP%]   ion-searchbar[_ngcontent-%COMP%]{padding:0;--height: 40px}[_nghost-%COMP%]   core-empty-box[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;margin-bottom:0}[_nghost-%COMP%]   core-empty-box[_ngcontent-%COMP%]   .subdued[_ngcontent-%COMP%]{color:var(--subdued-text-color)}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   .core-button-spinner[_ngcontent-%COMP%]{display:flex;align-items:center;margin-inline-start:10px;margin-inline-end:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   .core-button-spinner[_ngcontent-%COMP%]   ion-badge.core-course-download-courses-progress[_ngcontent-%COMP%]{margin-inline-end:12px}"]}),AddonBlockMyOverviewComponent})()}}]);