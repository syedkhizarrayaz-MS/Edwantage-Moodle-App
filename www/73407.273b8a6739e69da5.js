"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[73407],{2401:(e,t,r)=>{r.d(t,{R:()=>CoreListItemsManager});var o=r(10467),s=r(21182),i=r(15324),n=r(93417),a=r(81690),l=r(95990),u=r(82907),c=r(24742),d=r(55554);class CoreListItemsManager extends l.u{constructor(e,t){super(e);const r=a.j.debounce((()=>this.scrollToCurrentElement()),300);this.pageRouteLocator=t,this.addListener({onSelectedItemUpdated:r}),this.finishSuccessfulFetch=c.j.once((()=>d.g.ignoreErrors(this.logActivity())))}get items(){return this.getSource().getItems()||[]}get loaded(){return null!==this.itemsMap}get completed(){return this.getSource().isCompleted()}get empty(){const e=this.getSource().getItems();return null===e||0===e.length}start(e){var t=this;return(0,o.A)((function*(){e&&t.watchSplitViewOutlet(e),t.updateSelectedItem()}))()}destroy(){var e;super.destroy(),null===(e=this.splitViewOutletSubscription)||void 0===e||e.unsubscribe()}watchSplitViewOutlet(e){var t;this.splitView=e,this.splitViewOutletSubscription=e.outletRouteObservable.subscribe((e=>this.updateSelectedItem(this.getPageRouteFromSplitViewOutlet(e)))),this.updateSelectedItem(null!==(t=this.getPageRouteFromSplitViewOutlet(e.outletRoute))&&void 0!==t?t:null)}isSelected(e){return this.selectedItem===e}getItemAriaCurrent(e){return this.isSelected(e)?"page":"false"}select(e){var t=this;return(0,o.A)((function*(){if(!e)return yield t.navigateToIndex({reset:t.resetNavigation()}),void 0;yield t.navigateToItem(e,{reset:t.resetNavigation()})}))()}reset(){this.getSource().reset()}reload(){var e=this;return(0,o.A)((function*(){yield e.getSource().reload(),e.finishSuccessfulFetch()}))()}load(){var e=this;return(0,o.A)((function*(){yield e.getSource().load(),e.finishSuccessfulFetch()}))()}logActivity(){return(0,o.A)((function*(){}))()}resetNavigation(){var e;return!!n.CoreScreen.isTablet&&!(!this.splitView||null!==(e=this.splitView)&&void 0!==e&&e.isNested)}updateSelectedItem(e=null){super.updateSelectedItem(e);this.select(n.CoreScreen.isTablet&&null===this.selectedItem&&this.splitView&&!this.splitView.isNested?this.getDefaultItem():this.selectedItem)}scrollToCurrentElement(){var e=this;return(0,o.A)((function*(){var t,r,o;if(n.CoreScreen.isMobile)return;const s=(null!==(t=null===(r=e.splitView)||void 0===r?void 0:r.nativeElement)&&void 0!==t?t:document).querySelector('[aria-current="page"]');if(!s)return;u.y.isElementInViewport(s,1,null===(o=e.splitView)||void 0===o?void 0:o.nativeElement)||s.scrollIntoView({behavior:"smooth"})}))()}getDefaultItem(){return this.items[0]||null}getCurrentPageRoute(){return this.pageRouteLocator instanceof s.nX?i.CoreNavigator.isRouteActive(this.pageRouteLocator)?this.pageRouteLocator:null:i.CoreNavigator.getCurrentRoute({pageComponent:this.pageRouteLocator})}getSelectedItemPathFromRoute(e){const t=[];for(;e.firstChild;)t.push(...i.CoreNavigator.getRouteUrl(e=e.firstChild));return t.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}getPageRouteFromSplitViewOutlet(e){const t=this.buildRouteMatcher();for(;e&&!t(e);)e=e.parent;return e}buildRouteMatcher(){if(this.pageRouteLocator instanceof s.nX){const e=i.CoreNavigator.getRouteFullPath(this.pageRouteLocator);return t=>i.CoreNavigator.getRouteFullPath(t)===e}return e=>e.component===this.pageRouteLocator}}},73407:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var o=r(10467),s=r(2401),i=r(83696),n=r(29492),a=r(99891),l=r(27338),u=r(22693),c=r(52749),d=r(55554),g=r(79555),p=r(25572),h=r(86654),C=r(54438),m=r(2910),f=r(16986),_=r(64422),v=r(58197),I=r(88246),R=r(73955);const _forTrack0=(e,t)=>t.courseid;function CoreGradesCoursesPage_Conditional_15_Template(e,t){1&e&&(C.nrm(0,"core-empty-box",5),C.nI1(1,"translate")),2&e&&C.Y8G("message",C.bMT(1,1,"core.grades.nogradesreturned"))}function CoreGradesCoursesPage_Conditional_16_For_2_Conditional_5_Template(e,t){1&e&&(C.j41(0,"span",11),C.EFF(1),C.nI1(2,"translate"),C.k0s()),2&e&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"core.gradenoun")," "))}function CoreGradesCoursesPage_Conditional_16_For_2_Template(e,t){if(1&e){const e=C.RV6();C.j41(0,"ion-item",7),C.bIt("click",(function CoreGradesCoursesPage_Conditional_16_For_2_Template_ion_item_click_0_listener(){const t=C.eBV(e).$implicit,r=C.XpG(2);return C.Njj(r.courses.select(t))})),C.j41(1,"ion-label")(2,"p",8),C.nrm(3,"core-format-text",9),C.k0s()(),C.j41(4,"ion-badge",10),C.DNE(5,CoreGradesCoursesPage_Conditional_16_For_2_Conditional_5_Template,3,3,"span",11),C.EFF(6),C.k0s()()}if(2&e){const e=t.$implicit,r=C.XpG(2);C.Y8G("detail",!0),C.BMQ("aria-label",e.courseFullName)("aria-current",r.courses.getItemAriaCurrent(e)),C.R7$(3),C.Y8G("text",e.courseFullName)("contextInstanceId",e.courseid),C.R7$(2),C.vxM(5,e.grade&&"-"!==e.grade?5:-1),C.R7$(),C.SpI(" ",e.grade," ")}}function CoreGradesCoursesPage_Conditional_16_Template(e,t){if(1&e&&(C.j41(0,"ion-list"),C.Z7z(1,CoreGradesCoursesPage_Conditional_16_For_2_Template,7,7,"ion-item",6,_forTrack0),C.k0s()),2&e){const e=C.XpG();C.R7$(),C.Dyx(e.courses.items)}}let b=(()=>{var e;class CoreGradesCoursesPage{constructor(){const e=i.u.getOrCreateSource(a.b,[]);this.courses=new CoreGradesCoursesManager(e,CoreGradesCoursesPage)}ngAfterViewInit(){var e=this;return(0,o.A)((function*(){yield e.fetchInitialCourses(),e.courses.start(e.splitView)}))()}ngOnDestroy(){this.courses.destroy()}refreshCourses(e){var t=this;return(0,o.A)((function*(){yield d.g.ignoreErrors(l.CoreGrades.invalidateCoursesGradesData()),yield d.g.ignoreErrors(t.courses.reload()),null==e||e.complete()}))()}fetchInitialCourses(){var e=this;return(0,o.A)((function*(){try{yield e.courses.load()}catch(e){p.CoreAlerts.showError(e,{default:"Error loading courses"})}}))()}}return(e=CoreGradesCoursesPage).ɵfac=function CoreGradesCoursesPage_Factory(t){return new(t||e)},e.ɵcmp=C.VBU({type:e,selectors:[["page-core-grades-courses"]],viewQuery:function CoreGradesCoursesPage_Query(e,t){if(1&e&&C.GBs(n.M,5),2&e){let e;C.mGM(e=C.lsd())&&(t.splitView=e.first)}},standalone:!0,features:[C.aNF],decls:17,vars:12,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["placeholderType","column","placeholderHeight","48px",3,"hideUntil"],["icon","fas-chart-bar",3,"message"],["button","",1,"ion-text-wrap",3,"detail"],["button","",1,"ion-text-wrap",3,"click","detail"],[1,"item-heading"],["contextLevel","course",3,"text","contextInstanceId"],["slot","end","color","light"],[1,"sr-only"]],template:function CoreGradesCoursesPage_Template(e,t){1&e&&(C.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),C.nrm(3,"ion-back-button",1),C.nI1(4,"translate"),C.k0s(),C.j41(5,"ion-title")(6,"h1"),C.EFF(7),C.nI1(8,"translate"),C.k0s()()()(),C.j41(9,"ion-content")(10,"core-split-view")(11,"ion-refresher",2),C.bIt("ionRefresh",(function CoreGradesCoursesPage_Template_ion_refresher_ionRefresh_11_listener(e){return t.refreshCourses(e.target)})),C.nrm(12,"ion-refresher-content",3),C.nI1(13,"translate"),C.k0s(),C.j41(14,"core-loading",4),C.DNE(15,CoreGradesCoursesPage_Conditional_15_Template,2,3,"core-empty-box",5)(16,CoreGradesCoursesPage_Conditional_16_Template,3,0),C.k0s()()()),2&e&&(C.R7$(3),C.Y8G("text",C.bMT(4,6,"core.back")),C.R7$(4),C.JRh(C.bMT(8,8,"core.grades.grades")),C.R7$(4),C.Y8G("disabled",!t.courses.loaded),C.R7$(),C.FS9("pullingText",C.bMT(13,10,"core.pulltorefresh")),C.R7$(2),C.Y8G("hideUntil",t.courses.loaded),C.R7$(),C.vxM(15,t.courses.empty?15:16))},dependencies:[h.n,m.In,m.QW,m.W9,m.eU,m.uz,m.he,m.nf,m.To,m.Ki,m.BC,m.ai,m.el,f.h,_.R,n.M,v.B,I.i,R.D9],encapsulation:2}),CoreGradesCoursesPage})();class CoreGradesCoursesManager extends s.R{logActivity(){return(0,o.A)((function*(){yield l.CoreGrades.logCoursesGradesView(),u.OF.logEvent({type:u.qr.VIEW_ITEM_LIST,ws:"gradereport_overview_view_grade_report",name:g.HT.instant("core.grades.grades"),data:{courseId:c.CoreSites.getCurrentSiteHomeId(),category:"grades"},url:"/grade/report/overview/index.php"})}))()}}}}]);