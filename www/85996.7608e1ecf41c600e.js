"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[85996,69006],{85996:(e,t,n)=>{n.r(t),n.d(t,{AddonModChatIndexComponent:()=>M});var o=n(10467),i=n(69006),r=n(51024),s=n(15324),a=n(24742),d=n(35853),c=n(22535),l=n(86654),u=n(6736),h=n(30864),C=n(54438),m=n(2910),p=n(60177),g=n(69502),_=n(17388),f=n(64422),y=n(13988),v=n(86198),S=n(66731),A=n(43570),I=n(73955);const _c0=e=>({$a:e});function AddonModChatIndexComponent_Conditional_1_Template(e,t){if(1&e){const e=C.RV6();C.j41(0,"ion-button",7),C.nI1(1,"translate"),C.bIt("click",(function AddonModChatIndexComponent_Conditional_1_Template_ion_button_click_0_listener(){C.eBV(e);const t=C.XpG();return C.Njj(t.openModuleSummary())})),C.nrm(2,"ion-icon",8),C.k0s()}2&e&&C.Y8G("ariaLabel",C.bMT(1,1,"core.info"))}function AddonModChatIndexComponent_Conditional_2_Template(e,t){if(1&e){const e=C.RV6();C.j41(0,"core-context-menu")(1,"core-context-menu-item",9),C.nI1(2,"translate"),C.bIt("action",(function AddonModChatIndexComponent_Conditional_2_Template_core_context_menu_item_action_1_listener(){C.eBV(e);const t=C.XpG();return C.Njj(t.openModuleSummary())})),C.k0s()()}2&e&&(C.R7$(),C.Y8G("priority",5e3)("content",C.bMT(2,2,"core.info")))}function AddonModChatIndexComponent_ion_card_5_Template(e,t){if(1&e&&(C.j41(0,"ion-card",10)(1,"ion-item"),C.nrm(2,"ion-icon",11),C.j41(3,"ion-label"),C.EFF(4),C.nI1(5,"translate"),C.k0s()()()),2&e){const e=C.XpG();C.R7$(4),C.JRh(C.i5U(5,1,"addon.mod_chat.sessionstartsin",C.eq3(4,_c0,e.chatTime)))}}function AddonModChatIndexComponent_ion_button_6_Template(e,t){if(1&e){const e=C.RV6();C.j41(0,"ion-button",12),C.bIt("click",(function AddonModChatIndexComponent_ion_button_6_Template_ion_button_click_0_listener(){C.eBV(e);const t=C.XpG();return C.Njj(t.viewSessions())})),C.EFF(1),C.nI1(2,"translate"),C.k0s()}2&e&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"addon.mod_chat.viewreport")," "))}function AddonModChatIndexComponent_div_7_div_1_Template(e,t){if(1&e){const e=C.RV6();C.j41(0,"div",16)(1,"ion-button",17),C.bIt("click",(function AddonModChatIndexComponent_div_7_div_1_Template_ion_button_click_1_listener(){C.eBV(e);const t=C.XpG(2);return C.Njj(t.enterChat())})),C.EFF(2),C.nI1(3,"translate"),C.k0s()()}2&e&&(C.R7$(2),C.SpI(" ",C.bMT(3,1,"addon.mod_chat.enterchat")," "))}function AddonModChatIndexComponent_div_7_Template(e,t){if(1&e&&(C.j41(0,"div",13),C.DNE(1,AddonModChatIndexComponent_div_7_div_1_Template,4,3,"div",14),C.nrm(2,"core-course-module-navigation",15),C.k0s()),2&e){const e=C.XpG();C.R7$(),C.Y8G("ngIf",e.chat),C.R7$(),C.Y8G("courseId",e.courseId)("currentModuleId",e.module.id)}}let M=(()=>{var e;class AddonModChatIndexComponent extends i.y{constructor(e,t){super("AddonModChatIndexComponent",e,t),this.content=e,this.component=c.vz,this.pluginName="chat"}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,e=this;return(0,o.A)((function*(){_superprop_getNgOnInit().call(e),yield e.loadContent()}))()}fetchContent(){var e=this;return(0,o.A)((function*(){e.chat=yield d.V.getChat(e.courseId,e.module.id),e.description=e.chat.intro;const t=(e.chat.chattime||0)-a.j.timestamp();e.chatTime=e.chat.schedule&&t>0?a.j.formatTime(t):void 0,e.dataRetrieved.emit(e.chat)}))()}logActivity(){var e=this;return(0,o.A)((function*(){e.chat&&(yield d.V.logView(e.chat.id),e.analyticsLogEvent("mod_chat_view_chat"))}))()}enterChat(){var e;const t=(null===(e=this.chat)||void 0===e?void 0:e.name)||this.moduleName;s.CoreNavigator.navigateToSitePath(`${c.VU}/${this.courseId}/${this.module.id}/chat`,{params:{title:t,chatId:this.chat.id}})}viewSessions(){s.CoreNavigator.navigateToSitePath(`${c.VU}/${this.courseId}/${this.module.id}/sessions`,{params:{chatId:this.chat.id}})}}return(e=AddonModChatIndexComponent).ɵfac=function AddonModChatIndexComponent_Factory(t){return new(t||e)(C.rXU(m.W9),C.rXU(r.A,8))},e.ɵcmp=C.VBU({type:e,selectors:[["addon-mod-chat-index"]],standalone:!0,features:[C.Vt3,C.aNF],decls:8,vars:10,consts:[["slot","end"],["fill","clear","aria-haspopup","true",3,"ariaLabel"],[3,"hideUntil"],[3,"completionChanged","module","description","component","componentId","courseId"],["class","core-info-card",4,"ngIf"],["class","ion-margin ion-text-wrap","expand","block","fill","outline",3,"click",4,"ngIf"],["collapsible-footer","","slot","fixed",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click","ariaLabel"],["name","fas-circle-info","slot","icon-only","aria-hidden","true"],["iconAction","fas-circle-info",3,"action","priority","content"],[1,"core-info-card"],["name","fas-clock","slot","start","aria-hidden","true"],["expand","block","fill","outline",1,"ion-margin","ion-text-wrap",3,"click"],["collapsible-footer","","slot","fixed"],["class","list-item-limited-width",4,"ngIf"],[3,"courseId","currentModuleId"],[1,"list-item-limited-width"],["expand","block",1,"ion-margin","ion-text-wrap",3,"click"]],template:function AddonModChatIndexComponent_Template(e,t){1&e&&(C.j41(0,"core-navbar-buttons",0),C.DNE(1,AddonModChatIndexComponent_Conditional_1_Template,3,3,"ion-button",1)(2,AddonModChatIndexComponent_Conditional_2_Template,3,4),C.k0s(),C.j41(3,"core-loading",2)(4,"core-course-module-info",3),C.bIt("completionChanged",(function AddonModChatIndexComponent_Template_core_course_module_info_completionChanged_4_listener(){return t.onCompletionChange()})),C.k0s(),C.DNE(5,AddonModChatIndexComponent_ion_card_5_Template,6,6,"ion-card",4)(6,AddonModChatIndexComponent_ion_button_6_Template,3,3,"ion-button",5)(7,AddonModChatIndexComponent_div_7_Template,3,3,"div",6),C.k0s()),2&e&&(C.R7$(),C.vxM(1,t.courseContentsPage?2:1),C.R7$(2),C.Y8G("hideUntil",!t.showLoading),C.R7$(),C.Y8G("module",t.module)("description",t.description)("component",t.component)("componentId",t.componentId)("courseId",t.courseId),C.R7$(),C.Y8G("ngIf",t.chatTime),C.R7$(),C.Y8G("ngIf",t.chat),C.R7$(),C.Y8G("ngIf",!t.showLoading))},dependencies:[l.n,p.bT,m.Jm,m.b_,m.iq,m.uz,m.he,g.B,_.Q,f.R,y.c,v.t,S.i,A.T,I.D9,u.CoreCourseModuleInfoComponent,h.CoreCourseModuleNavigationComponent],encapsulation:2}),AddonModChatIndexComponent})()},35853:(e,t,n)=>{n.d(t,{V:()=>C});var o=n(10467),i=n(97254),r=n(98870),s=n(52749),a=n(79555),d=n(22535),c=n(74431),l=n(95384),u=n(54438);let h=(()=>{var e;class AddonModChatProvider{getChat(e,t,n={}){var i=this;return(0,o.A)((function*(){const o=yield s.CoreSites.getSite(n.siteId),r={courseids:[e]},a={cacheKey:i.getChatsCacheKey(e),updateFrequency:c.CoreCacheUpdateFrequency.RARELY,component:d.vz,...s.CoreSites.getReadingStrategyPreSets(n.readingStrategy)},u=yield o.read("mod_chat_get_chats_by_courses",r,a);return l.CoreCourseModuleHelper.getActivityByCmId(u.chats,t)}))()}loginUser(e,t){return(0,o.A)((function*(){const n=yield s.CoreSites.getSite(t),o={chatid:e};return(yield n.write("mod_chat_login_user",o)).chatsid}))()}logView(e,t){return(0,o.A)((function*(){const n={chatid:e};yield i.CoreCourseLogHelper.log("mod_chat_view_chat",n,d.vz,e,t)}))()}logViewSessions(e,t){return(0,o.A)((function*(){const n={cmid:e};t&&(n.start=t.start,n.end=t.end),yield i.CoreCourseLogHelper.log("mod_chat_view_sessions",n,d.vz,e)}))()}sendMessage(e,t,n,i){return(0,o.A)((function*(){const o=yield s.CoreSites.getSite(i),r={chatsid:e,messagetext:t,beepid:String(n)};return(yield o.write("mod_chat_send_chat_message",r)).messageid}))()}getLatestMessages(e,t,n){return(0,o.A)((function*(){return(yield s.CoreSites.getSite(n)).write("mod_chat_get_chat_latest_messages",{chatsid:e,chatlasttime:t})}))()}getMessagesUserData(e,t,n){return(0,o.A)((function*(){const i=e;return yield Promise.all(i.map(function(){var e=(0,o.A)((function*(e){try{const o=yield r.CoreUser.getProfile(e.userid,t,!0,n);e.userfullname=o.fullname,e.userprofileimageurl=o.profileimageurl}catch{e.userfullname=`${a.HT.instant("core.deleteduser")} ${e.userid}`}}));return function(t){return e.apply(this,arguments)}}())),i}))()}getChatUsers(e,t={}){return(0,o.A)((function*(){t.readingStrategy=t.readingStrategy||3;const n=yield s.CoreSites.getSite(t.siteId),o={chatsid:e},i={component:d.vz,componentId:t.cmId,...s.CoreSites.getReadingStrategyPreSets(t.readingStrategy)};return n.read("mod_chat_get_chat_users",o,i)}))()}getSessions(e,t=0,n=!1,i={}){var r=this;return(0,o.A)((function*(){const o=yield s.CoreSites.getSite(i.siteId),a={chatid:e,groupid:t,showall:n},l={cacheKey:r.getSessionsCacheKey(e,t,n),updateFrequency:c.CoreCacheUpdateFrequency.SOMETIMES,component:d.vz,componentId:i.cmId,...s.CoreSites.getReadingStrategyPreSets(i.readingStrategy)};return(yield o.read("mod_chat_get_sessions",a,l)).sessions}))()}getSessionMessages(e,t,n,i=0,r={}){var a=this;return(0,o.A)((function*(){const o=yield s.CoreSites.getSite(r.siteId),l={chatid:e,sessionstart:t,sessionend:n,groupid:i},u={cacheKey:a.getSessionMessagesCacheKey(e,t,i),updateFrequency:c.CoreCacheUpdateFrequency.RARELY,component:d.vz,componentId:r.cmId,...s.CoreSites.getReadingStrategyPreSets(r.readingStrategy)};return(yield o.read("mod_chat_get_session_messages",l,u)).messages}))()}invalidateChats(e,t){var n=this;return(0,o.A)((function*(){const o=yield s.CoreSites.getSite(t);yield o.invalidateWsCacheForKey(n.getChatsCacheKey(e))}))()}invalidateSessions(e,t=0,n=!1,i){var r=this;return(0,o.A)((function*(){const o=yield s.CoreSites.getSite(i);yield o.invalidateWsCacheForKey(r.getSessionsCacheKey(e,t,n))}))()}invalidateAllSessions(e,t){var n=this;return(0,o.A)((function*(){const o=yield s.CoreSites.getSite(t);yield o.invalidateWsCacheForKeyStartingWith(n.getSessionsCacheKeyPrefix(e))}))()}invalidateSessionMessages(e,t,n=0,i){var r=this;return(0,o.A)((function*(){const o=yield s.CoreSites.getSite(i);yield o.invalidateWsCacheForKey(r.getSessionMessagesCacheKey(e,t,n))}))()}invalidateAllSessionMessages(e,t){var n=this;return(0,o.A)((function*(){const o=yield s.CoreSites.getSite(t);yield o.invalidateWsCacheForKeyStartingWith(n.getSessionMessagesCacheKeyPrefix(e))}))()}getChatsCacheKey(e){return`${AddonModChatProvider.ROOT_CACHE_KEY}chats:${e}`}getSessionsCacheKey(e,t,n){return this.getSessionsCacheKeyPrefix(e)+t+":"+(n?1:0)}getSessionsCacheKeyPrefix(e){return`${AddonModChatProvider.ROOT_CACHE_KEY}sessions:${e}:`}getSessionMessagesCacheKey(e,t,n){return this.getSessionMessagesCacheKeyPrefix(e)+t+":"+n}getSessionMessagesCacheKeyPrefix(e){return`${AddonModChatProvider.ROOT_CACHE_KEY}sessionsMessages:${e}:`}}return(e=AddonModChatProvider).ROOT_CACHE_KEY="AddonModChat:",e.ɵfac=function AddonModChatProvider_Factory(t){return new(t||e)},e.ɵprov=u.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModChatProvider})();const C=(0,a.Qd)(h)},69006:(e,t,n)=>{n.d(t,{y:()=>p});var o=n(10467),i=n(23063),r=n(49882),s=n(44682),a=n(55554),d=n(51024),c=n(52749),l=n(25572),u=n(79555),h=n(95384),C=n(54438),m=n(2910);let p=(()=>{var e;class CoreCourseModuleMainActivityComponent extends i.x{constructor(e="CoreCourseModuleMainResourceComponent",t,n){super(e,n),this.content=t,this.moduleName=""}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,e=this;return(0,o.A)((function*(){yield _superprop_getNgOnInit().call(e),e.hasOffline=!1,e.moduleName=h.CoreCourseModuleHelper.translateModuleName(e.pluginName||e.moduleName||""),e.syncEventName&&(e.syncObserver=r.z.on(e.syncEventName,(t=>{e.autoSyncEventReceived(t)}),e.siteId))}))()}isRefreshSyncNeeded(e){return!1}autoSyncEventReceived(e){this.isRefreshSyncNeeded(e)&&this.showLoadingAndRefresh(!1)}refreshContent(e=!1,t=!1){var n=this;return(0,o.A)((function*(){n.module&&(yield a.g.ignoreErrors(Promise.all([n.invalidateContent(),n.showCompletion?s.CoreCourse.invalidateModule(n.module.id):void 0])),yield n.loadContent(!0,e,t))}))()}showLoadingAndFetch(e=!1,t=!1){var n=this;return(0,o.A)((function*(){var o;n.showLoading=!0,null===(o=n.content)||void 0===o||o.scrollToTop(),yield n.loadContent(!1,e,t)}))()}showLoadingAndRefresh(e=!1,t=!1){var n;return this.showLoading=!0,null===(n=this.content)||void 0===n||n.scrollToTop(),this.refreshContent(e,t)}fetchContent(e=!1,t=!1,n=!1){return(0,o.A)((function*(){}))()}loadContent(e,t=!1,n=!1){var i=this;return(0,o.A)((function*(){if(i.module)try{e&&i.showCompletion&&(yield a.g.ignoreErrors(i.fetchModule())),yield i.fetchContent(e,t,n),i.finishSuccessfulFetch()}catch(n){var o;if(!e&&(null===(o=c.CoreSites.getCurrentSite())||void 0===o||!o.isOfflineDisabled())&&h.CoreCourseModuleHelper.isNotFoundError(n))return yield i.refreshContent(t);l.CoreAlerts.showError(n,{default:u.HT.instant(i.fetchContentDefaultError)})}finally{i.showLoading=!1}}))()}sync(){return(0,o.A)((function*(){return{updated:!1,warnings:[]}}))()}hasSyncSucceed(e){return e.updated}syncActivity(e=!1){var t=this;return(0,o.A)((function*(){try{const e=yield t.sync();return e.warnings.length&&l.CoreAlerts.show({message:e.warnings[0]}),t.hasSyncSucceed(e)}catch(t){return e&&l.CoreAlerts.showError(t,{default:u.HT.instant("core.errorsync")}),!1}}))()}ngOnDestroy(){var e;super.ngOnDestroy(),null===(e=this.syncObserver)||void 0===e||e.off()}}return(e=CoreCourseModuleMainActivityComponent).ɵfac=function CoreCourseModuleMainActivityComponent_Factory(t){return new(t||e)(C.rXU("",8),C.rXU(m.W9),C.rXU(d.A))},e.ɵcmp=C.VBU({type:e,selectors:[["ng-component"]],inputs:{group:"group"},features:[C.Vt3],decls:0,vars:0,template:function CoreCourseModuleMainActivityComponent_Template(e,t){},encapsulation:2}),CoreCourseModuleMainActivityComponent})()}}]);