"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[95391],{95391:(e,t,n)=>{n.r(t),n.d(t,{default:()=>X});var o=n(10467),r=n(89417),a=n(49882),i=n(15221),l=n(52749),d=n(48966),s=n(24742),c=n(81690),m=n(66110),u=n(41450),_=n(8224),p=n(57186),f=n(68581),g=n(13462),h=n(79555),v=n(40867),E=n(75629),C=n(15324),b=n(63153),R=n(21604),T=n(94339),I=n(99234),y=n(24813),G=n(33014),A=n(43959),k=n(55554),$=n(25572),F=n(86654),P=n(75383),j=n(54438),M=n(60177),Y=n(2910),D=n(25880),x=n(64422),O=n(17778),N=n(86198),w=n(66731),S=n(88246),V=n(43570),q=n(9970),J=n(73955);const B=["editEventForm"],_c1=e=>({header:e}),_c2=e=>({$a:e});function AddonCalendarEditEventPage_form_14_ng_template_16_Template(e,t){if(1&e&&(j.j41(0,"ion-datetime",32)(1,"span",33),j.EFF(2),j.nI1(3,"translate"),j.k0s()()),2&e){const e=j.XpG(2);j.Y8G("max",e.maxDate)("min",e.minDate)("showDefaultButtons",!0),j.R7$(2),j.JRh(j.bMT(3,4,"core.date"))}}function AddonCalendarEditEventPage_form_14_ion_label_19_Template(e,t){1&e&&(j.j41(0,"ion-label")(1,"p",34),j.EFF(2),j.nI1(3,"translate"),j.k0s()()),2&e&&(j.R7$(),j.Y8G("core-mark-required",!0),j.R7$(),j.JRh(j.bMT(3,2,"addon.calendar.eventkind")))}function AddonCalendarEditEventPage_form_14_p_20_Template(e,t){if(1&e&&(j.j41(0,"p",35),j.EFF(1),j.nI1(2,"translate"),j.k0s()),2&e){const e=j.XpG(2);j.R7$(),j.JRh(j.bMT(2,1,e.eventTypes[0].name))}}function AddonCalendarEditEventPage_form_14_ion_select_21_ion_select_option_6_Template(e,t){if(1&e&&(j.j41(0,"ion-select-option",26),j.EFF(1),j.nI1(2,"translate"),j.k0s()),2&e){const e=t.$implicit;j.Y8G("value",e.value),j.R7$(),j.SpI(" ",j.bMT(2,2,e.name)," ")}}function AddonCalendarEditEventPage_form_14_ion_select_21_Template(e,t){if(1&e&&(j.j41(0,"ion-select",36),j.nI1(1,"translate"),j.nI1(2,"translate"),j.j41(3,"div",11),j.EFF(4),j.nI1(5,"translate"),j.k0s(),j.DNE(6,AddonCalendarEditEventPage_form_14_ion_select_21_ion_select_option_6_Template,3,4,"ion-select-option",37),j.k0s()),2&e){const e=j.XpG(2);j.Y8G("cancelText",j.bMT(1,5,"core.cancel"))("interfaceOptions",j.eq3(11,_c1,j.bMT(2,7,"addon.calendar.eventkind"))),j.R7$(3),j.Y8G("core-mark-required",!0),j.R7$(),j.JRh(j.bMT(5,9,"addon.calendar.eventkind")),j.R7$(2),j.Y8G("ngForOf",e.eventTypes)}}function AddonCalendarEditEventPage_form_14_ion_item_22_ion_select_option_8_Template(e,t){if(1&e&&(j.j41(0,"ion-select-option",26),j.EFF(1),j.k0s()),2&e){const e=t.$implicit;j.Y8G("value",e.id),j.R7$(),j.SpI(" ",e.name," ")}}function AddonCalendarEditEventPage_form_14_ion_item_22_Template(e,t){if(1&e&&(j.j41(0,"ion-item",9)(1,"ion-select",38),j.nI1(2,"translate"),j.nI1(3,"translate"),j.nI1(4,"translate"),j.j41(5,"p",11),j.EFF(6),j.nI1(7,"translate"),j.k0s(),j.DNE(8,AddonCalendarEditEventPage_form_14_ion_item_22_ion_select_option_8_Template,2,2,"ion-select-option",37),j.k0s()()),2&e){const e=j.XpG(2);j.R7$(),j.Y8G("placeholder",j.bMT(2,6,"core.noselection"))("cancelText",j.bMT(3,8,"core.cancel"))("interfaceOptions",j.eq3(14,_c1,j.bMT(4,10,"core.category"))),j.R7$(4),j.Y8G("core-mark-required",!0),j.R7$(),j.JRh(j.bMT(7,12,"core.category")),j.R7$(2),j.Y8G("ngForOf",e.categories)}}function AddonCalendarEditEventPage_form_14_ion_item_23_ion_select_option_8_Template(e,t){if(1&e&&(j.j41(0,"ion-select-option",26),j.EFF(1),j.k0s()),2&e){const e=t.$implicit;j.Y8G("value",e.id),j.R7$(),j.JRh(e.fullname)}}function AddonCalendarEditEventPage_form_14_ion_item_23_Template(e,t){if(1&e&&(j.j41(0,"ion-item",9)(1,"ion-select",39),j.nI1(2,"translate"),j.nI1(3,"translate"),j.nI1(4,"translate"),j.j41(5,"p",11),j.EFF(6),j.nI1(7,"translate"),j.k0s(),j.DNE(8,AddonCalendarEditEventPage_form_14_ion_item_23_ion_select_option_8_Template,2,2,"ion-select-option",37),j.k0s()()),2&e){const e=j.XpG(2);j.R7$(),j.Y8G("placeholder",j.bMT(2,6,"core.noselection"))("cancelText",j.bMT(3,8,"core.cancel"))("interfaceOptions",j.eq3(14,_c1,j.bMT(4,10,"core.course"))),j.R7$(4),j.Y8G("core-mark-required",!0),j.R7$(),j.JRh(j.bMT(7,12,"core.course")),j.R7$(2),j.Y8G("ngForOf",e.courses)}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_select_option_9_Template(e,t){if(1&e&&(j.j41(0,"ion-select-option",26),j.EFF(1),j.k0s()),2&e){const e=t.$implicit;j.Y8G("value",e.id),j.R7$(),j.SpI(" ",e.fullname," ")}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_10_Template(e,t){1&e&&(j.j41(0,"ion-item",43)(1,"ion-label")(2,"p"),j.EFF(3),j.nI1(4,"translate"),j.k0s()()()),2&e&&(j.R7$(3),j.JRh(j.bMT(4,1,"core.coursenogroups")))}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_ion_select_option_8_Template(e,t){if(1&e&&(j.j41(0,"ion-select-option",26),j.EFF(1),j.k0s()),2&e){const e=t.$implicit;j.Y8G("value",e.id),j.R7$(),j.JRh(e.name)}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_Template(e,t){if(1&e&&(j.j41(0,"ion-item",44)(1,"ion-select",45),j.nI1(2,"translate"),j.nI1(3,"translate"),j.nI1(4,"translate"),j.j41(5,"p",11),j.EFF(6),j.nI1(7,"translate"),j.k0s(),j.DNE(8,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_ion_select_option_8_Template,2,2,"ion-select-option",37),j.k0s()()),2&e){const e=j.XpG(3);j.R7$(),j.Y8G("placeholder",j.bMT(2,6,"core.noselection"))("cancelText",j.bMT(3,8,"core.cancel"))("interfaceOptions",j.eq3(14,_c1,j.bMT(4,10,"core.group"))),j.R7$(4),j.Y8G("core-mark-required",!0),j.R7$(),j.JRh(j.bMT(7,12,"core.group")),j.R7$(2),j.Y8G("ngForOf",e.groups)}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_ion_spinner_2_Template(e,t){1&e&&(j.nrm(0,"ion-spinner"),j.nI1(1,"translate")),2&e&&j.BMQ("aria-label",j.bMT(1,1,"core.loading"))}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_Template(e,t){if(1&e&&(j.j41(0,"ion-item",9)(1,"ion-label"),j.DNE(2,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_ion_spinner_2_Template,2,3,"ion-spinner",18),j.k0s()()),2&e){const e=j.XpG(3);j.R7$(2),j.Y8G("ngIf",e.loadingGroups)}}function AddonCalendarEditEventPage_form_14_ng_container_24_Template(e,t){if(1&e){const e=j.RV6();j.qex(0),j.j41(1,"ion-item",9)(2,"ion-select",40),j.nI1(3,"translate"),j.nI1(4,"translate"),j.nI1(5,"translate"),j.bIt("ionChange",(function AddonCalendarEditEventPage_form_14_ng_container_24_Template_ion_select_ionChange_2_listener(){j.eBV(e);const t=j.XpG(2);return j.Njj(t.groupCourseSelected())})),j.j41(6,"p",11),j.EFF(7),j.nI1(8,"translate"),j.k0s(),j.DNE(9,AddonCalendarEditEventPage_form_14_ng_container_24_ion_select_option_9_Template,2,2,"ion-select-option",37),j.k0s()(),j.DNE(10,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_10_Template,5,3,"ion-item",41)(11,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_Template,9,16,"ion-item",42)(12,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_Template,3,1,"ion-item",21),j.bVm()}if(2&e){const e=j.XpG(2);j.R7$(2),j.Y8G("placeholder",j.bMT(3,9,"core.noselection"))("cancelText",j.bMT(4,11,"core.cancel"))("interfaceOptions",j.eq3(17,_c1,j.bMT(5,13,"core.course"))),j.R7$(4),j.Y8G("core-mark-required",!0),j.R7$(),j.JRh(j.bMT(8,15,"core.course")),j.R7$(2),j.Y8G("ngForOf",e.courses),j.R7$(),j.Y8G("ngIf",!e.loadingGroups&&e.courseGroupSet&&!e.groups.length),j.R7$(),j.Y8G("ngIf",!e.loadingGroups&&e.groups.length>0),j.R7$(),j.Y8G("ngIf",e.loadingGroups)}}function AddonCalendarEditEventPage_form_14_ng_container_25_ion_item_9_Template(e,t){if(1&e){const e=j.RV6();j.j41(0,"ion-item",9)(1,"ion-label")(2,"p"),j.EFF(3),j.k0s()(),j.j41(4,"ion-button",47),j.nI1(5,"translate"),j.bIt("click",(function AddonCalendarEditEventPage_form_14_ng_container_25_ion_item_9_Template_ion_button_click_4_listener(){const t=j.eBV(e).$implicit,n=j.XpG(3);return j.Njj(n.removeReminder(t))})),j.nrm(6,"ion-icon",50),j.k0s()()}if(2&e){const e=t.$implicit;j.R7$(3),j.JRh(e.label),j.R7$(),j.Y8G("ariaLabel",j.bMT(5,2,"core.delete"))}}function AddonCalendarEditEventPage_form_14_ng_container_25_Template(e,t){if(1&e){const e=j.RV6();j.qex(0),j.j41(1,"ion-item-divider",46)(2,"ion-label")(3,"p",25),j.EFF(4),j.nI1(5,"translate"),j.k0s()(),j.j41(6,"ion-button",47),j.nI1(7,"translate"),j.bIt("click",(function AddonCalendarEditEventPage_form_14_ng_container_25_Template_ion_button_click_6_listener(){j.eBV(e);const t=j.XpG(2);return j.Njj(t.addReminder())})),j.nrm(8,"ion-icon",48),j.k0s()(),j.DNE(9,AddonCalendarEditEventPage_form_14_ng_container_25_ion_item_9_Template,7,4,"ion-item",49),j.bVm()}if(2&e){const e=j.XpG(2);j.R7$(4),j.JRh(j.bMT(5,3,"addon.calendar.reminders")),j.R7$(2),j.Y8G("ariaLabel",j.bMT(7,5,"addon.calendar.setnewreminder")),j.R7$(3),j.Y8G("ngForOf",e.reminders)}}function AddonCalendarEditEventPage_form_14_ion_item_42_ng_template_4_Template(e,t){if(1&e&&(j.j41(0,"ion-datetime",52)(1,"span",33),j.EFF(2),j.nI1(3,"translate"),j.k0s()()),2&e){const e=j.XpG(3);j.Y8G("max",e.maxDate)("min",e.minDate)("showDefaultButtons",!0),j.R7$(2),j.JRh(j.bMT(3,4,"addon.calendar.durationuntil"))}}function AddonCalendarEditEventPage_form_14_ion_item_42_Template(e,t){1&e&&(j.j41(0,"ion-item"),j.nrm(1,"ion-label",13)(2,"ion-datetime-button",51),j.j41(3,"ion-modal",16),j.DNE(4,AddonCalendarEditEventPage_form_14_ion_item_42_ng_template_4_Template,4,6,"ng-template"),j.k0s()()),2&e&&(j.R7$(3),j.Y8G("keepContentsMounted",!0))}function AddonCalendarEditEventPage_form_14_ion_item_48_Template(e,t){1&e&&(j.j41(0,"ion-item"),j.nrm(1,"ion-input",53),j.nI1(2,"translate"),j.k0s()),2&e&&(j.R7$(),j.Y8G("placeholder",j.bMT(2,1,"addon.calendar.durationminutes")))}function AddonCalendarEditEventPage_form_14_ng_container_49_Template(e,t){if(1&e){const e=j.RV6();j.qex(0),j.j41(1,"ion-item",54)(2,"ion-checkbox",55),j.bIt("ionChange",(function AddonCalendarEditEventPage_form_14_ng_container_49_Template_ion_checkbox_ionChange_2_listener(){j.eBV(e);const t=j.XpG(2);return j.Njj(t.repeatChanged())})),j.j41(3,"p",25),j.EFF(4),j.nI1(5,"translate"),j.k0s()()(),j.j41(6,"ion-item",9),j.nrm(7,"ion-input",56),j.nI1(8,"translate"),j.k0s(),j.bVm()}2&e&&(j.R7$(4),j.JRh(j.bMT(5,2,"addon.calendar.repeatevent")),j.R7$(3),j.Y8G("label",j.bMT(8,4,"addon.calendar.repeatweeksl")))}function AddonCalendarEditEventPage_form_14_div_50_Template(e,t){if(1&e&&(j.j41(0,"div",22)(1,"ion-radio-group",57)(2,"ion-item-divider",24)(3,"ion-label")(4,"p",25),j.EFF(5),j.nI1(6,"translate"),j.k0s()()(),j.j41(7,"ion-item",9)(8,"ion-radio",26),j.EFF(9),j.nI1(10,"translate"),j.k0s()(),j.j41(11,"ion-item",9)(12,"ion-radio",26),j.EFF(13),j.nI1(14,"translate"),j.k0s()()()()),2&e){const e=j.XpG(2);j.R7$(5),j.JRh(j.bMT(6,5,"addon.calendar.repeatedevents")),j.R7$(3),j.Y8G("value",1),j.R7$(),j.SpI(" ",j.i5U(10,7,"addon.calendar.repeateditall",j.eq3(12,_c2,e.otherEventsCount))," "),j.R7$(3),j.Y8G("value",0),j.R7$(),j.SpI(" ",j.bMT(14,10,"addon.calendar.repeateditthis")," ")}}function AddonCalendarEditEventPage_form_14_Template(e,t){if(1&e&&(j.j41(0,"form",8,0)(2,"ion-item",9)(3,"ion-input",10),j.nI1(4,"translate"),j.j41(5,"div",11),j.EFF(6),j.nI1(7,"translate"),j.k0s()(),j.nrm(8,"core-input-errors",12),j.k0s(),j.j41(9,"ion-item",9)(10,"ion-label",13)(11,"label",14),j.EFF(12),j.nI1(13,"translate"),j.k0s()(),j.nrm(14,"ion-datetime-button",15),j.j41(15,"ion-modal",16),j.DNE(16,AddonCalendarEditEventPage_form_14_ng_template_16_Template,4,6,"ng-template"),j.k0s(),j.nrm(17,"core-input-errors",12),j.k0s(),j.j41(18,"ion-item",17),j.DNE(19,AddonCalendarEditEventPage_form_14_ion_label_19_Template,4,4,"ion-label",18)(20,AddonCalendarEditEventPage_form_14_p_20_Template,3,3,"p",19)(21,AddonCalendarEditEventPage_form_14_ion_select_21_Template,7,13,"ion-select",20),j.k0s(),j.DNE(22,AddonCalendarEditEventPage_form_14_ion_item_22_Template,9,16,"ion-item",21)(23,AddonCalendarEditEventPage_form_14_ion_item_23_Template,9,16,"ion-item",21)(24,AddonCalendarEditEventPage_form_14_ng_container_24_Template,13,19,"ng-container",18)(25,AddonCalendarEditEventPage_form_14_ng_container_25_Template,10,7,"ng-container",18),j.j41(26,"div",22)(27,"ion-radio-group",23)(28,"ion-item-divider",24)(29,"ion-label")(30,"p",25),j.EFF(31),j.nI1(32,"translate"),j.k0s()()(),j.j41(33,"ion-item")(34,"ion-radio",26),j.EFF(35),j.nI1(36,"translate"),j.k0s()(),j.j41(37,"ion-item")(38,"ion-radio",26)(39,"label",27),j.EFF(40),j.nI1(41,"translate"),j.k0s()()(),j.DNE(42,AddonCalendarEditEventPage_form_14_ion_item_42_Template,5,1,"ion-item",18),j.j41(43,"ion-item")(44,"ion-radio",26)(45,"label",28),j.EFF(46),j.nI1(47,"translate"),j.k0s()()(),j.DNE(48,AddonCalendarEditEventPage_form_14_ion_item_48_Template,3,3,"ion-item",18),j.k0s()(),j.DNE(49,AddonCalendarEditEventPage_form_14_ng_container_49_Template,9,6,"ng-container",18)(50,AddonCalendarEditEventPage_form_14_div_50_Template,15,14,"div",29),j.j41(51,"ion-item",9)(52,"ion-label",13)(53,"p",25),j.EFF(54),j.nI1(55,"translate"),j.k0s()(),j.nrm(56,"core-rich-text-editor",30),j.nI1(57,"translate"),j.nI1(58,"translate"),j.k0s(),j.j41(59,"ion-item",9),j.nrm(60,"ion-input",31),j.nI1(61,"translate"),j.nI1(62,"translate"),j.k0s()()),2&e){const e=j.XpG();j.Y8G("formGroup",e.form),j.R7$(3),j.Y8G("placeholder",j.bMT(4,36,"addon.calendar.eventname")),j.R7$(2),j.Y8G("core-mark-required",!0),j.R7$(),j.JRh(j.bMT(7,38,"addon.calendar.eventname")),j.R7$(2),j.Y8G("control",e.form.controls.name),j.R7$(3),j.Y8G("core-mark-required",!0),j.R7$(),j.JRh(j.bMT(13,40,"core.date")),j.R7$(3),j.Y8G("keepContentsMounted",!0),j.R7$(2),j.Y8G("control",e.form.controls.timestart),j.R7$(2),j.Y8G("ngIf",1===e.eventTypes.length),j.R7$(),j.Y8G("ngIf",1===e.eventTypes.length),j.R7$(),j.Y8G("ngIf",e.eventTypes.length>1),j.R7$(),j.Y8G("ngIf","category"===e.typeControl.value),j.R7$(),j.Y8G("ngIf","course"===e.typeControl.value),j.R7$(),j.Y8G("ngIf","group"===e.typeControl.value),j.R7$(),j.Y8G("ngIf",e.remindersEnabled&&!e.eventId),j.R7$(6),j.JRh(j.bMT(32,42,"addon.calendar.eventduration")),j.R7$(3),j.Y8G("value",0),j.R7$(),j.SpI(" ",j.bMT(36,44,"addon.calendar.durationnone")," "),j.R7$(3),j.Y8G("value",1),j.R7$(2),j.JRh(j.bMT(41,46,"addon.calendar.durationuntil")),j.R7$(2),j.Y8G("ngIf",1===e.form.controls.duration.value),j.R7$(2),j.Y8G("value",2),j.R7$(2),j.JRh(j.bMT(47,48,"addon.calendar.durationminutes")),j.R7$(2),j.Y8G("ngIf",2===e.form.controls.duration.value),j.R7$(),j.Y8G("ngIf",!e.eventId||e.eventId<0),j.R7$(),j.Y8G("ngIf",e.eventRepeatId),j.R7$(4),j.JRh(j.bMT(55,50,"core.description")),j.R7$(2),j.Y8G("control",e.descriptionControl)("placeholder",j.bMT(57,52,"core.description"))("component",e.component)("componentId",e.eventId)("autoSave",!1),j.BMQ("aria-label",j.bMT(58,54,"core.description")),j.R7$(4),j.Y8G("placeholder",j.bMT(61,56,"core.location"))("label",j.bMT(62,58,"core.location"))}}function AddonCalendarEditEventPage_div_15_Template(e,t){if(1&e){const e=j.RV6();j.j41(0,"div",58)(1,"div",59)(2,"ion-button",60),j.bIt("click",(function AddonCalendarEditEventPage_div_15_Template_ion_button_click_2_listener(){j.eBV(e);const t=j.XpG();return j.Njj(t.submit())})),j.EFF(3),j.nI1(4,"translate"),j.k0s()()()}if(2&e){const e=j.XpG();j.R7$(2),j.Y8G("disabled",!e.form.valid),j.R7$(),j.SpI(" ",j.bMT(4,2,"core.save")," ")}}let X=(()=>{var e;class AddonCalendarEditEventPage{constructor(e){this.fb=e,this.title="addon.calendar.newevent",this.component=I.QX,this.loaded=!1,this.hasOffline=!1,this.eventTypes=[],this.categories=[],this.courses=[],this.groups=[],this.loadingGroups=!1,this.courseGroupSet=!1,this.error=!1,this.otherEventsCount=0,this.remindersEnabled=!1,this.reminders=[],this.types={},this.showAll=!1,this.isDestroyed=!1,this.gotEventData=!1,this.currentSite=l.CoreSites.getRequiredCurrentSite(),this.remindersEnabled=R.CoreReminders.isEnabled(),this.form=new r.gE({}),this.typeControl=this.fb.control(null,r.k0.required),this.groupControl=this.fb.control(null),this.descriptionControl=this.fb.control("",{nonNullable:!0}),this.form.addControl("name",this.fb.control("",r.k0.required)),this.form.addControl("eventtype",this.typeControl),this.form.addControl("categoryid",this.fb.control("")),this.form.addControl("groupcourseid",this.fb.control("")),this.form.addControl("groupid",this.groupControl),this.form.addControl("description",this.descriptionControl),this.form.addControl("location",this.fb.control("")),this.form.addControl("duration",this.fb.control(0)),this.form.addControl("timedurationminutes",this.fb.control("")),this.form.addControl("repeat",this.fb.control(!1)),this.form.addControl("repeats",this.fb.control({value:"1",disabled:!0})),this.form.addControl("repeateditall",this.fb.control(1)),this.maxDate=s.j.getDatetimeDefaultMax(),this.minDate=s.j.getDatetimeDefaultMin()}ngOnInit(){this.eventId=C.CoreNavigator.getRouteNumberParam("eventId")||void 0,this.courseId=C.CoreNavigator.getRouteNumberParam("courseId")||0,this.title=this.eventId?"addon.calendar.editevent":"addon.calendar.newevent";const e=C.CoreNavigator.getRouteNumberParam("timestamp"),t=s.j.toDatetimeFormat(e);this.form.addControl("timestart",this.fb.control(t,r.k0.required)),this.form.addControl("timedurationuntil",this.fb.control(t)),this.form.addControl("courseid",this.fb.control(this.courseId)),this.initReminders(),this.fetchData().finally((()=>{this.originalData=c.j.clone(this.form.value),this.loaded=!0}))}fetchData(){var e=this;return(0,o.A)((function*(){e.error=!1;try{const[t,n]=yield Promise.all([_.AddonCalendar.getAllowedEventTypes(e.courseId),k.g.ignoreErrors(_.AddonCalendar.getAccessInformation(e.courseId),{canmanageentries:!1,canmanageownentries:!1,canmanagegroupentries:!1})]);e.types=t;const o=[],r=f.AddonCalendarHelper.getEventTypeOptions(e.types);if(!r.length)throw new E.CoreError(h.HT.instant("addon.calendar.nopermissiontoupdatecalendar"));e.eventId&&!e.gotEventData&&o.push(e.fetchEventData(e.eventId)),e.types.category&&o.push(e.fetchCategories()),e.showAll=c.j.isTrueOrOne(e.currentSite.getStoredConfig("calendar_adminseesall"))&&n.canmanageentries,(e.types.course||e.types.groups)&&o.push(e.fetchCourses()),yield Promise.all(o),e.typeControl.value||e.typeControl.setValue(e.types.course?I.rz.COURSE:r[0].value),e.eventTypes=r}catch(t){$.CoreAlerts.showError(t,{default:"Error getting data."}),e.error=!0}}))()}fetchEventData(e){var t=this;return(0,o.A)((function*(){let n;yield g.AddonCalendarSync.waitForSync(I.w),t.isDestroyed||d.CoreSync.blockOperation(I.QX,e);try{n=yield p.AddonCalendarOffline.getEvent(e),t.hasOffline=!0}catch{t.hasOffline=!1}if(e>0){const o=yield _.AddonCalendar.getEventById(e,t.hasOffline?{}:{readingStrategy:2,filter:!1});n=null!=n?n:o,t.eventRepeatId=null==o?void 0:o.repeatid,t.eventRepeatId&&(t.otherEventsCount=o.eventcount?o.eventcount-1:0)}t.gotEventData=!0,n&&(yield t.loadEventData(n,t.hasOffline))}))()}fetchCategories(){var e=this;return(0,o.A)((function*(){e.categories=yield m.CoreCourses.getCategories(0,!0)}))()}fetchCourses(){var e=this;return(0,o.A)((function*(){let t=yield e.showAll?m.CoreCourses.getCoursesByField():m.CoreCourses.getUserCourses();if(t.length<0)return e.courses=[],void 0;const n=function(){var e=(0,o.A)((function*(e){try{const t=yield v.CoreFilterHelper.getFiltersAndFormatText(e.fullname,"course",e.id);e.fullname=t.text}catch{}}));return function courseFillFullname(t){return e.apply(this,arguments)}}();if(e.showAll){const e=l.CoreSites.getCurrentSiteHomeId();t=("contacts"in t[0],t.filter((t=>t.id!=e)))}"contacts"in t[0],yield Promise.all(t.map(n)),e.courses=t.sort(((e,t)=>{const n=e.fullname.toLowerCase(),o=t.fullname.toLowerCase();return n.localeCompare(o)}))}))()}loadEventData(e,t){var n=this;return(0,o.A)((function*(){var o;if(!e)return;const r=e,a=e,i=t?r.courseid:null===(o=a.course)||void 0===o?void 0:o.id;n.form.controls.name.setValue(e.name),n.form.controls.timestart.setValue(s.j.toDatetimeFormat(1e3*e.timestart)),n.typeControl.setValue(e.eventtype),n.form.controls.categoryid.setValue(e.categoryid||""),n.form.controls.courseid.setValue(i||""),n.form.controls.groupcourseid.setValue(i||""),n.groupControl.setValue(e.groupid||null),n.form.controls.description.setValue(e.description),n.form.controls.location.setValue(e.location),t?(n.form.controls.duration.setValue(r.duration),n.form.controls.timedurationuntil.setValue(s.j.toDatetimeFormat(1e3*(r.timedurationuntil||0)||void 0)),n.form.controls.timedurationminutes.setValue(r.timedurationminutes||""),n.form.controls.repeat.setValue(!!r.repeat),n.form.controls.repeats.setValue(r.repeats||"1"),n.form.controls.repeateditall.setValue(r.repeateditall||1)):(a.timeduration>0?(n.form.controls.duration.setValue(1),n.form.controls.timedurationuntil.setValue(s.j.toDatetimeFormat(1e3*(a.timestart+a.timeduration)))):(n.form.controls.duration.setValue(0),n.form.controls.timedurationuntil.setValue(s.j.toDatetimeFormat())),n.form.controls.timedurationminutes.setValue(""),n.form.controls.repeat.setValue(!!a.repeatid),n.form.controls.repeats.setValue(a.eventcount||"1"),n.form.controls.repeateditall.setValue(1)),e.eventtype===I.rz.GROUP&&i&&(yield n.loadGroups(i))}))()}refreshData(e){const t=[_.AddonCalendar.invalidateAccessInformation(this.courseId),_.AddonCalendar.invalidateAllowedEventTypes(this.courseId)];this.types&&(this.types.category&&t.push(m.CoreCourses.invalidateCategories(0,!0)),(this.types.course||this.types.groups)&&t.push(this.showAll?m.CoreCourses.invalidateCoursesByField():m.CoreCourses.invalidateUserCourses())),Promise.all(t).finally((()=>{this.fetchData().finally((()=>{null==e||e.complete()}))}))}groupCourseSelected(){var e=this;return(0,o.A)((function*(){const t=e.form.controls.groupcourseid.value;if(!t)return;const n=yield G.CoreLoadings.show();try{yield e.loadGroups(t),e.groupControl.setValue(null)}catch(e){$.CoreAlerts.showError(e,{default:"Error getting data."})}n.dismiss()}))()}loadGroups(e){var t=this;return(0,o.A)((function*(){t.loadingGroups=!0;try{t.groups=yield i.CoreGroups.getUserGroupsInCourse(e),t.courseGroupSet=!0}finally{t.loadingGroups=!1}}))()}selectDuration(e){this.form.controls.duration.setValue(e)}submit(){var e=this;return(0,o.A)((function*(){const t=e.form.value,n=(0,T.yf)(t.timestart).unix(),o=(0,T.yf)(t.timedurationuntil).unix(),r=parseInt(t.timedurationminutes||"",10);let a;if((t.eventtype!==I.rz.COURSE||t.courseid)&&(t.eventtype!==I.rz.GROUP||t.groupcourseid)?t.eventtype!==I.rz.GROUP||t.groupid?t.eventtype!==I.rz.CATEGORY||t.categoryid?1===t.duration&&n>o?a="addon.calendar.invalidtimedurationuntil":2===t.duration&&(isNaN(r)||r<1)&&(a="addon.calendar.invalidtimedurationminutes"):a="core.selectacategory":a="core.selectagroup":a="core.selectacourse",a)return $.CoreAlerts.showError(h.HT.instant(a)),void 0;const i={name:t.name,eventtype:t.eventtype,timestart:n,description:{text:t.description||"",format:P.C9,itemid:0},location:t.location,duration:t.duration,repeat:t.repeat};t.eventtype===I.rz.COURSE?i.courseid=t.courseid:t.eventtype===I.rz.GROUP?(i.groupcourseid=t.groupcourseid,i.groupid=t.groupid):t.eventtype===I.rz.CATEGORY&&(i.categoryid=t.categoryid),1==t.duration?i.timedurationuntil=o:2==t.duration&&(i.timedurationminutes=t.timedurationminutes),t.repeat&&(i.repeats=Number(t.repeats)),e.eventRepeatId&&(i.repeatid=e.eventRepeatId,i.repeateditall=t.repeateditall);const l=yield G.CoreLoadings.show("core.sending",!0);let d;try{const n=yield _.AddonCalendar.submitEvent(e.eventId,i,{reminders:e.eventId?[]:e.reminders});if(d=n.event,b.R.triggerFormSubmittedEvent(e.formElement,n.sent,e.currentSite.getId()),n.sent){const o=t.repeat?t.repeats:i.repeateditall&&e.otherEventsCount?e.otherEventsCount+1:1;try{yield f.AddonCalendarHelper.refreshAfterChangeEvent(n.event,o)}catch{}}e.returnToList(d)}catch(a){$.CoreAlerts.showError(a,{default:"Error sending data."})}l.dismiss()}))()}returnToList(e){this.unblockSync(),this.eventId&&this.eventId>0?a.z.trigger(I.bp,{eventId:this.eventId},this.currentSite.getId()):a.z.trigger(I.zl,{eventId:e.id,oldEventId:this.eventId},this.currentSite.getId()),this.originalData=void 0,C.CoreNavigator.back()}canLeave(){var e=this;return(0,o.A)((function*(){return f.AddonCalendarHelper.hasEventDataChanged(e.form.value,e.originalData)&&(yield $.CoreAlerts.confirmLeaveWithChanges()),b.R.triggerFormCancelledEvent(e.formElement,e.currentSite.getId()),!0}))()}unblockSync(){this.eventId&&d.CoreSync.unblockOperation(I.QX,this.eventId)}initReminders(){var e=this;return(0,o.A)((function*(){if(!e.remindersEnabled||e.eventId)return;const t=yield R.CoreReminders.getDefaultNotificationTime(e.currentSite.getId());if(t===A.Nc)return;const n=R.CoreRemindersService.convertSecondsToValueAndUnit(t);e.reminders.push({value:n.value,unit:n.unit,label:R.CoreReminders.getUnitValueLabel(n.value,n.unit,!0)})}))()}addReminder(){var e=this;return(0,o.A)((function*(){const t=(0,T.yf)(e.form.value.timestart).unix(),{CoreRemindersSetReminderMenuComponent:o}=yield n.e(64260).then(n.bind(n,64260)),r=yield y.CorePopovers.open({component:o,componentProps:{eventTime:t}});if(void 0===r)return;const a=R.CoreRemindersService.convertSecondsToValueAndUnit(r.timeBefore);e.reminders.push({time:r.timeBefore,value:a.value,unit:a.unit,label:R.CoreReminders.getUnitValueLabel(a.value,a.unit)})}))()}removeReminder(e){const t=this.reminders.indexOf(e);-1!==t&&this.reminders.splice(t,1)}repeatChanged(){this.form.controls.repeat.value?this.form.controls.repeats.enable():this.form.controls.repeats.disable()}ngOnDestroy(){this.unblockSync(),this.isDestroyed=!0}}return(e=AddonCalendarEditEventPage).ɵfac=function AddonCalendarEditEventPage_Factory(t){return new(t||e)(j.rXU(r.ok))},e.ɵcmp=j.VBU({type:e,selectors:[["page-addon-calendar-edit-event"]],viewQuery:function AddonCalendarEditEventPage_Query(e,t){if(1&e&&(j.GBs(u.CoreEditorRichTextEditorComponent,5),j.GBs(B,5)),2&e){let e;j.mGM(e=j.lsd())&&(t.descriptionEditor=e.first),j.mGM(e=j.lsd())&&(t.formElement=e.first)}},standalone:!0,features:[j.aNF],decls:16,vars:13,consts:[["editEventForm",""],["slot","start"],[3,"text"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[3,"formGroup",4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],[3,"formGroup"],[1,"ion-text-wrap"],["labelPlacement","stacked","type","text","name","name","formControlName","name",3,"placeholder"],["slot","label",3,"core-mark-required"],[3,"control"],["position","stacked"],["for","timestart-button",1,"item-heading",3,"core-mark-required"],["datetime","timestart","id","timestart-button"],[3,"keepContentsMounted"],[1,"ion-text-wrap","addon-calendar-eventtype-container"],[4,"ngIf"],["slot","end",4,"ngIf"],["formControlName","eventtype","interface","action-sheet",3,"cancelText","interfaceOptions",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap","addon-calendar-radio-container"],["formControlName","duration"],[1,"addon-calendar-radio-title"],[1,"item-heading"],[3,"value"],["for","timedurationuntil-button"],["for","timedurationminutes"],["class","ion-text-wrap addon-calendar-radio-container",4,"ngIf"],["name","description",3,"control","placeholder","component","componentId","autoSave"],["type","text","name","location","labelPlacement","stacked","formControlName","location",3,"placeholder","label"],["id","timestart","formControlName","timestart","presentation","date-time",3,"max","min","showDefaultButtons"],["slot","title"],[1,"item-heading",3,"core-mark-required"],["slot","end"],["formControlName","eventtype","interface","action-sheet",3,"cancelText","interfaceOptions"],[3,"value",4,"ngFor","ngForOf"],["formControlName","categoryid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],["formControlName","courseid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],["formControlName","groupcourseid","interface","action-sheet",3,"ionChange","placeholder","cancelText","interfaceOptions"],["class","ion-text-wrap core-danger-item",4,"ngIf"],["class","ion-text-wrap core-edit-set-group",4,"ngIf"],[1,"ion-text-wrap","core-danger-item"],[1,"ion-text-wrap","core-edit-set-group"],["formControlName","groupid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],[1,"addon-calendar-reminders-title"],["fill","clear","slot","end",3,"click","ariaLabel"],["name","fas-plus","slot","icon-only","aria-hidden","true"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["name","fas-trash","color","danger","slot","icon-only","aria-hidden","true"],["datetime","timedurationuntil","id","timedurationuntil-button"],["id","timedurationuntil","formControlName","timedurationuntil","presentation","date-time",3,"max","min","showDefaultButtons"],["type","number","name","timedurationminutes","labelPlacement","start","id","timedurationminutes","formControlName","timedurationminutes",3,"placeholder"],[1,"ion-text-wrap","divider"],["labelPlacement","start","formControlName","repeat",3,"ionChange"],["labelPlacement","stacked","type","number","name","repeats","formControlName","repeats",3,"label"],["formControlName","repeateditall"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width","adaptable-buttons-row"],["expand","block","type","submit",1,"ion-margin","ion-text-wrap",3,"click","disabled"]],template:function AddonCalendarEditEventPage_Template(e,t){1&e&&(j.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),j.nrm(3,"ion-back-button",2),j.nI1(4,"translate"),j.k0s(),j.j41(5,"ion-title")(6,"h1"),j.EFF(7),j.nI1(8,"translate"),j.k0s()()()(),j.j41(9,"ion-content")(10,"ion-refresher",3),j.bIt("ionRefresh",(function AddonCalendarEditEventPage_Template_ion_refresher_ionRefresh_10_listener(e){return t.refreshData(e.target)})),j.nrm(11,"ion-refresher-content",4),j.nI1(12,"translate"),j.k0s(),j.j41(13,"core-loading",5),j.DNE(14,AddonCalendarEditEventPage_form_14_Template,63,60,"form",6)(15,AddonCalendarEditEventPage_div_15_Template,5,4,"div",7),j.k0s()()),2&e&&(j.R7$(3),j.Y8G("text",j.bMT(4,7,"core.back")),j.R7$(4),j.JRh(j.bMT(8,9,t.title)),j.R7$(3),j.Y8G("disabled",!t.loaded),j.R7$(),j.FS9("pullingText",j.bMT(12,11,"core.pulltorefresh")),j.R7$(2),j.Y8G("hideUntil",t.loaded),j.R7$(),j.Y8G("ngIf",!t.error),j.R7$(),j.Y8G("ngIf",t.loaded&&!t.error))},dependencies:[F.n,M.Sq,M.bT,r.qT,r.BC,r.cb,Y.Jm,Y.QW,Y.eY,Y.W9,Y.A9,Y.K4,Y.eU,Y.iq,Y.$w,Y.uz,Y.Dg,Y.he,Y.KO,Y.f0,Y.To,Y.Ki,Y.Nm,Y.Ip,Y.w2,Y.BC,Y.ai,Y.Sb,Y.hB,Y.su,Y.Je,Y.Gw,Y.el,r.j4,r.JD,D.q,x.R,O.j,N.t,w.i,S.i,V.T,q.E,J.D9,u.CoreEditorRichTextEditorComponent],styles:["[_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]::part(icon){display:none}"]}),AddonCalendarEditEventPage})()}}]);